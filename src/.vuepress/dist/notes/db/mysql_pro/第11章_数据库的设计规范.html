<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://Ragnarokoo.github.io/LearningNotes/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html"><meta property="og:site_name" content="📚全栈开发学习指南"><meta property="og:title" content="第11章_数据库的设计规范"><meta property="og:description" content="1.为什么需要数据库设计 image-20221127170346275 image-20221127170536364 2.范 式 2.1 范式简介 image-20221127170752919 2.2 范式都包括哪些 image-20221127171149489 image-20221127171744605 2.3 键和相关属性的概念 范式的..."><meta property="og:type" content="article"><meta property="og:image" content="https://Ragnarokoo.github.io/LearningNotes/"><meta property="og:updated_time" content="2023-05-31T09:16:41.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="第11章_数据库的设计规范"><meta property="article:tag" content="mysql"><meta property="article:tag" content="SQL"><meta property="article:tag" content="关系型数据库"><meta property="article:modified_time" content="2023-05-31T09:16:41.000Z"><link rel="icon" href="/site_logo.svg"><title>第11章_数据库的设计规范 | 📚全栈开发学习指南</title><meta name="description" content="1.为什么需要数据库设计 image-20221127170346275 image-20221127170536364 2.范 式 2.1 范式简介 image-20221127170752919 2.2 范式都包括哪些 image-20221127171149489 image-20221127171744605 2.3 键和相关属性的概念 范式的...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.bc8b6d7c.css" as="style" /><link rel="stylesheet" href="/assets/style.bc8b6d7c.css" />
    <link rel="modulepreload" href="/assets/app.9b10ba0a.js"><link rel="modulepreload" href="/assets/第11章_数据库的设计规范.html.9f171a4e.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/第11章_数据库的设计规范.html.b4050fe3.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/site_logo.svg" alt="📚全栈开发学习指南"><!----><span class="site-name hide-in-pad">📚全栈开发学习指南</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/quicknav/" class="nav-link" aria-label="快速导航"><span class="icon iconfont icon-navigation"></span>快速导航<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-blog"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/notes/" class="nav-link active" aria-label="Java学习教程"><span class="icon iconfont icon-java"></span>Java学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/web/" class="nav-link" aria-label="web学习教程"><span class="icon iconfont icon-note"></span>web学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/springcloud/" class="nav-link" aria-label="SpringCloud学习教程"><span class="icon iconfont icon-cache"></span>SpringCloud学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/distributed/" class="nav-link" aria-label="分布式微服务架构"><span class="icon iconfont icon-read"></span>分布式微服务架构<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="资源宝库"><span class="title"><span class="icon iconfont icon-advance"></span>资源宝库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/resources/books/" class="nav-link" aria-label="书籍资源"><span class="icon iconfont icon-animation"></span>书籍资源<!----></a></li><li class="dropdown-item"><a href="/resources/videos/" class="nav-link" aria-label="影音资源"><span class="icon iconfont icon-play"></span>影音资源<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Ragnarokoo/LearningNotes" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索本站" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java Language专栏</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-IO"></span><span class="title">Java网络编程NIO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-community"></span><span class="title">JDBC数据库连接技术</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-categoryselected"></span><span class="title">JavaWeb</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-array"></span><span class="title">SSM Framework</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-geometry"></span><span class="title">SpringData</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-type"></span><span class="title">SpringBoot</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-module"></span><span class="title">mybatisplus</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-operate"></span><span class="title">构建工具&amp;云原生Devops</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-mysql"></span><span class="title">数据库以及调优策略</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mysql"></span><span class="title">MYSQL基础篇学习专栏</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-mysql"></span><span class="title">MYSQL高级篇学习专栏</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC01%E7%AB%A0_Linux%E4%B8%8BMySQL%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="第 01 章_Linux下MySQL的安装与使用"><!---->第 01 章_Linux下MySQL的安装与使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2002%20%E7%AB%A0_MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95.html" class="nav-link sidebar-link sidebar-page" aria-label="第 02 章_MySQL的数据目录"><!---->第 02 章_MySQL的数据目录<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2003%20%E7%AB%A0_%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="第 03 章_用户与权限管理"><!---->第 03 章_用户与权限管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2004%20%E7%AB%A0_%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 04 章_逻辑架构"><!---->第 04 章_逻辑架构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2005%20%E7%AB%A0_%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" class="nav-link sidebar-link sidebar-page" aria-label="第 05 章_存储引擎"><!---->第 05 章_存储引擎<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2006%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 06 章_索引的数据结构"><!---->第 06 章_索引的数据结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2008%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99.html" class="nav-link sidebar-link sidebar-page" aria-label="第 08 章_索引的创建与设计原则"><!---->第 08 章_索引的创建与设计原则<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2009%20%E7%AB%A0_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="第 09 章_性能分析工具的使用"><!---->第 09 章_性能分析工具的使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2010%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96.html" class="nav-link sidebar-link sidebar-page" aria-label="第 10 章_索引优化与查询优化"><!---->第 10 章_索引优化与查询优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="第11章_数据库的设计规范"><!---->第11章_数据库的设计规范<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_1-为什么需要数据库设计" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.为什么需要数据库设计"><!---->1.为什么需要数据库设计<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-范-式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.范 式"><!---->2.范 式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-1-范式简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 范式简介"><!---->2.1 范式简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-2-范式都包括哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2 范式都包括哪些"><!---->2.2 范式都包括哪些<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-3-键和相关属性的概念" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 键和相关属性的概念"><!---->2.3 键和相关属性的概念<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-4-第一范式-1st-nf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4 第一范式(1st NF)"><!---->2.4 第一范式(1st NF)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-5-第二范式-2nd-nf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.5 第二范式(2nd NF)"><!---->2.5 第二范式(2nd NF)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-6-第三范式-3rd-nf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.6 第三范式(3rd NF)"><!---->2.6 第三范式(3rd NF)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-7-小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.7 小结"><!---->2.7 小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-反范式化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.反范式化"><!---->3.反范式化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-1-概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 概述"><!---->3.1 概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-2-应用举例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 应用举例"><!---->3.2 应用举例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-3-反范式的新问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 反范式的新问题"><!---->3.3 反范式的新问题<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-4-反范式的适用场景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4 反范式的适用场景"><!---->3.4 反范式的适用场景<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_4-bcnf-巴斯范式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. BCNF(巴斯范式)"><!---->4. BCNF(巴斯范式)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_5-第四范式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. 第四范式"><!---->5. 第四范式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_6-第五范式、域键范式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6. 第五范式、域键范式"><!---->6. 第五范式、域键范式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-实战案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7. 实战案例"><!---->7. 实战案例<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-1-迭代1次-考虑1nf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.1 迭代1次:考虑1NF"><!---->7.1 迭代1次:考虑1NF<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-2-迭代2次-考虑2nf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.2 迭代2次:考虑2NF"><!---->7.2 迭代2次:考虑2NF<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-3-迭代3次-考虑3nf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.3 迭代3次:考虑3NF"><!---->7.3 迭代3次:考虑3NF<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-4-反范式化-业务优先的原则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.4 反范式化:业务优先的原则"><!---->7.4 反范式化:业务优先的原则<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-er模型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8. ER模型"><!---->8. ER模型<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-1-er模型包括哪些要素" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.1 ER模型包括哪些要素?"><!---->8.1 ER模型包括哪些要素?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-2-关系的类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.2 关系的类型"><!---->8.2 关系的类型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-3-建模分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.3 建模分析"><!---->8.3 建模分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-4-er-模型的细化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.4 ER 模型的细化"><!---->8.4 ER 模型的细化<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-5-er-模型图转换成数据表" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.5 ER 模型图转换成数据表"><!---->8.5 ER 模型图转换成数据表<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_9-数据表的设计原则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9. 数据表的设计原则"><!---->9. 数据表的设计原则<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-数据库对象编写建议" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10. 数据库对象编写建议"><!---->10. 数据库对象编写建议<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-1-关于库" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.1 关于库"><!---->10.1 关于库<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-2-关于表、列" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.2 关于表、列"><!---->10.2 关于表、列<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-3-关于索引" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.3 关于索引"><!---->10.3 关于索引<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-4-sql编写" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.4 SQL编写"><!---->10.4 SQL编写<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC12%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E5%AE%83%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5.html" class="nav-link sidebar-link sidebar-page" aria-label="第12章_数据库其它调优策略"><!---->第12章_数据库其它调优策略<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC13%E7%AB%A0_%E4%BA%8B%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" class="nav-link sidebar-link sidebar-page" aria-label="第13章_事务基础知识"><!---->第13章_事务基础知识<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC14%E7%AB%A0_MySQL%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97.html" class="nav-link sidebar-link sidebar-page" aria-label="第14章_MySQL事务日志"><!---->第14章_MySQL事务日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC15%E7%AB%A0_%E9%94%81.html" class="nav-link sidebar-link sidebar-page" aria-label="第 15 章_锁"><!---->第 15 章_锁<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC16%E7%AB%A0_%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="第 16 章_多版本并发控制"><!---->第 16 章_多版本并发控制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC17%E7%AB%A0_%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97.html" class="nav-link sidebar-link sidebar-page" aria-label="第17章_其他数据库日志"><!---->第17章_其他数据库日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="第 18 章_主从复制"><!---->第 18 章_主从复制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC19%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D.html" class="nav-link sidebar-link sidebar-page" aria-label="第19章_数据库备份与恢复"><!---->第19章_数据库备份与恢复<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">Redis入门到精通</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">Redis大厂进阶篇</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-free"></span><span class="title">数据库优化策略</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-search"></span><span class="title">Elasticsearch7.x分布式搜索引擎</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-search"></span><span class="title">Elasticsearch8.x分布式搜索引擎</span><span class="arrow right"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-quote"></span><span class="title">消息中间件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tool"></span><span class="title">软件以及环境配置</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">Linux操作系统</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-rank"></span><span class="title">JUC高并发编程</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mount"></span><span class="title">深入了解Java虚拟机</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-view"></span><span class="title">GOF23种设计模式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tag"></span><span class="title">技术要点业务篇</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->第11章_数据库的设计规范</h1><div class="page-info"><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category4 clickable" role="navigation">mysql</span></li></ul><meta property="articleSection" content="mysql"></span><span aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag4 clickable" role="navigation">mysql</span></li><li><span class="tag tag3 clickable" role="navigation">SQL</span></li><li><span class="tag tag0 clickable" role="navigation">关系型数据库</span></li></ul><meta property="keywords" content="mysql,SQL,关系型数据库"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 51 分钟</span><meta property="timeRequired" content="PT51M"></span><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/Ragnarokoo/" target="_blank" rel="noopener noreferrer">Ragnarok</a></span><span property="author" content="Ragnarok"></span></span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-05-31T09:16:41.000Z"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_1-为什么需要数据库设计" class="router-link-active router-link-exact-active toc-link level2">1.为什么需要数据库设计</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-范-式" class="router-link-active router-link-exact-active toc-link level2">2.范 式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-1-范式简介" class="router-link-active router-link-exact-active toc-link level3">2.1 范式简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-2-范式都包括哪些" class="router-link-active router-link-exact-active toc-link level3">2.2 范式都包括哪些</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-3-键和相关属性的概念" class="router-link-active router-link-exact-active toc-link level3">2.3 键和相关属性的概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-4-第一范式-1st-nf" class="router-link-active router-link-exact-active toc-link level3">2.4 第一范式(1st NF)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-5-第二范式-2nd-nf" class="router-link-active router-link-exact-active toc-link level3">2.5 第二范式(2nd NF)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-6-第三范式-3rd-nf" class="router-link-active router-link-exact-active toc-link level3">2.6 第三范式(3rd NF)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_2-7-小结" class="router-link-active router-link-exact-active toc-link level3">2.7 小结</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-反范式化" class="router-link-active router-link-exact-active toc-link level2">3.反范式化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-1-概述" class="router-link-active router-link-exact-active toc-link level3">3.1 概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-2-应用举例" class="router-link-active router-link-exact-active toc-link level3">3.2 应用举例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-3-反范式的新问题" class="router-link-active router-link-exact-active toc-link level3">3.3 反范式的新问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_3-4-反范式的适用场景" class="router-link-active router-link-exact-active toc-link level3">3.4 反范式的适用场景</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_4-bcnf-巴斯范式" class="router-link-active router-link-exact-active toc-link level2">4. BCNF(巴斯范式)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_5-第四范式" class="router-link-active router-link-exact-active toc-link level2">5. 第四范式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_6-第五范式、域键范式" class="router-link-active router-link-exact-active toc-link level2">6. 第五范式、域键范式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-实战案例" class="router-link-active router-link-exact-active toc-link level2">7. 实战案例</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-1-迭代1次-考虑1nf" class="router-link-active router-link-exact-active toc-link level3">7.1 迭代1次:考虑1NF</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-2-迭代2次-考虑2nf" class="router-link-active router-link-exact-active toc-link level3">7.2 迭代2次:考虑2NF</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-3-迭代3次-考虑3nf" class="router-link-active router-link-exact-active toc-link level3">7.3 迭代3次:考虑3NF</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_7-4-反范式化-业务优先的原则" class="router-link-active router-link-exact-active toc-link level3">7.4 反范式化:业务优先的原则</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-er模型" class="router-link-active router-link-exact-active toc-link level2">8. ER模型</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-1-er模型包括哪些要素" class="router-link-active router-link-exact-active toc-link level3">8.1 ER模型包括哪些要素?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-2-关系的类型" class="router-link-active router-link-exact-active toc-link level3">8.2 关系的类型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-3-建模分析" class="router-link-active router-link-exact-active toc-link level3">8.3 建模分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-4-er-模型的细化" class="router-link-active router-link-exact-active toc-link level3">8.4 ER 模型的细化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_8-5-er-模型图转换成数据表" class="router-link-active router-link-exact-active toc-link level3">8.5 ER 模型图转换成数据表</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_9-数据表的设计原则" class="router-link-active router-link-exact-active toc-link level2">9. 数据表的设计原则</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-数据库对象编写建议" class="router-link-active router-link-exact-active toc-link level2">10. 数据库对象编写建议</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-1-关于库" class="router-link-active router-link-exact-active toc-link level3">10.1 关于库</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-2-关于表、列" class="router-link-active router-link-exact-active toc-link level3">10.2 关于表、列</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-3-关于索引" class="router-link-active router-link-exact-active toc-link level3">10.3 关于索引</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html#_10-4-sql编写" class="router-link-active router-link-exact-active toc-link level3">10.4 SQL编写</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="第11章-数据库的设计规范" tabindex="-1"><a class="header-anchor" href="#第11章-数据库的设计规范" aria-hidden="true">#</a> 第11章_数据库的设计规范</h1><h2 id="_1-为什么需要数据库设计" tabindex="-1"><a class="header-anchor" href="#_1-为什么需要数据库设计" aria-hidden="true">#</a> 1.为什么需要数据库设计</h2><p><img src="/assets/d973b6516196af32bc335099705bac68.364e07ab.png" alt="image-20221127170346275"></p><p><img src="/assets/23ee32aebc0827c0c87d8aa5f1b83b11.3bb27db2.png" alt="image-20221127170536364"></p><h2 id="_2-范-式" tabindex="-1"><a class="header-anchor" href="#_2-范-式" aria-hidden="true">#</a> 2.范 式</h2><h3 id="_2-1-范式简介" tabindex="-1"><a class="header-anchor" href="#_2-1-范式简介" aria-hidden="true">#</a> 2.1 范式简介</h3><p><img src="/assets/51629f5e72cb01284aa1e37c6cd97f69.5af7076d.png" alt="image-20221127170752919"></p><h3 id="_2-2-范式都包括哪些" tabindex="-1"><a class="header-anchor" href="#_2-2-范式都包括哪些" aria-hidden="true">#</a> 2.2 范式都包括哪些</h3><p><img src="/assets/767ebcf22af645cbba91403b01aa1d74.809595e6.png" alt="image-20221127171149489"></p><p><img src="/assets/e67e65a5c19ff1223ddd638a5d5a7c50.42494918.png" alt="image-20221127171744605"></p><h3 id="_2-3-键和相关属性的概念" tabindex="-1"><a class="header-anchor" href="#_2-3-键和相关属性的概念" aria-hidden="true">#</a> 2.3 键和相关属性的概念</h3><p>范式的定义会使用到主键和<a href="https://so.csdn.net/so/search?q=%E5%80%99%E9%80%89%E9%94%AE&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">候选键<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，数据库中的键(Key)由一个或者多个属性组成。数据表中常用的几种键和属性的定义:</p><ul><li><p><code>超键</code>︰能唯─标识元组的属性集叫做超键。</p></li><li><p><code>候选键</code>︰如果超键不包括多余的属性，那么这个超键就是候选键。·主键:用户可以从候选键中选择一个作为主键。</p></li><li><p><code>外键</code>∶如果数据表R1中的某属性集不是R1的主键，而是另一个数据表R2的主键，那么这个属性集就是数据表R1的外键。</p></li><li><p><code>主属性</code>:包含在任一候选键中的属性称为主属性。</p></li><li><p><code>非主属性</code>:与主属性相对，指的是不包含在任何一个候选键中的属性。</p></li></ul><p>通常，我们也将候选键称之为<code>“码”</code>，把主键也称为<code>“主码”</code>。因为键可能是由多个属性组成的，针对单个属性，我们还可以用主属性和非主属性来进行区分。</p><p><strong>举例，这里有两个表：</strong></p><p><code>球员表(player)</code>：球员编号 | 姓名 | 身份证号 | 年龄 | 球队编号</p><p><code>球队表(team)</code>：球队编号 | 主教练 | 球队所在地</p><ul><li><p><code>超键</code>：对于球员表来说，超键就是包括球员编号或者身份证号的任意组合，比如（球员编号）（球员编号，姓名）（身份证号，年龄）等。</p></li><li><p><code>候选键</code>：就是最小的超键，对于球员表来说，候选键就是（球员编号）或者（身份证号）。</p></li><li><p><code>主键</code>：我们自己选定，也就是从候选键中选择一个，比如（球员编号）。</p></li><li><p><code>外键</code>：球员表中的球队编号。</p></li><li><p><code>主属性</code>、<code>非主属性</code>：在球员表中，主属性是（球员编号）（身份证号），其他的属性（姓名）（年龄）（球队编号）都是非主属性。</p></li></ul><h3 id="_2-4-第一范式-1st-nf" tabindex="-1"><a class="header-anchor" href="#_2-4-第一范式-1st-nf" aria-hidden="true">#</a> 2.4 <a href="https://so.csdn.net/so/search?q=%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">第一范式<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>(1st NF)</h3><p>第一范式主要是确保数据表中每个字段的值必须具有<a href="https://so.csdn.net/so/search?q=%E5%8E%9F%E5%AD%90%E6%80%A7&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">原子性<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，也就是说数据表中每个字段的值为不可再次拆分的最小数据单位。</p><p>我们在设计某个字段的时候，对于字段×来说，不能把字段×拆分成字段X_1和字段X_2。事实上，任何的DBMS都会满足第一范式的要求，不会将字段进行拆分。</p><p><strong>举例一：</strong></p><p><img src="/assets/3dcb17909a06a92796ed4af90c17be86.f58f1c42.png" alt="image-20221127173416188"></p><p><strong>举例二：</strong></p><p><img src="/assets/1fa1d444c09701089967fc02ea7ea03c.465375ff.png" alt="image-20221127173605845"></p><p><strong>举例三</strong></p><p><img src="/assets/04c7a0d2a22b2147760a9c2d3f2d7efa.731f5e1c.png" alt="image-20221127174218098"></p><p><img src="/assets/01b55bbf7c7e82f544b3a88236eb9932.3935e583.png" alt="image-20221127174259078"></p><h3 id="_2-5-第二范式-2nd-nf" tabindex="-1"><a class="header-anchor" href="#_2-5-第二范式-2nd-nf" aria-hidden="true">#</a> 2.5 第二范式(2nd NF)</h3><p>第二范式要求，在满足第一范式的基础上，还要==满足数据表里的每一条数据记录，都是可唯一标识的（也就是一定有主键）。而且所有非主键字段，都必须完全依赖主键，不能只依赖主键的一部分。==如果知道主键的所有属性的值，就可以检索到任何元组（行）的任何属性的任何值。(要求中的主键，其实可以拓展替换为候选键)</p><p>另外 第二范式只能完全函数依赖，不能部分函数依赖</p><p><strong>举例1：</strong></p><p>成绩表 （学号，课程号，成绩）关系中，（学号，课程号）可以决定成绩，但是学号不能决定成绩，课程号也不能决定成绩，所以“<code>（学号，课程号）→成绩</code>”就是 完全依赖关系 。</p><p><strong>举例2：</strong></p><p><code>比赛表 player_game</code>，里面包含球员编号、姓名、年龄、比赛编号、比赛时间和比赛场地等属性，这里候选键和主键都为（球员编号，比赛编号），我们可以通过候选键（或主键）来决定如下的关系：</p><blockquote><p>(球员编号, 比赛编号) → (姓名, 年龄, 比赛时间, 比赛场地，得分)</p></blockquote><p>但是这个数据表不满足第二范式，因为数据表中的字段之间还存在着如下的对应关系：</p><blockquote><p>姓名和年龄部分依赖球员编号。</p><p>⭐️(球员编号) → (姓名，年龄)</p><p>比赛时间, 比赛场地部分依赖(球员编号, 比赛编号)。</p><p>⭐️(比赛编号) → (比赛时间, 比赛场地)</p></blockquote><p><strong>对于非主属性来说，并非完全依赖候选键。这样会产生怎样的问题呢？(为什么要满足2NF)</strong></p><ol><li><p><code>数据冗余</code>： 如果一个球员可以参加 m 场比赛，那么球员的姓名和年龄就重复了 m-1 次。一个比赛也可能会有 n 个球员参加，比赛的时间和地点就重复了 n-1 次。</p></li><li><p><code>插入异常</code>： 如果我们想要添加一场新的比赛，但是这时还没有确定参加的球员都有谁，那么就没法插入。</p></li><li><p><code>删除异常</code>： 如果我要删除某个球员编号，如果没有单独保存比赛表的话，就会同时把比赛信息删除掉。</p></li><li><p><code>更新异常</code>： 如果我们调整了某个比赛的时间，那么数据表中所有这个比赛的时间都需要进行调整，否则就会出现一场比赛时间不同的情况。</p></li></ol><p>为了避免出现上述的情况，我们可以把球员比赛表设计为下面的三张表。</p><table><thead><tr><th>表名</th><th>属性（字段）</th></tr></thead><tbody><tr><td>球员 player 表</td><td>球员编号、姓名和年龄等属性</td></tr><tr><td>比赛 game 表</td><td>比赛编号、比赛时间和比赛场地等属性</td></tr><tr><td>球员比赛关系 player_game 表</td><td>球员编号、比赛编号和得分等属性</td></tr></tbody></table><p>这样的话，每张数据表都符合第二范式，也就避免了异常情况的发生。</p><blockquote><p>1NF告诉我们字段属性需要是原子性的，而2NF告诉我们一张表就是一个独立的对象，一张表只表达一个意思</p></blockquote><p><strong>举例三</strong></p><p><img src="/assets/a58107b435d43ee98631a08e4b17c2fb.01fb12a8.png" alt="image-20221127193808695"></p><blockquote><p>小结: 第二范式(2NF）要求实体的属性完全依赖主关键字。如果存在不完全依赖，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与元实体之间是一对多的关系。</p></blockquote><h3 id="_2-6-第三范式-3rd-nf" tabindex="-1"><a class="header-anchor" href="#_2-6-第三范式-3rd-nf" aria-hidden="true">#</a> 2.6 第三范式(3rd NF)</h3><p>第三范式是在第二范式的基础上，确保数据表中的每一个非主键字段都和主键字段直接相关，也就是说，要求数据表中的所有非主键字段不能依赖于其他非主键字段。（即，不能存在非主属性A依赖于非主属性B，非主属性B依赖于主键C的情况，即存在&quot;A–&gt;B–&gt;C&quot;的决定关系）通俗地讲，该规则的意思是所有<code>非主键属性</code>之间不能有传递依赖关系，必须<code>相互独立</code>。（这里的主键可以拓展为候选键）</p><p><strong>举例一</strong></p><p><code>部门信息表</code> ：每个部门有部门编号（dept_id）、部门名称、部门简介等信息。</p><p><code>员工信息表</code> ：每个员工有员工编号、姓名、部门编号。列出部门编号后就不能再将部门名称、部门简介等与部门有关的信息再加入员工信息表中。(因为会存在传递依赖，也就会导致4种不合理地方)</p><p>如果不存在部门信息表，则根据第三范式（3NF）也应该构建它，否则就会有大量的数据冗余。</p><p><strong>举例二</strong></p><p><img src="/assets/0913756b0c44e73e9bccd1a27c348faa.6fd17046.png" alt="image-20221127200525576"></p><p><img src="/assets/b8bdf35ee17952b17fa37dba306a29af.92793807.png" alt="image-20221127200454347"></p><p><strong>举例三</strong></p><p><img src="/assets/803af25acb9ba472459d236c467277fb.ccb6f5ca.png" alt="image-20221127200701162"></p><table><thead><tr><th>表名</th><th>属性（字段）</th></tr></thead><tbody><tr><td>球队表</td><td>球员编号、姓名和球队名称</td></tr><tr><td>球员表</td><td>球队名称、球队主教练</td></tr></tbody></table><p><strong>举例四</strong></p><p><img src="/assets/0dfccb62c8c4c42877809c714fdcc87d.05e0413d.png" alt="image-20221127201249899"></p><blockquote><p>符合3NF后的数据模型通俗地讲，2NF和3NF通常以这句话概括:“每个非键属性依赖于键，依赖于整个键，并且除了键别无他物”。</p></blockquote><h3 id="_2-7-小结" tabindex="-1"><a class="header-anchor" href="#_2-7-小结" aria-hidden="true">#</a> 2.7 小结</h3><p>关于数据表的设计，有三个范式要遵循。</p><p>（1）第一范式（1NF），确保每列保持<code>原子性</code></p><p>数据库的每一列都是不可分割的原子数据项，不可再分的最小数据单元，而不能是集合、数组、记录等非原子数据项。</p><p>（2）第二范式（2NF），确保每列都和主键<code>完全依赖</code></p><p>尤其在复合主键的情况向下，非主键部分不应该依赖于部分主键。</p><p>（3）第三范式（3NF），确保每列都和主键<code>直接相关</code>，而不是间接相关</p><p>**范式的优点：**数据的标准化有助于消除数据库中的<code>数据冗余</code>，第三范式（3NF）通常被认为在性能、拓展性和数据完整性方面达到了最好的平衡。</p><p>**范式的缺点：**范式的使用，可能<code>降低查询的效率</code>。因为范式等级越高，设计出来的数据表就越多、越精细，数据的冗余度就越低，进行数据查询的时候就可能需要<code>关联多张表</code>，这不但代价昂贵，也可能使一些<code>索引策略无效</code>。</p><p>范式只是提出了设计的标准，实际上设计数据表时，未必一定要符合这些标准。开发中，我们会出现为了性能和读取效率违反范式化的原则，通过<code>增加少量的冗余</code>或重复的数据来提高数据库的<code>读性能</code>，减少关联查询，join表的次数，实现<code>空间换取时间</code>的目的。因此在实际的设计过程中要理论结合实际，灵活运用。</p><blockquote><p>范式本身没有优劣之分，只有适用场景不同。没有完美的设计，只有合适的设计，我们在数据表的设计中，还需要根据需求将范式和反范式混合使用。</p></blockquote><h2 id="_3-反范式化" tabindex="-1"><a class="header-anchor" href="#_3-反范式化" aria-hidden="true">#</a> 3.反范式化</h2><h3 id="_3-1-概述" tabindex="-1"><a class="header-anchor" href="#_3-1-概述" aria-hidden="true">#</a> 3.1 概述</h3><p>有的时候不能简单按照规范要求设计数据表，因为有的数据看似穴余，其实对业务来说十分重要。这个时候，我们就要遵循<code>业务优先</code>的原则，首先满足业务需求，再尽量减少冗余。</p><p>如果数据库中的数据量比较大，系统的UV和PV访问频次比较高，则完全按照MySQL的三大范式设计数据表，读数据时会产生大量的关联查询，在一定程度上会影响数据库的读性能。如果我们想对查询效率进行优化，反范式化也是一种优化思路。此时，可以通过在数据表中增加冗余字段来提高数据库的读性能。</p><p><strong>规范化 vs 性能</strong></p><blockquote><ol><li>为满足某种商业目标 , 数据库性能比规范化数据库更重要</li><li>在数据规范化的同时 , 要综合考虑数据库的性能</li><li>通过在给定的表中添加额外的字段，以大量减少需要从中搜索信息所需的时间</li><li>通过在给定的表中插入计算列，以方便查询</li></ol></blockquote><h3 id="_3-2-应用举例" tabindex="-1"><a class="header-anchor" href="#_3-2-应用举例" aria-hidden="true">#</a> 3.2 应用举例</h3><p><strong>举例一</strong></p><p>员工的信息存储在 <code>employees</code> 表 中，部门信息存储在 <code>departments</code> 表 中。通过 employees 表中的department_id字段与 departments 表建立关联关系。如果要查询一个员工所在部门的名称：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> employee_id<span class="token punctuation">,</span>department_name
<span class="token keyword">from</span> employees e <span class="token keyword">join</span> departments d
<span class="token keyword">on</span> e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果经常需要进行这个操作，连接查询就会浪费很多时间。可以在 employees 表中增加一个冗余字段department_name，这样就不用每次都进行连接操作了。</p><p><strong>举例二：</strong></p><p><img src="/assets/81aba5cede27427847a57855a02bdd38.838c5c39.png" alt="image-20221127203136246"></p><p><strong>举例三</strong></p><p><img src="/assets/0aaa68fd229435ffb86782936c019153.464e7f42.png" alt="image-20221127203343257"></p><p><img src="/assets/f8a56000bbb1b8d9f7ac6495b439fb4a.2a5907b0.png" alt="image-20221127203421605"></p><p><strong>举例四</strong></p><p><img src="/assets/96fdf45e7bde348e5409f6a6b2a5ee30.d837b1ec.png" alt="image-20221127203526841"></p><p><strong>实验数据：模拟两张百万量级的数据表</strong></p><p>为了更好地进行 SQL 优化实验，我们需要给学生表和课程评论表随机模拟出百万量级的数据。我们可以通过存储过程来实现模拟数据。</p><ul><li><strong>创建表：</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> atguigudb3<span class="token punctuation">;</span>

<span class="token keyword">USE</span> atguigudb3<span class="token punctuation">;</span>

<span class="token comment">#学生表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student<span class="token punctuation">(</span>
  stu_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span> ， stu_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> ， create_time <span class="token keyword">DATETIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#课程评论表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> class_comment<span class="token punctuation">(</span>
  comment_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span> ， class_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
  comment_text <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span> ， comment_time <span class="token keyword">DATETIME</span> ， stu_id <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>创建存储过程</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">###创建向学生表中添加数据的存储过程</span>
<span class="token keyword">DELIMITER</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> batch_insert_student<span class="token punctuation">(</span><span class="token operator">IN</span> <span class="token keyword">START</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">IN</span> max_num <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> date_start <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token punctuation">(</span><span class="token string">&#39;2017-01-01 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> date_temp <span class="token keyword">DATETIME</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> date_temp <span class="token operator">=</span> date_start<span class="token punctuation">;</span>
<span class="token keyword">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">REPEAT</span>
<span class="token keyword">SET</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> date_temp <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>date_temp<span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> RAND<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">60</span> <span class="token keyword">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student<span class="token punctuation">(</span>stu_id<span class="token punctuation">,</span> stu_name<span class="token punctuation">,</span>create_time<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">START</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> CONCAT <span class="token punctuation">(</span><span class="token string">&#39;stu_&#39;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> date_temp<span class="token punctuation">)</span> <span class="token punctuation">;</span>
UNTIL i <span class="token operator">=</span> max_num
<span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>


<span class="token comment">###创建向课程评论表中添加数据的存储过程</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> batch_insert_class_comments<span class="token punctuation">(</span><span class="token operator">IN</span> <span class="token keyword">START</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">IN</span> max_num <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> date_start <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token punctuation">(</span><span class="token string">&#39;2018-01-01 00:00:00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> date_temp <span class="token keyword">DATETIME</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> comment_text <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> stu_id <span class="token keyword">INT</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> date_temp <span class="token operator">=</span> date_start<span class="token punctuation">;</span>
<span class="token keyword">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">REPEAT</span>
<span class="token keyword">SET</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> date_temp <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>date_temp<span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> RAND<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">60</span> <span class="token keyword">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> comment_text<span class="token operator">=</span>SUBSTR<span class="token punctuation">(</span>MD5<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> stu_id<span class="token operator">=</span>FLOOR<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>class_comment<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>comment_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>class_id<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>comment_text<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>comment_time<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>stu_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">START</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span>comment_text<span class="token punctuation">,</span>date_temp<span class="token punctuation">,</span>stu_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
UNTIL i <span class="token operator">=</span> max_num
<span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>调用存储过程</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#调用存储过程,学生id从10001开始，添加1000000条数据</span>
<span class="token keyword">CALL</span> batch_insert_student<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">1000000</span><span class="token punctuation">)</span>

<span class="token comment">#添加数据的过程的调用，一个1000000条数据</span>
<span class="token keyword">CALL</span> batch_insert_class_comments<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#######</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span><span class="token comment">#1000000</span>

<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> class_comment<span class="token punctuation">;</span><span class="token comment">#1000000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>测试</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">###需求####</span>
<span class="token comment">#0.050</span>
<span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>comment_text<span class="token punctuation">,</span> p<span class="token punctuation">.</span>comment_time<span class="token punctuation">,</span> stu<span class="token punctuation">.</span>stu_name
<span class="token keyword">FROM</span> class_comment <span class="token keyword">AS</span> p <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> student <span class="token keyword">AS</span> stu
<span class="token keyword">ON</span> p<span class="token punctuation">.</span>stu_id <span class="token operator">=</span> stu<span class="token punctuation">.</span>stu_id
<span class="token keyword">WHERE</span> p<span class="token punctuation">.</span>class_id <span class="token operator">=</span> <span class="token number">10001</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> p<span class="token punctuation">.</span>comment_id <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">10000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行时长为 0.050 秒，对于网站的响应来说，这已经很慢了，用户体验会非常差。</p><p>如果我们想要提升查询的效率，可以允许适当的数据冗余，也就是在商品评论表中增加用户昵称字段，在 class_comment 数据表的基础上增加 stu_name 字段，就得到了 class_comment2 数据表。</p><ul><li><strong>反范式优化实验对比</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">####进行反范式化的设计#####</span>
<span class="token comment">#表的复制</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> class_comment1
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> class_comment<span class="token punctuation">;</span>

<span class="token comment">#添加主键，保证class_comment1与class_comment的结构相同</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> class_comment1
<span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>comment_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> class_comment1<span class="token punctuation">;</span>

<span class="token comment">#向课程评论表中增加stu_name字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> class_comment1
<span class="token keyword">ADD</span> stu_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#给新添加的字段赋值</span>
<span class="token keyword">UPDATE</span> class_comment1 c
<span class="token keyword">SET</span> stu_name<span class="token operator">=</span><span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> stu_name
<span class="token keyword">FROM</span> student s
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>stu_id<span class="token operator">=</span>s<span class="token punctuation">.</span>stu_id
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>如果我们想要查询课程 ID 为 10001 的前 10000 条评论，需要写成下面这样：</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#查询同样的需求</span>
<span class="token comment">#0.020</span>
<span class="token keyword">SELECT</span> comment_text<span class="token punctuation">,</span> comment_time<span class="token punctuation">,</span> stu_name
<span class="token keyword">FROM</span> class_comment1
<span class="token keyword">WHERE</span> class_id <span class="token operator">=</span> <span class="token number">10001</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> class_id <span class="token keyword">DESC</span> 
<span class="token keyword">LIMIT</span> <span class="token number">10000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>优化之后只需要扫描一次聚集索引即可，运行时间为 0.020 秒，查询时间是之前的 1/2。 你能看到，在数据量大的情况下，查询效率会有显著的提升。</p><h3 id="_3-3-反范式的新问题" tabindex="-1"><a class="header-anchor" href="#_3-3-反范式的新问题" aria-hidden="true">#</a> 3.3 反范式的新问题</h3><ul><li><p>存储<code>空间变大</code>了</p></li><li><p>一个表中字段做了修改，另一个表中冗余的字段也需要做同步修改，否则<code>数据不一致</code></p></li><li><p>若采用存储过程来支持数据的更新、删除等额外操作，如果更新频繁，会非常<code>消耗系统资源</code></p></li><li><p>在<code>数据量小</code>的情况下，反范式不能体现性能的优势，可能还会让数据库的设计更加<code>复杂</code></p></li></ul><h3 id="_3-4-反范式的适用场景" tabindex="-1"><a class="header-anchor" href="#_3-4-反范式的适用场景" aria-hidden="true">#</a> 3.4 反范式的适用场景</h3><p>当冗余信息有价值或者能<code>大幅度提高查询效率</code>的时候，我们才会采取反范式的优化。</p><ol><li>增加冗余字段的建议</li></ol><p>1）这个冗余字段<code>不需要经常进行修改</code></p><p>2）这个冗余字段<code>查询的时候不可或缺</code> (因为经常要用，所以才增加该冗余字段)</p><ol start="2"><li>历史快照、历史数据的需要</li></ol><p>在现实生活中，我们经常需要一些冗余信息，比如订单中的收货人信息，包括姓名、电话和地址等。每次发生的<code>订单收货信息</code>都属于<code>历史快照</code>，需要进行保存，但用户可以随时修改自己的信息，这时保存这些冗余信息是非常有必要的。</p><p>反范式优化也常用在<code>数据仓库</code>的设计中，因为数据仓库通常<code>存储历史数据</code>，对增删改的实时性要求不强，对历史数据的分析需求强。这时适当允许数据的冗余度，更方便进行数据分析。</p><blockquote><p><strong>简单总结下数据仓库和数据库在使用上的区别:</strong></p><ol><li>数据库设计的目的在于<code>捕获数据</code>，而数据仓库设计的目的在于<code>分析数据</code>；</li><li>数据库对数据的<code>增删改实时性</code>要求强，需要存储在线的用户数据，而数据仓库存储的一般是<code>历史数据</code>;</li><li>数据库设计需要<code>尽量避免冗余</code>，但为了提高查询效率也允许一定的<code>冗余度</code>，而数据仓库在设计上更偏向采用反范式设计</li></ol></blockquote><p>==注意：==我们的反范式 反的是第二 或 第三范式，第一范式是一定要遵守的哦~</p><h2 id="_4-bcnf-巴斯范式" tabindex="-1"><a class="header-anchor" href="#_4-bcnf-巴斯范式" aria-hidden="true">#</a> 4. BCNF(巴斯范式)</h2><p>人们在3NF的基础上进行了改进，提出了<strong>巴斯范式(BCNF)</strong>，也叫做<strong>巴斯-科德范式(Boyce-Codd NormalForm)</strong>。BCNF被认为没有新的设计规范加入，只是对第三范式中设计规范要求更强，使得数据库冗余度更小。所以，称为是<code>修正的第三范式</code>，或<code>扩充的第三范式</code>，BCNF不被称为第四范式</p><p>若一个关系达到了第三范式，并且它只有一个候选键，或者它的每个候选键都是单属性，则该关系自然达到BC范式。</p><p>一般来说，一个数据库设计符合3NF或BCNF就可以了</p><p><strong>1、案例</strong></p><p>我们分析如下表的范式情况:</p><p><img src="/assets/f5ede97fbd0063ab983e096ed36e63d5.c89c9812.png" alt="image-20221221211602267"></p><p>在这个表中，一个仓库只有一个管理员，同时一个管理员也只管理一个仓库。先来梳理下这些属性之间的依赖关系。</p><p>仓库名决定了管理员，管理员也决定了仓库名，同时（仓库名，物品名）的属性集合可以决定数量这个属性。这样，我们就可以找到数据表的候选键。</p><p><code>候选键</code> ：是（管理员，物品名）和（仓库名，物品名），然后从候选键中选择一个作为 主键 ，比如（仓库名，物品名）。</p><p><code>主属性</code> ：包含在任一候选键中的属性，也就是仓库名，管理员和物品名。</p><p><code>非主属性</code> ：数量这个属性</p><p><strong>2、是否符合三范式</strong> 如何判断一张表的范式呢？需要根据范式的等级，从低到高来进行判断</p><ul><li>首先，数据表每个属性都是原子性的，符合 1NF 的要求；</li><li>其次，数据表中非主属性”数量“都与候选键全部依赖，（</li><li>仓库名，物品名）决定数量，（管理员，物品名）决定数量。因此，数据表符合 2NF 的要求；</li><li>最后，数据表中的非主属性，不传递依赖于候选键。因此符合 3NF 的要求。</li></ul><p><strong>3、存在的问题</strong> 既然数据表已经符合了 3NF 的要求，是不是就不存在问题了呢？来看下面的情况：</p><ol><li>增加一个仓库，但是还没有存放任何物品。根据数据表实体完整性的要求，主键不能有空值，因此会出现插入异常 ；</li><li>如果仓库更换了管理员，就可能会 修改数据表中的多条记录 ；</li><li>如果仓库里的商品都卖空了，那么此时仓库名称和相应的管理员名称也会随之被删除。</li></ol><p>你能看到，即便数据表符合 3NF 的要求，同样可能存在插入，更新和删除数据的异常情况</p><p><strong>4、问题解决</strong></p><p>首先需要确认造成异常的原因：主属性仓库名对于候选键（管理员，物品名）是部分依赖的关系，这样就有可能导致上面的异常情况。因此引入BCNF，它在 3NF 的基础上消除了主属性对候选键的部分依赖或者传递依赖关系。</p><p>如果在关系R中，U为主键，A属性是主键的一个属性，若存在A-&gt;Y，Y为主属性(也就是非候选码中的属性)，则该关系不属于BCNF。</p><p>根据 BCNF 的要求，需要把仓库管理关系 warehouse_keeper 表拆分成下面这样：</p><ul><li><code>仓库表</code> ：（仓库名，管理员）</li><li><code>库存表</code> ：（仓库名，物品名，数量）</li></ul><p>这样就不存在主属性对于候选键的部分依赖或传递依赖，上面数据表的设计就符合 BCNF。</p><p><strong>再举例：</strong></p><p>有一个 学生导师表，其中包含字段：学生ID，专业，导师，专业GPA，这其中学生ID和专业是联合主键。</p><p><img src="/assets/5abf09564cd21171a2d0cd9bc3c1f8b3.205a3bec.png" alt="image-20221221214347478"></p><p>这个表的设计满足三范式，但是这里存在另一个依赖关系，“专业”依赖于“导师”，也就是说每个导师只做一个专业方面的导师，只要知道了是哪个导师，自然就知道是哪个专业的了。</p><p>所以这个表的部分主键Major依赖于非主键属性Advisor，那么我们可以进行以下的调整，拆分成2个表：</p><p>学生导师表：</p><p><img src="/assets/c3262a559c2fe5e48ebcd44cb8a8d41d.512668db.png" alt="image-20221221214511430"></p><p>导师表：</p><p><img src="/assets/1fac370f2f141210cbd4746055108f48.f660b08d.png" alt="image-20221221214533669"></p><h2 id="_5-第四范式" tabindex="-1"><a class="header-anchor" href="#_5-第四范式" aria-hidden="true">#</a> 5. 第四范式</h2><p>多值依赖的概念:</p><ul><li><p><code>多值依赖</code>即属性之间的一对多关系，记为K→→A</p></li><li><p><code>函数依赖</code>事实上是单值依赖，所以不能表达属性值之间的一对多关系</p></li><li><p><code>平凡的多值依赖</code>∶全集U=K+A，一个K可以对应于多个A，即K→→A。此时整个表就是一组一对多关系</p></li><li><p><code>非平凡的多值依赖</code>︰全集U=K+A+B，一个K可以对应于多个A，也可以对应于多个B，A与B互相独立，即K→→A，K→→B。整个表有多组一对多关系，且有：“一&quot;部分是相同的属性集合，“多”&quot;部分是互相独立的属性集合</p></li></ul><p>第四范式即在满足巴斯-科德范式(BCNF）的基础上，消除非平凡且非函数依赖的多值依赖（即把同一表内的多对多关系删除)</p><p><strong>举例1：</strong></p><p>职工表(职工编号，职工孩子姓名，职工选修课程)。</p><p>在这个表中，同一个职工可能会有多个职工孩子姓名。同样，同一个职工也可能会有多个职工选修课程，即这里存在着多值事实，不符合第四范式。</p><p>如果要符合第四范式，只需要将上表分为两个表，使它们只有一个多值事实，例如： <code>职工表一 (职工编号，职工孩子姓名)</code>，<code>职工表二 (职工编号，职工选修课程)</code>，两个表都只有一个多值事实，所以符合第四范式</p><p><strong>举例2：</strong></p><p>比如建立课程、教师、教材的模型。我们规定，每门课程有对应的一组教师，每门课程也有对应的一组教材，一门课程使用的教材和教师没有关系。我们建立的关系表如下：</p><p>课程ID，教师ID，教材ID；这三列作为联合主键。</p><p>为了表述方便，我们用Name代替ID，这样更容易看懂：</p><p><img src="/assets/2fbd950a5b1a450757afe82e8832b9d7.dde31f18.png" alt="image-20221221215720852"></p><p>这个表除了主键，就没有其他字段了，所以肯定满足BC范式，但是却存在<code>多值依赖</code>导致的异常。</p><p>假如下学期想采用一本新的英版高数教材，但是还没确定具体哪个老师来教，那么就无法在这个表中维护Course高数和Book英版高数教材的的关系。</p><p>解决办法是把这个多值依赖的表拆解成2个表，分别建立关系。这是拆分后的表：</p><p><img src="/assets/8a5f3fe528da4abddf0a831c55aeff60.4271a1d7.png" alt="image-20221221215822964"></p><p>以及</p><p><img src="/assets/0a4127e449da98e5d0e997ab56c5b831.f514e4ae.png" alt="image-20221221215839791"></p><h2 id="_6-第五范式、域键范式" tabindex="-1"><a class="header-anchor" href="#_6-第五范式、域键范式" aria-hidden="true">#</a> 6. 第五范式、域键范式</h2><p>除了第四范式外，还有更高级的第五范式（又称完美范式）和域键范式（DKNF）。</p><p>在满足第四范式（4NF）的基础上，消除不是由候选键所蕴含的连接依赖。如果关系模式R中的每一个连接依赖均由R的候选键所隐含，则称此关系模式符合第五范式。</p><p>函数依赖是多值依赖的一种特殊的情况，而多值依赖实际上是连接依赖的一种特殊情况。但连接依赖不像函数依赖和多值依赖可以由<code>语义直接导出</code> ，而是在 <code>关系连接运算 </code>时才反映出来。存在连接依赖的关系模式仍可能遇到数据冗余及插入、修改、删除异常等问题。</p><p>第五范式处理的是<code>无损连接问题</code>，这个范式基本 <code>没有实际意义</code> ，因为无损连接很少出现，而且难以察觉。而域键范式试图定义一个<code>终极范式</code> ，该范式考虑所有的依赖和约束类型，但是实用价值也是最小的，只存在理论研究中。</p><h2 id="_7-实战案例" tabindex="-1"><a class="header-anchor" href="#_7-实战案例" aria-hidden="true">#</a> 7. 实战案例</h2><p>商超进货系统中的进货单表进行剖析：</p><p>进货单表：</p><p><img src="/assets/b2e14983bb46815a1f53732249e6f60d.ea524a27.png" alt="image-20221221230058669"></p><p>这个表中的字段很多，表里的数据量也很惊人。大量重复导致表变得庞大，效率极低。如何改造?</p><blockquote><p>在实际工作场景中，这种由于数据表结构设计不合理，而导致的数据重复的现象并不少见。往往是系统虽然能够运行，承载能力却很差，稍微有点流量，就会出现内存不足、CUP使用率飙升的情况，甚至会导致整个项目失败</p></blockquote><h3 id="_7-1-迭代1次-考虑1nf" tabindex="-1"><a class="header-anchor" href="#_7-1-迭代1次-考虑1nf" aria-hidden="true">#</a> 7.1 迭代1次:考虑1NF</h3><p>第一范式要求:所有的字段都是基本数据字段，不可进一步拆分。这里需要确认，所有的列中，每个字段只包含—种数据。</p><p>这张表里把“property&quot;这一字段，拆分成&quot;specification (规格)“和&quot;unit(单位)”，这2个字段如下:</p><p><img src="/assets/f0054bdb91f2d87dff713e9ea4497e63.52f4fb75.png" alt="image-20221221230249133"></p><h3 id="_7-2-迭代2次-考虑2nf" tabindex="-1"><a class="header-anchor" href="#_7-2-迭代2次-考虑2nf" aria-hidden="true">#</a> 7.2 迭代2次:考虑2NF</h3><p>第二范式要求，在满足第一范式的基础上，还要满足数据表里的每一条数据记录，都是可唯一标识的。而且所有字段，都必须完全依赖主键，不能只依赖主键的一部分</p><p>第1步，就是要确定这个表的主键。通过观察发现，字段““listnumber(单号)”+&quot;barcode(条码)&quot;可以唯一标识每一条记录，可以作为主键。</p><p>第2步，确定好了主键以后，判断哪些字段完全依赖主键，哪些字段只依赖于主键的一部分。把只依赖于主键一部分的字段拆分出去，形成新的数据表。</p><p>首先，进货单明细表里面的“goodsname(名称)&quot; &quot;specification(规格)“unit(单位)“这些信息是商品的属性，只依赖于“barcode(条码)”，不完全依赖主键，可以拆分出去。把这3个字段加上它们所依赖的字段”“barcode(条码)”，拆分形成一个新的数据表“商品信息表”。</p><p>这样一来，原来的数据表就被拆分成了两个表</p><p>商品信息表:</p><p><img src="/assets/ba2f7d793c2bc63bf27ecfddc759bdd3.b8759b84.png" alt="image-20221221230713549"></p><p>进货单表：</p><p><img src="/assets/507f8c54f7ef6cb7bd4692dcf6308eb1.1983b188.png" alt="image-20221221230734844"></p><p>此外，字段“supplierid(供应商编号)”“suppliername(供应商名称)”&quot;stock(仓库)“只依赖于&quot;listnumber(单号)”，不完全依赖于主键，所以，可以把&quot;supplierid”“suppliername&quot;stock&quot;这3个字段拆出去，再加上它们依赖的字段&quot;listnumber(单号)””，就形成了一个新的表“<code>进货单头表</code>”。剩下的字段，会组成新的表，我们叫它”进货单明细表”。</p><p>原来的数据表就拆分成了3个表</p><p>进货单头表:</p><p><img src="/assets/797dcd58dcb47b835abddc98fb32bf72.494e226e.png" alt="image-20221221230951770"></p><p>进货单明细表：</p><p><img src="/assets/da308210596c28b6add0f1a4389c81d2.a07a50ac.png" alt="image-20221221231013100"></p><p>商品信息表：</p><p><img src="/assets/52b83c4c69eb370245365e125d7d32de.d459cf82.png" alt="image-20221221231042371"></p><p>现在来分析一下拆分后的3个表，保证这3个表都满足第二范式的要求</p><p>第3步，在&quot;商品信息表&quot;中，字段&quot;barcode&quot;是有<code>可能存在重复的</code>，比如，用户门店可能有散装称重商品和自产商品，会存在条码共用的情况。所以，所有的字段都不能唯一标识表里的记录。这个时候必须给这个表加上一个主键，比如说是自增字段&quot;<code>itemnumber</code>”。</p><p>现在就可以把进货单明细表里面的字段&quot;barcode&quot;都替换成字段&quot;itemnumber&quot;，这就得到了新的如下表</p><p>进货单明细表：</p><p><img src="/assets/321d681a70cb435819db1fa85e6b4de7.afe8ad4f.png" alt="image-20221221231358391"></p><p>商品信息表：</p><p><img src="/assets/a4aa3e02095e554ad999779497b474ee.e2061e30.png" alt="image-20221221231342038"></p><p>拆分后的3个数据表就全部满足了第二范式的要求</p><h3 id="_7-3-迭代3次-考虑3nf" tabindex="-1"><a class="header-anchor" href="#_7-3-迭代3次-考虑3nf" aria-hidden="true">#</a> 7.3 迭代3次:考虑3NF</h3><p>进货单头表还有数据冗余的可能。因为“supplername &quot;依赖&quot;supplierid&quot;那么，这个时候，就可以按照第三范式的原则进行拆分了。进一步拆分一下进货单头表，把它拆解成供货商表和进货单头表。</p><p>供货商表:</p><p><img src="/assets/73a3be21ab8942fa4047bc8900bdf227.5d850ccd.png" alt="image-20221221231543741"></p><p>进货单头表：</p><p><img src="/assets/3059ec7bbe267e34f7fde8291bf49e5e-20230308174139280.a28a601b.png" alt="image-20221221231609611"></p><p>这2个表都满足第三范式的要求了</p><h3 id="_7-4-反范式化-业务优先的原则" tabindex="-1"><a class="header-anchor" href="#_7-4-反范式化-业务优先的原则" aria-hidden="true">#</a> 7.4 反范式化:业务优先的原则</h3><p>在进货单明细表中，<code>quantity * importprice = importvalue</code>、“importprice&quot;、“quantity&quot;和&quot;importvalue可以通过任意两个计算出第三个来，这就存在冗余字段。如果严格按照第三范式的要求，应该进行进一步优化。优化的办法是删除其中一个字段，只保留另外2个，这样就没有冗余数据了。</p><p>可是，真的可以这样做吗? 要回答这个问题就要先了解下实际工作中的业务优先原则。</p><p>所谓的业务优先原则，就是指一切以业务需求为主，技术服务于业务。**完全按照理论的设计不一定就是最优，还要根据实际情况来决定。**这里就来分析一下不同选择的利与弊。</p><p>对于<code>quantity * importprice =importvalue</code>，看起来&quot;importvalue&quot;似乎是冗余字段，但并不会导致数据不一致，可是，如果把这个字段取消，是会影响业务的。</p><p>因为有的时候，供货商会经常进行一些促销活动，按金额促销，那他们拿来的进货单只有金额，没有价格。而”“importprice&quot;反而是通过“importvalue / quantity&quot;计算出来的，经过四舍五入，会产生较大的误差。这样日积月累，最终会导致查询结果出现较大偏差，影响系统的可靠性。</p><p>举例:进货金额(importvalue)是25.5元，数量(quantity)是 34，那么进货价格(importprice)就等于25.5/34=0.74元，但是如果用这个计算出来的进货价格(importprice)来计算进货金额，那么，进货金额(importvalue)就等于0.74x34=25.16元，其中相差了25.5-25.16=0.34元</p><p>所以，本着业务优先的原则，在不影响系统可靠性的前提下，可适当增加数据冗余，保留“importvalue&quot;importprice”和“quantity&quot;。</p><p>因此，最后我们可以把进货单表拆分成下面的4个表:</p><p>进货单明细表：</p><p><img src="/assets/95f26ad30a8375a91e3b8ddcd9dcd825.c32b98ab.png" alt="image-20221221232106379"></p><p>商品信息表：</p><p><img src="/assets/e330cef565bc23de3cac91fc1dbad122.6560eceb.png" alt="image-20221221232038171"></p><p>供货商表:</p><p><img src="/assets/73a3be21ab8942fa4047bc8900bdf227.5d850ccd.png" alt="image-20221221231543741"></p><p>进货单头表：</p><p><img src="/assets/3059ec7bbe267e34f7fde8291bf49e5e-20230308174139280.a28a601b.png" alt="image-20221221231609611"></p><p>这样一来，我们就避免了冗余，而且还能够满足业务的需求，这样的数据表设计，才是合格的设计。</p><h2 id="_8-er模型" tabindex="-1"><a class="header-anchor" href="#_8-er模型" aria-hidden="true">#</a> 8. ER模型</h2><p>数据库设计是牵一发而动全身的。那有没有什么办法提前看到数据库的全貌呢?比如需要哪些数据表、数据表中应该有哪些字段，数据表与数据表之间有什么关系、通过什么字段进行连接，等等。这样才能进行整体的梳理和设计。</p><p>其实，ER模型就是一个这样的工具。ER模型也叫作<code>实体关系模型</code>，是用来描述现实生活中客观存在的事物、事物的属性，以及事物之间关系的一种数据模型。在开发基于数据库的信息系统的设计阶段，通常使用ER模型来描述信息需求和信息特性，帮助我们理清业务逻辑，从而设计出优秀的数据库</p><h3 id="_8-1-er模型包括哪些要素" tabindex="-1"><a class="header-anchor" href="#_8-1-er模型包括哪些要素" aria-hidden="true">#</a> 8.1 ER模型包括哪些要素?</h3><p>ER模型中有三个要素。分别是实体、属性和关系</p><ul><li><p><code>实体</code>，可以看做是数据对象，往往对应于现实生活中的真实存在的个体。在ER模型中，用<code>矩形</code>来表示。实体分为两类，分别是<code>强实体</code>和<code>弱实体</code>。强实体是指不依赖于其他实体的实体;弱实体是指对另一个实体有很强的依赖关系的实体。</p></li><li><p><code>属性</code>， 则是指实体的特性。比如超市的地址、联系电话、员工数等。在ER模型中用<code>椭圆形</code>来表示。</p></li><li><p><code>关系</code>， 则是指实体之间的联系。比如超市把商品卖给顾客，就是一种超市与顾客之间的联系。在ER模型中用菱形来表示。</p></li></ul><p>注意:实体和属性不容易区分。这里提供一个原则:要从系统整体的角度出发去看，可以独立存在的是实体，不可再分的是属性。也就是说，属性不能包含其他属性。</p><h3 id="_8-2-关系的类型" tabindex="-1"><a class="header-anchor" href="#_8-2-关系的类型" aria-hidden="true">#</a> 8.2 关系的类型</h3><p>在ER模型的3个要素中，关系又可以分为3种类型，分别是一对一、一对多、多对多。</p><ul><li><p><code>一对一</code>︰指实体之间的关系是一一对应的，比如个人与身份证信息之间的关系就是一对一的关系。一个人只能有一个身份证信息，一个身份证信息也只属于一个人。</p></li><li><p><code>一对多</code>∶指一边的实体通过关系，可以对应多个另外一边的实体。相反，另外一边的实体通过这个关系，则只能对应唯一的一边的实体。比如说，新建一个班级表，而每个班级都有多个学生，每个学生则对应一个班级，班级对学生就是一对多的关系。</p></li><li><p><code>多对多</code>︰指关系两边的实体都可以通过关系对应多个对方的实体。比如在进货模块中，供货商与超市之间的关系就是多对多的关系，一个供货商可以给多个超市供货，一个超市也可以从多个供货商那里采购商品。再比如一个选课表，有许多科目，每个科目有很多学生选，而每个学生又可以选择多个科目，这就是多对多的关系。</p></li></ul><h3 id="_8-3-建模分析" tabindex="-1"><a class="header-anchor" href="#_8-3-建模分析" aria-hidden="true">#</a> 8.3 建模分析</h3><p>ER模型看起来比较麻烦，但是对我们把控项目整体非常重要。如果你只是开发一个小应用，或许简单设计几个表够用了，一旦要设计有一定规模的应用，在项目的初始阶段，建立完整的ER模型就非常关键了。开发应用项目的实质，其实就是<code>建模</code></p><p>此处设计的案例是<code>电商业务</code>，由于电商业务太过庞大且复杂，所以做了业务简化，比如针对SKU(StockKeepingUnit，库存量单位）和SPU(Standard Product Unit，标准化产品单元)的含义上，直接使用了SKU，并没有提及SPU的概念。本次电商业务设计总共有8个实体，如下所示。</p><ul><li><p>地址实体</p></li><li><p>用户实体</p></li><li><p>购物车实体</p></li><li><p>评论实体</p></li><li><p>商品实体</p></li><li><p>商品分类实体</p></li><li><p>订单实体</p></li><li><p>订单详情实体</p></li></ul><p>其中，<code>用户</code>和<code>商品分类</code>是强实体，因为它们不需要依赖其他任何实体。而其他同于弱实体，因为它们虽然都可以独立存在，但是它们都依赖用户这个实体，因此都是弱实体。知道了这些要素就可以给电商业务创建ER模型了，如图:</p><p><img src="/assets/55506f3ea2d0ccec89135683ede8239e.a7d9073f.png" alt="image-20221223000234590"></p><p>在这个图中，地址和用户之间的添加关系，是一对多的关系，而商品和商品详情示一对一的关系，商品和订单是多对多的关系。 这个 ER 模型，包括了 8个实体之间的 8种关系。</p><p>（1）用户可以在电商平台添加多个地址；</p><p>（2）用户只能拥有一个购物车；</p><p>（3）用户可以生成多个订单；</p><p>（4）用户可以发表多条评论；</p><p>（5）一件商品可以有多条评论；</p><p>（6）每一个商品分类包含多种商品；</p><p>（7）一个订单可以包含多个商品，一个商品可以在多个订单里。</p><p>（8）订单中又包含多个订单详情，因为一个订单中可能包含不同种类的商品</p><h3 id="_8-4-er-模型的细化" tabindex="-1"><a class="header-anchor" href="#_8-4-er-模型的细化" aria-hidden="true">#</a> 8.4 ER 模型的细化</h3><p>有了这个 ER 模型就可以从整体上<code>理解</code>电商的业务了。刚刚的 ER 模型展示了电商业务的框架，但是只包括了订单，地址，用户，购物车，评论，商品，商品分类和订单详情这八个实体，以及它们之间的关系，还不能对应到具体的表，以及表与表之间的关联。需要<code>把属性加上</code>，用<code>椭圆</code>来表示，这样得到的 ER 模型就更加完整了。</p><p>因此，我们需要进一步去设计一下这个 ER 模型的各个局部，也就是细化下电商的具体业务流程，然后把它们综合到一起，形成一个完整的 ER 模型。这样可以理清数据库的设计思路。</p><p>接下来再分析一下各个实体都有哪些属性，如下所示。</p><p>（1） <code>地址实体</code> 包括用户编号、省、市、地区、收件人、联系电话、是否是默认地址。</p><p>（2） <code>用户实体</code> 包括用户编号、用户名称、昵称、用户密码、手机号、邮箱、头像、用户</p><p>（3） <code>购物车实体</code> 包括购物车编号、用户编号、商品编号、商品数量、图片文件url</p><p>（4）<code>订单实体</code> 包括订单编号、收货人、收件人电话、总金额、用户编号、付款方式、送货地址、下单时间。</p><p>（5） <code>订单详情实体</code> 包括订单详情编号、订单编号、商品名称、商品编号、商品数量。</p><p>（6） <code>商品实体</code> 包括商品编号、价格、商品名称、分类编号、是否销售，规格、颜色。</p><p>（7） <code>评论实体</code> 包括评论id、评论内容、评论时间、用户编号、商品编号</p><p>（8） <code>商品分类实体</code> 包括类别编号、类别名称、父类别编号</p><p>这样细分之后就可以重新设计电商业务了，ER 模型如图：</p><p><img src="/assets/dac305af6ff3b1f2e2d0af77c40fe3f9.00ca0dbe.png" alt="image-20221223000842728"></p><h3 id="_8-5-er-模型图转换成数据表" tabindex="-1"><a class="header-anchor" href="#_8-5-er-模型图转换成数据表" aria-hidden="true">#</a> 8.5 ER 模型图转换成数据表</h3><p>通过绘制 ER 模型已经理清了业务逻辑，现在就要进行非常重要的一步了：把绘制好的 ER模型，转换成具体的数据表，下面介绍下转换的原则：</p><p>（1）一个<code>实体</code>通常转换成一个 <code>数据表</code> ；</p><p>（2）一个 <code>多对多的关系</code> ，通常也转换成一个 <code>数据表</code> ；</p><p>（3）一个<code> 1 对 1</code> ，或者 <code>1 对多</code> 的关系，往往通过表的<code> 外键</code> 来表达，而不是设计一个新的数据表；</p><p>（4） <code>属性</code> 转换成表的 <code>字段 </code>。</p><p>下面结合前面的ER模型，具体讲解一下怎么运用这些转换的原则，把 ER 模型转换成具体的数据表，从而把抽象出来的数据模型，落实到具体的数据库设计当中</p><p>1、一个实体通常转换成一个数据表</p><p><strong>先来看一下强实体转换成数据表:</strong></p><p><code>用户实体</code>转换成<code>用户表</code>(user_info)的代码如下所示</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user_info<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>nick_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户昵称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>passwd<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户密码&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>phone_num<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;手机号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>head_img<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;头像&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_level<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户级别&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;用户表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>商品分类实体</code>转换成商品分类表 (base_category)，由于商品分类可以有一级分类和二级分类，比如一级分类有家居、手机等等分类，二级分类可以根据手机的一级分类分为手机配件，运营商等，这里我们把商品分类实体规划为两张表，分别是一级分类表和二级分类表，之所以这么规划是因为一级分类和二级分类都是有限的，存储为两张表业务结构更加清晰。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#一级分类表</span>
  <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span><span class="token identifier"><span class="token punctuation">`</span>base_category1<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span><span class="token operator">-</span><span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;分类名称&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;一级分类表&#39;</span><span class="token punctuation">;</span>

<span class="token comment">#二级分类表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>base_category2<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;二级分类名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>category1_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;一级分类编号&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;二级分类表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么如果规划为—张表呢，表结构如下所示。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>base_category<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;分类名不&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>category_parent_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;父分类编号&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id  <span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span> <span class="token string">&#39;分类表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果这样分类的话，那么查询一级分类时候，就需要判断父分类编号是否为空，但是如果插入二级分类的时候也是空，就容易造成<code>业务数据混乱</code>。而且查询二级分类的时候IS NOT NULL条件是无法使用到索引的。同时，这样的设计也不符合第二范式(因为父分类编号并不依赖分类编号ID，因为父分类编号可以有很多数据为NULL)，所以需要进行表的拆分。因此无论是<code>业务需求</code>还是<code>数据库表的规范</code>来看都应该拆分为两张表。</p><p><strong>下面我们再把弱实体转换成数据表:</strong></p><p>地址实体转换成地址表(user_address) ，如下所示。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user_address<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
<span class="token string">&#39;province&#39;</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;省&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>city<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;市&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>user_address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;具体地址&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>user_id bipint(20)<span class="token punctuation">`</span></span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户id&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>consignee<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;收件人&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>phone_num <span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> ‘联系方式<span class="token string">&#39;,
`is_default` varchar( 1) DEFAULT NULL COMMENT &#39;</span>是否是默认<span class="token string">&#39;,
PRIMARY KEY (`id`)
)ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT=&#39;</span>用户地址表&#39;<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>订单实体转换成订单表（order_info)，如下所示，实际业务中订单的信息会非常多，我们这里做了简化。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>order_info<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>consignee<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;收货人&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>consignee_tel<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;收件人电话&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>total_amount<span class="token punctuation">`</span></span> <span class="token keyword">decimal</span><span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;总金额&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;用户id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>payment_way<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;付款方式&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>delivery_address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;送货地址&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;下单时间&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORNAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span> <span class="token string">&#39;订单表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>订单详情实体转换成订单详情表（order_detail)，如下所示。(用于体现多对多关系的，见下节)</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#订单详情表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>order_detail<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;订单详情编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;订单编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;sku_id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;sku名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_num<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;购买个数&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;操作时间&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;订单明细表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>购物车实体转换成购物车表(cart_info)，如下所示。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>cart_info<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>cart_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;用户id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;skuid&#39;</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_num<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;数量&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>img_url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;图片文件&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;购物车表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>评论实体转换成评论表(members)，如下所示。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sku_comments<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>comment_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;评论编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> bigin<span class="token punctuation">)</span>t <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;用户编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_id<span class="token punctuation">`</span></span> <span class="token keyword">decimal</span><span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> NULI <span class="token keyword">COMMENT</span> <span class="token string">&#39;商品编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>comment<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;评论内容&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;评论时间&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
）<span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC COMMNENT<span class="token operator">=</span><span class="token string">&#39;商品评论表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>商品实体转换成商品表(members)，如下所示。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sku_info<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> COPMENT<span class="token string">&#39;商品编号(itemID)&#39;</span><span class="token punctuation">,</span>
   <span class="token identifier"><span class="token punctuation">`</span>price<span class="token punctuation">`</span></span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;价格&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;sku名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_desc<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;商品规格描述&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>category3_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;三级分类id(冗余)&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>color<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;颜色&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>is_sale<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> CONMMENT<span class="token string">&#39;是否销售(1:是0:否)&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span> <span class="token string">&#39;商品表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、一个多对多的关系转换成一个数据表 这个ER模型中的多对多的关系有1个，即<code>商品</code>和<code>订单</code>之间的关系，同品类的商品可以出现在不同的订单中，不同的订单也可以包含同一类型的商品，所以它们之间的关系是多对多。针对这种情况需要设计一个独立的表来表示，这种表一般称为<code>中间表</code>。</p><p>我们可以设计一个独立的<code>订单详情表</code>，来代表商品和订单之间的包含关系。这个表关联到2个实体，分别是订单、商品。所以，表中必须要包括这2个实体转换成的表的主键。除此之外，我们还要包括该关系自有的属性:商品数量，商品下单价格以及商品名称。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#订单详情表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>order_detail<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;订单详情编号&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;订单编号&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>sku_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;sku_id &#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>sku_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;sku名称&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>sku_num<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;购买个数&#39;</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;操作时间&#39;</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;订单明细表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>公司的订单相关表主要有：order、order_item、sku、spu…其中order_detail相当于order_item</p></blockquote><p>3、通过外键来表达1对多的关系</p><p>在上面的表的设计中，我们可以用外键来表达1对多的关系。比如在商品评论表sku_comments中我们分别把user_id、sku_id定义成外键，以使用下面的语句设置外键。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CONSTRAINT</span> fk_comment_user <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> user_info <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token keyword">CONSTRAINT</span> fk_comment_sku <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>sku_id<span class="token punctuation">)</span><span class="token keyword">REFERENCES</span> sku_info <span class="token punctuation">(</span>sku_id<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>外键约束主要是在数据库层面上<code>保证数据的一致性</code>，但是因为插入和更新数据需要检查外键，理论上<code>性能会有所下降</code>，对性能是负面的影响。</p><p>实际的项目，不建议使用外键，一方面是<code>降低开发的复杂度</code>(有外键的话主从表类的操作必须先操作主表)，另外是有外键在<code>处理数据的时候非常麻烦</code>。在电商平台，由于<code>并发业务量比较大</code>，所以一般不设置外键，以免影响数据库<code>性能</code>。</p><p>在应用层面做数据的<code>一致性检查</code>，本来就是一个正常的功能需求。如学生选课的场景，课程肯定不是输入的，而是通过下拉或查找等方式从系统中进行选取，就能够保证是合法的课程ID，因此就不需要靠数据库的外键来检查了。</p><p>4、把属性转换成表的字段 在刚刚的设计中，我们也完成了把属性都转换成了表的字段，比如把商品属性转换成了商品信息表中的字段。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sku_info<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> COPMENT<span class="token string">&#39;商品编号(itemID)&#39;</span><span class="token punctuation">,</span>
   <span class="token identifier"><span class="token punctuation">`</span>price<span class="token punctuation">`</span></span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;价格&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;sku名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sku_desc<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;商品规格描述&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>category3_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">&#39;三级分类id(冗余)&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>color<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;颜色&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>is_sale<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> CONMMENT<span class="token string">&#39;是否销售(1:是0:否)&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> AUTO_INCRENENT<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 ROW_FORMAT<span class="token operator">=</span>DYNAMIC <span class="token keyword">COMMENT</span><span class="token operator">=</span> <span class="token string">&#39;商品表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这里，我们通过创建<code>电商项目业务流程</code>的ER模型，再把ER模型转换成具体的数据表的过程，完成利用ER模型设计电商项目数据库的工作。</p><p>其实，任何一个基于数据库的应用项目，都可以通过这种<code>先建立ER 模型</code> ，再<code>转换成数据表</code>的方式，完成数据库的设计工作。创建ER模型不是目的，目的是把业务逻辑梳理清楚，设计出优秀的数据库。不是为了建模而建模，要利用创建ER模型的过程来整理思路，这样创建ER模型才有意义。</p><p><img src="/assets/8c26d8b7ed9eafed87662272aade1619.adc543b9.png" alt="image-20221223002758954"></p><h2 id="_9-数据表的设计原则" tabindex="-1"><a class="header-anchor" href="#_9-数据表的设计原则" aria-hidden="true">#</a> 9. 数据表的设计原则</h2><p>综合以上内容，总结出数据表设计的一般原则：“三少一多”</p><p>1、数据表的个数越少越好</p><p>RDBMS的核心在于对实体和联系的定义，也就是E-R图(Entity Relationship Diagram)，数据表越少，证明实体和联系设计得越简洁，既方便理解又方便操作。</p><p>2、数据表中的字段个数越少越好</p><p>字段个数越多，数据冗余的可能性越大。设置字段个数少的前提是各个字段相互独立，而不是某个字段的取值可以由其他字段计算出来。当然字段个数少是相对的，通常会在<code>数据冗余</code>和<code>检索效率</code>中进行平衡。</p><p>3、数据表中联合主键的字段个数越少越好</p><p>设置主键是为了确定唯一性，当一个字段无法确定唯一性的时候，就需要采用联合主键的方式(也就是用多个字段来定义一个主健)。联合主键中的字段越多，占用的索列空间越大，不仅会加大理解难度，还会增加运行时间和索引空间，因此联合主键的字段个数越少越好。</p><p>4、使用主键和外键越多越好</p><p>数据库的设计实际上就是定义各种表，以及各种字段之间的关系。这些关系越多，证明这些实体之间的冗余度越低，<code>利用度越高</code>。这样做的好处在于不仅保证了数据表之间的<code>独立性</code>，还能提升相互之间的关联使用率。</p><p>这里的外键指业务上实现外键，也就是逻辑外键。不一定使用外键约束实现。</p><p>“三少一多&quot;原则的核心就是<code>简单可复用</code>。简单指的是用更少的表、更少的字段、更少的联合主键字段来完成数据表的设计。可复用则是通过主键、外键的使用来增强数据表之间的复用率。因为一个主键可以理解是一张表的代表。键设计得越多，证明它们之间的利用率越高。</p><blockquote><p>注意：这个原则并不是绝对的，有时候我们需要牺牲数据的冗余度来换取数据处理的效率。</p></blockquote><h2 id="_10-数据库对象编写建议" tabindex="-1"><a class="header-anchor" href="#_10-数据库对象编写建议" aria-hidden="true">#</a> 10. 数据库对象编写建议</h2><p>前面讲了数据库的设计规范，下面给出的这些规范适用于大多数公司，按照下面的规范来使用数据库，这样数据库可以发挥出更高的性能</p><h3 id="_10-1-关于库" tabindex="-1"><a class="header-anchor" href="#_10-1-关于库" aria-hidden="true">#</a> 10.1 关于库</h3><ol><li>【强制】库的名称必须控制在32个字符以内，只能使用英文字母、数字和下划线，建议以英文字母开头。</li><li>【强制】库名中英文<code>一律小写</code>，不同单词采用<code>下划线</code>分割。须见名知意。</li><li>【强制】库的名称格式：业务系统名称_子系统名。</li><li>【强制】库名禁止使用关键字（如type,order等）。</li><li>【强制】创建数据库时必须<code>显式指定字符集</code>，并且字符集只能是utf8或者utf8mb4。创建数据库SQL举例：CREATE DATABASE crm_fund <code>DEFAULT CHARACTER SET &#39;utf8&#39;</code>;</li><li>【建议】对于程序连接数据库账号，遵循<code>权限最小原则</code>。使用数据库账号只能在一个DB下使用，不准跨库。程序使用的账号<code>原则上不准有drop权限</code>。</li><li>【建议】临时库以<code>tmp_</code>为前缀，并以日期为后缀；备份库以<code>bak_</code>为前缀，并以日期为后缀。</li></ol><h3 id="_10-2-关于表、列" tabindex="-1"><a class="header-anchor" href="#_10-2-关于表、列" aria-hidden="true">#</a> 10.2 关于表、列</h3><ol><li><p>【强制】表和列的名称必须控制在32个字符以内，表名只能使用英文字母、数字和下划线，建议以<code>英文字母开头</code>。</p></li><li><p>【强制】 <code>表名、列名一律小写</code>，不同单词采用下划线分割。须见名知意。</p></li><li><p>【强制】表名要求有模块名强相关，同一模块的表名尽量使用<code>统一前缀</code>。比如：crm_fund_item</p></li><li><p>【强制】创建表时必须<code>显式指定字符集</code>为utf8或utf8mb4。</p></li><li><p>【强制】表名、列名禁止使用关键字（如type,order等）。</p></li><li><p>【强制】创建表时必须<code>显式指定表存储引擎</code>类型。如无特殊需求，一律为InnoDB。</p></li><li><p>【强制】建表必须有comment。</p></li><li><p>【强制】字段命名应尽可能使用表达实际含义的英文单词或<code>缩写</code>。如：公司 ID，不要使用 corporation_id, 而用corp_id 即可。</p></li><li><p>【强制】布尔值类型的字段命名为<code>is_描述</code>。如member表上表示是否为enabled的会员的字段命名为 is_enabled。</p></li><li><p>【强制】禁止在数据库中存储图片、文件等大的二进制数据。通常文件很大，短时间内造成数据量快速增长，数据库进行数据库读取时，通常会进行大量的随机IO操作，文件很大时，IO操作很耗时。通常存储于文件服务器(如FastDFS)，数据库只存储文件地址信息。</p></li><li><p>【建议】建表时关于主键：表必须有主键</p><p>(1)强制要求主键为id，类型为int或bigint，且为auto_increment 建议使用unsigned无符号型。 (2)标识表里每一行主体的字段不要设为主键，建议设为其他字段如user_id，order_id等，并建立unique key索引。因为如果设为主键且主键值为随机插入，则会导致innodb内部页分裂和大量随机I/O，性能下降。</p></li><li><p>【建议】核心表（如用户表）必须有行数据的创建时间字段（create_time）和最后更新时间字段（update_time），便于查问题。</p></li><li><p>【建议】表中所有字段尽量都是NOT NULL属性，业务可以根据需要定义DEFAULT值。 因为使用NULL值会存在每一行都会占用额外存储空间、数据迁移容易出错、聚合函数计算结果偏差、业务代码容易出现空指针等问题。</p></li><li><p>【建议】所有存储相同数据的列名和列类型必须一致（一般作为关联列，如果查询时关联列类型不一致会自动进行数据类型隐式转换，会造成列上的索引失效，导致查询效率降低</p></li><li><p>【建议】中间表（或临时表）用于保留中间结果集，名称以tmp_开头。备份表用于备份或抓取源表快照，名称以bak_开头。中间表和备份表定期清理。</p></li><li><p>【示范】一个较为规范的建表语句：</p></li></ol><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_info <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;自增主键&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;真实姓名&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户邮箱&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>nickname<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;昵称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>birthday<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;生日&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;性别&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>short_introduce<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;一句话介绍自己，最多50个汉字&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_resume<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户提交的简历存放地址&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_register_ip<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户注册时的源ip&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;修改时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_review_status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户资料审核状态，1为通过，2为审核中，3为未通过，4为还未提交审核&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>uniq_user_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_username<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_create_time_status<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>user_review_status<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;网站用户基本信息&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="17"><li>【建议】创建表时，可以使用可视化工具。这样可以确保表、字段相关的约定都能设置上。实际上，我们通常很少自己写 DDL 语句，可以使用一些可视化工具来创建和操作数据库和数据表。可视化工具除了方便，还能直接帮我们将数据库的结构定义转化成 SQL 语言，方便数据库和数据表结构的导出和导入。</li></ol><h3 id="_10-3-关于索引" tabindex="-1"><a class="header-anchor" href="#_10-3-关于索引" aria-hidden="true">#</a> 10.3 关于索引</h3><ol><li>【强制】InnoDB表必须主键为id int/bigint auto_increment，且主键值<code>禁止被更新</code>。</li><li>【强制】InnoDB和MyISAM存储引擎表，索引类型必须为<code>BTREE</code> (此处是官方写法，代表的其实就是B+树)</li><li>【建议】主键的名称以<code>pk_</code>开头，唯一键以<code>uni_</code>或<code>uk_</code>开头，普通索引以<code>idx_</code>开头，一律使用小写格式，以字段的名称或缩写作为后缀。</li><li>【建议】多单词组成的columnname，取前几个单词首字母，加末单词组成column_name。如: sample 表 member_id 上的索引：<code>idx_sample_mid</code>。</li><li>【建议】单个表上的索引个数<code>不能超过6个</code>。</li><li>【建议】在建立索引时，多考虑建立<code>联合索引</code>，并把区分度最高的字段放在最前面。</li><li>【建议】在多表 JOIN 的SQL里，<code>保证被驱动表的连接列上有索引</code>，这样JOIN 执行效率最高。</li><li>【建议】建表或加索引时，保证表里互相不存在<code>冗余索引</code>。 比如：如果表里已经存在key(a,b)， 则key(a)为冗余索引，需要删除。</li></ol><h3 id="_10-4-sql编写" tabindex="-1"><a class="header-anchor" href="#_10-4-sql编写" aria-hidden="true">#</a> 10.4 SQL编写</h3><ol><li>【强制】程序端SELECT语句必须指定具体字段名称，<code>禁止写成 *</code>。</li><li>【建议】程序端insert语句指定具体字段名称，不要写成INSERT INTO t1 VALUES(…)。</li><li>【建议】除静态表或小表（100行以内），DML语句必须有WHERE条件，且使用索引查找。</li><li>【建议】INSERT INTO…VALUES(XX),(XX),(XX)… 这里XX的值不要超过5000个。 值过多虽然上线很快，但会引起主从<code>同步延迟</code>。</li><li>【建议】SELECT语句不要使用UNION，<code>推荐使用UNION ALL</code>，并且UNION子句个数限制在5个以内。</li><li>【建议】线上环境，多表 JOIN 不要超过5个表。</li><li>【建议】减少使用ORDER BY，和业务沟通能不排序就不排序，或将排序放到程序端去做。ORDER BY、GROUP BY、DISTINCT 这些语句较为耗费CPU，数据库的CPU资源是极其宝贵的。</li><li>【建议】包含了ORDER BY、GROUP BY、DISTINCT 这些查询的语句，WHERE 条件过滤出来的结果集请保持在1000行以内，否则SQL会很慢。</li><li>【建议】对单表的多次alter操作必须合并为一次。对于超过100W行的大表进行alter table，必须经过DBA审核，并在业务低峰期执行，多个alter需整合在一起。 因为alter table会产生<code>表锁</code>，期间阻塞对于该表的所有写入，对于业务可能会产生极大影响。</li><li>【建议】批量操作数据时，需要控制事务处理间隔时间，进行必要的sleep。</li><li>【建议】事务里包含SQL不超过5个。因为过长的事务会导致锁数据较久，MySQL内部缓存、连接消耗过多等问题。</li><li>【建议】事务里更新语句尽量基于主键或UNIQUE KEY，如UPDATE… WHERE id=XX;否则会产生间隙锁，内部扩大锁定范围，导致系统性能下降，产生死锁。</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Ragnarokoo/LearningNotes/edit/master/src/notes/db/mysql_pro/第11章_数据库的设计规范.md" rel="noopener noreferrer" target="_blank" aria-label="在【Github】上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在【Github】上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><a href="/notes/db/mysql_pro/%E7%AC%AC%2010%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96.html" class="nav-link prev" aria-label="第 10 章_索引优化与查询优化"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->第 10 章_索引优化与查询优化</div></a><a href="/notes/db/mysql_pro/%E7%AC%AC12%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E5%AE%83%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5.html" class="nav-link next" aria-label="第12章_数据库其它调优策略"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">第12章_数据库其它调优策略<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.9b10ba0a.js" defer></script>
  </body>
</html>
