<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://Ragnarokoo.github.io/LearningNotes/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html"><meta property="og:site_name" content="📚全栈开发学习指南"><meta property="og:title" content="第 18 章_主从复制"><meta property="og:description" content="1. 主从复制概述 1. 1 如何提升数据库并发能力 在实际工作中，我们常常将Redis作为缓存与MySQL配合来使用，当有请求的时候，首先会从缓存中进行查找，如果存在就直接取出。如果不存在再访问数据库，这样就提升了读取的效率，也减少了对后端数据库的访问压力。Redis的缓存架构是高并发架构中非常重要的一环。 image-202203292311369..."><meta property="og:type" content="article"><meta property="og:image" content="https://Ragnarokoo.github.io/LearningNotes/"><meta property="og:updated_time" content="2023-05-31T09:16:41.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="第 18 章_主从复制"><meta property="article:tag" content="mysql"><meta property="article:tag" content="SQL"><meta property="article:tag" content="关系型数据库"><meta property="article:modified_time" content="2023-05-31T09:16:41.000Z"><link rel="icon" href="/site_logo.svg"><title>第 18 章_主从复制 | 📚全栈开发学习指南</title><meta name="description" content="1. 主从复制概述 1. 1 如何提升数据库并发能力 在实际工作中，我们常常将Redis作为缓存与MySQL配合来使用，当有请求的时候，首先会从缓存中进行查找，如果存在就直接取出。如果不存在再访问数据库，这样就提升了读取的效率，也减少了对后端数据库的访问压力。Redis的缓存架构是高并发架构中非常重要的一环。 image-202203292311369...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.bc8b6d7c.css" as="style" /><link rel="stylesheet" href="/assets/style.bc8b6d7c.css" />
    <link rel="modulepreload" href="/assets/app.9b10ba0a.js"><link rel="modulepreload" href="/assets/第18章_主从复制.html.6f04c152.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/第18章_主从复制.html.906d450d.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/site_logo.svg" alt="📚全栈开发学习指南"><!----><span class="site-name hide-in-pad">📚全栈开发学习指南</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/quicknav/" class="nav-link" aria-label="快速导航"><span class="icon iconfont icon-navigation"></span>快速导航<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-blog"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/notes/" class="nav-link active" aria-label="Java学习教程"><span class="icon iconfont icon-java"></span>Java学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/web/" class="nav-link" aria-label="web学习教程"><span class="icon iconfont icon-note"></span>web学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/springcloud/" class="nav-link" aria-label="SpringCloud学习教程"><span class="icon iconfont icon-cache"></span>SpringCloud学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/distributed/" class="nav-link" aria-label="分布式微服务架构"><span class="icon iconfont icon-read"></span>分布式微服务架构<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="资源宝库"><span class="title"><span class="icon iconfont icon-advance"></span>资源宝库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/resources/books/" class="nav-link" aria-label="书籍资源"><span class="icon iconfont icon-animation"></span>书籍资源<!----></a></li><li class="dropdown-item"><a href="/resources/videos/" class="nav-link" aria-label="影音资源"><span class="icon iconfont icon-play"></span>影音资源<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Ragnarokoo/LearningNotes" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索本站" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java Language专栏</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-IO"></span><span class="title">Java网络编程NIO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-community"></span><span class="title">JDBC数据库连接技术</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-categoryselected"></span><span class="title">JavaWeb</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-array"></span><span class="title">SSM Framework</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-geometry"></span><span class="title">SpringData</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-type"></span><span class="title">SpringBoot</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-module"></span><span class="title">mybatisplus</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-operate"></span><span class="title">构建工具&amp;云原生Devops</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-mysql"></span><span class="title">数据库以及调优策略</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mysql"></span><span class="title">MYSQL基础篇学习专栏</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-mysql"></span><span class="title">MYSQL高级篇学习专栏</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC01%E7%AB%A0_Linux%E4%B8%8BMySQL%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="第 01 章_Linux下MySQL的安装与使用"><!---->第 01 章_Linux下MySQL的安装与使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2002%20%E7%AB%A0_MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95.html" class="nav-link sidebar-link sidebar-page" aria-label="第 02 章_MySQL的数据目录"><!---->第 02 章_MySQL的数据目录<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2003%20%E7%AB%A0_%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="第 03 章_用户与权限管理"><!---->第 03 章_用户与权限管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2004%20%E7%AB%A0_%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 04 章_逻辑架构"><!---->第 04 章_逻辑架构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2005%20%E7%AB%A0_%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" class="nav-link sidebar-link sidebar-page" aria-label="第 05 章_存储引擎"><!---->第 05 章_存储引擎<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2006%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="第 06 章_索引的数据结构"><!---->第 06 章_索引的数据结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2008%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99.html" class="nav-link sidebar-link sidebar-page" aria-label="第 08 章_索引的创建与设计原则"><!---->第 08 章_索引的创建与设计原则<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2009%20%E7%AB%A0_%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="第 09 章_性能分析工具的使用"><!---->第 09 章_性能分析工具的使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC%2010%20%E7%AB%A0_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96.html" class="nav-link sidebar-link sidebar-page" aria-label="第 10 章_索引优化与查询优化"><!---->第 10 章_索引优化与查询优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html" class="nav-link sidebar-link sidebar-page" aria-label="第11章_数据库的设计规范"><!---->第11章_数据库的设计规范<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC12%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E5%AE%83%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5.html" class="nav-link sidebar-link sidebar-page" aria-label="第12章_数据库其它调优策略"><!---->第12章_数据库其它调优策略<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC13%E7%AB%A0_%E4%BA%8B%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" class="nav-link sidebar-link sidebar-page" aria-label="第13章_事务基础知识"><!---->第13章_事务基础知识<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC14%E7%AB%A0_MySQL%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97.html" class="nav-link sidebar-link sidebar-page" aria-label="第14章_MySQL事务日志"><!---->第14章_MySQL事务日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC15%E7%AB%A0_%E9%94%81.html" class="nav-link sidebar-link sidebar-page" aria-label="第 15 章_锁"><!---->第 15 章_锁<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC16%E7%AB%A0_%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="第 16 章_多版本并发控制"><!---->第 16 章_多版本并发控制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC17%E7%AB%A0_%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97.html" class="nav-link sidebar-link sidebar-page" aria-label="第17章_其他数据库日志"><!---->第17章_其他数据库日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="第 18 章_主从复制"><!---->第 18 章_主从复制<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_1-主从复制概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. 主从复制概述"><!---->1. 主从复制概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_1-1-如何提升数据库并发能力" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. 1 如何提升数据库并发能力"><!---->1. 1 如何提升数据库并发能力<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_1-2-主从复制的作用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. 2 主从复制的作用"><!---->1. 2 主从复制的作用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_2-主从复制的原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. 主从复制的原理"><!---->2. 主从复制的原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_2-1-原理剖析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. 1 原理剖析"><!---->2. 1 原理剖析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_2-2-复制的基本原则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. 2 复制的基本原则"><!---->2. 2 复制的基本原则<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-一主一从架构搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 一主一从架构搭建"><!---->3. 一主一从架构搭建<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-1-准备工作" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 1 准备工作"><!---->3. 1 准备工作<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-2-主机配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 2 主机配置文件"><!---->3. 2 主机配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-3-从机配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 3 从机配置文件"><!---->3. 3 从机配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-4-主机-建立账户并授权" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 4 主机：建立账户并授权"><!---->3. 4 主机：建立账户并授权<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-5-从机-配置需要复制的主机" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 5 从机：配置需要复制的主机"><!---->3. 5 从机：配置需要复制的主机<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-6-测试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 6 测试"><!---->3. 6 测试<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-7-停止主从同步" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 7 停止主从同步"><!---->3. 7 停止主从同步<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-8-后续" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 8 后续"><!---->3. 8 后续<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-同步数据一致性问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 同步数据一致性问题"><!---->4. 同步数据一致性问题<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-1-理解主从延迟问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 1 理解主从延迟问题"><!---->4. 1 理解主从延迟问题<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-2-主从延迟问题原因" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 2 主从延迟问题原因"><!---->4. 2 主从延迟问题原因<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-3-如何减少主从延迟" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 3 如何减少主从延迟"><!---->4. 3 如何减少主从延迟<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-4-如何解决一致性问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 4 如何解决一致性问题"><!---->4. 4 如何解决一致性问题<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_5-知识延伸" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. 知识延伸"><!---->5. 知识延伸<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/notes/db/mysql_pro/%E7%AC%AC19%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D.html" class="nav-link sidebar-link sidebar-page" aria-label="第19章_数据库备份与恢复"><!---->第19章_数据库备份与恢复<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">Redis入门到精通</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-workingDirectory"></span><span class="title">Redis大厂进阶篇</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-free"></span><span class="title">数据库优化策略</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-search"></span><span class="title">Elasticsearch7.x分布式搜索引擎</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-search"></span><span class="title">Elasticsearch8.x分布式搜索引擎</span><span class="arrow right"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-quote"></span><span class="title">消息中间件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tool"></span><span class="title">软件以及环境配置</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">Linux操作系统</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-rank"></span><span class="title">JUC高并发编程</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mount"></span><span class="title">深入了解Java虚拟机</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-view"></span><span class="title">GOF23种设计模式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tag"></span><span class="title">技术要点业务篇</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->第 18 章_主从复制</h1><div class="page-info"><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category4 clickable" role="navigation">mysql</span></li></ul><meta property="articleSection" content="mysql"></span><span aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag4 clickable" role="navigation">mysql</span></li><li><span class="tag tag3 clickable" role="navigation">SQL</span></li><li><span class="tag tag0 clickable" role="navigation">关系型数据库</span></li></ul><meta property="keywords" content="mysql,SQL,关系型数据库"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/Ragnarokoo/" target="_blank" rel="noopener noreferrer">Ragnarok</a></span><span property="author" content="Ragnarok"></span></span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-05-31T09:16:41.000Z"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_1-主从复制概述" class="router-link-active router-link-exact-active toc-link level2">1. 主从复制概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_1-1-如何提升数据库并发能力" class="router-link-active router-link-exact-active toc-link level2">1. 1 如何提升数据库并发能力</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_1-2-主从复制的作用" class="router-link-active router-link-exact-active toc-link level2">1. 2 主从复制的作用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_2-主从复制的原理" class="router-link-active router-link-exact-active toc-link level2">2. 主从复制的原理</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_2-1-原理剖析" class="router-link-active router-link-exact-active toc-link level3">2. 1 原理剖析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_2-2-复制的基本原则" class="router-link-active router-link-exact-active toc-link level3">2. 2 复制的基本原则</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-一主一从架构搭建" class="router-link-active router-link-exact-active toc-link level2">3. 一主一从架构搭建</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-1-准备工作" class="router-link-active router-link-exact-active toc-link level3">3. 1 准备工作</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-2-主机配置文件" class="router-link-active router-link-exact-active toc-link level3">3. 2 主机配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-3-从机配置文件" class="router-link-active router-link-exact-active toc-link level3">3. 3 从机配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-4-主机-建立账户并授权" class="router-link-active router-link-exact-active toc-link level3">3. 4 主机：建立账户并授权</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-5-从机-配置需要复制的主机" class="router-link-active router-link-exact-active toc-link level3">3. 5 从机：配置需要复制的主机</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-6-测试" class="router-link-active router-link-exact-active toc-link level3">3. 6 测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-7-停止主从同步" class="router-link-active router-link-exact-active toc-link level3">3. 7 停止主从同步</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_3-8-后续" class="router-link-active router-link-exact-active toc-link level3">3. 8 后续</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-同步数据一致性问题" class="router-link-active router-link-exact-active toc-link level2">4. 同步数据一致性问题</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-1-理解主从延迟问题" class="router-link-active router-link-exact-active toc-link level3">4. 1 理解主从延迟问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-2-主从延迟问题原因" class="router-link-active router-link-exact-active toc-link level3">4. 2 主从延迟问题原因</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-3-如何减少主从延迟" class="router-link-active router-link-exact-active toc-link level3">4. 3 如何减少主从延迟</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_4-4-如何解决一致性问题" class="router-link-active router-link-exact-active toc-link level3">4. 4 如何解决一致性问题</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/db/mysql_pro/%E7%AC%AC18%E7%AB%A0_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html#_5-知识延伸" class="router-link-active router-link-exact-active toc-link level2">5. 知识延伸</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="第-18-章-主从复制" tabindex="-1"><a class="header-anchor" href="#第-18-章-主从复制" aria-hidden="true">#</a> 第 18 章_主从复制</h1><h2 id="_1-主从复制概述" tabindex="-1"><a class="header-anchor" href="#_1-主从复制概述" aria-hidden="true">#</a> 1. 主从复制概述</h2><h2 id="_1-1-如何提升数据库并发能力" tabindex="-1"><a class="header-anchor" href="#_1-1-如何提升数据库并发能力" aria-hidden="true">#</a> 1. 1 如何提升数据库并发能力</h2><p>在实际工作中，我们常常将<code>Redis</code>作为缓存与<code>MySQL</code>配合来使用，当有请求的时候，首先会从缓存中进行查找，如果存在就直接取出。如果不存在再访问数据库，这样就<code>提升了读取的效率</code>，也减少了对后端数据库的<code>访问压力</code>。Redis的缓存架构是<code>高并发架构</code>中非常重要的一环。</p><p><img src="/assets/image-20220329231136992.fc9e7644.png" alt="image-20220329231136992"></p><p>此外，一般应用对数据库而言都是“<code>读多写少</code>”，也就说对数据库读取数据的压力比较大，有一个思路就是采用数据库集群的方案，做<code>主从架构</code>、进行<code>读写分离</code>，这样同样可以提升数据库的并发处理能力。但并不是所有的应用都需要对数据库进行主从架构的设置，毕竟设置架构本身是有成本的。</p><p>如果我们的目的在于提升数据库高并发访问的效率，那么首先考虑的是如何优化<code>SQL和索引</code>，这种方式简单有效；其次才是采用<code>缓存的策略</code>，比如使用 Redis将热点数据保存在内存数据库中，提升读取的效率；最后才是对数据库采用<code>主从架构</code>，进行读写分离。</p><h2 id="_1-2-主从复制的作用" tabindex="-1"><a class="header-anchor" href="#_1-2-主从复制的作用" aria-hidden="true">#</a> 1. 2 主从复制的作用</h2><p>主从同步设计不仅可以提高数据库的吞吐量，还有以下 3 个方面的作用。</p><p>**第 1 个作用：读写分离。**我们可以通过主从复制的方式来同步数据，然后通过读写分离提高数据库并发处理能力</p><p><img src="/assets/image-20220329231214389.11749a67.png" alt="image-20220329231214389"></p><p>**第 2 个作用就是数据备份。**我们通过主从复制将主库上的数据复制到了从库上，相当于是一种热备份机制，也就是在主库正常运行的情况下进行的备份，不会影响到服务。</p><p>**第 3 个作用是具有高可用性。**数据备份实际上是一种冗余的机制，通过这种冗余的方式可以换取数据库的高可用性，也就是当服务器出现<code>故障</code>或<code>宕机</code>的情况下，可以<code>切换</code>到从服务器上，保证服务的正常运行。</p><p>关于高可用性的程度，我们可以用一个指标衡量，即正常可用时间/全年时间。比如要达到全年99.999%的时间都可用，就意味着系统在一年中的不可用时间不得超过<code>365*24*60*(1-99.999%)=5.256</code>分钟(含系统崩溃的时间、日常维护操作导致的停机时间等)，其他时间都需要保持可用的状态。</p><p>实际上，更高的高可用性，意味着需要付出更高的成本代价。在现实中我们需要结合业务需求和成本来进行选择。</p><h2 id="_2-主从复制的原理" tabindex="-1"><a class="header-anchor" href="#_2-主从复制的原理" aria-hidden="true">#</a> 2. 主从复制的原理</h2><p><code>Slave</code>会从<code>Master</code>读取<code>binlog</code>来进行数据同步。</p><h3 id="_2-1-原理剖析" tabindex="-1"><a class="header-anchor" href="#_2-1-原理剖析" aria-hidden="true">#</a> 2. 1 原理剖析</h3><h5 id="三个线程" tabindex="-1"><a class="header-anchor" href="#三个线程" aria-hidden="true">#</a> 三个线程</h5><p>实际上主从同步的原理就是基于 binlog 进行数据同步的。在主从复制过程中，会基于 <code>3 个线程</code>来操作，一个主库线程，两个从库线程。</p><p><img src="/assets/image-20220329231300735.cd6a235b.png" alt="image-20220329231300735"></p><p><code>二进制日志转储线程</code>（Binlog dump thread）是一个主库线程。当从库线程连接的时候， 主库可以将二进制日志发送给从库，当主库读取事件（Event）的时候，会在 Binlog 上<code>加锁</code>，读取完成之后，再将锁释放掉。</p><p><code>从库 I/O 线程会连接到主库</code>，向主库发送请求更新 Binlog。这时从库的 I/O 线程就可以读取到主库的二进制日志转储线程发送的 Binlog 更新部分，并且拷贝到本地的中继日志 （Relay log）。</p><p><code>从库 SQL 线程会</code>读取从库中的中继日志，并且执行日志中的事件，将从库中的数据与主库保持同步。</p><p><img src="/assets/image-20220329231429347.90aa9134.png" alt="image-20220329231429347"></p><blockquote><p>注意: 不是所有版本的MySQL都默认开启服务器的二进制日志。在进行主从同步的时候，我们需要先检查服务器是否已经开启了二进制日志。</p><p>除非特殊指定，默认情况下从服务器会执行所有主服务器中保存的事件。也可以通过配置，使从服务器执行特定的事件。</p></blockquote><h5 id="复制三步骤" tabindex="-1"><a class="header-anchor" href="#复制三步骤" aria-hidden="true">#</a> 复制三步骤</h5><p>步骤 1 ：<code>Master</code>将写操作记录到二进制日志（<code>binlog</code>）。</p><p>步骤 2 ：<code>Slave</code>将<code>Master</code>的binary log events拷贝到它的中继日志（<code>relay log</code>）；</p><p>步骤 3 ：<code>Slave</code>重做中继日志中的事件，将改变应用到自己的数据库中。 MySQL复制是异步的且串行化 的，而且重启后从<code>接入点</code>开始复制。</p><p><strong>复制的问题</strong></p><p>复制的最大问题：<code>延时</code></p><h3 id="_2-2-复制的基本原则" tabindex="-1"><a class="header-anchor" href="#_2-2-复制的基本原则" aria-hidden="true">#</a> 2. 2 复制的基本原则</h3><ul><li>每个<code>Slave</code>只有一个<code>Master</code></li><li>每个<code>Slave</code>只能有一个唯一的服务器ID</li><li>每个<code>Master</code>可以有多个<code>Slave</code></li></ul><h2 id="_3-一主一从架构搭建" tabindex="-1"><a class="header-anchor" href="#_3-一主一从架构搭建" aria-hidden="true">#</a> 3. 一主一从架构搭建</h2><p>一台<code>主机</code>用于处理所有<code>写请求</code>，一台从机负责所有读请求，架构图如下：</p><p><img src="/assets/image-20220329231549800.ee1b891d.png" alt="image-20220329231549800"></p><h3 id="_3-1-准备工作" tabindex="-1"><a class="header-anchor" href="#_3-1-准备工作" aria-hidden="true">#</a> 3. 1 准备工作</h3><p>1 、准备 <code>2 台</code>CentOS 虚拟机</p><p>2 、每台虚拟机上需要安装好MySQL (可以是MySQL8.0 )</p><p>说明：前面我们讲过如何克隆一台CentOS。大家可以在一台CentOS上安装好MySQL，进而通过克隆的方式复制出 1 台包含MySQL的虚拟机。</p><p>注意：克隆的方式需要修改新克隆出来主机的：① <code>MAC地址</code> ② <code>hostname</code> ③ <code>IP 地址</code> ④ <code>UUID</code>。</p><p>此外，克隆的方式生成的虚拟机（包含MySQL Server），则克隆的虚拟机MySQL Server的UUID相同，必须修改，否则在有些场景会报错。比如：<code>show slave status\G</code>，报如下的错误：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Last_IO_Error: Fatal error: The slave I/O thread stops because master and slave have
equal MySQL server UUIDs<span class="token punctuation">;</span> these UUIDs must be different <span class="token keyword">for</span> replication to work.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>修改MySQL Server 的UUID方式：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /var/lib/mysql/auto.cnf
systemctl restart mysqld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-主机配置文件" tabindex="-1"><a class="header-anchor" href="#_3-2-主机配置文件" aria-hidden="true">#</a> 3. 2 主机配置文件</h3><p>建议mysql版本一致且后台以服务运行，主从所有配置项都配置在[mysqld]节点下，且都是小写字母。</p><p>具体参数配置如下：</p><p><strong>必选</strong></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#[必须]主服务器唯一ID</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span> <span class="token value attr-value">1</span>

<span class="token comment">#[必须]启用二进制日志,指名路径。比如：自己本地的路径/log/mysqlbin</span>
<span class="token key attr-name">log-bin</span><span class="token punctuation">=</span><span class="token value attr-value">atguigu-bin</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>可选</strong></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#[可选] 0（默认）表示读写（主机）， 1 表示只读（从机）</span>
<span class="token key attr-name">read-only</span><span class="token punctuation">=</span> <span class="token value attr-value">0</span>

<span class="token comment">#设置日志文件保留的时长，单位是秒</span>
<span class="token key attr-name">binlog_expire_logs_seconds</span><span class="token punctuation">=</span> <span class="token value attr-value">6000</span>

<span class="token comment">#控制单个二进制日志大小。此参数的最大和默认值是1GB</span>
<span class="token key attr-name">max_binlog_size</span><span class="token punctuation">=</span><span class="token value attr-value">200M</span>

<span class="token comment">#[可选]设置不要复制的数据库</span>
<span class="token key attr-name">binlog-ignore-db</span><span class="token punctuation">=</span><span class="token value attr-value">test</span>

<span class="token comment">#[可选]设置需要复制的数据库,默认全部记录。比如：binlog-do-db=atguigu_master_slave</span>
<span class="token key attr-name">binlog-do-db</span><span class="token punctuation">=</span><span class="token value attr-value">需要复制的主数据库名字</span>

<span class="token comment">#[可选]设置binlog格式</span>
<span class="token key attr-name">binlog_format</span><span class="token punctuation">=</span><span class="token value attr-value">STATEMENT</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>binlog格式设置：</strong></p><p>格式 1 ：<code>STATEMENT模式</code>（基于SQL语句的复制(statement-based replication, SBR)）</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">binlog_format</span><span class="token punctuation">=</span><span class="token value attr-value">STATEMENT</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>每一条会修改数据的sql语句会记录到binlog中。这是默认的binlog格式。</p><ul><li>SBR 的优点： <ul><li>历史悠久，技术成熟</li><li>不需要记录每一行的变化，减少了binlog日志量，文件较小</li><li>binlog中包含了所有数据库更改信息，可以据此来审核数据库的安全等情况</li><li>binlog可以用于实时的还原，而不仅仅用于复制</li><li>主从版本可以不一样，从服务器版本可以比主服务器版本高</li></ul></li><li>SBR 的缺点： <ul><li>不是所有的UPDATE语句都能被复制，尤其是包含不确定操作的时候</li></ul></li><li>使用以下函数的语句也无法被复制：LOAD_FILE()、UUID()、USER()、FOUND_ROWS()、SYSDATE()(除非启动时启用了 --sysdate-is-now 选项) <ul><li>INSERT ... SELECT 会产生比 RBR 更多的行级锁</li><li>复制需要进行全表扫描(WHERE 语句中没有使用到索引)的 UPDATE 时，需要比 RBR 请求更多的行级锁</li><li>对于有 AUTO_INCREMENT 字段的 InnoDB表而言，INSERT 语句会阻塞其他 INSERT 语句</li><li>对于一些复杂的语句，在从服务器上的耗资源情况会更严重，而 RBR 模式下，只会对那个发生变化的记录产生影响</li><li>执行复杂语句如果出错的话，会消耗更多资源</li><li>数据表必须几乎和主服务器保持一致才行，否则可能会导致复制出错</li></ul></li></ul><p><strong>② ROW模式（基于行的复制(row-based replication, RBR)）</strong></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">binlog_format</span><span class="token punctuation">=</span><span class="token value attr-value">ROW</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>5.1.5版本的MySQL才开始支持，不记录每条sql语句的上下文信息，仅记录哪条数据被修改了，修改成什么样了。</p><ul><li>RBR 的优点： <ul><li>任何情况都可以被复制，这对复制来说是最<code>安全可靠</code>的。（比如：不会出现某些特定情况下的存储过程、function、trigger的调用和触发无法被正确复制的问题）</li><li>多数情况下，从服务器上的表如果有主键的话，复制就会快了很多</li><li>复制以下几种语句时的行锁更少：INSERT ... SELECT、包含 AUTO_INCREMENT 字段的 INSERT、没有附带条件或者并没有修改很多记录的 UPDATE 或 DELETE 语句</li><li>执行 INSERT，UPDATE，DELETE 语句时锁更少</li><li>从服务器上采用<code>多线程</code>来执行复制成为可能</li></ul></li><li>RBR 的缺点： <ul><li>binlog 大了很多</li><li>复杂的回滚时 binlog 中会包含大量的数据</li><li>主服务器上执行 UPDATE 语句时，所有发生变化的记录都会写到 binlog 中，而 SBR 只会写一次，这会导致频繁发生 binlog 的并发写问题</li><li>无法从 binlog 中看到都复制了些什么语句</li></ul></li></ul><p><strong>③ MIXED模式（混合模式复制(mixed-based replication, MBR)）</strong></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">binlog_format</span><span class="token punctuation">=</span><span class="token value attr-value">MIXED</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>从5.1.8版本开始，MySQL提供了Mixed格式，实际上就是Statement与Row的结合。</p><p>在Mixed模式下，一般的语句修改使用statment格式保存binlog。如一些函数，statement无法完成主从复制的操作，则采用row格式保存binlog。</p><p>MySQL会根据执行的每一条具体的sql语句来区分对待记录的日志形式，也就是在Statement和Row之间选择一种。</p><h3 id="_3-3-从机配置文件" tabindex="-1"><a class="header-anchor" href="#_3-3-从机配置文件" aria-hidden="true">#</a> 3. 3 从机配置文件</h3><p>要求主从所有配置项都配置在my.cnf的[mysqld]栏位下，且都是小写字母。</p><p><strong>必选</strong></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#[必须]从服务器唯一ID</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span> <span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>可选</strong></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#[可选]启用中继日志</span>
<span class="token key attr-name">relay-log</span><span class="token punctuation">=</span><span class="token value attr-value">mysql-relay</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>重启后台mysql服务，使配置生效。</p><blockquote><p>注意：主从机都关闭防火墙</p><p>service iptables stop #CentOS 6</p><p>systemctl stop firewalld.service #CentOS 7</p></blockquote><h3 id="_3-4-主机-建立账户并授权" tabindex="-1"><a class="header-anchor" href="#_3-4-主机-建立账户并授权" aria-hidden="true">#</a> 3. 4 主机：建立账户并授权</h3><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#在主机MySQL里执行授权主从复制的命令
GRANT REPLICATION SLAVE ON *.* TO &#39;slave1&#39;@&#39;从机器数据库IP&#39; IDENTIFIED BY &#39;abc123&#39;;
#5.5,5.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：如果使用的是MySQL8，需要如下的方式建立账户，并授权slave：</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE USER &#39;slave1&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT REPLICATION SLAVE ON *.* TO &#39;slave1&#39;@&#39;%&#39;;

#此语句必须执行。否则见下面。
ALTER USER &#39;slave1&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;

flush privileges;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：在从机执行show slave status\G时报错：</p><p>Last_IO_Error: error connecting to master &#39;slave1@192.168.1.150:3306&#39; - retry-time: 60 retries: 1 message: Authentication plugin &#39;caching_sha2_password&#39; reported error: Authentication requires secure connection.</p></blockquote><p>查询Master的状态，并记录下File和Position的值。</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>show master status;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20220329232741694.998f82d7.png" alt="image-20220329232741694"></p><ul><li>记录下File和Position的值</li></ul><blockquote><p>注意：执行完此步骤后 不要再操作主服务器MySQL ，防止主服务器状态值变化。</p></blockquote><h3 id="_3-5-从机-配置需要复制的主机" tabindex="-1"><a class="header-anchor" href="#_3-5-从机-配置需要复制的主机" aria-hidden="true">#</a> 3. 5 从机：配置需要复制的主机</h3><p><strong>步骤 1 ： 从机上复制主机的命令</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CHANGE MASTER TO
MASTER_HOST=&#39;主机的IP地址&#39;,
MASTER_USER=&#39;主机用户名&#39;,
MASTER_PASSWORD=&#39;主机用户名的密码&#39;,
MASTER_LOG_FILE=&#39;mysql-bin.具体数字&#39;,
MASTER_LOG_POS=具体值;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>举例：</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CHANGE MASTER TO
MASTER_HOST=&#39;192.168.1.150&#39;,MASTER_USER=&#39;slave1&#39;,MASTER_PASSWORD=&#39;123456&#39;,MASTER_LOG_F
ILE=&#39;atguigu-bin.000007&#39;,MASTER_LOG_POS= 154 ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20220329232934516.b58fa922.png" alt="image-20220329232934516"></p><p><img src="/assets/image-20220329232941780.b49c6628.png" alt="image-20220329232941780"></p><p>步骤 2 ：</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#启动slave同步
START SLAVE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="data:image/png;base64,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" alt="image-20220329232952153"></p><p>如果报错：</p><p><img src="/assets/image-20220329232958011.ef939002.png" alt="image-20220329232958011"></p><p>可以执行如下操作，删除之前的relay_log信息。然后重新执行 CHANGE MASTER TO ...语句即可。</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; reset slave; #删除SLAVE数据库的relaylog日志文件，并重新启用新的relaylog文件
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>接着，查看同步状态：</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW SLAVE STATUS\G;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/assets/image-20220329233124775.048f06c2.png" alt="image-20220329233124775"></p><blockquote><p>上面两个参数都是Yes，则说明主从配置成功！</p></blockquote><p><strong>显式如下的情况，就是不正确的。可能错误的原因有：</strong></p><ol><li>网络不通</li><li>账户密码错误</li><li>防火墙</li><li>mysql配置文件问题</li><li>连接服务器时语法</li><li>主服务器mysql权限</li></ol><p><img src="/assets/image-20220329233204316.9556c672.png" alt="image-20220329233204316"></p><h3 id="_3-6-测试" tabindex="-1"><a class="header-anchor" href="#_3-6-测试" aria-hidden="true">#</a> 3. 6 测试</h3><p>主机新建库、新建表、insert记录，从机复制：</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE DATABASE atguigu_master_slave;
CREATE TABLE mytbl(id INT,NAME VARCHAR( 16 ));		
INSERT INTO mytbl VALUES( 1 , &#39;zhang3&#39;);
INSERT INTO mytbl VALUES( 2 ,@@hostname);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-停止主从同步" tabindex="-1"><a class="header-anchor" href="#_3-7-停止主从同步" aria-hidden="true">#</a> 3. 7 停止主从同步</h3><ul><li><p>停止主从同步命令：</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>stop slave;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>如何重新配置主从</p><p>如果停止从服务器复制功能，再使用需要重新配置主从。否则会报错如下：</p><p><img src="/assets/image-20220329233352720.9fb38421.png" alt="image-20220329233352720"></p><p>重新配置主从，需要在从机上执行：</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>stop slave;

reset master; #删除Master中所有的binglog文件，并将日志索引文件清空，重新开始所有新的日志文件(慎用)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_3-8-后续" tabindex="-1"><a class="header-anchor" href="#_3-8-后续" aria-hidden="true">#</a> 3. 8 后续</h3><h5 id="搭建主从复制-双主双从" tabindex="-1"><a class="header-anchor" href="#搭建主从复制-双主双从" aria-hidden="true">#</a> 搭建主从复制：双主双从</h5><p><img src="/assets/e74cdb04428b07731a11ab61f0e49e92.6231e03e.png" alt="image-20220329233433439"></p><p><img src="/assets/image-20220329233448778.5e28d051.png" alt="image-20220329233448778"></p><h2 id="_4-同步数据一致性问题" tabindex="-1"><a class="header-anchor" href="#_4-同步数据一致性问题" aria-hidden="true">#</a> 4. 同步数据一致性问题</h2><p><strong>主从同步的要求：</strong></p><ul><li>读库和写库的数据一致(最终一致)；</li><li>写数据必须写到写库；</li><li>读数据必须到读库(不一定)；</li></ul><h3 id="_4-1-理解主从延迟问题" tabindex="-1"><a class="header-anchor" href="#_4-1-理解主从延迟问题" aria-hidden="true">#</a> 4. 1 理解主从延迟问题</h3><p>进行主从同步的内容是二进制日志，它是一个文件，在进行<code>网络传输</code>的过程中就一定会<code>存在主从延迟</code>（比如 500 ms），这样就可能造成用户在从库上读取的数据不是最新的数据，也就是主从同步中的<code>数据不一致性</code>问题。</p><p>**举例:**导致主从延迟的时间点主要包括以下三个:</p><p>1.主库A执行完成一个事务，写入binlog，我们把这个时刻记为T1;</p><p>2之后传给从库B，我们把从库B接收完这个binlog的时刻记为T2;</p><p>3．从库B执行完成这个事务，我们把这个时刻记为T3。</p><h3 id="_4-2-主从延迟问题原因" tabindex="-1"><a class="header-anchor" href="#_4-2-主从延迟问题原因" aria-hidden="true">#</a> 4. 2 主从延迟问题原因</h3><p>在网络正常的时候，日志从主库传给从库所需的时间是很短的，即T 2 - T 1 的值是非常小的。即，网络正常情况下，主备延迟的主要来源是备库接收完binlog和执行完这个事务之间的时间差。</p><p><strong>主备延迟最直接的表现是，从库消费中继日志（relay log）的速度，比主库生产binlog的速度要慢。</strong> 造成原因：</p><p>1 、从库的机器性能比主库要差</p><p>2 、从库的压力大</p><p>3 、大事务的执行</p><p><strong>举例 1 ：</strong> 一次性用delete语句删除太多数据</p><p>结论：后续再删除数据的时候，要控制每个事务删除的数据量，分成多次删除。</p><p><strong>举例 2 ：</strong> 一次性用insert...select插入太多数据</p><p><strong>举例: 3 ：</strong> 大表DDL</p><p>比如在主库对一张500W的表添加一个字段耗费了 10 分钟，那么从节点上也会耗费 10 分钟。</p><h3 id="_4-3-如何减少主从延迟" tabindex="-1"><a class="header-anchor" href="#_4-3-如何减少主从延迟" aria-hidden="true">#</a> 4. 3 如何减少主从延迟</h3><p><strong>若想要减少主从延迟的时间，可以采取下面的办法：</strong></p><ol><li>降低多线程大事务并发的概率，优化业务逻辑</li><li>优化SQL，避免慢SQL，<code>减少批量操作</code>，建议写脚本以update-sleep这样的形式完成。</li><li><code>提高从库机器的配置</code>，减少主库写binlog和从库读binlog的效率差。</li><li>尽量采用<code>短的链路</code>，也就是主库和从库服务器的距离尽量要短，提升端口带宽，减少binlog传输的网络延时。</li><li>实时性要求的业务读强制走主库，从库只做灾备，备份。</li></ol><h3 id="_4-4-如何解决一致性问题" tabindex="-1"><a class="header-anchor" href="#_4-4-如何解决一致性问题" aria-hidden="true">#</a> 4. 4 如何解决一致性问题</h3><p>如果操作的数据存储在同一个数据库中，那么对数据进行更新的时候，可以对记录加写锁，这样在读取的时候就不会发生数据不一致的情况。但这时从库的作用就是备份，并没有起到读写分离，分担主库读压力的作用。</p><p><img src="/assets/image-20220329233714671.c09ad3c9.png" alt="image-20220329233714671"></p><p>读写分离情况下，解决主从同步中数据不一致的问题， 就是解决主从之间<code>数据复制方式</code>的问题，如果按照数据一致性<code>从弱到强来</code>进行划分，有以下 3 种复制方式。</p><h4 id="方法-1-异步复制" tabindex="-1"><a class="header-anchor" href="#方法-1-异步复制" aria-hidden="true">#</a> 方法 1 ：异步复制</h4><p>异步模式就是客户端提交COMMIT之后不需要等从库返回任何结果，而是直接将结果返回给客户端，这样做的好处是不会影响主库写的效率，但可能会存在主库宕机，而Binlog还没有同步到从库的情况，也就是此时的主库和从库数据不一致。这时候从从库中选择一个作为新主，那么新主则可能缺少原来主服务器中已提交的事务。所以，这种复制模式下的数据一致性是最弱的。</p><p><img src="/assets/image-20220329233747296.cfd0dbf6.png" alt="image-20220329233747296"></p><h4 id="方法-2-半同步复制" tabindex="-1"><a class="header-anchor" href="#方法-2-半同步复制" aria-hidden="true">#</a> 方法 2 ：半同步复制</h4><p>MySQL5.5版本之后开始支持半同步复制的方式。原理是在客户端提交COMMIT之后不直接将结果返回给客户端，而是等待至少有一个从库接收到了Binlog，并且写入到中继日志中，再返回给客户端。</p><p>这样做的好处就是提高了数据的一致性，当然相比于异步复制来说，至少多增加了一个网络连接的延迟，降低了主库写的效率。</p><p>在MySQL5.7版本中还增加了一个rpl_semi_sync_master_wait_for_slave_count参数，可以对应答的从库数量进行设置，默认为1，也就是说只要有1个从库进行了响应，就可以返回给客户端。如果将这个参数调大，可以提升数据一致性的强度，但也会增加主库等待从库响应的时间。</p><p><img src="/assets/image-20220329233800680.9fbd05f5.png" alt="image-20220329233800680"></p><h4 id="方法-3-组复制" tabindex="-1"><a class="header-anchor" href="#方法-3-组复制" aria-hidden="true">#</a> 方法 3 ：组复制</h4><p>异步复制和半同步复制都无法最终保证数据的一致性问题，半同步复制是通过判断从库响应的个数来决定是否返回给客户端，虽然数据一致性相比于异步复制有提升，但仍然无法满足对数据一致性要求高的场景，比如金融领域。MGR 很好地弥补了这两种复制模式的不足。</p><p>组复制技术，简称 MGR（MySQL Group Replication）。是 MySQL 在 5.7.17 版本中推出的一种新的数据复制技术，这种复制技术是基于 Paxos 协议的状态机复制。</p><p><strong>MGR 是如何工作的</strong></p><p>首先我们将多个节点共同组成一个复制组，在<code>执行读写（RW）事务</code>的时候，需要通过一致性协议层（Consensus 层）的同意，也就是读写事务想要进行提交，必须要经过组里“大多数人”（对应 Node 节点）的同意，大多数指的是同意的节点数量需要大于 （N/2+1），这样才可以进行提交，而不是原发起方一个说了算。而针对<code>只读（RO）事务</code>则不需要经过组内同意，直接 COMMIT 即可。</p><p>在一个复制组内有多个节点组成，它们各自维护了自己的数据副本，并且在一致性协议层实现了原子消息和全局有序消息，从而保证组内数据的一致性。</p><p><img src="/assets/image-20220329233847020.311ceeec.png" alt="image-20220329233847020"></p><p>MGR 将 MySQL 带入了数据强一致性的时代，是一个划时代的创新，其中一个重要的原因就是MGR 是基于 Paxos 协议的。Paxos 算法是由 2013 年的图灵奖获得者 Leslie Lamport 于 1990 年提出的，有关这个算法的决策机制可以搜一下。事实上，Paxos 算法提出来之后就作为<code>分布式一致性算法</code>被广泛应用，比如Apache 的 ZooKeeper 也是基于 Paxos 实现的。</p><h2 id="_5-知识延伸" tabindex="-1"><a class="header-anchor" href="#_5-知识延伸" aria-hidden="true">#</a> 5. 知识延伸</h2><p>在主从架构的配置中，如果想要采取读写分离的策略，我们可以<code>自己编写程序</code>，也可以通过<code>第三方的中间件</code>来实现。</p><ul><li><p>自己编写程序的好处就在于比较自主，我们可以自己判断哪些查询在从库上来执行，针对实时性要求高的需求，我们还可以考虑哪些查询可以在主库上执行。同时，程序直接连接数据库，减少了中间件层，相当于减少了性能损耗。</p></li><li><p>采用中间件的方法有很明显的优势，功能强大，使用简单。但因为在客户端和数据库之间增加了中间件层会有一些性能损耗，同时商业中间件也是有使用成本的。我们也可以考虑采取一些优秀的开源工具。</p><p><img src="/assets/image-20220329234028528.3a8582e9.png" alt="image-20220329234028528"></p></li></ul><p>① Cobar属于阿里B2B事业群，始于 2008 年，在阿里服役 3 年多，接管3000+个MySQL数据库的schema,集群日处理在线SQL请求 50 亿次以上。由于Cobar发起人的离职，Cobar停止维护。</p><p>② Mycat是开源社区在阿里cobar基础上进行二次开发，解决了cobar存在的问题，并且加入了许多新的功能在其中。青出于蓝而胜于蓝。</p><p>③ OneProxy基于MySQL官方的proxy思想利用c语言进行开发的，OneProxy是一款商业收费的中间件。舍弃了一些功能，专注在性能和稳定性上。</p><p>④ kingshard由小团队用go语言开发，还需要发展，需要不断完善。</p><p>⑤ Vitess是Youtube生产在使用，架构很复杂。不支持MySQL原生协议，使用需要大量改造成本。</p><p>⑥ Atlas是 360 团队基于mysql proxy改写，功能还需完善，高并发下不稳定。</p><p>⑦ MaxScale是mariadb（MySQL原作者维护的一个版本） 研发的中间件</p><p>⑧ MySQLRoute是MySQL官方Oracle公司发布的中间件</p><p><img src="/assets/image-20220329234200370.ad06c5c8.png" alt="image-20220329234200370"></p><p><img src="/assets/image-20220329234212660.b7b283df.png" alt="image-20220329234212660"></p><p>主备切换：</p><p><img src="/assets/image-20220329234237134.35f75874.png" alt="image-20220329234237134"></p><ul><li><p>主动切换</p></li><li><p>被动切换</p></li><li><p>如何判断主库出问题了？如何解决过程中的数据不一致性问题？</p></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Ragnarokoo/LearningNotes/edit/master/src/notes/db/mysql_pro/第18章_主从复制.md" rel="noopener noreferrer" target="_blank" aria-label="在【Github】上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在【Github】上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><a href="/notes/db/mysql_pro/%E7%AC%AC17%E7%AB%A0_%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97.html" class="nav-link prev" aria-label="第17章_其他数据库日志"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->第17章_其他数据库日志</div></a><a href="/notes/db/mysql_pro/%E7%AC%AC19%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D.html" class="nav-link next" aria-label="第19章_数据库备份与恢复"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">第19章_数据库备份与恢复<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.9b10ba0a.js" defer></script>
  </body>
</html>
