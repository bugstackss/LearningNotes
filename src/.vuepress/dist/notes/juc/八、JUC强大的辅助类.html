<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://Ragnarokoo.github.io/LearningNotes/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html"><meta property="og:site_name" content="ğŸ“šå…¨æ ˆå¼€å‘å­¦ä¹ æŒ‡å—"><meta property="og:title" content="å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»"><meta property="og:description" content="å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±» 1ã€CountDownLatchå‡å°‘è®¡æ•° CountDownLatchç§°ä¹‹ä¸ºé—­é”ï¼Œå®ƒå¯ä»¥ä½¿ä¸€ä¸ªæˆ–ä¸€æ‰¹çº¿ç¨‹åœ¨é—­é”ä¸Šç­‰å¾…ï¼Œç­‰åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œç›¸åº”æ“ä½œåï¼Œé—­é”æ‰“å¼€ï¼Œè¿™äº›ç­‰å¾…çš„çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ç¡®åˆ‡çš„è¯´ï¼Œé—­é”åœ¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå€’è®¡æ•°å™¨ã€‚é€šè¿‡è¯¥è®¡æ•°å™¨çš„å€¼æ¥å†³å®šé—­é”çš„çŠ¶æ€ï¼Œä»è€Œå†³å®šæ˜¯å¦å…è®¸ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚ å¸¸ç”¨æ–¹æ³•ï¼š public Co..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-05-31T09:16:41.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="java"><meta property="article:tag" content="juc"><meta property="article:tag" content="å¹¶å‘ç¼–ç¨‹"><meta property="article:modified_time" content="2023-05-31T09:16:41.000Z"><link rel="icon" href="/site_logo.svg"><title>å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±» | ğŸ“šå…¨æ ˆå¼€å‘å­¦ä¹ æŒ‡å—</title><meta name="description" content="å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±» 1ã€CountDownLatchå‡å°‘è®¡æ•° CountDownLatchç§°ä¹‹ä¸ºé—­é”ï¼Œå®ƒå¯ä»¥ä½¿ä¸€ä¸ªæˆ–ä¸€æ‰¹çº¿ç¨‹åœ¨é—­é”ä¸Šç­‰å¾…ï¼Œç­‰åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œç›¸åº”æ“ä½œåï¼Œé—­é”æ‰“å¼€ï¼Œè¿™äº›ç­‰å¾…çš„çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ç¡®åˆ‡çš„è¯´ï¼Œé—­é”åœ¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå€’è®¡æ•°å™¨ã€‚é€šè¿‡è¯¥è®¡æ•°å™¨çš„å€¼æ¥å†³å®šé—­é”çš„çŠ¶æ€ï¼Œä»è€Œå†³å®šæ˜¯å¦å…è®¸ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚ å¸¸ç”¨æ–¹æ³•ï¼š public Co...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.bc8b6d7c.css" as="style" /><link rel="stylesheet" href="/assets/style.bc8b6d7c.css" />
    <link rel="modulepreload" href="/assets/app.9b10ba0a.js"><link rel="modulepreload" href="/assets/å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±».html.cab19152.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±».html.13a2aaa2.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/site_logo.svg" alt="ğŸ“šå…¨æ ˆå¼€å‘å­¦ä¹ æŒ‡å—"><!----><span class="site-name hide-in-pad">ğŸ“šå…¨æ ˆå¼€å‘å­¦ä¹ æŒ‡å—</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/quicknav/" class="nav-link" aria-label="å¿«é€Ÿå¯¼èˆª"><span class="icon iconfont icon-navigation"></span>å¿«é€Ÿå¯¼èˆª<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="åšå®¢ä¸»é¡µ"><span class="icon iconfont icon-blog"></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/notes/" class="nav-link active" aria-label="Javaå­¦ä¹ æ•™ç¨‹"><span class="icon iconfont icon-java"></span>Javaå­¦ä¹ æ•™ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/web/" class="nav-link" aria-label="webå­¦ä¹ æ•™ç¨‹"><span class="icon iconfont icon-note"></span>webå­¦ä¹ æ•™ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/springcloud/" class="nav-link" aria-label="SpringCloudå­¦ä¹ æ•™ç¨‹"><span class="icon iconfont icon-cache"></span>SpringCloudå­¦ä¹ æ•™ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/distributed/" class="nav-link" aria-label="åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„"><span class="icon iconfont icon-read"></span>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="èµ„æºå®åº“"><span class="title"><span class="icon iconfont icon-advance"></span>èµ„æºå®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/resources/books/" class="nav-link" aria-label="ä¹¦ç±èµ„æº"><span class="icon iconfont icon-animation"></span>ä¹¦ç±èµ„æº<!----></a></li><li class="dropdown-item"><a href="/resources/videos/" class="nav-link" aria-label="å½±éŸ³èµ„æº"><span class="icon iconfont icon-play"></span>å½±éŸ³èµ„æº<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Ragnarokoo/LearningNotes" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢æœ¬ç«™" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java Languageä¸“æ </span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-IO"></span><span class="title">Javaç½‘ç»œç¼–ç¨‹NIO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-community"></span><span class="title">JDBCæ•°æ®åº“è¿æ¥æŠ€æœ¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-categoryselected"></span><span class="title">JavaWeb</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-array"></span><span class="title">SSM Framework</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-geometry"></span><span class="title">SpringData</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-type"></span><span class="title">SpringBoot</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-module"></span><span class="title">mybatisplus</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-operate"></span><span class="title">æ„å»ºå·¥å…·&amp;äº‘åŸç”ŸDevops</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mysql"></span><span class="title">æ•°æ®åº“ä»¥åŠè°ƒä¼˜ç­–ç•¥</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-quote"></span><span class="title">æ¶ˆæ¯ä¸­é—´ä»¶</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tool"></span><span class="title">è½¯ä»¶ä»¥åŠç¯å¢ƒé…ç½®</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">Linuxæ“ä½œç³»ç»Ÿ</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-rank"></span><span class="title">JUCé«˜å¹¶å‘ç¼–ç¨‹</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸€ã€çº¿ç¨‹åŸºç¡€"><!---->ä¸€ã€çº¿ç¨‹åŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0.html" class="nav-link sidebar-link sidebar-page" aria-label="äºŒã€çº¿ç¨‹æ± "><!---->äºŒã€çº¿ç¨‹æ± <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%B8%89%E3%80%81CompletableFuture.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸‰ã€CompletableFuture"><!---->ä¸‰ã€CompletableFuture<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%9B%9B%E3%80%81Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="å››ã€Javaâ€œé”â€äº‹"><!---->å››ã€Javaâ€œé”â€äº‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%BA%94%E3%80%81%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="äº”ã€çº¿ç¨‹é—´é€šä¿¡"><!---->äº”ã€çº¿ç¨‹é—´é€šä¿¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%85%AD%E3%80%81LockSupport%E4%B8%8E%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD.html" class="nav-link sidebar-link sidebar-page" aria-label="å…­ã€LockSupportä¸çº¿ç¨‹ä¸­æ–­"><!---->å…­ã€LockSupportä¸çº¿ç¨‹ä¸­æ–­<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%B8%83%E3%80%81%E9%9B%86%E5%90%88%E4%B8%8D%E5%AE%89%E5%85%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸ƒã€é›†åˆä¸å®‰å…¨"><!---->ä¸ƒã€é›†åˆä¸å®‰å…¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»"><!---->å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#å…«ã€jucå¼ºå¤§çš„è¾…åŠ©ç±»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»"><!---->å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#_1ã€countdownlatchå‡å°‘è®¡æ•°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€CountDownLatchå‡å°‘è®¡æ•°"><!---->1ã€CountDownLatchå‡å°‘è®¡æ•°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#_2ã€cyclicbarrierå¾ªç¯æ …æ " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€CyclicBarrierå¾ªç¯æ …æ "><!---->2ã€CyclicBarrierå¾ªç¯æ …æ <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#_3ã€semaphoreä¿¡å·ç¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€Semaphoreä¿¡å·ç¯"><!---->3ã€Semaphoreä¿¡å·ç¯<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%B9%9D%E3%80%81Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B9%8BJMM.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¹ã€Javaå†…å­˜æ¨¡å‹ä¹‹JMM"><!---->ä¹ã€Javaå†…å­˜æ¨¡å‹ä¹‹JMM<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E3%80%81volatile%E4%B8%8EJava%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="åã€volatileä¸Javaå†…å­˜æ¨¡å‹"><!---->åã€volatileä¸Javaå†…å­˜æ¨¡å‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%B8%80%E3%80%81CAS.html" class="nav-link sidebar-link sidebar-page" aria-label="åä¸€ã€CAS"><!---->åä¸€ã€CAS<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%BA%8C%E3%80%81%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%B1%BB%E4%B9%8B18%E7%BD%97%E6%B1%89%E5%A2%9E%E5%BC%BA.html" class="nav-link sidebar-link sidebar-page" aria-label="åäºŒã€åŸå­æ“ä½œç±»ä¹‹18ç½—æ±‰å¢å¼º"><!---->åäºŒã€åŸå­æ“ä½œç±»ä¹‹18ç½—æ±‰å¢å¼º<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%B8%89%E3%80%81ThreadLocal%E3%80%81InheritableThreadLocal.html" class="nav-link sidebar-link sidebar-page" aria-label="åä¸‰ã€ThreadLocalã€InheritableThreadLocal"><!---->åä¸‰ã€ThreadLocalã€InheritableThreadLocal<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E5%9B%9B%E3%80%81Java%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%A4%B4.html" class="nav-link sidebar-link sidebar-page" aria-label="åå››ã€Javaå¯¹è±¡å†…å­˜å¸ƒå±€å’Œå¯¹è±¡å¤´"><!---->åå››ã€Javaå¯¹è±¡å†…å­˜å¸ƒå±€å’Œå¯¹è±¡å¤´<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%BA%94%E3%80%81Synchronized%E4%B8%8E%E9%94%81%E5%8D%87%E7%BA%A7.html" class="nav-link sidebar-link sidebar-page" aria-label="åäº”ã€Synchronizedä¸é”å‡çº§"><!---->åäº”ã€Synchronizedä¸é”å‡çº§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E5%85%AD%E3%80%81AbstractQueuedSynchronizer%E4%B9%8BAQS.html" class="nav-link sidebar-link sidebar-page" aria-label="åå…­ã€AbstractQueuedSynchronizerä¹‹AQS"><!---->åå…­ã€AbstractQueuedSynchronizerä¹‹AQS<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%B8%83%E3%80%81ReentrantLock%E3%80%81ReentrantReadWriteLock%E3%80%81StampedLock.html" class="nav-link sidebar-link sidebar-page" aria-label="åä¸ƒã€ReentrantLockã€ReentrantReadWriteLockã€StampedLock"><!---->åä¸ƒã€ReentrantLockã€ReentrantReadWriteLockã€StampedLock<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/Prog.html" class="nav-link sidebar-link sidebar-page" aria-label="JUCæ ¸å¿ƒæŠ€æœ¯æ–‡ç« "><span class="icon iconfont icon-java"></span>JUCæ ¸å¿ƒæŠ€æœ¯æ–‡ç« <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mount"></span><span class="title">æ·±å…¥äº†è§£Javaè™šæ‹Ÿæœº</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-view"></span><span class="title">GOF23ç§è®¾è®¡æ¨¡å¼</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tag"></span><span class="title">æŠ€æœ¯è¦ç‚¹ä¸šåŠ¡ç¯‡</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»</h1><div class="page-info"><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category7 clickable" role="navigation">JUC</span></li><li><span class="category category6 clickable" role="navigation">java</span></li></ul><meta property="articleSection" content="JUC,java"></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag6 clickable" role="navigation">java</span></li><li><span class="tag tag1 clickable" role="navigation">juc</span></li><li><span class="tag tag6 clickable" role="navigation">å¹¶å‘ç¼–ç¨‹</span></li></ul><meta property="keywords" content="java,juc,å¹¶å‘ç¼–ç¨‹"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 38 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT38M"></span><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/Ragnarokoo/" target="_blank" rel="noopener noreferrer">Ragnarok</a></span><span property="author" content="Ragnarok"></span></span><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-05-31T09:16:41.000Z"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#å…«ã€jucå¼ºå¤§çš„è¾…åŠ©ç±»" class="router-link-active router-link-exact-active toc-link level2">å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#_1ã€countdownlatchå‡å°‘è®¡æ•°" class="router-link-active router-link-exact-active toc-link level3">1ã€CountDownLatchå‡å°‘è®¡æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#_2ã€cyclicbarrierå¾ªç¯æ …æ " class="router-link-active router-link-exact-active toc-link level3">2ã€CyclicBarrierå¾ªç¯æ …æ </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html#_3ã€semaphoreä¿¡å·ç¯" class="router-link-active router-link-exact-active toc-link level3">3ã€Semaphoreä¿¡å·ç¯</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="å…«ã€jucå¼ºå¤§çš„è¾…åŠ©ç±»" tabindex="-1"><a class="header-anchor" href="#å…«ã€jucå¼ºå¤§çš„è¾…åŠ©ç±»" aria-hidden="true">#</a> å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»</h2><h3 id="_1ã€countdownlatchå‡å°‘è®¡æ•°" tabindex="-1"><a class="header-anchor" href="#_1ã€countdownlatchå‡å°‘è®¡æ•°" aria-hidden="true">#</a> 1ã€CountDownLatchå‡å°‘è®¡æ•°</h3><p>CountDownLatchç§°ä¹‹ä¸ºé—­é”ï¼Œå®ƒå¯ä»¥ä½¿ä¸€ä¸ªæˆ–ä¸€æ‰¹çº¿ç¨‹åœ¨é—­é”ä¸Šç­‰å¾…ï¼Œç­‰åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œç›¸åº”æ“ä½œåï¼Œé—­é”æ‰“å¼€ï¼Œè¿™äº›ç­‰å¾…çš„çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ç¡®åˆ‡çš„è¯´ï¼Œé—­é”åœ¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå€’è®¡æ•°å™¨ã€‚é€šè¿‡è¯¥è®¡æ•°å™¨çš„å€¼æ¥å†³å®šé—­é”çš„çŠ¶æ€ï¼Œä»è€Œå†³å®šæ˜¯å¦å…è®¸ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p><p><strong>å¸¸ç”¨æ–¹æ³•ï¼š</strong></p><p><strong>public CountDownLatch(int count)</strong>ï¼šæ„é€ æ–¹æ³•ï¼Œcountè¡¨ç¤ºè®¡æ•°å™¨çš„å€¼ï¼Œä¸èƒ½å°äº0ï¼Œå¦è€…ä¼šæŠ¥å¼‚å¸¸ã€‚</p><p><strong>public void await() throws InterruptedException</strong>ï¼šè°ƒç”¨await()ä¼šè®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ï¼Œæ–¹æ³•æ‰ä¼šè¿”å›ï¼Œæ­¤æ–¹æ³•ä¼šå“åº”çº¿ç¨‹ä¸­æ–­æ“ä½œã€‚</p><p><strong>public boolean await(long timeout, TimeUnit unit) throws InterruptedException</strong>ï¼šé™æ—¶ç­‰å¾…ï¼Œåœ¨è¶…æ—¶ä¹‹å‰ï¼Œè®¡æ•°å™¨å˜ä¸ºäº†0ï¼Œæ–¹æ³•è¿”å›trueï¼Œå¦è€…ç›´åˆ°è¶…æ—¶ï¼Œè¿”å›falseï¼Œæ­¤æ–¹æ³•ä¼šå“åº”çº¿ç¨‹ä¸­æ–­æ“ä½œã€‚</p><p><strong>public void countDown()</strong>ï¼šè®©è®¡æ•°å™¨å‡1</p><p>CountDownLatchä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºCountDownLatchå¯¹è±¡</li><li>è°ƒç”¨å…¶å®ä¾‹æ–¹æ³•<code>await()</code>ï¼Œè®©å½“å‰çº¿ç¨‹ç­‰å¾…</li><li>è°ƒç”¨<code>countDown()</code>æ–¹æ³•ï¼Œè®©è®¡æ•°å™¨å‡1</li><li>å½“è®¡æ•°å™¨å˜ä¸º0çš„æ—¶å€™ï¼Œ<code>await()</code>æ–¹æ³•ä¼šè¿”å›</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * 
 * @Description:
 *  *è®©ä¸€äº›çº¿ç¨‹é˜»å¡ç›´åˆ°å¦ä¸€äº›çº¿ç¨‹å®Œæˆä¸€ç³»åˆ—æ“ä½œåæ‰è¢«å”¤é†’ã€‚
 * 
 * CountDownLatchä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šé˜»å¡ã€‚
 * å…¶å®ƒçº¿ç¨‹è°ƒç”¨countDownæ–¹æ³•ä¼šå°†è®¡æ•°å™¨å‡1(è°ƒç”¨countDownæ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡)ï¼Œ
 * å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º0æ—¶ï¼Œå› awaitæ–¹æ³•é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚
 * 
 * è§£é‡Šï¼š6ä¸ªåŒå­¦é™†ç»­ç¦»å¼€æ•™å®¤åå€¼ç­åŒå­¦æ‰å¯ä»¥å…³é—¨ã€‚
 * 
 * mainä¸»çº¿ç¨‹å¿…é¡»è¦ç­‰å‰é¢6ä¸ªçº¿ç¨‹å®Œæˆå…¨éƒ¨å·¥ä½œåï¼Œè‡ªå·±æ‰èƒ½å¼€å¹² 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span>
<span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
   <span class="token punctuation">{</span>
         <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//6ä¸ªä¸Šè‡ªä¹ çš„åŒå­¦ï¼Œå„è‡ªç¦»å¼€æ•™å®¤çš„æ—¶é—´ä¸ä¸€è‡´</span>
       <span class="token punctuation">{</span>
          <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t å·åŒå­¦ç¦»å¼€æ•™å®¤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t****** ç­é•¿å…³é—¨èµ°äººï¼Œmainçº¿ç¨‹æ˜¯ç­é•¿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>CountDownLatchä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šé˜»å¡ã€‚</li><li>å…¶å®ƒçº¿ç¨‹è°ƒç”¨countDownæ–¹æ³•ä¼šå°†è®¡æ•°å™¨å‡1(è°ƒç”¨countDownæ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡)ï¼Œ</li><li>å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º0æ—¶ï¼Œå› awaitæ–¹æ³•é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚</li></ul><h4 id="ç¤ºä¾‹1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹1" aria-hidden="true">#</a> ç¤ºä¾‹1</h4><p>å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œå½“æˆ‘ä»¬éœ€è¦è§£æä¸€ä¸ªExcelé‡Œå¤šä¸ªsheetçš„æ•°æ®æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è§£æä¸€ä¸ªsheeté‡Œçš„æ•°æ®ï¼Œç­‰åˆ°æ‰€æœ‰çš„sheetéƒ½è§£æå®Œä¹‹åï¼Œç¨‹åºéœ€è¦ç»Ÿè®¡è§£ææ€»è€—æ—¶ã€‚åˆ†æä¸€ä¸‹ï¼šè§£ææ¯ä¸ªsheetè€—æ—¶å¯èƒ½ä¸ä¸€æ ·ï¼Œæ€»è€—æ—¶å°±æ˜¯æœ€é•¿è€—æ—¶çš„é‚£ä¸ªæ“ä½œã€‚</p><p>æˆ‘ä»¬èƒ½å¤Ÿæƒ³åˆ°çš„æœ€ç®€å•çš„åšæ³•æ˜¯ä½¿ç”¨joinï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//ä¼‘çœ æ—¶é—´ï¼ˆç§’ï¼‰</span>
        <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds <span class="token operator">=</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¼€å§‹å¤„ç†!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä¼‘çœ sleepSecondsç§’</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¤„ç†å®Œæ¯•,è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è§£æsheet1çº¿ç¨‹&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è§£æsheet2çº¿ç¨‹&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token number">1563767560271</span><span class="token punctuation">,</span>è§£æsheet1çº¿ç¨‹<span class="token punctuation">,</span>å¼€å§‹å¤„ç†<span class="token operator">!</span>
<span class="token number">1563767560272</span><span class="token punctuation">,</span>è§£æsheet2çº¿ç¨‹<span class="token punctuation">,</span>å¼€å§‹å¤„ç†<span class="token operator">!</span>
<span class="token number">1563767562273</span><span class="token punctuation">,</span>è§£æsheet1çº¿ç¨‹<span class="token punctuation">,</span>å¤„ç†å®Œæ¯•<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">2002</span>
<span class="token number">1563767565274</span><span class="token punctuation">,</span>è§£æsheet2çº¿ç¨‹<span class="token punctuation">,</span>å¤„ç†å®Œæ¯•<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">5002</span>
æ€»è€—æ—¶<span class="token operator">:</span><span class="token number">5005</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­å¯åŠ¨äº†2ä¸ªè§£æsheetçš„çº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªè€—æ—¶2ç§’ï¼Œç¬¬äºŒä¸ªè€—æ—¶5ç§’ï¼Œæœ€ç»ˆç»“æœä¸­æ€»è€—æ—¶ï¼š5ç§’ã€‚ä¸Šé¢çš„å…³é”®æŠ€æœ¯ç‚¹æ˜¯çº¿ç¨‹çš„<code>join()</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ç­‰å¾…è¢«è°ƒç”¨çš„çº¿ç¨‹å®Œæˆä¹‹åæ‰èƒ½ç»§ç»­ã€‚å¯ä»¥çœ‹ä¸€ä¸‹joinçš„æºç ï¼Œå†…éƒ¨å…¶å®æ˜¯åœ¨synchronizedæ–¹æ³•ä¸­è°ƒç”¨äº†çº¿ç¨‹çš„waitæ–¹æ³•ï¼Œæœ€åè¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œç”±jvmè‡ªåŠ¨è°ƒç”¨å…¶notifyAll()æ–¹æ³•ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…ä¸­çš„çº¿ç¨‹ã€‚è¿™ä¸ªnotifyAll()æ–¹æ³•æ˜¯ç”±jvmå†…éƒ¨è‡ªåŠ¨è°ƒç”¨çš„ï¼Œjdkæºç ä¸­æ˜¯çœ‹ä¸åˆ°çš„ï¼Œéœ€è¦çœ‹jvmæºç ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»æŸ¥ä¸€ä¸‹ã€‚æ‰€ä»¥JDKä¸æ¨èåœ¨çº¿ç¨‹ä¸Šè°ƒç”¨waitã€notifyã€notifyAllæ–¹æ³•ã€‚</p><p>è€Œåœ¨JDK1.5ä¹‹åçš„å¹¶å‘åŒ…ä¸­æä¾›çš„CountDownLatchä¹Ÿå¯ä»¥å®ç°joinçš„è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨CountDownLatchæ¥å®Œæˆä¸Šé¢ç¤ºä¾‹ä¸­ä½¿ç”¨joinå®ç°çš„åŠŸèƒ½ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//ä¼‘çœ æ—¶é—´ï¼ˆç§’ï¼‰</span>
        <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds <span class="token operator">=</span> sleepSeconds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countDownLatch <span class="token operator">=</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¼€å§‹å¤„ç†!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä¼‘çœ sleepSecondsç§’</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¤„ç†å®Œæ¯•,è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;çº¿ç¨‹ start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è§£æsheet1çº¿ç¨‹&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è§£æsheet2çº¿ç¨‹&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;çº¿ç¨‹ end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token number">1563767580511</span><span class="token punctuation">,</span>mainçº¿ç¨‹ start<span class="token operator">!</span>
<span class="token number">1563767580513</span><span class="token punctuation">,</span>è§£æsheet1çº¿ç¨‹<span class="token punctuation">,</span>å¼€å§‹å¤„ç†<span class="token operator">!</span>
<span class="token number">1563767580513</span><span class="token punctuation">,</span>è§£æsheet2çº¿ç¨‹<span class="token punctuation">,</span>å¼€å§‹å¤„ç†<span class="token operator">!</span>
<span class="token number">1563767582515</span><span class="token punctuation">,</span>è§£æsheet1çº¿ç¨‹<span class="token punctuation">,</span>å¤„ç†å®Œæ¯•<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">2002</span>
<span class="token number">1563767585515</span><span class="token punctuation">,</span>è§£æsheet2çº¿ç¨‹<span class="token punctuation">,</span>å¤„ç†å®Œæ¯•<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">5002</span>
<span class="token number">1563767585515</span><span class="token punctuation">,</span>mainçº¿ç¨‹ end<span class="token operator">!</span>
æ€»è€—æ—¶<span class="token operator">:</span><span class="token number">5003</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ç»“æœä¸­çœ‹å‡ºï¼Œæ•ˆæœå’Œjoinå®ç°çš„æ•ˆæœä¸€æ ·ï¼Œä»£ç ä¸­åˆ›å»ºäº†è®¡æ•°å™¨ä¸º2çš„<code>CountDownLatch</code>ï¼Œä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>countDownLatch.await();</code>ä¼šè®©ä¸»çº¿ç¨‹ç­‰å¾…ï¼Œt1ã€t2çº¿ç¨‹ä¸­æ¨¡æ‹Ÿæ‰§è¡Œè€—æ—¶æ“ä½œï¼Œæœ€ç»ˆåœ¨finallyä¸­è°ƒç”¨äº†<code>countDownLatch.countDown();</code>,æ­¤æ–¹æ³•æ¯è°ƒç”¨ä¸€æ¬¡ï¼ŒCountDownLatchå†…éƒ¨è®¡æ•°å™¨ä¼šå‡1ï¼Œå½“è®¡æ•°å™¨å˜ä¸º0çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹ä¸­çš„await()ä¼šè¿”å›ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚æ³¨æ„ï¼šä¸Šé¢çš„<code>countDown()</code>è¿™ä¸ªæ˜¯å¿…é¡»è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ‰€ä»¥æ”¾åœ¨finallyä¸­æ‰§è¡Œã€‚</p><h4 id="ç¤ºä¾‹2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹2" aria-hidden="true">#</a> ç¤ºä¾‹2</h4><p>ç­‰å¾…æŒ‡å®šçš„æ—¶é—´</p><p>è¿˜æ˜¯ä¸Šé¢çš„ç¤ºä¾‹ï¼Œ2ä¸ªçº¿ç¨‹è§£æ2ä¸ªsheetï¼Œä¸»çº¿ç¨‹ç­‰å¾…2ä¸ªsheetè§£æå®Œæˆã€‚ä¸»çº¿ç¨‹è¯´ï¼Œæˆ‘ç­‰å¾…2ç§’ï¼Œä½ ä»¬è¿˜æ˜¯æ— æ³•å¤„ç†å®Œæˆï¼Œå°±ä¸ç­‰å¾…äº†ï¼Œç›´æ¥è¿”å›ã€‚å¦‚ä¸‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//ä¼‘çœ æ—¶é—´ï¼ˆç§’ï¼‰</span>
        <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds <span class="token operator">=</span> sleepSeconds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countDownLatch <span class="token operator">=</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¼€å§‹å¤„ç†!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä¼‘çœ sleepSecondsç§’</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¤„ç†å®Œæ¯•,è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;çº¿ç¨‹ start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è§£æsheet1çº¿ç¨‹&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è§£æsheet2çº¿ç¨‹&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;çº¿ç¨‹ end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸»çº¿ç¨‹è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,result:&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token number">1563767637316</span><span class="token punctuation">,</span>mainçº¿ç¨‹ start<span class="token operator">!</span>
<span class="token number">1563767637320</span><span class="token punctuation">,</span>è§£æsheet1çº¿ç¨‹<span class="token punctuation">,</span>å¼€å§‹å¤„ç†<span class="token operator">!</span>
<span class="token number">1563767637320</span><span class="token punctuation">,</span>è§£æsheet2çº¿ç¨‹<span class="token punctuation">,</span>å¼€å§‹å¤„ç†<span class="token operator">!</span>
<span class="token number">1563767639321</span><span class="token punctuation">,</span>è§£æsheet1çº¿ç¨‹<span class="token punctuation">,</span>å¤„ç†å®Œæ¯•<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">2001</span>
<span class="token number">1563767639322</span><span class="token punctuation">,</span>mainçº¿ç¨‹ end<span class="token operator">!</span>
ä¸»çº¿ç¨‹è€—æ—¶<span class="token operator">:</span><span class="token number">2004</span><span class="token punctuation">,</span>result<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token number">1563767642322</span><span class="token punctuation">,</span>è§£æsheet2çº¿ç¨‹<span class="token punctuation">,</span>å¤„ç†å®Œæ¯•<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">5002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹2è€—æ—¶äº†5ç§’ï¼Œä¸»çº¿ç¨‹è€—æ—¶äº†2ç§’ï¼Œä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>countDownLatch.await(2, TimeUnit.SECONDS);</code>ï¼Œè¡¨ç¤ºæœ€å¤šç­‰2ç§’ï¼Œä¸ç®¡è®¡æ•°å™¨æ˜¯å¦ä¸º0ï¼Œawaitæ–¹æ³•éƒ½ä¼šè¿”å›ï¼Œè‹¥ç­‰å¾…æ—¶é—´å†…ï¼Œè®¡æ•°å™¨å˜ä¸º0äº†ï¼Œç«‹å³è¿”å›trueï¼Œå¦åˆ™è¶…æ—¶åè¿”å›falseã€‚</p><h4 id="ç¤ºä¾‹3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹3" aria-hidden="true">#</a> ç¤ºä¾‹3</h4><p>2ä¸ªCountDownç»“åˆä½¿ç”¨çš„ç¤ºä¾‹</p><p>æœ‰3ä¸ªäººå‚è§è·‘æ­¥æ¯”èµ›ï¼Œéœ€è¦å…ˆç­‰æŒ‡ä»¤å‘˜å‘æŒ‡ä»¤æªåæ‰èƒ½å¼€è·‘ï¼Œæ‰€æœ‰äººéƒ½è·‘å®Œä¹‹åï¼ŒæŒ‡ä»¤å‘˜å–Šä¸€å£°ï¼Œå¤§å®¶è·‘å®Œäº†ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·‘æ­¥è€—æ—¶ï¼ˆç§’ï¼‰</span>
        <span class="token keyword">int</span> runCostSeconds<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> commanderCd<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDown<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> runCostSeconds<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> commanderCd<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> countDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>runCostSeconds <span class="token operator">=</span> runCostSeconds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>commanderCd <span class="token operator">=</span> commanderCd<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countDown <span class="token operator">=</span> countDown<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç­‰å¾…æŒ‡ä»¤å‘˜æªå“</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                commanderCd<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å¼€å§‹è·‘!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä¼‘çœ runCostSecondsç§’</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>runCostSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDown<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·‘æ­¥ç»“æŸ,è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;çº¿ç¨‹ start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> commanderCd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å°å¼ &quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> commanderCd<span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å°æ&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> commanderCd<span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;è·¯äººç”²&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> commanderCd<span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸»çº¿ç¨‹ä¼‘çœ 5ç§’,æ¨¡æ‹ŸæŒ‡ä»¤å‘˜å‡†å¤‡å‘æªè€—æ—¶æ“ä½œ</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,æªå“äº†ï¼Œå¤§å®¶å¼€å§‹è·‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commanderCd<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ‰€æœ‰äººè·‘å®Œäº†ï¼Œä¸»çº¿ç¨‹è€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token number">1563767691087</span><span class="token punctuation">,</span>mainçº¿ç¨‹ start<span class="token operator">!</span>
<span class="token number">1563767696092</span><span class="token punctuation">,</span>æªå“äº†ï¼Œå¤§å®¶å¼€å§‹è·‘
<span class="token number">1563767696092</span><span class="token punctuation">,</span>å°å¼ <span class="token punctuation">,</span>å¼€å§‹è·‘<span class="token operator">!</span>
<span class="token number">1563767696092</span><span class="token punctuation">,</span>å°æ<span class="token punctuation">,</span>å¼€å§‹è·‘<span class="token operator">!</span>
<span class="token number">1563767696092</span><span class="token punctuation">,</span>è·¯äººç”²<span class="token punctuation">,</span>å¼€å§‹è·‘<span class="token operator">!</span>
<span class="token number">1563767698093</span><span class="token punctuation">,</span>å°å¼ <span class="token punctuation">,</span>è·‘æ­¥ç»“æŸ<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">2001</span>
<span class="token number">1563767701093</span><span class="token punctuation">,</span>å°æ<span class="token punctuation">,</span>è·‘æ­¥ç»“æŸ<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">5001</span>
<span class="token number">1563767706093</span><span class="token punctuation">,</span>è·¯äººç”²<span class="token punctuation">,</span>è·‘æ­¥ç»“æŸ<span class="token punctuation">,</span>è€—æ—¶<span class="token operator">:</span><span class="token number">10001</span>
<span class="token number">1563767706093</span><span class="token punctuation">,</span>mainæ‰€æœ‰äººè·‘å®Œäº†ï¼Œä¸»çº¿ç¨‹è€—æ—¶<span class="token operator">:</span><span class="token number">15004</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­ï¼Œt1ã€t2ã€t3å¯åŠ¨ä¹‹åï¼Œéƒ½é˜»å¡åœ¨<code>commanderCd.await();</code>ï¼Œä¸»çº¿ç¨‹æ¨¡æ‹Ÿå‘æªå‡†å¤‡æ“ä½œè€—æ—¶5ç§’ï¼Œç„¶åè°ƒç”¨<code>commanderCd.countDown();</code>æ¨¡æ‹Ÿå‘æªæ“ä½œï¼Œæ­¤æ–¹æ³•è¢«è°ƒç”¨ä»¥åï¼Œé˜»å¡åœ¨<code>commanderCd.await();</code>çš„3ä¸ªçº¿ç¨‹ä¼šå‘ä¸‹æ‰§è¡Œã€‚ä¸»çº¿ç¨‹è°ƒç”¨<code>countDownLatch.await();</code>ä¹‹åè¿›è¡Œç­‰å¾…ï¼Œæ¯ä¸ªäººè·‘å®Œä¹‹åï¼Œè°ƒç”¨<code>countDown.countDown();</code>é€šçŸ¥ä¸€ä¸‹<code>countDownLatch</code>è®©è®¡æ•°å™¨å‡1ï¼Œæœ€å3ä¸ªäººéƒ½è·‘å®Œäº†ï¼Œä¸»çº¿ç¨‹ä»<code>countDownLatch.await();</code>è¿”å›ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><h4 id="æ‰‹å†™ä¸€ä¸ªå¹¶è¡Œå¤„ç†ä»»åŠ¡çš„å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#æ‰‹å†™ä¸€ä¸ªå¹¶è¡Œå¤„ç†ä»»åŠ¡çš„å·¥å…·ç±»" aria-hidden="true">#</a> æ‰‹å†™ä¸€ä¸ªå¹¶è¡Œå¤„ç†ä»»åŠ¡çš„å·¥å…·ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Stream</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskDisposeUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">//å¹¶è¡Œçº¿ç¨‹æ•°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">POOL_SIZE</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token constant">POOL_SIZE</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * å¹¶è¡Œå¤„ç†ï¼Œå¹¶ç­‰å¾…ç»“æŸ
     *
     * <span class="token keyword">@param</span> <span class="token parameter">taskList</span> ä»»åŠ¡åˆ—è¡¨
     * <span class="token keyword">@param</span> <span class="token parameter">consumer</span> æ¶ˆè´¹è€…
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">InterruptedException</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> taskList<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token constant">POOL_SIZE</span><span class="token punctuation">,</span> taskList<span class="token punctuation">,</span> consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * å¹¶è¡Œå¤„ç†ï¼Œå¹¶ç­‰å¾…ç»“æŸ
     *
     * <span class="token keyword">@param</span> <span class="token parameter">moreThread</span> æ˜¯å¦å¤šçº¿ç¨‹æ‰§è¡Œ
     * <span class="token keyword">@param</span> <span class="token parameter">poolSize</span>   çº¿ç¨‹æ± å¤§å°
     * <span class="token keyword">@param</span> <span class="token parameter">taskList</span>   ä»»åŠ¡åˆ—è¡¨
     * <span class="token keyword">@param</span> <span class="token parameter">consumer</span>   æ¶ˆè´¹è€…
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">InterruptedException</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> moreThread<span class="token punctuation">,</span> <span class="token keyword">int</span> poolSize<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> taskList<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moreThread <span class="token operator">&amp;&amp;</span> poolSize <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            poolSize <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>poolSize<span class="token punctuation">,</span> taskList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>poolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> item <span class="token operator">:</span> taskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>executorService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> item <span class="token operator">:</span> taskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//ç”Ÿæˆ1-10çš„10ä¸ªæ•°å­—ï¼Œæ”¾åœ¨listä¸­ï¼Œç›¸å½“äº10ä¸ªä»»åŠ¡</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¯åŠ¨å¤šçº¿ç¨‹å¤„ç†listä¸­çš„æ•°æ®ï¼Œæ¯ä¸ªä»»åŠ¡ä¼‘çœ æ—¶é—´ä¸ºlistä¸­çš„æ•°å€¼</span>
        <span class="token class-name">TaskDisposeUtils</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,ä»»åŠ¡&quot;</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">&quot;æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸Šé¢æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæ¯•å®Œæ¯•ä¹‹åï¼Œç¨‹åºæ‰èƒ½ç»§ç»­</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list <span class="token operator">+</span> <span class="token string">&quot;ä¸­çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæ¯•!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œä»£ç è¾“å‡ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">1563769828130</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">1</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">1000</span>
<span class="token number">1563769829130</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">2</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">2000</span>
<span class="token number">1563769830131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">3</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">3001</span>
<span class="token number">1563769831131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">4</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">4001</span>
<span class="token number">1563769832131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">5</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">5001</span>
<span class="token number">1563769833130</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">6</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">6000</span>
<span class="token number">1563769834131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">7</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">7001</span>
<span class="token number">1563769835131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">8</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">8001</span>
<span class="token number">1563769837131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">9</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">9001</span>
<span class="token number">1563769839131</span><span class="token punctuation">,</span>ä»»åŠ¡<span class="token number">10</span>æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶<span class="token operator">:</span><span class="token number">10001</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>ä¸­çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæ¯•<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>TaskDisposeUtilsæ˜¯ä¸€ä¸ªå¹¶è¡Œå¤„ç†çš„å·¥å…·ç±»ï¼Œå¯ä»¥ä¼ å…¥nä¸ªä»»åŠ¡å†…éƒ¨ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡éƒ½å¤„ç†å®Œæˆä¹‹åï¼Œæ–¹æ³•æ‰ä¼šè¿”å›ã€‚æ¯”å¦‚æˆ‘ä»¬å‘é€çŸ­ä¿¡ï¼Œç³»ç»Ÿä¸­æœ‰1ä¸‡æ¡çŸ­ä¿¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„å·¥å…·ï¼Œæ¯æ¬¡å–100æ¡å¹¶è¡Œå‘é€ï¼Œå¾…100ä¸ªéƒ½å¤„ç†å®Œæ¯•ä¹‹åï¼Œå†å–ä¸€æ‰¹æŒ‰ç…§åŒæ ·çš„é€»è¾‘å‘é€ã€‚</strong></p><h3 id="_2ã€cyclicbarrierå¾ªç¯æ …æ " tabindex="-1"><a class="header-anchor" href="#_2ã€cyclicbarrierå¾ªç¯æ …æ " aria-hidden="true">#</a> 2ã€CyclicBarrierå¾ªç¯æ …æ </h3><p>CyclicBarrieré€šå¸¸ç§°ä¸ºå¾ªç¯å±éšœã€‚å®ƒå’ŒCountDownLatchå¾ˆç›¸ä¼¼ï¼Œéƒ½å¯ä»¥ä½¿çº¿ç¨‹å…ˆç­‰å¾…ç„¶åå†æ‰§è¡Œã€‚ä¸è¿‡CountDownLatchæ˜¯ä½¿ä¸€æ‰¹çº¿ç¨‹ç­‰å¾…å¦ä¸€æ‰¹çº¿ç¨‹æ‰§è¡Œå®Œåå†æ‰§è¡Œï¼›è€ŒCyclicBarrieråªæ˜¯ä½¿ç­‰å¾…çš„çº¿ç¨‹è¾¾åˆ°ä¸€å®šæ•°ç›®åå†è®©å®ƒä»¬ç»§ç»­æ‰§è¡Œã€‚æ•…è€ŒCyclicBarrierå†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªè®¡æ•°å™¨,è®¡æ•°å™¨çš„åˆå§‹å€¼åœ¨åˆ›å»ºå¯¹è±¡æ—¶é€šè¿‡æ„é€ å‚æ•°æŒ‡å®š,å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>parties<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯è°ƒç”¨ä¸€æ¬¡await()æ–¹æ³•éƒ½å°†ä½¿é˜»å¡çš„çº¿ç¨‹æ•°+1ï¼Œåªæœ‰é˜»å¡çš„çº¿ç¨‹æ•°è¾¾åˆ°è®¾å®šå€¼æ—¶å±éšœæ‰ä¼šæ‰“å¼€ï¼Œå…è®¸é˜»å¡çš„æ‰€æœ‰çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCyclicBarrierè¿˜æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹:</p><ul><li>CyclicBarrierçš„è®¡æ•°å™¨å¯ä»¥é‡ç½®è€ŒCountDownLatchä¸è¡Œï¼Œè¿™æ„å‘³ç€CyclicBarrierå®ä¾‹å¯ä»¥è¢«é‡å¤ä½¿ç”¨è€ŒCountDownLatchåªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ã€‚è€Œè¿™ä¹Ÿæ˜¯å¾ªç¯å±éšœå¾ªç¯äºŒå­—çš„è¯­ä¹‰æ‰€åœ¨ã€‚</li><li>CyclicBarrierå…è®¸ç”¨æˆ·è‡ªå®šä¹‰barrierActionæ“ä½œï¼Œè¿™æ˜¯ä¸ªå¯é€‰æ“ä½œï¼Œå¯ä»¥åœ¨åˆ›å»ºCyclicBarrierå¯¹è±¡æ—¶æŒ‡å®š</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> barrierAction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parties <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parties <span class="token operator">=</span> parties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> parties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>barrierCommand <span class="token operator">=</span> barrierAction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ—¦ç”¨æˆ·åœ¨åˆ›å»ºCyclicBarrierå¯¹è±¡æ—¶è®¾ç½®äº†barrierActionå‚æ•°ï¼Œåˆ™åœ¨é˜»å¡çº¿ç¨‹æ•°è¾¾åˆ°è®¾å®šå€¼å±éšœæ‰“å¼€å‰ï¼Œä¼šè°ƒç”¨barrierActionçš„run()æ–¹æ³•å®Œæˆç”¨æˆ·è‡ªå®šä¹‰çš„æ“ä½œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 
 *
 * CyclicBarrier
 * çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ï¼ˆCyclicï¼‰ä½¿ç”¨çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œ
 * è®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œ
 * ç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰
 * è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚
 * çº¿ç¨‹è¿›å…¥å±éšœé€šè¿‡CyclicBarrierçš„await()æ–¹æ³•ã€‚
 * 
 * é›†é½7é¢—é¾™ç å°±å¯ä»¥å¬å”¤ç¥é¾™
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierDemo</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">NUMBER</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     <span class="token comment">//CyclicBarrier(int parties, Runnable barrierAction) </span>

     <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token constant">NUMBER</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*****é›†é½7é¢—é¾™ç å°±å¯ä»¥å¬å”¤ç¥é¾™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t æ˜Ÿé¾™ç è¢«æ”¶é›† &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO Auto-generated catch block</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>


  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>CyclicBarrierçš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ï¼ˆCyclicï¼‰ä½¿ç”¨çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œ</li><li>è®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œ</li><li>ç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰</li><li>è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚</li><li>çº¿ç¨‹è¿›å…¥å±éšœé€šè¿‡CyclicBarrierçš„await()æ–¹æ³•ã€‚</li></ul><h4 id="ç¤ºä¾‹1-ç®€å•ä½¿ç”¨cyclicbarrier" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹1-ç®€å•ä½¿ç”¨cyclicbarrier" aria-hidden="true">#</a> ç¤ºä¾‹1 ç®€å•ä½¿ç”¨CyclicBarrier</h4><p>å…¬å¸ç»„ç»‡æ—…æ¸¸ï¼Œå¤§å®¶éƒ½æœ‰ç»å†è¿‡ï¼Œ10ä¸ªäººï¼Œä¸­åˆåˆ°é¥­ç‚¹äº†ï¼Œéœ€è¦ç­‰åˆ°10ä¸ªäººéƒ½åˆ°äº†æ‰èƒ½å¼€é¥­ï¼Œå…ˆåˆ°çš„äººåé‚£ç­‰ç€ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿä¼‘çœ </span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å¼€å§‹åƒé¥­äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">9000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">1000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">2001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">3001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">4001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">6000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">7999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">7000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­æ¨¡æ‹Ÿäº†10ä¸ªå‘˜å·¥ä¸Šæ¡Œåƒé¥­çš„åœºæ™¯ï¼Œç­‰å¾…æ‰€æœ‰å‘˜å·¥éƒ½åˆ°é½äº†æ‰èƒ½å¼€å‘ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬10ä¸ªå‘˜å·¥æœ€æ…¢ï¼Œå‰é¢çš„éƒ½åœ¨ç­‰å¾…ç¬¬10ä¸ªå‘˜å·¥ï¼Œå‘˜å·¥1ç­‰å¾…äº†9ç§’ï¼Œä¸Šé¢ä»£ç ä¸­è°ƒç”¨<code>cyclicBarrier.await();</code>ä¼šè®©å½“å‰çº¿ç¨‹ç­‰å¾…ã€‚å½“10ä¸ªå‘˜å·¥éƒ½è°ƒç”¨äº†<code>cyclicBarrier.await();</code>ä¹‹åï¼Œæ‰€æœ‰å¤„äºç­‰å¾…ä¸­çš„å‘˜å·¥éƒ½ä¼šè¢«å”¤é†’ï¼Œç„¶åç»§ç»­è¿è¡Œã€‚</p><h4 id="ç¤ºä¾‹2-å¾ªç¯ä½¿ç”¨cyclicbarrier" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹2-å¾ªç¯ä½¿ç”¨cyclicbarrier" aria-hidden="true">#</a> ç¤ºä¾‹2 å¾ªç¯ä½¿ç”¨CyclicBarrier</h4><p>å¯¹ç¤ºä¾‹1è¿›è¡Œæ”¹é€ ä¸€ä¸‹ï¼Œåƒé¥­å®Œæ¯•ä¹‹åï¼Œæ‰€æœ‰äººéƒ½å»è½¦ä¸Šï¼Œå¾…æ‰€æœ‰äººéƒ½åˆ°è½¦ä¸Šä¹‹åï¼Œé©±è½¦å»ä¸‹ä¸€æ™¯ç‚¹ç©ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç­‰å¾…åƒé¥­</span>
        <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿä¼‘çœ </span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å¼€å§‹åƒé¥­äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ä¼‘çœ sleepæ—¶é—´ï¼Œæ¨¡æ‹Ÿå½“å‰å‘˜å·¥åƒé¥­è€—æ—¶</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç­‰å¾…æ‰€æœ‰äººåˆ°é½ä¹‹åï¼Œå¼€è½¦å»ä¸‹ä¸€ç«™</span>
        <span class="token keyword">void</span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç­‰å¾…æ‰€æœ‰äººåˆ°é½ä¹‹ååƒé¥­ï¼Œå…ˆåˆ°çš„äººåé‚£ç­‰ç€ï¼Œä»€ä¹ˆäº‹æƒ…ä¸è¦å¹²</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ç­‰å¾…æ‰€æœ‰äººåˆ°é½ä¹‹åå¼€è½¦å»ä¸‹ä¸€æ™¯ç‚¹ï¼Œå…ˆåˆ°çš„äººåé‚£ç­‰ç€ï¼Œä»€ä¹ˆäº‹æƒ…ä¸è¦å¹²</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">4000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">6000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">7000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">9001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">8000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">2001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">3000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">8998</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">4999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">5999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">6998</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">7998</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">1999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">2999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">3999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å»ä¸‹ä¸€æ™¯ç‚¹çš„è·¯ä¸Šï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘ï¼Œåˆæ˜¯å‘˜å·¥10æœ€æ…¢ï¼Œè¦æå‡æ•ˆç‡äº†ï¼Œä¸èƒ½åƒçš„å¤ªå¤šï¼Œå¾—å‡è‚¥ã€‚</p><p>ä»£ç ä¸­CyclicBarrierç›¸å½“äºä½¿ç”¨äº†2æ¬¡ï¼Œç¬¬ä¸€æ¬¡ç”¨äºç­‰å¾…æ‰€æœ‰äººåˆ°è¾¾åå¼€é¥­ï¼Œç¬¬äºŒæ¬¡ç”¨äºç­‰å¾…æ‰€æœ‰äººä¸Šè½¦åé©±è½¦å»ä¸‹ä¸€æ™¯ç‚¹ã€‚æ³¨æ„ä¸€äº›å…ˆåˆ°çš„å‘˜å·¥ä¼šåœ¨å…¶ä»–äººåˆ°è¾¾ä¹‹å‰ï¼Œéƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼ˆ<code>cyclicBarrier.await();</code>ä¼šè®©å½“å‰çº¿ç¨‹é˜»å¡ï¼‰ï¼Œæ— æ³•å¹²å…¶ä»–äº‹æƒ…ï¼Œç­‰åˆ°æœ€åä¸€ä¸ªäººåˆ°äº†ä¼šå”¤é†’æ‰€æœ‰äººï¼Œç„¶åç»§ç»­ã€‚</p><blockquote><p>CyclicBarrierå†…éƒ¨ç›¸å½“äºæœ‰ä¸ªè®¡æ•°å™¨ï¼ˆæ„é€ æ–¹æ³•ä¼ å…¥çš„ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨<code>await();</code>åï¼Œè®¡æ•°å™¨ä¼šå‡1ï¼Œå¹¶ä¸”await()æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…è®¡æ•°å™¨å‡ä¸º0çš„æ—¶å€™ï¼Œæ‰€æœ‰åœ¨await()ä¸Šç­‰å¾…çš„çº¿ç¨‹è¢«å”¤é†’ï¼Œç„¶åç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œæ­¤æ—¶è®¡æ•°å™¨åˆä¼šè¢«è¿˜åŸä¸ºåˆ›å»ºæ—¶çš„å€¼ï¼Œç„¶åå¯ä»¥ç»§ç»­å†æ¬¡ä½¿ç”¨ã€‚</p></blockquote><h4 id="ç¤ºä¾‹3-æœ€ååˆ°çš„äººç»™å¤§å®¶ä¸Šé…’-ç„¶åå¼€é¥­" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹3-æœ€ååˆ°çš„äººç»™å¤§å®¶ä¸Šé…’-ç„¶åå¼€é¥­" aria-hidden="true">#</a> ç¤ºä¾‹3 æœ€ååˆ°çš„äººç»™å¤§å®¶ä¸Šé…’ï¼Œç„¶åå¼€é¥­</h4><p>è¿˜æ˜¯ç¤ºä¾‹1ä¸­çš„ä¾‹å­ï¼Œå‘˜å·¥10æ˜¯æœ€ååˆ°è¾¾çš„ï¼Œè®©æ‰€æœ‰äººéƒ½ä¹…ç­‰äº†ï¼Œé‚£æ€ä¹ˆåŠï¼Œå¾—ç»™æ‰€æœ‰äººå€’é…’ï¼Œç„¶åå¼€é¥­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¨¡æ‹Ÿå€’é…’ï¼ŒèŠ±äº†2ç§’ï¼Œåˆå¾—è®©å…¶ä»–9ä¸ªäººç­‰2ç§’</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;è¯´ï¼Œä¸å¥½æ„æ€ï¼Œè®©å¤§å®¶ä¹…ç­‰äº†ï¼Œç»™å¤§å®¶å€’é…’èµ”ç½ª!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿä¼‘çœ </span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å¼€å§‹åƒé¥­äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å‘˜å·¥<span class="token number">10</span>è¯´ï¼Œä¸å¥½æ„æ€ï¼Œè®©å¤§å®¶ä¹…ç­‰äº†ï¼Œç»™å¤§å®¶å€’é…’èµ”ç½ª<span class="token operator">!</span>
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">2000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">11000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">10000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">7000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">3000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">8000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">9001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">4001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">6001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­åˆ›å»º<code>CyclicBarrier</code>å¯¹è±¡æ—¶ï¼Œå¤šä¼ å…¥äº†ä¸€ä¸ªå‚æ•°ï¼ˆå†…éƒ¨æ˜¯å€’é…’æ“ä½œï¼‰ï¼Œå…ˆåˆ°çš„äººå…ˆç­‰å¾…ï¼Œå¾…æ‰€æœ‰äººéƒ½åˆ°é½ä¹‹åï¼Œéœ€è¦å…ˆç»™å¤§å®¶å€’é…’ï¼Œç„¶åå”¤é†’æ‰€æœ‰ç­‰å¾…ä¸­çš„äººè®©å¤§å®¶å¼€é¥­ã€‚ä»è¾“å‡ºç»“æœä¸­æˆ‘ä»¬å‘ç°ï¼Œå€’é…’æ“ä½œæ˜¯ç”±æœ€åä¸€ä¸ªäººæ“ä½œçš„ï¼Œæœ€åä¸€ä¸ªäººå€’é…’å®Œæ¯•ä¹‹åï¼Œæ‰å”¤é†’æ‰€æœ‰ç­‰å¾…ä¸­çš„å…¶ä»–å‘˜å·¥ï¼Œè®©å¤§å®¶å¼€é¥­ã€‚</p><h4 id="ç¤ºä¾‹4-å…¶ä¸­ä¸€ä¸ªäººç­‰å¾…ä¸­è¢«æ‰“æ–­äº†" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹4-å…¶ä¸­ä¸€ä¸ªäººç­‰å¾…ä¸­è¢«æ‰“æ–­äº†" aria-hidden="true">#</a> ç¤ºä¾‹4 å…¶ä¸­ä¸€ä¸ªäººç­‰å¾…ä¸­è¢«æ‰“æ–­äº†</h4><p>å‘˜å·¥5ç­‰å¾…ä¸­ï¼Œçªç„¶æ¥äº†ä¸ªç”µè¯ï¼Œæœ‰ç‚¹æ€¥äº‹ï¼Œç„¶åå°±æ‹¿èµ·ç­·å­å¼€åƒäº†ï¼Œå…¶ä»–äººä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿçœ‹ç€ä»–åƒä¹ˆï¼Ÿ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Time</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> endTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿä¼‘çœ </span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;åˆ°äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å¼€å§‹åƒé¥­äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> sleep <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sleep <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿå‘˜å·¥5æ¥äº†ä¸ªç”µè¯ï¼Œå°†è‡ªå·±ç­‰å¾…åƒé¥­ç»™æ‰“æ–­äº†</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,æœ‰ç‚¹æ€¥äº‹ï¼Œæˆ‘å…ˆå¼€å¹²äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                t<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å‘˜å·¥<span class="token number">4</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">3</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">5</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">1</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">2</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>æœ‰ç‚¹æ€¥äº‹ï¼Œæˆ‘å…ˆå¼€å¹²äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>InterruptedException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span>$<span class="token class-name">ConditionObject</span><span class="token punctuation">.</span><span class="token function">reportInterruptAfterWait</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2014</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span>$<span class="token class-name">ConditionObject</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2048</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">234</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">6</span>åˆ°äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">9</span>åˆ°äº†ï¼
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">8</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">7</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> ç­‰å¾…äº†<span class="token function">1</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name">Disconnected</span> from the target <span class="token constant">VM</span><span class="token punctuation">,</span> address<span class="token operator">:</span> &#39;<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">64413</span>&#39;<span class="token punctuation">,</span> transport<span class="token operator">:</span> <span class="token char">&#39;socket&#39;</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">10</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºçš„ä¿¡æ¯çœ‹ç€æœ‰ç‚¹ä¹±ï¼Œç»™å¤§å®¶ç†ä¸€ç†ï¼Œå‘˜å·¥5é‡åˆ°æ€¥äº‹ï¼Œæ‹¿èµ·ç­·å­å°±æ˜¯åƒï¼Œè¿™æ ·å¥½ä¹ˆï¼Œå½“ç„¶ä¸å¥½ï¼Œä»–è¿™ä¹ˆåšäº†ï¼Œåé¢çœ‹ä»–è¿™ä¹ˆåšäº†éƒ½è·Ÿç€è¿™ä¹ˆåšï¼ˆè¿™ç§åœºæ™¯æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæœ‰ä¸€ä¸ªäººæ‹¿èµ·ç­·å­å…ˆåƒèµ·æ¥ï¼Œå…¶ä»–äººéƒ½è·Ÿç€ä¸Šäº†ï¼‰ï¼Œç›´æ¥ä¸ç­‰å…¶ä»–äººäº†ï¼Œæ‹¿èµ·ç­·å­å°±å¼€åƒäº†ã€‚CyclicBarrieré‡åˆ°è¿™ç§æƒ…å†µå°±æ˜¯è¿™ä¹ˆå¤„ç†çš„ã€‚å‰é¢4ä¸ªå‘˜å·¥éƒ½åœ¨<code>await()</code>å¤„ç­‰å¾…ç€ï¼Œå‘˜å·¥5ä¹Ÿåœ¨<code>await()</code>ä¸Šç­‰å¾…ç€ï¼Œç­‰äº†1ç§’ï¼ˆ<code>TimeUnit.SECONDS.sleep(1);</code>ï¼‰ï¼Œæ¥äº†ä¸ªç”µè¯ï¼Œç„¶åç»™å‘˜å·¥5å‘é€ä¸­æ–­ä¿¡å·åï¼ˆ<code>t.interrupt();</code>ï¼‰ï¼Œå‘˜å·¥5çš„await()æ–¹æ³•ä¼šè§¦å‘<code>InterruptedException</code>å¼‚å¸¸ï¼Œæ­¤æ—¶å…¶ä»–ç­‰å¾…ä¸­çš„å‰4ä¸ªå‘˜å·¥ï¼Œçœ‹ç€5å¼€åƒäº†ï¼Œè‡ªå·±ç«‹å³ä¹Ÿä¸ç­‰äº†ï¼Œå†…éƒ¨ä»<code>await()</code>æ–¹æ³•ä¸­è§¦å‘<code>BrokenBarrierException</code>å¼‚å¸¸ï¼Œç„¶åä¹Ÿå¼€åƒäº†ï¼Œåé¢çš„6/7/8/9/10å‘˜å·¥æ¥äº†ä»¥åå‘ç°å¤§å®¶éƒ½å¼€åƒäº†ï¼Œè‡ªå·±ä¹Ÿä¸ç­‰äº†ï¼Œ6-10å‘˜å·¥è°ƒç”¨<code>await()</code>ç›´æ¥æŠ›å‡ºäº†<code>BrokenBarrierException</code>å¼‚å¸¸ï¼Œç„¶åç»§ç»­å‘ä¸‹ã€‚</p><p><strong>ç»“è®ºï¼š</strong></p><ol><li><strong>å†…éƒ¨æœ‰ä¸€ä¸ªäººæŠŠè§„åˆ™ç ´åäº†ï¼ˆæ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼‰ï¼Œå…¶ä»–äººéƒ½ä¸æŒ‰è§„åˆ™æ¥äº†ï¼Œä¸ä¼šç­‰å¾…äº†</strong></li><li><strong>æ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·çš„çº¿ç¨‹ï¼Œawaitæ–¹æ³•ä¼šè§¦å‘InterruptedExceptionå¼‚å¸¸ï¼Œç„¶åè¢«å”¤é†’å‘ä¸‹è¿è¡Œ</strong></li><li><strong>å…¶ä»–ç­‰å¾…ä¸­ æˆ–è€…åé¢åˆ°è¾¾çš„çº¿ç¨‹ï¼Œä¼šåœ¨await()æ–¹æ³•ä¸Šè§¦å‘<code>BrokenBarrierException</code>å¼‚å¸¸ï¼Œç„¶åç»§ç»­æ‰§è¡Œ</strong></li></ol><h4 id="ç¤ºä¾‹5-å…¶ä¸­ä¸€ä¸ªäººåªæ„¿æ„ç­‰çš„5ç§’" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹5-å…¶ä¸­ä¸€ä¸ªäººåªæ„¿æ„ç­‰çš„5ç§’" aria-hidden="true">#</a> ç¤ºä¾‹5 å…¶ä¸­ä¸€ä¸ªäººåªæ„¿æ„ç­‰çš„5ç§’</h4><p>åŸºäºç¤ºä¾‹1ï¼Œå‘˜å·¥1åªæ„¿æ„ç­‰çš„5ç§’ï¼Œ5såå¦‚æœå¤§å®¶è¿˜æ²¡åˆ°æœŸï¼Œè‡ªå·±è¦å¼€åƒäº†ï¼Œå‘˜å·¥1å¼€åƒäº†ï¼Œå…¶ä»–äººä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> endTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿä¼‘çœ </span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;åˆ°äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å¼€å§‹åƒé¥­äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å‘˜å·¥<span class="token number">1</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">2</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">3</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">4</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">5</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">6</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">5001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>TimeoutException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">257</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">435</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">2</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">4002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">3001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">2001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">7</span>åˆ°äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">8</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">9</span>åˆ°äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">10</span>åˆ°äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»è¾“å‡ºç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š1ç­‰å¾…5ç§’ä¹‹åï¼Œå¼€åƒäº†ï¼Œå…¶ä»–ç­‰å¾…äººéƒ½å¼€åƒäº†ï¼Œåé¢æ¥çš„äººä¸ç­‰å¾…ï¼Œç›´æ¥å¼€åƒäº†ã€‚</p><p>å‘˜å·¥1è°ƒç”¨æœ‰å‚<code>await</code>æ–¹æ³•ç­‰å¾…5ç§’ä¹‹åï¼Œè§¦å‘äº†<code>TimeoutException</code>å¼‚å¸¸ï¼Œç„¶åç»§ç»­å‘ä¸‹è¿è¡Œï¼Œå…¶ä»–çš„åœ¨5å¼€åƒä¹‹å‰å·²ç»ç­‰äº†ä¸€ä¼šçš„çš„å‡ ä¸ªå‘˜å·¥ï¼Œä»–ä»¬çœ‹åˆ°5å¼€åƒäº†ï¼Œè‡ªå·±ç«‹å³ä¸ç­‰å¾…äº†ï¼Œä¹Ÿä¹Ÿå¼€åƒäº†ï¼ˆä»–ä»¬çš„<code>await</code>æŠ›å‡ºäº†<code>BrokenBarrierException</code>å¼‚å¸¸ï¼‰ï¼›è¿˜æœ‰å‡ ä¸ªå‘˜å·¥åœ¨5å¼€åƒä¹‹ååˆ°è¾¾çš„ï¼Œä»–ä»¬ç›´æ¥ä¸ç­‰å¾…äº†ï¼Œç›´æ¥æŠ›å‡º<code>BrokenBarrierException</code>å¼‚å¸¸ï¼Œç„¶åä¹Ÿå¼€åƒäº†ã€‚</p><p><strong>ç»“è®ºï¼š</strong></p><ol><li><p><strong>ç­‰å¾…è¶…æ—¶çš„æ–¹æ³•</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">BrokenBarrierException</span><span class="token punctuation">,</span><span class="token class-name">TimeoutException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><strong>å†…éƒ¨æœ‰ä¸€ä¸ªäººæŠŠè§„åˆ™ç ´åäº†ï¼ˆç­‰å¾…è¶…æ—¶ï¼‰ï¼Œå…¶ä»–äººéƒ½ä¸æŒ‰è§„åˆ™æ¥äº†ï¼Œä¸ä¼šç­‰å¾…äº†</strong></p></li><li><p><strong>ç­‰å¾…è¶…æ—¶çš„çº¿ç¨‹ï¼Œawaitæ–¹æ³•ä¼šè§¦å‘TimeoutExceptionå¼‚å¸¸ï¼Œç„¶åè¢«å”¤é†’å‘ä¸‹è¿è¡Œ</strong></p></li><li><p><strong>å…¶ä»–ç­‰å¾…ä¸­ æˆ–è€…åé¢åˆ°è¾¾çš„çº¿ç¨‹ï¼Œä¼šåœ¨await()æ–¹æ³•ä¸Šè§¦å‘<code>BrokenBarrierException</code>å¼‚å¸¸ï¼Œç„¶åç»§ç»­æ‰§è¡Œ</strong></p></li></ol><h4 id="ç¤ºä¾‹6-é‡å»ºè§„åˆ™" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹6-é‡å»ºè§„åˆ™" aria-hidden="true">#</a> ç¤ºä¾‹6 é‡å»ºè§„åˆ™</h4><p>ç¤ºä¾‹5ä¸­æ”¹é€ ä¸€ä¸‹ï¼Œå‘˜å·¥1ç­‰å¾…5ç§’è¶…æ—¶ä¹‹åï¼Œå¼€åƒäº†ï¼Œæ‰“ç ´äº†è§„åˆ™ï¼Œå…ˆå‰ç­‰å¾…ä¸­çš„ä»¥åŠåé¢åˆ°è¾¾çš„éƒ½ä¸æŒ‰è§„åˆ™æ¥äº†ï¼Œéƒ½æ‹¿èµ·ç­·å­å¼€åƒã€‚è¿‡äº†ä¸€ä¼šï¼Œå¯¼æ¸¸é‡æ–°å‘ŠçŸ¥å¤§å®¶ï¼Œè¦æŒ‰è§„åˆ™æ¥ï¼Œç„¶åé‡å»ºäº†è§„åˆ™ï¼Œå¤§å®¶éƒ½æŒ‰è§„åˆ™æ¥äº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo6</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è§„åˆ™æ˜¯å¦å·²é‡å»º</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> guizhe <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> endTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¨¡æ‹Ÿä¼‘çœ </span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è°ƒç”¨await()çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–å‘˜å·¥éƒ½åˆ°è¾¾awaitäº†æ‰èƒ½ç»§ç»­</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;åˆ°äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>guizhe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; ç­‰å¾…äº†&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),å¼€å§‹åƒé¥­äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç­‰å¾…10ç§’ä¹‹åï¼Œé‡ç½®ï¼Œé‡å»ºè§„åˆ™</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cyclicBarrier<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        guizhe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------------å¤§å®¶å¤ªçš®äº†ï¼Œè¯·å¤§å®¶æŒ‰è§„åˆ™æ¥------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å†æ¥ä¸€æ¬¡</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;å‘˜å·¥&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å‘˜å·¥<span class="token number">1</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">2</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">3</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">4</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">5</span>åˆ°äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>TimeoutException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">257</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">435</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">6</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">5002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">4</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">2004</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">1004</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">3002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">4004</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">7</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">8</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">9</span>åˆ°äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
å‘˜å·¥<span class="token number">10</span>åˆ°äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>å¤§å®¶å¤ªçš®äº†ï¼Œè¯·å¤§å®¶æŒ‰è§„åˆ™æ¥<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
å‘˜å·¥<span class="token number">1</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">2</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">3</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">4</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">5</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">6</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">7</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">8</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">9</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">10</span>åˆ°äº†ï¼
å‘˜å·¥<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> ç­‰å¾…äº†<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> ç­‰å¾…äº†<span class="token function">9000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> ç­‰å¾…äº†<span class="token function">8000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> ç­‰å¾…äº†<span class="token function">6999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> ç­‰å¾…äº†<span class="token function">3000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> ç­‰å¾…äº†<span class="token function">4000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> ç­‰å¾…äº†<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> ç­‰å¾…äº†<span class="token function">6000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> ç­‰å¾…äº†<span class="token function">999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
å‘˜å·¥<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> ç­‰å¾…äº†<span class="token function">1999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>å¼€å§‹åƒé¥­äº†ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸€æ¬¡è§„åˆ™è¢«æ‰“ä¹±äº†ï¼Œè¿‡äº†ä¸€ä¼šå¯¼æ¸¸é‡å»ºäº†è§„åˆ™ï¼ˆ<code>cyclicBarrier.reset();</code>ï¼‰ï¼Œæ¥ç€åˆé‡æ¥æ¥äº†ä¸€æ¬¡æ¨¡æ‹Ÿç­‰å¾…åƒé¥­çš„æ“ä½œï¼Œæ­£å¸¸äº†ã€‚</p><h4 id="countdownlatchå’Œcyclicbarrierçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#countdownlatchå’Œcyclicbarrierçš„åŒºåˆ«" aria-hidden="true">#</a> CountDownLatchå’ŒCyclicBarrierçš„åŒºåˆ«</h4><p>è¿˜æ˜¯ä¸¾ä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼š</p><p><strong>CountDownLatchç¤ºä¾‹</strong></p><p>ä¸»ç®¡ç›¸å½“äº <strong>CountDownLatch</strong>ï¼Œå¹²æ´»çš„å°å¼Ÿç›¸å½“äºåšäº‹æƒ…çš„çº¿ç¨‹ã€‚</p><p>è€æ¿äº¤ç»™ä¸»ç®¡äº†ä¸€ä¸ªä»»åŠ¡ï¼Œè®©ä¸»ç®¡æå®Œä¹‹åç«‹å³ä¸ŠæŠ¥ç»™è€æ¿ã€‚ä¸»ç®¡ä¸‹é¢æœ‰10ä¸ªå°å¼Ÿï¼Œæ¥åˆ°ä»»åŠ¡ä¹‹åå°†ä»»åŠ¡åˆ’åˆ†ä¸º10ä¸ªå°ä»»åŠ¡åˆ†ç»™æ¯ä¸ªå°å¼Ÿå»å¹²ï¼Œä¸»ç®¡ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼ˆä¸»ç®¡ä¼šè°ƒç”¨<code>await()</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼‰ï¼Œè®©æ¯ä¸ªå°å¼Ÿå¹²å®Œä¹‹åé€šçŸ¥ä¸€ä¸‹ä¸»ç®¡ï¼ˆè°ƒç”¨<code>countDown()</code>æ–¹æ³•é€šçŸ¥ä¸»ç®¡ï¼Œæ­¤æ–¹æ³•ä¼šç«‹å³è¿”å›ï¼‰ï¼Œä¸»ç®¡ç­‰åˆ°æ‰€æœ‰çš„å°å¼Ÿéƒ½åšå®Œäº†ï¼Œä¼šè¢«å”¤é†’ï¼Œä»await()æ–¹æ³•ä¸Šè‹é†’ï¼Œç„¶åå°†ç»“æœåé¦ˆç»™è€æ¿ã€‚æœŸé—´ä¸»ç®¡ä¼šç­‰å¾…ï¼Œä¼šç­‰å¾…æ‰€æœ‰å°å¼Ÿå°†ç»“æœæ±‡æŠ¥ç»™è‡ªå·±ã€‚</p><p><strong>è€ŒCyclicBarrieræ˜¯ä¸€æ‰¹çº¿ç¨‹è®©è‡ªå·±ç­‰å¾…ï¼Œç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹éƒ½å‡†å¤‡å¥½äº†ï¼Œè‡ªå·±æ‰èƒ½ç»§ç»­ã€‚</strong></p><h3 id="_3ã€semaphoreä¿¡å·ç¯" tabindex="-1"><a class="header-anchor" href="#_3ã€semaphoreä¿¡å·ç¯" aria-hidden="true">#</a> 3ã€Semaphoreä¿¡å·ç¯</h3><p>Semaphoreï¼ˆä¿¡å·é‡ï¼‰ä¸ºå¤šçº¿ç¨‹åä½œæä¾›äº†æ›´ä¸ºå¼ºå¤§çš„æ§åˆ¶æ–¹æ³•ï¼Œå‰é¢çš„æ–‡ç« ä¸­æˆ‘ä»¬å­¦äº†synchronizedå’Œé‡å…¥é”ReentrantLockï¼Œè¿™2ç§é”ä¸€æ¬¡éƒ½åªèƒ½å…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªèµ„æºï¼Œè€Œä¿¡å·é‡å¯ä»¥æ§åˆ¶æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å¯ä»¥<strong>åŒæ—¶è®¿é—®</strong>ç‰¹å®šçš„èµ„æºã€‚</p><p><strong>Semaphoreå¸¸ç”¨åœºæ™¯ï¼šé™æµ</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>æ¯”å¦‚æœ‰ä¸ªåœè½¦åœºï¼Œæœ‰5ä¸ªç©ºä½ï¼Œé—¨å£æœ‰ä¸ªé—¨å«ï¼Œæ‰‹ä¸­5æŠŠé’¥åŒ™åˆ†åˆ«å¯¹åº”5ä¸ªè½¦ä½ä¸Šé¢çš„é”ï¼Œæ¥ä¸€è¾†è½¦ï¼Œé—¨å«ä¼šç»™å¸æœºä¸€æŠŠé’¥åŒ™ï¼Œç„¶åè¿›å»æ‰¾åˆ°å¯¹åº”çš„è½¦ä½åœä¸‹æ¥ï¼Œå‡ºå»çš„æ—¶å€™å¸æœºå°†é’¥åŒ™å½’è¿˜ç»™é—¨å«ã€‚åœè½¦åœºç”Ÿæ„æ¯”è¾ƒå¥½ï¼ŒåŒæ—¶æ¥äº†100ä¸¤è½¦ï¼Œé—¨å«æ‰‹ä¸­åªæœ‰5æŠŠé’¥åŒ™ï¼ŒåŒæ—¶åªèƒ½æ”¾5è¾†è½¦è¿›å…¥ï¼Œå…¶ä»–è½¦åªèƒ½ç­‰å¾…ï¼Œç­‰æœ‰äººå°†é’¥åŒ™å½’è¿˜ç»™é—¨å«ä¹‹åï¼Œæ‰èƒ½è®©å…¶ä»–è½¦è¾†è¿›å…¥ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­é—¨å«å°±ç›¸å½“äºSemaphoreï¼Œè½¦é’¥åŒ™å°±ç›¸å½“äºè®¸å¯è¯ï¼Œè½¦å°±ç›¸å½“äºçº¿ç¨‹ã€‚</p><h4 id="_1ã€semaphoreä¸»è¦æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_1ã€semaphoreä¸»è¦æ–¹æ³•" aria-hidden="true">#</a> 1ã€Semaphoreä¸»è¦æ–¹æ³•</h4><ul><li><strong>Semaphore(int permits)</strong>ï¼šæ„é€ æ–¹æ³•ï¼Œå‚æ•°è¡¨ç¤ºè®¸å¯è¯æ•°é‡ï¼Œç”¨æ¥åˆ›å»ºä¿¡å·é‡</li><li><strong>Semaphore(int permits,boolean fair)</strong>ï¼šæ„é€ æ–¹æ³•ï¼Œå½“fairç­‰äºtrueæ—¶ï¼Œåˆ›å»ºå…·æœ‰ç»™å®šè®¸å¯æ•°çš„è®¡æ•°ä¿¡å·é‡å¹¶è®¾ç½®ä¸ºå…¬å¹³ä¿¡å·é‡</li><li><strong>void acquire() throws InterruptedException</strong>ï¼šä»æ­¤ä¿¡å·é‡è·å–1ä¸ªè®¸å¯å‰çº¿ç¨‹å°†ä¸€ç›´é˜»å¡ï¼Œç›¸å½“äºä¸€è¾†è½¦å äº†ä¸€ä¸ªè½¦ä½ï¼Œæ­¤æ–¹æ³•ä¼šå“åº”çº¿ç¨‹ä¸­æ–­ï¼Œè¡¨ç¤ºè°ƒç”¨çº¿ç¨‹çš„interruptæ–¹æ³•ï¼Œä¼šä½¿è¯¥æ–¹æ³•æŠ›å‡ºInterruptedExceptionå¼‚å¸¸</li><li><strong>void acquire(int permits) throws InterruptedException</strong> ï¼šå’Œacquire()æ–¹æ³•ç±»ä¼¼ï¼Œå‚æ•°è¡¨ç¤ºéœ€è¦è·å–è®¸å¯çš„æ•°é‡ï¼›æ¯”å¦‚ä¸€ä¸ªå¤§å¡è½¦è¦å…¥åœè½¦åœºï¼Œç”±äºè½¦æ¯”è¾ƒå¤§ï¼Œéœ€è¦ç”³è¯·3ä¸ªè½¦ä½æ‰å¯ä»¥åœæ”¾</li><li><strong>void acquireUninterruptibly(int permits)</strong> ï¼šå’Œacquire(int permits) æ–¹æ³•ç±»ä¼¼ï¼Œåªæ˜¯ä¸ä¼šå“åº”çº¿ç¨‹ä¸­æ–­</li><li><strong>boolean tryAcquire()</strong>ï¼šå°è¯•è·å–1ä¸ªè®¸å¯ï¼Œä¸ç®¡æ˜¯å¦èƒ½å¤Ÿè·å–æˆåŠŸï¼Œéƒ½ç«‹å³è¿”å›ï¼Œtrueè¡¨ç¤ºè·å–æˆåŠŸï¼Œfalseè¡¨ç¤ºè·å–å¤±è´¥</li><li><strong>boolean tryAcquire(int permits)</strong>ï¼šå’ŒtryAcquire()ï¼Œè¡¨ç¤ºå°è¯•è·å–permitsä¸ªè®¸å¯</li><li><strong>boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException</strong>ï¼šå°è¯•åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–1ä¸ªè®¸å¯ï¼Œè·å–æˆåŠŸè¿”å›trueï¼ŒæŒ‡å®šçš„æ—¶é—´è¿‡åè¿˜æ˜¯æ— æ³•è·å–è®¸å¯ï¼Œè¿”å›false</li><li><strong>boolean tryAcquire(int permits, long timeout, TimeUnit unit) throws InterruptedException</strong>ï¼šå’ŒtryAcquire(long timeout, TimeUnit unit)ç±»ä¼¼ï¼Œå¤šäº†ä¸€ä¸ªpermitså‚æ•°ï¼Œè¡¨ç¤ºå°è¯•è·å–permitsä¸ªè®¸å¯</li><li><strong>void release()</strong>ï¼šé‡Šæ”¾ä¸€ä¸ªè®¸å¯ï¼Œå°†å…¶è¿”å›ç»™ä¿¡å·é‡ï¼Œç›¸å½“äºè½¦ä»åœè½¦åœºå‡ºå»æ—¶å°†é’¥åŒ™å½’è¿˜ç»™é—¨å«</li><li><strong>void release(int n)</strong>ï¼šé‡Šæ”¾nä¸ªè®¸å¯</li><li><strong>int availablePermits()</strong>ï¼šå½“å‰å¯ç”¨çš„è®¸å¯æ•°</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 
 * @Description: TODO(è¿™é‡Œç”¨ä¸€å¥è¯æè¿°è¿™ä¸ªç±»çš„ä½œç”¨)  
 * 
 * åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š
 * acquireï¼ˆè·å–ï¼‰ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨acquireæ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡æˆåŠŸè·å–ä¿¡å·é‡ï¼ˆä¿¡å·é‡å‡1ï¼‰ï¼Œ
 *             è¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è¶…æ—¶ã€‚
 * releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šä¼šå°†ä¿¡å·é‡çš„å€¼åŠ 1ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚
 * 
 * ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¨¡æ‹Ÿ3ä¸ªåœè½¦ä½</span>

     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//æ¨¡æ‹Ÿ6éƒ¨æ±½è½¦</span>
     <span class="token punctuation">{</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> 
          <span class="token punctuation">{</span>
            semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t æŠ¢åˆ°äº†è½¦ä½&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t------- ç¦»å¼€&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š</p><ul><li>acquireï¼ˆè·å–ï¼‰ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨acquireæ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡æˆåŠŸè·å–ä¿¡å·é‡ï¼ˆä¿¡å·é‡å‡1ï¼‰ï¼Œè¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è¶…æ—¶ã€‚</li><li>releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šä¼šå°†ä¿¡å·é‡çš„å€¼åŠ 1ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</li><li>ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚</li></ul><h4 id="_2ã€semaphoreç®€å•çš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_2ã€semaphoreç®€å•çš„ä½¿ç”¨" aria-hidden="true">#</a> 2ã€Semaphoreç®€å•çš„ä½¿ç”¨</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·å–è®¸å¯!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,é‡Šæ”¾è®¸å¯!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­<code>new Semaphore(2)</code>åˆ›å»ºäº†è®¸å¯æ•°é‡ä¸º2çš„ä¿¡å·é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–1ä¸ªè®¸å¯ï¼ŒåŒæ—¶å…è®¸ä¸¤ä¸ªçº¿ç¨‹è·å–è®¸å¯ï¼Œä»è¾“å‡ºä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥è·å–è®¸å¯ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…å·²è·å–è®¸å¯çš„çº¿ç¨‹é‡Šæ”¾è®¸å¯ä¹‹åæ‰èƒ½è¿è¡Œã€‚ä¸ºè·å–åˆ°è®¸å¯çš„çº¿ç¨‹ä¼šé˜»å¡åœ¨<code>acquire()</code>æ–¹æ³•ä¸Šï¼Œç›´åˆ°è·å–åˆ°è®¸å¯æ‰èƒ½ç»§ç»­ã€‚</p><h4 id="_3ã€è·å–è®¸å¯ä¹‹åä¸é‡Šæ”¾" tabindex="-1"><a class="header-anchor" href="#_3ã€è·å–è®¸å¯ä¹‹åä¸é‡Šæ”¾" aria-hidden="true">#</a> 3ã€è·å–è®¸å¯ä¹‹åä¸é‡Šæ”¾</h4><p>é—¨å«ï¼ˆSemaphoreï¼‰æœ‰ç‚¹å‘†ï¼Œå¸æœºè¿›å»çš„æ—¶å€™ç»™äº†é’¥åŒ™ï¼Œå‡ºæ¥çš„æ—¶å€™ä¸å½’è¿˜ï¼Œé—¨å«ä¹Ÿä¸ä¼šè¯´ä»€ä¹ˆã€‚æœ€ç»ˆç»“æœå°±æ˜¯å…¶ä»–è½¦è¾†éƒ½æ— æ³•è¿›å…¥äº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·å–è®¸å¯!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è¿è¡Œç»“æŸ!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ç¨‹åºè¿è¡Œåä¸€ç›´æ— æ³•ç»“æŸï¼Œè§‚å¯Ÿä¸€ä¸‹ä»£ç ï¼Œä»£ç ä¸­è·å–è®¸å¯åï¼Œæ²¡æœ‰é‡Šæ”¾è®¸å¯çš„ä»£ç ï¼Œæœ€ç»ˆå¯¼è‡´ï¼Œå¯ç”¨è®¸å¯æ•°é‡ä¸º0ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–è®¸å¯ï¼Œä¼šåœ¨<code>semaphore.acquire();</code>å¤„ç­‰å¾…ï¼Œå¯¼è‡´ç¨‹åºæ— æ³•ç»“æŸã€‚</p><h4 id="_4ã€é‡Šæ”¾è®¸å¯æ­£ç¡®çš„å§¿åŠ¿" tabindex="-1"><a class="header-anchor" href="#_4ã€é‡Šæ”¾è®¸å¯æ­£ç¡®çš„å§¿åŠ¿" aria-hidden="true">#</a> 4ã€é‡Šæ”¾è®¸å¯æ­£ç¡®çš„å§¿åŠ¿</h4><p>ç¤ºä¾‹1ä¸­ï¼Œåœ¨finallyé‡Œé¢é‡Šæ”¾é”ï¼Œä¼šæœ‰é—®é¢˜ä¹ˆï¼Ÿ</p><p>å¦‚æœè·å–é”çš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´è·å–é”å¤±è´¥ï¼Œæœ€åfinallyé‡Œé¢ä¹Ÿé‡Šæ”¾äº†è®¸å¯ï¼Œæœ€ç»ˆä¼šæ€ä¹ˆæ ·ï¼Œå¯¼è‡´è®¸å¯æ•°é‡å‡­ç©ºå¢é•¿äº†ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·å–è®¸å¯,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ä¼‘çœ 100ç§’</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è¿è¡Œç»“æŸ!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼‘çœ 1ç§’</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼‘çœ 1ç§’</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç»™t2å’Œt3å‘é€ä¸­æ–­ä¿¡å·</span>
        t2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¨‹åºä¸­ä¿¡å·é‡è®¸å¯æ•°é‡ä¸º1ï¼Œåˆ›å»ºäº†3ä¸ªçº¿ç¨‹è·å–è®¸å¯ï¼Œçº¿ç¨‹t1è·å–æˆåŠŸäº†ï¼Œç„¶åä¼‘çœ 100ç§’ã€‚å…¶ä»–ä¸¤ä¸ªçº¿ç¨‹é˜»å¡åœ¨<code>semaphore.acquire();</code>æ–¹æ³•å¤„ï¼Œä»£ç ä¸­å¯¹çº¿ç¨‹t2ã€t3å‘é€ä¸­æ–­ä¿¡å·ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹Semaphoreä¸­acquireçš„æºç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ³•ä¼šå“åº”çº¿ç¨‹ä¸­æ–­ï¼Œä¸»çº¿ç¨‹ä¸­å¯¹t2ã€t3å‘é€ä¸­æ–­ä¿¡å·ä¹‹åï¼Œ<code>acquire()</code>æ–¹æ³•ä¼šè§¦å‘<code>InterruptedException</code>å¼‚å¸¸ï¼Œt2ã€t3æœ€ç»ˆæ²¡æœ‰è·å–åˆ°è®¸å¯ï¼Œä½†æ˜¯ä»–ä»¬éƒ½æ‰§è¡Œäº†finallyä¸­çš„é‡Šæ”¾è®¸å¯çš„æ“ä½œï¼Œæœ€åå¯¼è‡´è®¸å¯æ•°é‡å˜ä¸ºäº†2ï¼Œå¯¼è‡´è®¸å¯æ•°é‡å¢åŠ äº†ã€‚æ‰€ä»¥ç¨‹åºä¸­é‡Šæ”¾è®¸å¯çš„æ–¹å¼æœ‰é—®é¢˜ã€‚éœ€è¦æ”¹è¿›ä¸€ä¸‹ï¼Œè·å–è®¸å¯æˆåŠŸæ‰å»é‡Šæ”¾é”ã€‚</p><p><strong>æ­£ç¡®çš„é‡Šæ”¾é”çš„æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è·å–è®¸å¯æ˜¯å¦æˆåŠŸ</span>
            <span class="token keyword">boolean</span> acquireSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                acquireSuccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·å–è®¸å¯,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ä¼‘çœ 100ç§’</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è¿è¡Œç»“æŸ!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>acquireSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼‘çœ 1ç§’</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼‘çœ 1ç§’</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç»™t2å’Œt3å‘é€ä¸­æ–­ä¿¡å·</span>
        t2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¨‹åºä¸­å¢åŠ äº†ä¸€ä¸ªå˜é‡<code>acquireSuccess</code>ç”¨æ¥æ ‡è®°è·å–è®¸å¯æ˜¯å¦æˆåŠŸï¼Œåœ¨finallyä¸­æ ¹æ®è¿™ä¸ªå˜é‡æ˜¯å¦ä¸ºtrueï¼Œæ¥ç¡®å®šæ˜¯å¦é‡Šæ”¾è®¸å¯ã€‚</p><h4 id="_5ã€åœ¨è§„å®šçš„æ—¶é—´å†…å¸Œæœ›è·å–è®¸å¯" tabindex="-1"><a class="header-anchor" href="#_5ã€åœ¨è§„å®šçš„æ—¶é—´å†…å¸Œæœ›è·å–è®¸å¯" aria-hidden="true">#</a> 5ã€åœ¨è§„å®šçš„æ—¶é—´å†…å¸Œæœ›è·å–è®¸å¯</h4><p>å¸æœºæ¥åˆ°åœè½¦åœºï¼Œå‘ç°åœè½¦åœºå·²ç»æ»¡äº†ï¼Œåªèƒ½åœ¨å¤–ç­‰å¾…å†…éƒ¨çš„è½¦å‡ºæ¥ä¹‹åæ‰èƒ½è¿›å»ï¼Œä½†æ˜¯è¦ç­‰å¤šä¹…ï¼Œä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œä»–å¸Œæœ›ç­‰10åˆ†é’Ÿï¼Œå¦‚æœè¿˜æ˜¯æ— æ³•è¿›å»ï¼Œå°±ä¸åˆ°è¿™é‡Œåœè½¦äº†ã€‚</p><p>Semaphoreå†…éƒ¨2ä¸ªæ–¹æ³•å¯ä»¥æä¾›è¶…æ—¶è·å–è®¸å¯çš„åŠŸèƒ½ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æŒ‡å®šçš„æ—¶é—´å†…å»å°è¯•è·å–è®¸å¯ï¼Œå¦‚æœèƒ½å¤Ÿè·å–åˆ°ï¼Œè¿”å›trueï¼Œè·å–ä¸åˆ°è¿”å›falseã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è·å–è®¸å¯æ˜¯å¦æˆåŠŸ</span>
            <span class="token keyword">boolean</span> acquireSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//å°è¯•åœ¨1ç§’å†…è·å–è®¸å¯ï¼Œè·å–æˆåŠŸè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,å°è¯•è·å–è®¸å¯,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                acquireSuccess <span class="token operator">=</span> semaphore<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è·å–æˆåŠŸæ‰§è¡Œä¸šåŠ¡ä»£ç </span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>acquireSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·å–è®¸å¯æˆåŠŸ,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//ä¼‘çœ 5ç§’</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,è·å–è®¸å¯å¤±è´¥,å½“å‰å¯ç”¨è®¸å¯æ•°é‡:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>acquireSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼‘çœ 1ç§’</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼‘çœ 1ç§’</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­è®¸å¯æ•°é‡ä¸º1ï¼Œ<code>semaphore.tryAcquire(1, TimeUnit.SECONDS);</code>ï¼šè¡¨ç¤ºå°è¯•åœ¨1ç§’å†…è·å–è®¸å¯ï¼Œè·å–æˆåŠŸç«‹å³è¿”å›trueï¼Œè¶…è¿‡1ç§’è¿˜æ˜¯è·å–ä¸åˆ°ï¼Œè¿”å›falseã€‚çº¿ç¨‹t1è·å–è®¸å¯æˆåŠŸï¼Œä¹‹åä¼‘çœ äº†5ç§’ï¼Œä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºt2å’Œt3éƒ½å°è¯•äº†1ç§’ï¼Œè·å–å¤±è´¥ã€‚</p><h4 id="_6ã€å…¶ä»–ä¸€äº›ä½¿ç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_6ã€å…¶ä»–ä¸€äº›ä½¿ç”¨è¯´æ˜" aria-hidden="true">#</a> 6ã€å…¶ä»–ä¸€äº›ä½¿ç”¨è¯´æ˜</h4><ol><li>Semaphoreé»˜è®¤åˆ›å»ºçš„æ˜¯éå…¬å¹³çš„ä¿¡å·é‡ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™ä¸ªæ¶‰åŠåˆ°å…¬å¹³ä¸éå…¬å¹³ã€‚ä¸¾ä¸ªä¾‹å­ï¼š5ä¸ªè½¦ä½ï¼Œå…è®¸5ä¸ªè½¦è¾†è¿›å»ï¼Œæ¥äº†100è¾†è½¦ï¼Œåªèƒ½è¿›å»5è¾†ï¼Œå…¶ä»–95åœ¨å¤–é¢æ’é˜Ÿç­‰ç€ã€‚é‡Œé¢åˆšå¥½å‡ºæ¥äº†1è¾†ï¼Œæ­¤æ—¶åˆšå¥½åˆæ¥äº†10è¾†è½¦ï¼Œè¿™10è¾†è½¦æ˜¯ç›´æ¥æ’é˜Ÿåˆ°å…¶ä»–95è¾†å‰é¢å»ï¼Œè¿˜æ˜¯åˆ°95è¾†åé¢å»æ’é˜Ÿå‘¢ï¼Ÿæ’é˜Ÿå°±è¡¨ç¤ºå…¬å¹³ï¼Œç›´æ¥å»æ’é˜Ÿäº‰æŠ¢ç¬¬ä¸€ä¸ªï¼Œå°±è¡¨ç¤ºä¸å…¬å¹³ã€‚å¯¹äºåœè½¦åœºï¼Œæ’é˜Ÿè‚¯å®šæ›´å¥½ä¸€äº›å’¯ã€‚ä¸è¿‡å¯¹äºä¿¡å·é‡æ¥è¯´ä¸å…¬å¹³çš„æ•ˆç‡æ›´é«˜ä¸€äº›ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¸å…¬å¹³çš„ã€‚</li><li>å»ºè®®é˜…è¯»ä»¥ä¸‹Semaphoreçš„æºç ï¼Œå¯¹å¸¸ç”¨çš„æ–¹æ³•æœ‰ä¸ªäº†è§£ï¼Œä¸éœ€è¦éƒ½è®°ä½ï¼Œç”¨çš„æ—¶å€™ä¹Ÿæ–¹ä¾¿æŸ¥è¯¢å°±å¥½ã€‚</li><li>æ–¹æ³•ä¸­å¸¦æœ‰<code>throws InterruptedException</code>å£°æ˜çš„ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•ä¼šå“åº”çº¿ç¨‹ä¸­æ–­ä¿¡å·ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿè¡¨ç¤ºè°ƒç”¨çº¿ç¨‹çš„<code>interrupt()</code>æ–¹æ³•ï¼Œä¼šè®©è¿™äº›æ–¹æ³•è§¦å‘<code>InterruptedException</code>å¼‚å¸¸ï¼Œå³ä½¿è¿™äº›æ–¹æ³•å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¹Ÿä¼šç«‹å³è¿”å›ï¼Œå¹¶æŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ï¼Œçº¿ç¨‹ä¸­æ–­ä¿¡å·ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Ragnarokoo/LearningNotes/edit/master/src/notes/juc/å…«ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±».md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ã€Githubã€‘ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ã€Githubã€‘ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></footer><nav class="page-nav"><a href="/notes/juc/%E4%B8%83%E3%80%81%E9%9B%86%E5%90%88%E4%B8%8D%E5%AE%89%E5%85%A8.html" class="nav-link prev" aria-label="ä¸ƒã€é›†åˆä¸å®‰å…¨"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->ä¸ƒã€é›†åˆä¸å®‰å…¨</div></a><a href="/notes/juc/%E4%B9%9D%E3%80%81Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B9%8BJMM.html" class="nav-link next" aria-label="ä¹ã€Javaå†…å­˜æ¨¡å‹ä¹‹JMM"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">ä¹ã€Javaå†…å­˜æ¨¡å‹ä¹‹JMM<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.9b10ba0a.js" defer></script>
  </body>
</html>
