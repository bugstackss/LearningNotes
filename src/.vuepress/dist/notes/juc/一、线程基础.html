<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://Ragnarokoo.github.io/LearningNotes/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html"><meta property="og:site_name" content="📚全栈开发学习指南"><meta property="og:title" content="一、线程基础"><meta property="og:description" content="一、线程基础 1、Java多线程相关概念 1、进程 是程序的⼀次执⾏，是系统进⾏资源分配和调度的独⽴单位，每⼀个进程都有它⾃⼰的内存空间和系统资源 进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。程序是指令、数据及其组织形式的描述，进程是程序的实体。 进程具有的特征： 动态..."><meta property="og:type" content="article"><meta property="og:image" content="https://Ragnarokoo.github.io/LearningNotes/"><meta property="og:updated_time" content="2023-05-31T09:16:41.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="一、线程基础"><meta property="article:tag" content="java"><meta property="article:tag" content="juc"><meta property="article:tag" content="并发编程"><meta property="article:modified_time" content="2023-05-31T09:16:41.000Z"><link rel="icon" href="/site_logo.svg"><title>一、线程基础 | 📚全栈开发学习指南</title><meta name="description" content="一、线程基础 1、Java多线程相关概念 1、进程 是程序的⼀次执⾏，是系统进⾏资源分配和调度的独⽴单位，每⼀个进程都有它⾃⼰的内存空间和系统资源 进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。程序是指令、数据及其组织形式的描述，进程是程序的实体。 进程具有的特征： 动态...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.bc8b6d7c.css" as="style" /><link rel="stylesheet" href="/assets/style.bc8b6d7c.css" />
    <link rel="modulepreload" href="/assets/app.9b10ba0a.js"><link rel="modulepreload" href="/assets/一、线程基础.html.a6a892ef.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/一、线程基础.html.340de577.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/site_logo.svg" alt="📚全栈开发学习指南"><!----><span class="site-name hide-in-pad">📚全栈开发学习指南</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/quicknav/" class="nav-link" aria-label="快速导航"><span class="icon iconfont icon-navigation"></span>快速导航<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-blog"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/notes/" class="nav-link active" aria-label="Java学习教程"><span class="icon iconfont icon-java"></span>Java学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/web/" class="nav-link" aria-label="web学习教程"><span class="icon iconfont icon-note"></span>web学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/springcloud/" class="nav-link" aria-label="SpringCloud学习教程"><span class="icon iconfont icon-cache"></span>SpringCloud学习教程<!----></a></div><div class="nav-item hide-in-mobile"><a href="/distributed/" class="nav-link" aria-label="分布式微服务架构"><span class="icon iconfont icon-read"></span>分布式微服务架构<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="资源宝库"><span class="title"><span class="icon iconfont icon-advance"></span>资源宝库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/resources/books/" class="nav-link" aria-label="书籍资源"><span class="icon iconfont icon-animation"></span>书籍资源<!----></a></li><li class="dropdown-item"><a href="/resources/videos/" class="nav-link" aria-label="影音资源"><span class="icon iconfont icon-play"></span>影音资源<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Ragnarokoo/LearningNotes" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索本站" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java Language专栏</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-IO"></span><span class="title">Java网络编程NIO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-community"></span><span class="title">JDBC数据库连接技术</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-categoryselected"></span><span class="title">JavaWeb</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-array"></span><span class="title">SSM Framework</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-geometry"></span><span class="title">SpringData</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-type"></span><span class="title">SpringBoot</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-module"></span><span class="title">mybatisplus</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-operate"></span><span class="title">构建工具&amp;云原生Devops</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mysql"></span><span class="title">数据库以及调优策略</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-quote"></span><span class="title">消息中间件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tool"></span><span class="title">软件以及环境配置</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">Linux操作系统</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-rank"></span><span class="title">JUC高并发编程</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="一、线程基础"><!---->一、线程基础<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#一、线程基础" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="一、线程基础"><!---->一、线程基础<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_1、java多线程相关概念" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1、Java多线程相关概念"><!---->1、Java多线程相关概念<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_2、线程的基本操作" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2、线程的基本操作"><!---->2、线程的基本操作<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3、为什么多线程极其重要" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3、为什么多线程极其重要？？？"><!---->3、为什么多线程极其重要？？？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_4、从start一个线程说起" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4、从start一个线程说起"><!---->4、从start一个线程说起<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_5、用户线程和守护线程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5、用户线程和守护线程"><!---->5、用户线程和守护线程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_6、获得多线程的方法几种" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6、获得多线程的方法几种？"><!---->6、获得多线程的方法几种？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_7、callable接口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7、Callable接口"><!---->7、Callable接口<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0.html" class="nav-link sidebar-link sidebar-page" aria-label="二、线程池"><!---->二、线程池<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%B8%89%E3%80%81CompletableFuture.html" class="nav-link sidebar-link sidebar-page" aria-label="三、CompletableFuture"><!---->三、CompletableFuture<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%9B%9B%E3%80%81Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="四、Java“锁”事"><!---->四、Java“锁”事<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%BA%94%E3%80%81%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="五、线程间通信"><!---->五、线程间通信<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%85%AD%E3%80%81LockSupport%E4%B8%8E%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%96%AD.html" class="nav-link sidebar-link sidebar-page" aria-label="六、LockSupport与线程中断"><!---->六、LockSupport与线程中断<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%B8%83%E3%80%81%E9%9B%86%E5%90%88%E4%B8%8D%E5%AE%89%E5%85%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="七、集合不安全"><!---->七、集合不安全<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%85%AB%E3%80%81JUC%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%BE%85%E5%8A%A9%E7%B1%BB.html" class="nav-link sidebar-link sidebar-page" aria-label="八、JUC强大的辅助类"><!---->八、JUC强大的辅助类<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E4%B9%9D%E3%80%81Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B9%8BJMM.html" class="nav-link sidebar-link sidebar-page" aria-label="九、Java内存模型之JMM"><!---->九、Java内存模型之JMM<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E3%80%81volatile%E4%B8%8EJava%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="十、volatile与Java内存模型"><!---->十、volatile与Java内存模型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%B8%80%E3%80%81CAS.html" class="nav-link sidebar-link sidebar-page" aria-label="十一、CAS"><!---->十一、CAS<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%BA%8C%E3%80%81%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%B1%BB%E4%B9%8B18%E7%BD%97%E6%B1%89%E5%A2%9E%E5%BC%BA.html" class="nav-link sidebar-link sidebar-page" aria-label="十二、原子操作类之18罗汉增强"><!---->十二、原子操作类之18罗汉增强<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%B8%89%E3%80%81ThreadLocal%E3%80%81InheritableThreadLocal.html" class="nav-link sidebar-link sidebar-page" aria-label="十三、ThreadLocal、InheritableThreadLocal"><!---->十三、ThreadLocal、InheritableThreadLocal<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E5%9B%9B%E3%80%81Java%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%A4%B4.html" class="nav-link sidebar-link sidebar-page" aria-label="十四、Java对象内存布局和对象头"><!---->十四、Java对象内存布局和对象头<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%BA%94%E3%80%81Synchronized%E4%B8%8E%E9%94%81%E5%8D%87%E7%BA%A7.html" class="nav-link sidebar-link sidebar-page" aria-label="十五、Synchronized与锁升级"><!---->十五、Synchronized与锁升级<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E5%85%AD%E3%80%81AbstractQueuedSynchronizer%E4%B9%8BAQS.html" class="nav-link sidebar-link sidebar-page" aria-label="十六、AbstractQueuedSynchronizer之AQS"><!---->十六、AbstractQueuedSynchronizer之AQS<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/%E5%8D%81%E4%B8%83%E3%80%81ReentrantLock%E3%80%81ReentrantReadWriteLock%E3%80%81StampedLock.html" class="nav-link sidebar-link sidebar-page" aria-label="十七、ReentrantLock、ReentrantReadWriteLock、StampedLock"><!---->十七、ReentrantLock、ReentrantReadWriteLock、StampedLock<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/juc/Prog.html" class="nav-link sidebar-link sidebar-page" aria-label="JUC核心技术文章"><span class="icon iconfont icon-java"></span>JUC核心技术文章<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mount"></span><span class="title">深入了解Java虚拟机</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-view"></span><span class="title">GOF23种设计模式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-tag"></span><span class="title">技术要点业务篇</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->一、线程基础</h1><div class="page-info"><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li><span class="category category7 clickable" role="navigation">JUC</span></li><li><span class="category category6 clickable" role="navigation">java</span></li></ul><meta property="articleSection" content="JUC,java"></span><span aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag6 clickable" role="navigation">java</span></li><li><span class="tag tag1 clickable" role="navigation">juc</span></li><li><span class="tag tag6 clickable" role="navigation">并发编程</span></li></ul><meta property="keywords" content="java,juc,并发编程"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 29 分钟</span><meta property="timeRequired" content="PT29M"></span><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/Ragnarokoo/" target="_blank" rel="noopener noreferrer">Ragnarok</a></span><span property="author" content="Ragnarok"></span></span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-05-31T09:16:41.000Z"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#一、线程基础" class="router-link-active router-link-exact-active toc-link level2">一、线程基础</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_1、java多线程相关概念" class="router-link-active router-link-exact-active toc-link level3">1、Java多线程相关概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_2、线程的基本操作" class="router-link-active router-link-exact-active toc-link level3">2、线程的基本操作</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3、为什么多线程极其重要" class="router-link-active router-link-exact-active toc-link level3">3、为什么多线程极其重要？？？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_4、从start一个线程说起" class="router-link-active router-link-exact-active toc-link level3">4、从start一个线程说起</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_5、用户线程和守护线程" class="router-link-active router-link-exact-active toc-link level3">5、用户线程和守护线程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_6、获得多线程的方法几种" class="router-link-active router-link-exact-active toc-link level3">6、获得多线程的方法几种？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/juc/%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_7、callable接口" class="router-link-active router-link-exact-active toc-link level3">7、Callable接口</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="一、线程基础" tabindex="-1"><a class="header-anchor" href="#一、线程基础" aria-hidden="true">#</a> 一、线程基础</h2><h3 id="_1、java多线程相关概念" tabindex="-1"><a class="header-anchor" href="#_1、java多线程相关概念" aria-hidden="true">#</a> 1、Java多线程相关概念</h3><h4 id="_1、进程" tabindex="-1"><a class="header-anchor" href="#_1、进程" aria-hidden="true">#</a> 1、进程</h4><p>是程序的⼀次执⾏，是系统进⾏资源分配和调度的独⽴单位，每⼀个进程都有它⾃⼰的内存空间和系统资源</p><p>进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。程序是指令、数据及其组织形式的描述，进程是程序的实体。</p><p><strong>进程具有的特征：</strong></p><ul><li><strong>动态性</strong>：进程是程序的一次执行过程，是临时的，有生命期，是动态产生，动态消亡的</li><li><strong>并发性</strong>：任何进程都可以同其他进行一起并发执行</li><li><strong>独立性</strong>：进程是系统进行资源分配和调度的一个独立单位</li><li><strong>结构性</strong>：进程由程序，数据和进程控制块三部分组成</li></ul><p>我们经常使用windows系统，经常会看见.exe后缀的文件，双击这个.exe文件的时候，这个文件中的指令就会被系统加载，那么我们就能得到一个关于这个.exe程序的进程。进程是**“活”**的，或者说是正在被执行的。</p><h4 id="_2、线程" tabindex="-1"><a class="header-anchor" href="#_2、线程" aria-hidden="true">#</a> 2、线程</h4><p>在同⼀个进程内⼜可以执⾏多个任务，⽽这每⼀个任务我们就可以看做是⼀个线程 ⼀个进程会有1个或多个线程的</p><p>线程是轻量级的进程，是程序执行的最小单元，使用多线程而不是多进程去进行并发程序的设计，是因为线程间的切换和调度的成本远远小于进程。</p><h4 id="_3、进程与线程的一个简单解释" tabindex="-1"><a class="header-anchor" href="#_3、进程与线程的一个简单解释" aria-hidden="true">#</a> 3、进程与线程的一个简单解释</h4><p>进程（process）和线程（thread）是操作系统的基本概念，但是它们比较抽象，不容易掌握。</p><p>1.计算机的核心是CPU，它承担了所有的计算任务。它就像一座工厂，时刻在运行。</p><p><img src="/assets/f65f6640-fde3-4f6f-be2a-aa05b6a3c1b9.a388e525.png" alt="f65f6640-fde3-4f6f-be2a-aa05b6a3c1b9"></p><p>2.假定工厂的电力有限，一次只能供给一个车间使用。也就是说，一个车间开工的时候，其他车间都必须停工。背后的含义就是，单个CPU一次只能运行一个任务。</p><p><img src="/assets/aa874eba-0c27-4924-be97-9c853c009ca9.7d9e5d39.png" alt="aa874eba-0c27-4924-be97-9c853c009ca9"></p><p>3.进程就好比工厂的车间，它代表CPU所能处理的单个任务。任一时刻，CPU总是运行一个进程，其他进程处于非运行状态。</p><p><img src="/assets/f03b160d-4e18-46a1-9158-913a4afdb2b2.c02efc03.png" alt="f03b160d-4e18-46a1-9158-913a4afdb2b2"></p><p>4.一个车间里，可以有很多工人。他们协同完成一个任务。</p><p><img src="/assets/9985e48b-92bd-434e-8a4e-6f85c95a8dbd.25995254.png" alt="9985e48b-92bd-434e-8a4e-6f85c95a8dbd"></p><p>5.线程就好比车间里的工人。一个进程可以包括多个线程。</p><p><img src="/assets/3dc76caa-b3d9-4555-b8c4-c805bb97e03e.0b0942ed.png" alt="3dc76caa-b3d9-4555-b8c4-c805bb97e03e"></p><p>6.车间的空间是工人们共享的，比如许多房间是每个工人都可以进出的。这象征一个进程的内存空间是共享的，每个线程都可以使用这些共享内存。</p><p><img src="/assets/b3ef804e-346b-4280-bb8d-809c9bd42853.04a4c868.png" alt="b3ef804e-346b-4280-bb8d-809c9bd42853"></p><p>7.可是，每间房间的大小不同，有些房间最多只能容纳一个人，比如厕所。里面有人的时候，其他人就不能进去了。这代表一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。</p><p><img src="/assets/bea2bf20-2b08-484e-80b7-3e210d0e20df.dc590bc7.png" alt="bea2bf20-2b08-484e-80b7-3e210d0e20df"></p><p>8.一个防止他人进入的简单方法，就是门口加一把锁。先到的人锁上门，后到的人看到上锁，就在门口排队，等锁打开再进去。这就叫”互斥锁”（Mutual exclusion，缩写 Mutex），防止多个线程同时读写某一块内存区域。</p><p><img src="/assets/876a4f82-7931-4674-ac6b-a6d04a88a5b1.660fc9e5.png" alt="876a4f82-7931-4674-ac6b-a6d04a88a5b1"></p><p>9.还有些房间，可以同时容纳n个人，比如厨房。也就是说，如果人数大于n，多出来的人只能在外面等着。这好比某些内存区域，只能供给固定数目的线程使用。</p><p><img src="/assets/ae960b3a-c0e8-4c3d-bbcb-bfc5ebbecb79.212c31f9.png" alt="ae960b3a-c0e8-4c3d-bbcb-bfc5ebbecb79"></p><p>10.这时的解决方法，就是在门口挂n把钥匙。进去的人就取一把钥匙，出来时再把钥匙挂回原处。后到的人发现钥匙架空了，就知道必须在门口排队等着了。这种做法叫做”信号量”（Semaphore），用来保证多个线程不会互相冲突。</p><p>11.操作系统的设计，因此可以归结为三点：</p><p>（1）以多进程形式，允许多个任务同时运行；</p><p>（2）以多线程形式，允许单个任务分成不同的部分运行；</p><p>（3）提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源。</p><h4 id="_4、管程" tabindex="-1"><a class="header-anchor" href="#_4、管程" aria-hidden="true">#</a> 4、管程</h4><p>Monitor(监视器)，也就是我们平时所说的锁</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Monitor其实是一种同步机制，他的义务是保证（同一时间）只有一个线程可以访问被保护的数据和代码。</span>
<span class="token comment">// JVM中同步是基于进入和退出监视器对象(Monitor,管程对象)来实现的，每个对象实例都会有一个Monitor对象，</span>
<span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Monitor对象会和Java对象一同创建并销毁，它底层是由C++语言来实现的。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20210904000040589.3f597e68.png" alt="image-20210904000040589"></p><h4 id="_5、线程状态" tabindex="-1"><a class="header-anchor" href="#_5、线程状态" aria-hidden="true">#</a> 5、线程状态？</h4><p>进程的状态参考操作系统：创建态、就绪态、运行态、阻塞态、终止态</p><p>这是从 <strong>操作系统</strong> 层面来描述的</p><p><img src="/assets/1649066126899-0b988758-8c4a-4e7d-b882-85bfae2d61a8.a7986431.png" alt="imagepng"></p><ul><li><p>【初始状态】仅是在语言层面创建了线程对象，还未与操作系统线程关联</p></li><li><p>【可运行状态】（就绪状态）指该线程已经被创建（与操作系统线程关联），可以由 CPU 调度执行</p></li><li><p>【运行状态】指获取了 CPU 时间片运行中的状态</p><ul><li>当 CPU 时间片用完，会从【运行状态】转换至【可运行状态】，会导致线程的上下文切换</li></ul></li><li><p>【阻塞状态】</p><ul><li><p>如果调用了阻塞 API，如 BIO 读写文件，这时该线程实际不会用到 CPU，会导致线程上下文切换，进入【阻塞状态】</p></li><li><p>等 BIO 操作完毕，会由操作系统唤醒阻塞的线程，转换至【可运行状态】</p></li><li><p>与【可运行状态】的区别是，对【阻塞状态】的线程来说只要它们一直不唤醒，调度器就一直不会考虑调度它们</p></li></ul></li><li><p>【终止状态】表示线程已经执行完毕，生命周期已经结束，不会再转换为其它状态</p></li></ul><p>线程由生到死的完整过程（生命周期）：当线程被创建并启动以后，既不是一启动就进入了执行状态，也不是一直处于执行状态，在 API 中 <code>java.lang.Thread.State</code> 这个枚举中给出了六种线程状态：</p><table><thead><tr><th>线程状态</th><th>导致状态发生条件</th></tr></thead><tbody><tr><td>NEW（新建）</td><td>线程刚被创建，但是并未启动，还没调用 start 方法，只有线程对象，没有线程特征</td></tr><tr><td>Runnable（可运行）</td><td>线程可以在 Java 虚拟机中运行的状态，可能正在运行自己代码，也可能没有，这取决于操作系统处理器，调用了 t.start() 方法：就绪（经典叫法）</td></tr><tr><td>Blocked（阻塞）</td><td>当一个线程试图获取一个对象锁，而该对象锁被其他的线程持有，则该线程进入 Blocked 状态；当该线程持有锁时，该线程将变成 Runnable 状态</td></tr><tr><td>Waiting（无限等待）</td><td>一个线程在等待另一个线程执行一个（唤醒）动作时，该线程进入 Waiting 状态，进入这个状态后不能自动唤醒，必须等待另一个线程调用 notify 或者 notifyAll 方法才能唤醒</td></tr><tr><td>Timed Waiting （限期等待）</td><td>有几个方法有超时参数，调用将进入 Timed Waiting 状态，这一状态将一直保持到超时期满或者接收到唤醒通知。带有超时参数的常用方法有 Thread.sleep 、Object.wait</td></tr><tr><td>Teminated（结束）</td><td>run 方法正常退出而死亡，或者因为没有捕获的异常终止了 run 方法而死亡</td></tr></tbody></table><p><img src="/assets/JUC-线程6种状态.0b3550c2.png" alt=""></p><ul><li><p>NEW → RUNNABLE：当调用 t.start() 方法时，由 NEW → RUNNABLE</p></li><li><p>RUNNABLE &lt;--&gt; WAITING：</p><ul><li><p>调用 obj.wait() 方法时</p><p>调用 obj.notify()、obj.notifyAll()、t.interrupt()：</p><ul><li>竞争锁成功，t 线程从 WAITING → RUNNABLE</li><li>竞争锁失败，t 线程从 WAITING → BLOCKED</li></ul></li><li><p>当前线程调用 t.join() 方法，注意是当前线程在 t 线程对象的监视器上等待</p></li><li><p>当前线程调用 LockSupport.park() 方法</p></li></ul></li><li><p>RUNNABLE &lt;--&gt; TIMED_WAITING：调用 obj.wait(long n) 方法、当前线程调用 t.join(long n) 方法、当前线程调用 Thread.sleep(long n)</p></li><li><p>RUNNABLE &lt;--&gt; BLOCKED：t 线程用 synchronized(obj) 获取了对象锁时竞争失败</p></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Thread.State</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token constant">NEW</span><span class="token punctuation">,</span><span class="token punctuation">(</span>新建<span class="token punctuation">)</span>
    <span class="token constant">RUNNABLE</span><span class="token punctuation">,</span>（准备就绪）
    <span class="token constant">BLOCKED</span><span class="token punctuation">,</span>（阻塞）
    <span class="token constant">WAITING</span><span class="token punctuation">,</span>（不见不散）
    <span class="token constant">TIMED_WAITING</span><span class="token punctuation">,</span>（过时不候）
    <span class="token constant">TERMINATED</span><span class="token punctuation">;</span><span class="token punctuation">(</span>终结<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>线程几个状态的介绍：</p><ul><li><strong>New</strong>：表示刚刚创建的线程，这种线程还没有开始执行</li><li><strong>RUNNABLE</strong>：运行状态，线程的start()方法调用后，线程会处于这种状态</li><li><strong>BLOCKED</strong>：阻塞状态。当线程在执行的过程中遇到了synchronized同步块，但这个同步块被其他线程已获取还未释放时，当前线程将进入阻塞状态，会暂停执行，直到获取到锁。当线程获取到锁之后，又会进入到运行状态（RUNNABLE）</li><li><strong>WAITING</strong>：等待状态。和TIME_WAITING都表示等待状态，区别是WAITING会进入一个无时间限制的等，而TIME_WAITING会进入一个有限的时间等待，那么等待的线程究竟在等什么呢？一般来说，WAITING的线程正式在等待一些特殊的事件，比如，通过wait()方法等待的线程在等待notify()方法，而通过join()方法等待的线程则会等待目标线程的终止。一旦等到期望的事件，线程就会再次进入RUNNABLE运行状态。</li><li><strong>TERMINATED</strong>：表示结束状态，线程执行完毕之后进入结束状态。</li></ul><p><strong>注意：从NEW状态出发后，线程不能在回到NEW状态，同理，处理TERMINATED状态的线程也不能在回到RUNNABLE状态</strong></p><h4 id="_6、wait-sleep的区别" tabindex="-1"><a class="header-anchor" href="#_6、wait-sleep的区别" aria-hidden="true">#</a> 6、wait/sleep的区别？</h4><p>功能都是当前线程暂停，有什么区别？</p><p>wait放开手去睡，放开手里的锁</p><p>sleep握紧手去睡，醒了手里还有锁</p><h3 id="_2、线程的基本操作" tabindex="-1"><a class="header-anchor" href="#_2、线程的基本操作" aria-hidden="true">#</a> 2、线程的基本操作</h3><h4 id="_1、新建线程" tabindex="-1"><a class="header-anchor" href="#_1、新建线程" aria-hidden="true">#</a> 1、新建线程</h4><p>新建线程很简单。只需要使用new关键字创建一个线程对象，然后调用它的start()启动线程即可。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>那么线程start()之后，会干什么呢？线程有个run()方法，start()会创建一个新的线程并让这个线程执行run()方法。</p><p>这里需要注意，下面代码也能通过编译，也能正常执行。但是，却不能新建一个线程，而是在当前线程中调用run()方法，将run方法只是作为一个普通的方法调用。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>所以，希望大家注意，调用start方法和直接调用run方法的区别。</p><p><strong>start方法是启动一个线程，run方法只会在垫钱线程中串行的执行run方法中的代码。</strong></p><p>默认情况下， 线程的run方法什么都没有，启动一个线程之后马上就结束了，所以如果你需要线程做点什么，需要把您的代码写到run方法中，所以必须重写run方法。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            
    <span class="token annotation punctuation">@Override</span>            
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,我是一个线程!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面是使用匿名内部类实现的，重写了Thread的run方法，并且打印了一条信息。**我们可以通过继承Thread类，然后重写run方法，来自定义一个线程。**但考虑java是单继承的，从扩展性上来说，我们实现一个接口来自定义一个线程更好一些，java中刚好提供了Runnable接口来自定义一个线程。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>    
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thread类有一个非常重要的构造方法：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public Thread(Runnable target)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们在看一下Thread的run方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            
        target<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当我们启动线程的start方法之后，线程会执行run方法，run方法中会调用Thread构造方法传入的target的run方法。</p><p><strong>实现Runnable接口是比较常见的做法，也是推荐的做法。</strong></p><h4 id="_2、终止线程" tabindex="-1"><a class="header-anchor" href="#_2、终止线程" aria-hidden="true">#</a> 2、终止线程</h4><p>一般来说线程执行完毕就会结束，无需手动关闭。但是如果我们想关闭一个正在运行的线程，有什么方法呢？可以看一下Thread类中提供了一个stop()方法，调用这个方法，就可以立即将一个线程终止，非常方便。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当前线程休眠1秒</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭线程thread1</span>
        thread1<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出线程thread1的状态</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> thread1<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当前线程休眠1秒</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出线程thread1的状态</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> thread1<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行代码，输出：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>18:02:15.312 [thread1] INFO com.itsoku.chat01.Demo01 - start
18:02:16.311 [main] INFO com.itsoku.chat01.Demo01 - RUNNABLE
18:02:17.313 [main] INFO com.itsoku.chat01.Demo01 - TERMINATED
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码中有个死循环，调用stop方法之后，线程thread1的状态变为TERMINATED（结束状态），线程停止了。</p><p>我们使用idea或者eclipse的时候，会发现这个方法是一个废弃的方法，也就是说，在将来，jdk可能就会移除该方法。</p><p>stop方法为何会被废弃而不推荐使用？stop方法过于暴力，强制把正在执行的方法停止了。</p><p>大家是否遇到过这样的场景：<strong>电力系统需要维修，此时咱们正在写代码，维修人员直接将电源关闭了，代码还没保存的，是不是很崩溃，这种方式就像直接调用线程的stop方法类似。线程正在运行过程中，被强制结束了，可能会导致一些意想不到的后果。可以给大家发送一个通知，告诉大家保存一下手头的工作，将电脑关闭。</strong></p><h4 id="_3、线程中断" tabindex="-1"><a class="header-anchor" href="#_3、线程中断" aria-hidden="true">#</a> 3、线程中断</h4><p>在java中，线程中断是一种重要的线程写作机制，从表面上理解，中断就是让目标线程停止执行的意思，实际上并非完全如此。在上面中，我们已经详细讨论了stop方法停止线程的坏处，jdk中提供了更好的中断线程的方法。严格的说，线程中断并不会使线程立即退出，而是给线程发送一个通知，告知目标线程，有人希望你退出了！至于目标线程接收到通知之后如何处理，则完全由目标线程自己决定，这点很重要，如果中断后，线程立即无条件退出，我们又会到stop方法的老问题。</p><p>Thread提供了3个与线程中断有关的方法，这3个方法容易混淆，大家注意下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//中断线程</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//判断线程是否被中断</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//判断线程是否被中断，并清除当前中断状态</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>interrupt()<strong>方法是一个</strong>实例方法</strong>，它通知目标线程中断，也就是设置中断标志位为true，中断标志位表示当前线程已经被中断了。<strong>isInterrupted()<strong>方法也是一个</strong>实例方法</strong>，它判断当前线程是否被中断（通过检查中断标志位）。最后一个方法<strong>interrupted()<strong>是一个</strong>静态方法</strong>，返回boolean类型，也是用来判断当前线程是否被中断，但是同时会清除当前线程的中断标志位的状态。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我要退出了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中有个死循环，interrupt()方法被调用之后，线程的中断标志将被置为true，循环体中通过检查线程的中断标志是否为ture（<code>this.isInterrupted()</code>）来判断线程是否需要退出了。</p><p>再看一种中断的方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> isStop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isStop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我要退出了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isStop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码中通过一个变量isStop来控制线程是否停止。</p><p>通过变量控制和线程自带的interrupt方法来中断线程有什么区别呢？</p><p>如果一个线程调用了sleep方法，一直处于休眠状态，通过变量控制，还可以中断线程么？大家可以思考一下。</p><p>此时只能使用线程提供的interrupt方法来中断线程了。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//休眠100秒</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我要退出了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>调用interrupt()方法之后，线程的sleep方法将会抛出<code>InterruptedException</code>异常。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//休眠100秒</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我要退出了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行上面的代码，发现程序无法终止。为什么？</p><p>代码需要改为：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//休眠100秒</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我要退出了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码可以终止。</p><p><strong>注意：sleep方法由于中断而抛出异常之后，线程的中断标志会被清除（置为false），所以在异常中需要执行this.interrupt()方法，将中断标志位置为true</strong></p><h4 id="_4、等待-wait-和通知-notify" tabindex="-1"><a class="header-anchor" href="#_4、等待-wait-和通知-notify" aria-hidden="true">#</a> 4、等待（wait）和通知（notify）</h4><p>为了支持多线程之间的协作，JDK提供了两个非常重要的方法：等待wait()方法和通知notify()方法。这2个方法并不是在Thread类中的，而是在Object类中定义的。这意味着所有的对象都可以调用者两个方法。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>当在一个对象实例上调用wait()方法后，当前线程就会在这个对象上等待。这是什么意思？比如在线程A中，调用了obj.wait()方法，那么线程A就会停止继续执行，转为等待状态。等待到什么时候结束呢？线程A会一直等到其他线程调用obj.notify()方法为止，这时，obj对象成为了多个线程之间的有效通信手段。</p><p>那么wait()方法和notify()方法是如何工作的呢？如图2.5展示了两者的工作过程。如果一个线程调用了object.wait()方法，那么它就会进出object对象的等待队列。这个队列中，可能会有多个线程，因为系统可能运行多个线程同时等待某一个对象。当object.notify()方法被调用时，它就会从这个队列中随机选择一个线程，并将其唤醒。这里希望大家注意一下，这个选择是不公平的，并不是先等待线程就会优先被选择，这个选择完全是随机的。</p><p><img src="/assets/f950f73b-52a6-4ecd-a8cb-5422bcd3a44e.fe9b498b.png" alt="f950f73b-52a6-4ecd-a8cb-5422bcd3a44e"></p><p>除notify()方法外，Object独享还有一个nofiyAll()方法，它和notify()方法的功能类似，不同的是，它会唤醒在这个等待队列中所有等待的线程，而不是随机选择一个。</p><p>这里强调一点，Object.wait()方法并不能随便调用。它必须包含在对应的synchronize语句汇总，无论是wait()方法或者notify()方法都需要首先获取目标独享的一个监视器。图2.6显示了wait()方法和nofiy()方法的工作流程细节。其中T1和T2表示两个线程。T1在正确执行wait()方法钱，必须获得object对象的监视器。而wait()方法在执行后，会释放这个监视器。这样做的目的是使其他等待在object对象上的线程不至于因为T1的休眠而全部无法正常执行。</p><p>线程T2在notify()方法调用前，也必须获得object对象的监视器。所幸，此时T1已经释放了这个监视器，因此，T2可以顺利获得object对象的监视器。接着，T2执行了notify()方法尝试唤醒一个等待线程，这里假设唤醒了T1。T1在被唤醒后，要做的第一件事并不是执行后续代码，而是要尝试重新获得object对象的监视器，而这个监视器也正是T1在wait()方法执行前所持有的那个。如果暂时无法获得，则T1还必须等待这个监视器。当监视器顺利获得后，T1才可以在真正意义上继续执行。</p><p>给大家上个例子：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo06</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T1 start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T1 wait for object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    object<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T1 end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T2</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T2 start，notify one thread! &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                object<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T2 end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">T2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">1562934497212</span><span class="token operator">:</span><span class="token constant">T1</span> start<span class="token operator">!</span>
<span class="token number">1562934497212</span><span class="token operator">:</span><span class="token constant">T1</span> wait <span class="token keyword">for</span> object
<span class="token number">1562934497212</span><span class="token operator">:</span><span class="token constant">T2</span> start，notify one thread<span class="token operator">!</span>
<span class="token number">1562934497212</span><span class="token operator">:</span><span class="token constant">T2</span> end<span class="token operator">!</span>
<span class="token number">1562934499213</span><span class="token operator">:</span><span class="token constant">T1</span> end<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意下打印结果，T2调用notify方法之后，T1并不能立即继续执行，而是要等待T2释放objec投递锁之后，T1重新成功获取锁后，才能继续执行。因此最后2行日志相差了2秒（因为T2调用notify方法后休眠了2秒）。</p><p><strong>注意：Object.wait()方法和Thread.sleep()方法都可以让现场等待若干时间。除wait()方法可以被唤醒外，另外一个主要的区别就是wait()方法会释放目标对象的锁，而Thread.sleep()方法不会释放锁。</strong></p><p>再给大家讲解一下wait()，notify()，notifyAll()，加深一下理解：</p><p>可以这么理解，obj对象上有2个队列，如图1，<strong>q1：等待队列，q2：准备获取锁的队列</strong>；两个队列都为空。</p><p><img src="data:image/png;base64,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" alt="5f1e0099-c802-4e79-803a-a5117e6666ff"></p><p><strong>obj.wait()过程：</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">synchronize</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假如有3个线程，t1、t2、t3同时执行上面代码，t1、t2、t3会进入q2队列，如图2，进入q2的队列的这些线程才有资格去争抢obj的锁，假设t1争抢到了，那么t2、t3机型在q2中等待着获取锁，t1进入代码块执行wait()方法，此时t1会进入q1队列，然后系统会通知q2队列中的t2、t3去争抢obj的锁，抢到之后过程如t1的过程。最后t1、t2、t3都进入了q1队列，如图3。</p><p><img src="data:image/png;base64,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" alt="6c5eec72-3303-40a5-b70d-6e24ba12d2de"></p><p><img src="data:image/png;base64,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" alt="45fd3950-b371-4d46-a5df-2ce1c8303707"></p><p>上面过程之后，又来了线程t4执行了notify()方法，如下：**</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">synchronize</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>t4会获取到obj的锁，然后执行notify()方法，系统会从q1队列中随机取一个线程，将其加入到q2队列，假如t2运气比较好，被随机到了，然后t2进入了q2队列，如图4，进入q2的队列的锁才有资格争抢obj的锁，t4线程执行完毕之后，会释放obj的锁，此时队列q2中的t2会获取到obj的锁，然后继续执行，执行完毕之后，q1中包含t1、t3，q2队列为空，如图5</p><p><img src="data:image/png;base64,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" alt="fbf3b798-65f7-4b90-a614-66854fcce5fa"></p><p><img src="data:image/png;base64,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" alt="b3868bc9-3da0-474b-a48e-20f90c1335ee"></p><p><strong>接着又来了个t5队列，执行了notifyAll()方法，如下：</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">synchronize</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.调用obj.wait()方法，当前线程会加入队列queue1，然后会释放obj对象的锁</p><p><img src="data:image/png;base64,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" alt="9e648015-c445-4e84-bd8c-a53a380cbd7f"></p><p>t5会获取到obj的锁，然后执行notifyAll()方法，系统会将队列q1中的线程都移到q2中，如图6，t5线程执行完毕之后，会释放obj的锁，此时队列q2中的t1、t3会争抢obj的锁，争抢到的继续执行，未增强到的带锁释放之后，系统会通知q2中的线程继续争抢索，然后继续执行，最后两个队列中都为空了。</p><h4 id="_5、挂起-suspend-和继续执行-resume-线程" tabindex="-1"><a class="header-anchor" href="#_5、挂起-suspend-和继续执行-resume-线程" aria-hidden="true">#</a> 5、挂起（suspend）和继续执行（resume）线程</h4><p>Thread类中还有2个方法，即<strong>线程挂起(suspend)<strong>和</strong>继续执行(resume)</strong>，这2个操作是一对相反的操作，被挂起的线程，必须要等到resume()方法操作后，才能继续执行。系统中已经标注着2个方法过时了，不推荐使用。</p><p>系统不推荐使用suspend()方法去挂起线程是因为suspend()方法导致线程暂停的同时，并不会释放任何锁资源。此时，其他任何线程想要访问被它占用的锁时，都会被牵连，导致无法正常运行（如图2.7所示）。直到在对应的线程上进行了resume()方法操作，被挂起的线程才能继续，从而其他所有阻塞在相关锁上的线程也可以继续执行。但是，如果resume()方法操作意外地在suspend()方法前就被执行了，那么被挂起的线程可能很难有机会被继续执行了。并且，更严重的是：它所占用的锁不会被释放，因此可能会导致整个系统工作不正常。而且，对于被挂起的线程，从它线程的状态上看，居然还是<strong>Runnable</strong>状态，这也会影响我们队系统当前状态的判断。</p><p>上个例子：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo07</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">T1</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;in &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T1</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T1</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行代码输出：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>in t1
in t2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>我们会发现程序不会结束，线程t2被挂起了，导致程序无法结束，使用jstack命令查看线程堆栈信息可以看到：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token string">&quot;t2&quot;</span> #<span class="token number">13</span> prio<span class="token operator">=</span><span class="token number">5</span> os_prio<span class="token operator">=</span><span class="token number">0</span> tid<span class="token operator">=</span><span class="token number">0x000000002796c000</span> nid<span class="token operator">=</span><span class="token number">0xa3c</span> runnable <span class="token punctuation">[</span><span class="token number">0x000000002867f000</span><span class="token punctuation">]</span>
   <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread<span class="token punctuation">.</span>State</span><span class="token operator">:</span> <span class="token constant">RUNNABLE</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">suspend0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1029</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat01<span class="token punctuation">.</span></span>Demo07</span>$<span class="token constant">T1</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo07</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> locked <span class="token generics"><span class="token punctuation">&lt;</span>0x0000000717372fc0<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发现t2线程在<strong>suspend0</strong>处被挂起了，t2的状态竟然还是RUNNABLE状态，线程明明被挂起了，状态还是运行中容易导致我们队当前系统进行误判，代码中已经调用resume()方法了，但是由于时间先后顺序的缘故，resume并没有生效，这导致了t2永远滴被挂起了，并且永远占用了object的锁，这对于系统来说可能是致命的。</p><h4 id="_6、等待线程结束-join-和谦让-yeild" tabindex="-1"><a class="header-anchor" href="#_6、等待线程结束-join-和谦让-yeild" aria-hidden="true">#</a> 6、等待线程结束（join）和谦让（yeild）</h4><p>很多时候，一个线程的输入可能非常依赖于另外一个或者多个线程的输出，此时，这个线程就需要等待依赖的线程执行完毕，才能继续执行。jdk提供了join()操作来实现这个功能。如下所示，显示了2个join()方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>第1个方法表示无限等待，它会一直只是当前线程。知道目标线程执行完毕。</p><p>第2个方法有个参数，用于指定等待时间，如果超过了给定的时间目标线程还在执行，当前线程也会停止等待，而继续往下执行。</p><p>比如：线程T1需要等待T2、T3完成之后才能继续执行，那么在T1线程中需要分别调用T2和T3的join()方法。</p><p>上个示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo08</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">T1</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,start &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                num<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,end &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T1</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,num = &quot;</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">1562939889129</span><span class="token punctuation">,</span>start t1
<span class="token number">1562939891134</span><span class="token punctuation">,</span>end t1
<span class="token number">1562939891134</span><span class="token punctuation">,</span>num <span class="token operator">=</span> <span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>num的结果为10，1、3行的时间戳相差2秒左右，说明主线程等待t1完成之后才继续执行的。</p><p>看一下jdk1.8中Thread.join()方法的实现：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
            now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从join的代码中可以看出，在被等待的线程上使用了synchronize，调用了它的wait()方法，线程最后执行完毕之后，<strong>系统会自动调用它的notifyAll()方法</strong>，唤醒所有在此线程上等待的其他线程。</p><p><strong>注意：被等待的线程执行完毕之后，系统自动会调用该线程的notifyAll()方法。所以一般情况下，我们不要去在线程对象上使用wait()、notify()、notifyAll()方法。</strong></p><p>另外一个方法是<strong>Thread.yield()</strong>，他的定义如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>yield是谦让的意思，这是一个静态方法，一旦执行，它会让当前线程出让CPU，但需要注意的是，出让CPU并不是说不让当前线程执行了，当前线程在出让CPU后，还会进行CPU资源的争夺，但是能否再抢到CPU的执行权就不一定了。因此，对Thread.yield()方法的调用好像就是在说：我已经完成了一些主要的工作，我可以休息一下了，可以让CPU给其他线程一些工作机会了。</p><p>如果觉得一个线程不太重要，或者优先级比较低，而又担心此线程会过多的占用CPU资源，那么可以在适当的时候调用一下Thread.yield()方法，给与其他线程更多的机会。</p><h4 id="_7、总结" tabindex="-1"><a class="header-anchor" href="#_7、总结" aria-hidden="true">#</a> 7、总结</h4><ol><li>创建线程的2中方式：继承Thread类；实现Runnable接口</li><li>启动线程：调用线程的start()方法</li><li>终止线程：调用线程的stop()方法，方法已过时，建议不要使用</li><li>线程中断相关的方法：调用线程<strong>实例interrupt()方法</strong>将中断标志置为true；使用**线程实例方法isInterrupted()<strong>获取中断标志；调用</strong>Thread的静态方法interrupted()**获取线程是否被中断，此方法调用之后会清除中断标志（将中断标志置为false了）</li><li>wait、notify、notifyAll方法，这块比较难理解，可以回过头去再理理</li><li>线程挂起使用<strong>线程实例方法suspend()</strong>，恢复线程使用<strong>线程实例方法resume()</strong>，这2个方法都过时了，不建议使用</li><li>等待线程结束：调用<strong>线程实例方法join()</strong></li><li>出让cpu资源：调用<strong>线程静态方法yeild()</strong></li></ol><h3 id="_3、为什么多线程极其重要" tabindex="-1"><a class="header-anchor" href="#_3、为什么多线程极其重要" aria-hidden="true">#</a> 3、为什么多线程极其重要？？？</h3><ol><li>硬件方面 - 摩尔定律失效</li></ol><p>摩尔定律： 它是由英特尔创始人之一Gordon Moore(戈登·摩尔)提出来的。其内容为： 当价格不变时，集成电路上可容纳的元器件的数目约每隔18-24个月便会增加一倍，性能也将提升一倍。 换言之，每一美元所能买到的电脑性能，将每隔18-24个月翻一倍以上。这一定律揭示了信息技术进步的速度。</p><p>可是从2003年开始CPU主频已经不再翻倍，而是采用多核而不是更快的主频。</p><p>摩尔定律失效。</p><p>在主频不再提高且核数在不断增加的情况下，要想让程序更快就要用到并行或并发编程。</p><ol start="2"><li>软件方面</li></ol><p>高并发系统，异步+回调等生产需求</p><h3 id="_4、从start一个线程说起" tabindex="-1"><a class="header-anchor" href="#_4、从start一个线程说起" aria-hidden="true">#</a> 4、从start一个线程说起</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Java线程理解以及openjdk中的实现</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Java语言本身底层就是C++语言</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>OpenJDK源码网址:<a href="http://openjdk.java.net/" target="_blank" rel="noopener noreferrer">http://openjdk.java.net/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>openjdk8\hotspot\src\share\vm\runtime
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>更加底层的C++源码解读</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>openjdk8\jdk\src\share\<span class="token keyword">native</span>\java\lang   thread<span class="token punctuation">.</span>c
java线程是通过start的方法启动执行的，主要内容在<span class="token keyword">native</span>方法start0中，<span class="token class-name">Openjdk</span>的写<span class="token constant">JNI</span>一般是一一对应的，<span class="token class-name">Thread</span><span class="token punctuation">.</span>java对应的就是<span class="token class-name">Thread</span><span class="token punctuation">.</span>c start0其实就是<span class="token class-name">JVM_StartThread</span>。此时查看源代码可以看到在jvm<span class="token punctuation">.</span>h中找到了声明，jvm<span class="token punctuation">.</span>cpp中有实现。    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20210903235656449.4a7ee3fd.png" alt="image-20210903235656449"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>openjdk8\hotspot\src\share\vm\prims  jvm<span class="token punctuation">.</span>cpp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/assets/image-20210903235812379.9661289c.png" alt="image-20210903235812379"></p><p><img src="/assets/image-20210903235817486.d31c132e.png" alt="image-20210903235817486"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>openjdk8\hotspot\src\share\vm\runtime  thread<span class="token punctuation">.</span>cpp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/assets/image-20210903235840971.84ba5593.png" alt="image-20210903235840971"></p><h3 id="_5、用户线程和守护线程" tabindex="-1"><a class="header-anchor" href="#_5、用户线程和守护线程" aria-hidden="true">#</a> 5、用户线程和守护线程</h3><p>Java线程分为用户线程和守护线程，线程的daemon属性为true表示是守护线程，false表示是用户线程</p><h4 id="守护线程" tabindex="-1"><a class="header-anchor" href="#守护线程" aria-hidden="true">#</a> 守护线程</h4><p>是一种特殊的线程，在后台默默地完成一些系统性的服务，比如垃圾回收线程</p><h4 id="用户线程" tabindex="-1"><a class="header-anchor" href="#用户线程" aria-hidden="true">#</a> 用户线程</h4><p>是系统的工作线程，它会完成这个程序需要完成的业务操作</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DaemonDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t 开始运行，&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;守护线程&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;用户线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//线程的daemon属性为true表示是守护线程，false表示是用户线程</span>
        t1<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3秒钟后主线程再运行</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----------main线程运行完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重点" tabindex="-1"><a class="header-anchor" href="#重点" aria-hidden="true">#</a> 重点</h4><p>当程序中所有用户线程执行完毕之后，不管守护线程是否结束，系统都会自动退出</p><p>如果用户线程全部结束了，意味着程序需要完成的业务操作已经结束了，系统可以退出了。所以当系统只剩下守护进程的时候，java虚拟机会自动退出</p><p>设置守护线程，需要在<strong>start()<strong>方法</strong>之前</strong>进行</p><h3 id="_6、获得多线程的方法几种" tabindex="-1"><a class="header-anchor" href="#_6、获得多线程的方法几种" aria-hidden="true">#</a> 6、获得多线程的方法几种？</h3><ul><li><p>传统的是</p><ul><li>继承thread类</li><li>实现runnable接口，</li></ul></li><li><p>java5以后</p><ul><li>实现callable接口</li><li>java的线程池获得</li></ul></li></ul><h3 id="_7、callable接口" tabindex="-1"><a class="header-anchor" href="#_7、callable接口" aria-hidden="true">#</a> 7、Callable接口</h3><h4 id="_1、与runnable对比" tabindex="-1"><a class="header-anchor" href="#_1、与runnable对比" aria-hidden="true">#</a> 1、与runnable对比</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 创建新类MyThread实现runnable接口</span>
<span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 新类MyThread2实现callable接口</span>
<span class="token keyword">class</span> <span class="token class-name">MyThread2</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">200</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token comment">// 面试题:callable接口与runnable接口的区别？</span>

<span class="token comment">// 答：（1）是否有返回值</span>
<span class="token comment">//     （2）是否抛异常</span>
<span class="token comment">//    （3）落地方法不一样，一个是run，一个是call</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、怎么用" tabindex="-1"><a class="header-anchor" href="#_2、怎么用" aria-hidden="true">#</a> 2、怎么用</h4><p>直接替换runnable是否可行？</p><p><img src="/assets/1614161513991-ca4fa075-8d4d-4c45-b1c8-cf6f3d83c6e4.0b19ff84.png" alt="image"></p><p>不可行，因为：thread类的构造方法根本没有Callable</p><p><img src="/assets/1614161519289-57011bee-6de0-4002-b81e-433cede8c7a0.7e849b35.png" alt="image"></p><p>认识不同的人找中间人</p><p><img src="/assets/1614161525949-6b3bf259-23a9-421e-8877-ae7f7de4f3d8.5f3b5175.png" alt="image"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
  <span class="token class-name">FutureTask</span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;AA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行成功后如何获得返回值？</p><p><img src="/assets/1614161535188-cd8c298a-b466-41da-bee3-8ee572236b1f.820cdb70.png" alt="image"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
  <span class="token class-name">FutureTask</span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;AA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/Ragnarokoo/LearningNotes/edit/master/src/notes/juc/一、线程基础.md" rel="noopener noreferrer" target="_blank" aria-label="在【Github】上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在【Github】上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><!----></footer><nav class="page-nav"><!----><a href="/notes/juc/%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0.html" class="nav-link next" aria-label="二、线程池"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">二、线程池<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.9b10ba0a.js" defer></script>
  </body>
</html>
