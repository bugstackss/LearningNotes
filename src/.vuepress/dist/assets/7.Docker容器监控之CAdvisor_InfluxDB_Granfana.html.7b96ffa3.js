import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as i,c as o,d as s,e as n,b as e,a as t,r as l}from"./app.9b10ba0a.js";const c="/assets/image-20230522155658823.01286da6.png",r="/assets/image-20230522155710615.5fd20ebf.png",u="/assets/image-20230522160144158.498921e7.png",d="/assets/image-20230522160024767.9f654e08.png",m="/assets/image-20230522160041087.fbe20111.png",k="/assets/image-20230522160100738.d777f08c.png",g="/assets/image-20230522160124612.9d55e068.png",v="/assets/image-20230522160232255.e07a922e.png",_="/assets/image-20230522160541926.880130e7.png",b="/assets/image-20230522160600410.6c715856.png",f="/assets/image-20230522160705838.5072c8e2.png",h="/assets/image-20230522160802952.1aad3312.png",y="/assets/image-20230522161039998.0e203848.png",x="/assets/image-20230522161106068.579b2a7f.png",q="/assets/image-20230522161136004.5035abbd.png",I="/assets/image-20230522161157043.a43f73de.png",B="/assets/image-20230522161210287.7c6792df.png",D="/assets/image-20230522161221949.6ba59af3.png",A="/assets/image-20230522161251842.5e698d0c.png",N="/assets/image-20230522161304037.e9468b0b.png",C="/assets/image-20230522161316468.649d694f.png",E="/assets/image-20230522161328929.5a8334cd.png",S="/assets/image-20230522161341595.69bd4855.png",T="/assets/image-20230522161353806.f0bc8cef.png",U={},L=t('<h2 id="一、原生命令" tabindex="-1"><a class="header-anchor" href="#一、原生命令" aria-hidden="true">#</a> 一、原生命令</h2><blockquote><p><strong>操作</strong></p></blockquote><p><img src="'+c+'" alt="image-20230522155658823"></p><p><strong>docker stats命令的结果</strong></p><p><img src="'+r+'" alt="image-20230522155710615"></p><blockquote><p><strong>问题</strong></p></blockquote><p>通过docker stats命令可以很方便的看到当前宿主机上所有容器的CPU,内存以及网络流量等数据，<strong>一般小公司够用了。。。。</strong></p><p>但是，docker stats统计结果只能是当前宿主机的全部容器，数据资料是实时的，没有地方存储、没有健康指标过线预警等功能</p><h2 id="二、是什么" tabindex="-1"><a class="header-anchor" href="#二、是什么" aria-hidden="true">#</a> 二、是什么</h2><p><strong>容器监控三剑客</strong></p><p>一句话：CAdvisor监控收集+InfluxDB存储数据+Granfana展示图标</p><p><img src="'+u+'" alt="image-20230522160144158"></p><p><strong>CAdvisor</strong></p><p><img src="'+d+'" alt="image-20230522160024767"></p><p><strong>InfluxDB</strong></p><p><img src="'+m+'" alt="image-20230522160041087"></p><p><strong>Granfana</strong></p><p><img src="'+k+'" alt="image-20230522160100738"></p><p><strong>总结</strong></p><p><img src="'+g+'" alt="image-20230522160124612"></p><h2 id="三、compose容器编排-一套带走" tabindex="-1"><a class="header-anchor" href="#三、compose容器编排-一套带走" aria-hidden="true">#</a> 三、compose容器编排，一套带走</h2><p>1.新建目录</p><p><img src="'+v+`" alt="image-20230522160232255"></p><p>2.新建3件套组合的docker-compose.yml文件</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.1&#39;</span>
 
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">grafana_data</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
 <span class="token key atrule">influxdb</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> tutum/influxdb<span class="token punctuation">:</span><span class="token number">0.9</span>
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> PRE_CREATE_DB=cadvisor

  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8083:8083&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8086:8086&quot;</span>

  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ./data/influxdb<span class="token punctuation">:</span>/data

 <span class="token key atrule">cadvisor</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> google/cadvisor
  <span class="token key atrule">links</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> influxdb<span class="token punctuation">:</span>influxsrv
  <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>storage_driver=influxdb <span class="token punctuation">-</span>storage_driver_db=cadvisor <span class="token punctuation">-</span>storage_driver_host=influxsrv<span class="token punctuation">:</span><span class="token number">8086</span>
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /<span class="token punctuation">:</span>/rootfs<span class="token punctuation">:</span>ro
    <span class="token punctuation">-</span> /var/run<span class="token punctuation">:</span>/var/run<span class="token punctuation">:</span>rw
    <span class="token punctuation">-</span> /sys<span class="token punctuation">:</span>/sys<span class="token punctuation">:</span>ro
    <span class="token punctuation">-</span> /var/lib/docker/<span class="token punctuation">:</span>/var/lib/docker<span class="token punctuation">:</span>ro

 <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
  <span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token string">&quot;104&quot;</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana
  <span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token string">&quot;104&quot;</span>
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">links</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> influxdb<span class="token punctuation">:</span>influxsrv
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;3000:3000&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> grafana_data<span class="token punctuation">:</span>/var/lib/grafana
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> HTTP_USER=admin
    <span class="token punctuation">-</span> HTTP_PASS=admin
    <span class="token punctuation">-</span> INFLUXDB_HOST=influxsrv
    <span class="token punctuation">-</span> INFLUXDB_PORT=8086
    <span class="token punctuation">-</span> INFLUXDB_NAME=cadvisor
    <span class="token punctuation">-</span> INFLUXDB_USER=root
    <span class="token punctuation">-</span> INFLUXDB_PASS=root
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.启动docker-compose文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> up
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+_+'" alt="image-20230522160541926"></p><p><img src="'+b+'" alt="image-20230522160600410"></p><p>4.查看三个服务容器是否启动</p><p><img src="'+f+'" alt="image-20230522160705838"></p><p>5.测试</p>',32),P=s("code",null,"收集",-1),F={href:"http://ip:8080/",target:"_blank",rel:"noopener noreferrer"},G=s("p",null,[s("img",{src:h,alt:"image-20230522160802952"})],-1),R=s("ul",null,[s("li",null,"第一次访问慢，请稍等"),s("li",null,"cadvisor也有基础的图行展示功能，这里主要用它来做数据采集")],-1),X=s("code",null,"存储",-1),w={href:"http://ip:8083/",target:"_blank",rel:"noopener noreferrer"},V=s("code",null,"展现",-1),H={href:"http://ip:3000",target:"_blank",rel:"noopener noreferrer"},O=t('<p>ip+3000端口的方式访问，默认账户密码（admin/admin）</p><p><img src="'+y+'" alt="image-20230522161039998"></p><p><strong>配置步骤</strong></p><ol><li>配置数据源</li></ol><p><img src="'+x+'" alt="image-20230522161106068"></p><ol start="2"><li>选择Influxdb数据源</li></ol><p><img src="'+q+'" alt="image-20230522161136004"></p><ol start="3"><li>配置细节</li></ol><p><img src="'+I+'" alt="image-20230522161157043"></p><p><img src="'+B+'" alt="image-20230522161210287"></p><p><img src="'+D+'" alt="image-20230522161221949"></p><ol start="4"><li>配置面板panel</li></ol><p><img src="'+A+'" alt="image-20230522161251842"></p><p><img src="'+N+'" alt="image-20230522161304037"></p><p><img src="'+C+'" alt="image-20230522161316468"></p><p><img src="'+E+'" alt="image-20230522161328929"></p><p><img src="'+S+'" alt="image-20230522161341595"></p><p><img src="'+T+'" alt="image-20230522161353806"></p><p>到这里CAdvisor+Influxdb+Grafana容器监控系统部署完成了</p>',19);function M(j,z){const a=l("ExternalLinkIcon");return i(),o("div",null,[L,s("blockquote",null,[s("p",null,[n("浏览CAdvisor"),P,n("服务，"),s("a",F,[n("http://ip:8080/"),e(a)])])]),G,R,s("blockquote",null,[s("p",null,[n("浏览Influxdb"),X,n("功能，"),s("a",w,[n("http://ip:8083/"),e(a)])])]),s("blockquote",null,[s("p",null,[n("浏览grafana"),V,n("功能，"),s("a",H,[n("http://ip:3000"),e(a)])])]),O])}const Q=p(U,[["render",M],["__file","7.Docker容器监控之CAdvisor+InfluxDB+Granfana.html.vue"]]);export{Q as default};
