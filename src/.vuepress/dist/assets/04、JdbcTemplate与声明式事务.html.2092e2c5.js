import{_ as o}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as c,c as l,d as n,b as a,a as t,e,r as i}from"./app.9b10ba0a.js";const u="/assets/NfepJE5nQI6jAd7.d4d8076a.png",r="/assets/gs6N9lbZckfdD4t.a67208fc.png",k="/assets/8e5aPG6Sx3YlZty.d6d46d87.png",d="/assets/n4qpwel6KRakdAm.961c7634.png",m="/assets/lr6szWvfcaO1bDm.62e17aeb.png",v="/assets/TCLlJNIZ3RBovUX.b7b207cd.png",b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaIAAABBCAYAAACTrKD3AAANW0lEQVR4nO3cWXBUV37H8e+VWvsGQis7AwZhBCNAEgYJm8UglrE1AjPGs5WTiquSyeRhkpSrJqmpSh6SqtRUUpXUPE3FM5WMh/IUGRaPzW6ZxWC0AGLfBGhh0UZraaGlu9U3Dy0JNRKoW2p8Bfp9nujD1f/ec/rf99/33HPbyMvLM5Hnwu12A2Cz2Sw+EhEv5aSMRSFWH4CIiIxvKkQiImIpFSIREbGUCpGIiFhKhUhERCw15NKZqTNnExUTM6jd3lhPd1cXczIyhw3saGvl1rVLoz/Cl5TGWMYa5aRYZchCNG3WHCalpA5qv36pAkdLM9/OXTFs4Lp7tUFPSNMMxRbqocfz4q84H6tjLOOXclKsYtnUXNq6n/M3P9vKFNO/omKak1jy/j/zkw//jmXpfv7Nqz/kp//4M7InvPiFayQCHWOR5+155WTiggKWZ88hIkhxgx1Pni0oT7W12Ju4UH6aB7VVuFwuEiYkDvnNanRMelxu3G4Xbk+QQw8ja/FiACrOnftmdyzyFMpJX5PmrSJ7Ug+Xy27SPQbjjRcjzcuAC5G9sYGDuz/pfx0VE0v1rRvMTTPZlhPKxOgQbjfYOXyxIdDQz2QYdi7s+CcueF8FNfazTJ8xgzVr1wFgt9upqa5+7vt8coxnZ2SSmJxC2Ylin7bY+ITnfiwy9ignZSwaTV4GXIiczm7q7tX6tG3MsvHOsjCM3vqQNTOElRmh/MtuJ22dz7i0NU2iX/kORQW5pEX34LhfwenPP6eypefxJjOK+OCHy4nuDW52lLHn3/9ArWE8ESqMpMWFrF6xkKQ4aK8+QfE1k9FcWE+cmMjbhUWEhHhnMN8uLOL3v/tfmpvto4g6vCfHOG3KdGLjE4ZsG5YfY5y27udsy7zB4QNuMtdmkxzlwnGvgq/3fcatFt/Lz6gZq8h/YxnTUxMIc7dhryrn1JEvuOswe3eXwfoP/4zw0gNELFlLov0o+4+HkV+0gviWMg7u2EtNV+97aRpEz1zF66tfY0ZaPCHdduquHePEkRIeur65LxsvkvGSk6YZSnLWd3l9+askT4wlzOyivf4m54/8H+dqu7zbTFjL9/+6gOT+c0EB7/+ioPfvPVTu/pD9Vx7n0bC5G0C8KRt/wZY5F9j5X3uo6zs3zd3OX22byrlf/5KSxr4cH74fL4PR5mXAhSg8PILE5BQAWpvtxIV1sCXXhmFAp9PkYTtMTTRIjjfY9pqNj750PSPaLBblVHP7xB6uRs1gYV4+Be908PCjwzSbvclQf4pDO28QCiRkFrFy5lM6Mm0jmzflYKs+yanjtbgSMli6ZDIm7kC7CIBhGOTk5tLY6Htll5Oby+FDBzGf49zxwDEGiImLJzwigrQp03za/OPHGAMYr7BocSWVx3dxKXIW316ZT0GRg9//ppjWvg/apNW8vX0DUXdPULa/lu6oGSzIX89bW13s+O3R/u0AklIMSo6Wk1XwBmuzT1FWXEHWxjxyFx2nprQFgJCUNRS+t57ouycp+dwbb2H+O2yJcfPxzjN0GipGA42rnExazfrNuYReP8TxY3V0GbGkLykg/3tbafnPj7njNuDRRU7sbiIKSM15j8VxFzlWfInO3r203X28R79yN4B4fvOnHy+4YORlwIUoMTmFgqLtAHy5bw+zIu8Q2rvk4V93O7nXbPKT9eFkfyuEBVOHWQsR3UXln3Zyvt0AznHHmcwHmxYyO+Ew5S29neyqp+ZGPQAp077z1FDJ8xeQ4LzIvj/s5ZbbG6/B9rd8Pz3QHnqZpsmhgwdG9sejNHCMB3qy7ckr0yH5McYARLZz49OdVPRudy9kMu+vzWBGdDEXej+JkbFuHpzbw/XiU9S7DeA8VWY6HxRkMjPmKOc7+oIZOKpKuXo2nLglK5hy5xhXzkUTl7OMVydMALw7TsnKIdnd+565vPutcifx5xuWMzfuDOfbAxq2l954ysmQ1HQSjXpOf3mEq3bvyfr2zWtcS4zoLwyGq4G7V3pPfhnbIbyeqssVtPV/gXl8kvcndwOJ5y9/+vGiC0ZeBlyI6u7V8j+/+mX/6zkLQp+6bejT/8urs54mB/3vb1djPY9IJzqevnOV32Jj46C1nibX43j2pgZMkgMLNAY8OcZZuXmkTpnmM0ff1zYsf8e4y3e7NvtD3EwlKgb6PjHd1Sc4Xg2mYSMs3IYBeDocuJlMZAzQ8Ticx+wBTEwTPD09QA+eHnw+y3Gx8dDcgN2IJCzc29bT1ECHsYj4iYAK0ZjxTeekp+4uTZ5MMjcW0nPpFvUP7lLf2IK93mAkBSGQ3A2mYPfjZTXqVXNX7nnwmBBiwD8UhfdPzQFcqhlueZs56KWJQcgI3h/DMADfe0KjedzIMAzWrS9gYmKiT3uz3f7cp0GCy88xNj1PbGl6R3Pg7N2EheRt3sSCaYlE2B5f7Zpm/YiOzDAMjPR1/OjDdb57Ntv7r7LlsXGVkw+Psf+P4axYsZjcTflEhBq4H92n8sROviirpSfAadtg567fgtyPsSgYeTlkIWpva6GtxXuTaWJSMhMSk/r/LzY+of8JaxOTq+fPsrfcTVGOjahwg6m9x9LkMPlj6XD3Z4xBLw1GtsDA21nDJ+JICtrAeGWlpfzgRz8mMjISgK6uLg4dOBCUD7y/YwyQOmUasXHxZOXm+bT5JzhjbJqxLNr8HlmTKjn92V7qHG5vjCmrKFw9IcBofTFNzMav2X/gwhPTFG7a60YU8qU2nnLSMDy03jjI/hsHMUMiiU/5Fq/kF7Ji/Tbst/+D8gDWZjyf3PVAiO/5BsMgBA8ez8Cm4PVjrApGXg5ZiC6eKSE2Lp6w8AiuVJSTkj6l/6nq8PAIn4Tz9Hj405nT3Krz8PdveedXKqo9/Hexk47hFuBHpZIUB/d6p2Aik1OJwcGjVr+O3Ud7uwNmp5IUBq299S8xKQVjFOvmmpvtfLp3N+9sexeAT/fuDtrqpEDGODYunvDIyEFt7Y624XcUtDFOY1KKjfbLxZRfqupvjUh8Y8RPRTva22Cqh0c1N3nQe5PajE5nxuQIzG/4WbEXxXjJyfCkOUxJ6OBB5T26PF046q5w5sRMMuctJyEReKLLpmfwF9HHAs/dZ8eDNnsLRKeSFA0Per9FTUxOJdTTTNuAKe9A+/GiGm1eDipE4RGRvFHwFpOne5entbU0c/TAXipKTpKQOAl7k+/zBH2u3Ht85qhu9AxfhACcCcwv3EbIhUo6o2eyMO8VzIYj3B6QkFFp80mL96ZLQkIYhCaQNi/Te+DOJu7fqaPbMGi8dpm2nDxef/dtYs7X4kqYz9yMSMxR3hKsqa6m+IvD/f8OhkDHeFTz8X6MsX/u0/DASebCQla3naS21UPUpLnMnpeCi2etjHy6hooyGpeuZe3WTs5drcNpm8j07DXMjznLrl/dwY9T2rg0HnLSk5jDm9syaC4/yIWqVnpC40hdvJR4dy1nh7hafviwETMjkyXZTdzt9ADdNFVepdlpMJLcfXY8cFwtpeb1bbz2bhGhZ6rojptH1vLJtF8+zB03/Rd9gfbjRTaavBxUiLLzVvUnI0D8hIms3ljI7o8/GuVhDqHnBufPulmwdgsp0R7a7p/i0L4vsA9YVjx1xY/Z+OrAw0xg+ffmAmC2fuVdxw+4a/bz+f4IVq1YyorN2Ty6W8qx8hqmbRj9YoVgP70+1sbYH4bRwaV9vyOuYBPz87eQYXTSUlPKVyUuNhTOGtGheRqK2fsJrFqzjPy34jCcDpprSti/az/3PS/+3Pnz9LLnpOv6bj47XER+TgFrlkRhMztpf1hF+a49XB6w0KGPvWQXX6dvZfGb21kYFoJp1lP666uUNI4sd58VD8BwlHFgRzgr38xn6YZcbM6HPDj/CQeKL+E0Rt6PF91I89LIy8vzmbva/hc/JSIyatCGe3f8lo5HDmLjEshZuaa/vfLqpf4fOfzNX3rnB5scJg97HxL7t0+dIzqwl4Hb7Z0jtNl8632gY9w3DWIfsE6/bxpkqKtTkadRTspYNOiKyOV0DpmQbpcTl8uF09lN/YBnBR45Bs/xJMUZJMW9ZKU+iAId46HW9dTj/cl9kWBQToqVBhWim1cusPi1lT5t92uq+m9Ctre1UlF68plBB14RyWDBGGORYFJOipUGFaKLZ0owTZi7YBFh4RHU3rlJ2VdHAwp68noPe8tH9tM640EwxlgkmJSTYqVB94gkeJ42Hy9iFeWkjEV6fl1ERCylQiQiIpZSIRIREUupEImIiKVsfTcv5fnRGMtYo5yUscTmDvCnXkRERILJ1vXIYfUxiIjIOKZ7RCIiYikVIhERsZQKkYiIWEqFSERELKVCJCIillIhEhERS6kQiYiIpVSIRETEUipEIiJiKRUiERGxlAqRiIhYSoVIREQspUIkIiKWUiESERFLqRCJiIilVIhERMRSKkQiImIpFSIREbGUCpGIiFhKhUhERCylQiQiIpZSIRIREUupEImIiKVUiERExFIqRCIiYikVIhERsZQKkYiIWEqFSERELKVCJCIillIhEhERS6kQiYiIpVSIRETEUipEIiJiqf8Hsyu5Pi2UgekAAAAASUVORK5CYII=",g="/assets/oCSa3qAMGYbyfRN.de4fb24e.png",q="/assets/YHjmQBSNXzDdPRL.c035dcda.png",h="/assets/SgzfJ29Ph4VbpKl.c2534632.png",w="/assets/Z8cquiezmorPxXY.79705ea1.png",f="/assets/Vvtmo9BXnd1IfFG.3768038b.png",y="/assets/9Fu65poPBDlmryn.17fe42fb.gif",x="/assets/hsX2AgEaPbSK8dj.adeca7de.png",_="/assets/rAOuq8Ml7kaE3ZJ.4322f9b3.png",S="/assets/djR3QoVOblLS7c5.902de642.png",j="/assets/zVF7b5RdXPyJZ2l.438c7dfc.png",T="/assets/uogKOIvxQhl3d9L.7760bcd4.png",R="/assets/IDQY1ue4BTSLwtW.908609d3.png",p="/assets/lbWkLeNT67x5yKD.4c5f7d39.png",D="/assets/42ncr6mtsbLGFvg.0efc8939.png",A="/assets/XNTP5Kwz3hGW1vp.b6dadc52.png",B="/assets/MbpwgBudcGKx7rJ.2059e26d.png",E="/assets/lbWkLeNT67x5yKD.4c5f7d39.png",I="/assets/z91mdZWXBLIuDKT.7838ad08.png",L="/assets/vh6obZc7uBwU4pO.c7c02553.png",O="/assets/57BxlHsi6zJtPdZ.29b7f2c7.png",M="/assets/F6Ab9jzGw3XvCpq.45edceff.png",C={},P=t('<h1 id="jdbctemplate与声明式事务" tabindex="-1"><a class="header-anchor" href="#jdbctemplate与声明式事务" aria-hidden="true">#</a> JdbcTemplate与声明式事务</h1><h2 id="_1、jdbctemplate" tabindex="-1"><a class="header-anchor" href="#_1、jdbctemplate" aria-hidden="true">#</a> 1、JdbcTemplate</h2><h3 id="_1-1、概述" tabindex="-1"><a class="header-anchor" href="#_1-1、概述" aria-hidden="true">#</a> 1.1、概述</h3><p>前面我们已经学习了 Spring 中的<code>Core Container</code>核心部分和<code>AOP</code>、<code>Aspects</code>等面向切面编程部分，接下来就是<code>Data Access/Integration</code>即数据访问和集成部分</p><p>Spring 既可以单独使用，也可以集成其他框架，如<code>Hibernate</code>、<code>MyBatis</code>等。除此之外，其中对于<code>JDBC</code>也做了封装，即本章节的<code>JdbcTemplate</code>，用它可以比较方便地对数据库进行增删改查等操作</p>',5),U={href:"https://s2.loli.net/2022/03/06/NfepJE5nQI6jAd7.png",target:"_blank",rel:"noopener noreferrer"},J=n("img",{src:u,alt:"image-20220306201355097"},null,-1),F=t('<p>总结一下：</p><ul><li><code>JdbcTemplate</code>就是 Spring 框架对<code>JDBC</code>技术进行的二次封装模板，能够简化对数据库的操作</li></ul><h3 id="_1-2、准备工作" tabindex="-1"><a class="header-anchor" href="#_1-2、准备工作" aria-hidden="true">#</a> 1.2、准备工作</h3><p><strong>步骤预览</strong></p><ul><li>1）引入相关<code>jar</code>包</li><li>2）Spring 配置文件配置<code>Druid</code>连接池信息</li><li>3）配置<code>JdbcTemplate</code>对象，注入<code>dataSource</code></li><li>4）创建 Service 和 Dao 类，在 Dao 类中注入<code>JdbcTemplate</code>对象</li></ul><p><strong>详细操作</strong></p><ul><li>1）引入相关jar包（或依赖） <ul><li><code>druid</code></li><li><code>mysql-connector-java</code></li><li><code>spring-jdbc</code></li><li><code>spring-orm</code></li><li><code>spring-tx</code></li></ul></li></ul>',7),z={href:"https://s2.loli.net/2022/03/06/gs6N9lbZckfdD4t.png",target:"_blank",rel:"noopener noreferrer"},N=n("img",{src:r,alt:"image-20220306203931377"},null,-1),X=t(`<ul><li>2）Spring 配置文件配置<code>Druid</code>连接池信息</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.driverClassName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.username}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>沿用之前章节的<code>Jdbc.properties</code>配置信息，但稍作修改</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">mysql.driverClassName</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">mysql.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql:///book_db</span>
<span class="token key attr-name">mysql.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">mysql.password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>3）配置<code>JdbcTemplate</code>对象，注入<code>dataSource</code></li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--配置JdbcTemplate--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--属性注入dataSource--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为何使用属性注入？</strong></p><p><code>JdbcTemplate</code>虽然含有<code>DataSource</code>的有参构造，但其调用了<code>setDataSource()</code>方法</p>`,8),Y={href:"https://s2.loli.net/2022/03/06/8e5aPG6Sx3YlZty.png",target:"_blank",rel:"noopener noreferrer"},V=n("img",{src:k,alt:"image-20220306213548608"},null,-1),G=n("p",null,"这个方法是在其父类中定义了的",-1),K={href:"https://s2.loli.net/2022/03/06/n4qpwel6KRakdAm.png",target:"_blank",rel:"noopener noreferrer"},Q=n("img",{src:d,alt:"image-20220306213626024"},null,-1),H=t(`<ul><li>4）创建 Service 和 Dao 类，在 Dao 类中注入<code>JdbcTemplate</code>对象</li></ul><p>Dao 类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service 类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>别忘了开启注解扫描</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--开启注解扫描--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vectorx.spring5.s15_jdbctemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>配置文件整体结构</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--开启注解扫描--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vectorx.spring5.s15_jdbctemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--配置dataSource--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.driverClassName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.username}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--配置JdbcTemplate--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--属性注入dataSource--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3、添加操作" tabindex="-1"><a class="header-anchor" href="#_1-3、添加操作" aria-hidden="true">#</a> 1.3、添加操作</h3><p><strong>步骤预览</strong></p><ul><li>1）创建数据库中<code>t_book</code>表对应的实体对象</li><li>2）编写 Service 和 Dao 代码，增加<em>添加图书</em>的功能逻辑</li><li>3）代码测试</li></ul><p><strong>详细操作</strong></p><ul><li>1）创建数据库中<code>t_book</code>表对应的实体对象</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bname<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bstatus<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBid</span><span class="token punctuation">(</span><span class="token class-name">String</span> bid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bid <span class="token operator">=</span> bid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBname</span><span class="token punctuation">(</span><span class="token class-name">String</span> bname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bname <span class="token operator">=</span> bname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBstatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bstatus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBstatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> bstatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bstatus <span class="token operator">=</span> bstatus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>2）编写 Service 和 Dao 代码，增加<em>添加图书</em>的功能逻辑</li></ul><p>Service 类：添加<code>addBook()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookDao</span> bookDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">addBook</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Dao 类：通过操作<code>JdbcTemplate</code>对象的<code>update()</code>方法可实现插入，其中两个参数分别是</p><ul><li>第一个参数<code>sql</code>：编写插入数据对应的<code>sql</code>语句，可使用通配符<code>?</code>做占位符</li><li>第二个参数<code>args</code>：可变参数列表，设置占位符对应的参数值</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//操作JdbcTemplate对象，使用update方法进行添加操作</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_book(bid,bname,bstatus) values(?,?,?)&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token punctuation">{</span>book<span class="token punctuation">.</span><span class="token function">getBid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token function">getBname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token function">getBstatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>3）代码测试</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;bean13.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BookService</span> bookService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;bookService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">BookService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//模拟新增图书</span>
<span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
book<span class="token punctuation">.</span><span class="token function">setBid</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
book<span class="token punctuation">.</span><span class="token function">setBname</span><span class="token punctuation">(</span><span class="token string">&quot;Spring JdbcTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
book<span class="token punctuation">.</span><span class="token function">setBstatus</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> result <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">addBook</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Loading class \`com.mysql.jdbc.Driver&#39;. This is deprecated. The new driver class is \`com.mysql.cj.jdbc.Driver&#39;. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.
三月 06, 2022 10:25:49 下午 com.alibaba.druid.pool.DruidDataSource info
信息: {dataSource-1} inited
1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刷新数据库中<code>t_book</code>表数据，核验是否插入成功</p>`,26),Z={href:"https://s2.loli.net/2022/03/06/lr6szWvfcaO1bDm.png",target:"_blank",rel:"noopener noreferrer"},W=n("img",{src:m,alt:"image-20220306222833478"},null,-1),$=t(`<p>可以看到，表中成功新增了一条数据</p><h3 id="_1-4、修改和删除" tabindex="-1"><a class="header-anchor" href="#_1-4、修改和删除" aria-hidden="true">#</a> 1.4、修改和删除</h3><p>修改、删除操作和添加操作代码逻辑基本一致</p><p>BookService 类：添加<code>updateBook()</code>和<code>deleteBook()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 修改</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateBook</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//删除</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteBook</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BookDao 类：添加<code>update()</code>和<code>delete()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 修改</span>
<span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 删除</span>
<span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BookDaoImpl 类：实现<code>update()</code>和<code>delete()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 修改</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Book</span> book<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update t_book set bname=?,bstatus=? where bid=?&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token punctuation">{</span>book<span class="token punctuation">.</span><span class="token function">getBname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token function">getBstatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token function">getBid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 删除</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;delete from t_book where bid=? &quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试修改</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//修改图书信息</span>
<span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
book<span class="token punctuation">.</span><span class="token function">setBid</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
book<span class="token punctuation">.</span><span class="token function">setBname</span><span class="token punctuation">(</span><span class="token string">&quot;JdbcTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
book<span class="token punctuation">.</span><span class="token function">setBstatus</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> result2 <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">updateBook</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p>`,12),nn={href:"https://s2.loli.net/2022/03/07/TCLlJNIZ3RBovUX.png",target:"_blank",rel:"noopener noreferrer"},sn=n("img",{src:v,alt:"image-20220307210646847"},null,-1),an=t(`<p>测试删除</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//删除图书</span>
<span class="token keyword">int</span> result3 <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">deleteBook</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p>`,3),tn={href:"https://s2.loli.net/2022/03/07/JPM6ABoLmV7ZeWj.png",target:"_blank",rel:"noopener noreferrer"},en=n("img",{src:b,alt:"image-20220307211156970"},null,-1),pn=n("h3",{id:"_1-5、查询操作",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-5、查询操作","aria-hidden":"true"},"#"),e(" 1.5、查询操作")],-1),on=n("p",null,"这里演示三种查询操作：",-1),cn=n("ul",null,[n("li",null,"1）查询返回某个值"),n("li",null,"2）查询返回对象"),n("li",null,"3）查询返回集合")],-1),ln=n("p",null,[e("为了演示效果，需要先在数据库的"),n("code",null,"t_book"),e("表中添加两条数据")],-1),un={href:"https://s2.loli.net/2022/03/07/oCSa3qAMGYbyfRN.png",target:"_blank",rel:"noopener noreferrer"},rn=n("img",{src:g,alt:"image-20220307214231166"},null,-1),kn=t(`<p>接着我们先将代码完成，最后再作进一步的分析说明</p><p><strong>代码实现</strong></p><p>BookService 类：添加<code>findCount()</code>、<code>findById()</code>和<code>findAll()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 查找返回一个值</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">findCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 查找返回对象</span>
<span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 查找返回集合</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> bookDao<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BookDao 类：添加<code>selectCount()</code>、<code>selectById()</code>和<code>selectAll()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 查找返回一个值</span>
<span class="token keyword">int</span> <span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查找返回对象</span>
<span class="token class-name">Book</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查找返回集合</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BookDaoImpl 类：实现<code>selectCount()</code>、<code>selectById()</code>和<code>selectAll()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 查找返回一个值</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select count(0) from t_book&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 查找返回对象</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from t_book where bid=?&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 查找返回集合</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from t_book where 1=1&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">int</span> count <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">findCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Book</span> book <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> bookList <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2
Book{bid=&#39;1&#39;, bname=&#39;Spring&#39;, bstatus=&#39;add&#39;}
[Book{bid=&#39;1&#39;, bname=&#39;Spring&#39;, bstatus=&#39;add&#39;}, Book{bid=&#39;2&#39;, bname=&#39;SpringMVC&#39;, bstatus=&#39;add&#39;}]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>代码分析</strong></p><p>上述代码逻辑中使用到了<code>queryForObject()</code>和<code>query()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分别对应<code>JdbcTemplate</code>中的三个方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> rowMapper<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> rowMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，有两个参数值得关注，一个是<code>Class&lt;T&gt; requiredType</code>，另一个是<code>RowMapper&lt;T&gt; rowMapper</code></p><ul><li><code>Class&lt;T&gt; requiredType</code>：返回值的<code>Class</code>类型</li><li><code>RowMapper&lt;T&gt; rowMapper</code>：是一个接口，返回不同类型数据，可以使用其实现类进行数据的封装。其实现类有很多，因为我们需要返回一个数据库实体对象，所以可以选择使用<code>BeanPropertyRowMapper</code></li></ul>`,19),dn={href:"https://s2.loli.net/2022/03/07/YHjmQBSNXzDdPRL.png",target:"_blank",rel:"noopener noreferrer"},mn=n("img",{src:q,alt:"image-20220307215452377"},null,-1),vn=t(`<p>另外，<code>queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, Object... args)</code>和<code>query(String sql, RowMapper&lt;T&gt; rowMapper)</code>的</p><p>区别在于</p><ul><li><code>queryForObject</code>返回一个对象</li><li><code>query</code>返回一个集合</li></ul><h3 id="_1-6、批量操作" tabindex="-1"><a class="header-anchor" href="#_1-6、批量操作" aria-hidden="true">#</a> 1.6、批量操作</h3><p><code>JdbcTemplate</code>中提供了<code>batchUpdate()</code>可供我们进行批量操作，如：批量添加、批量修改、批量删除等，代码实现上大同小异，我们对代码进行快速实现</p><p><strong>代码实现</strong></p><p>BookService 类：添加<code>batchAddBook()</code>、<code>batchUpdateBook()</code>和<code>batchDelBook()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 批量添加</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchAddBook</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bookDao<span class="token punctuation">.</span><span class="token function">batchAdd</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 批量修改</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchUpdateBook</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bookDao<span class="token punctuation">.</span><span class="token function">batchUpdate</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 批量删除</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchDelBook</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bookDao<span class="token punctuation">.</span><span class="token function">batchDel</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BookDao 类：添加<code>batchAdd()</code>、<code>batchUpdate()</code>和<code>batchDel()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 批量添加</span>
<span class="token keyword">void</span> <span class="token function">batchAdd</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 批量修改</span>
<span class="token keyword">void</span> <span class="token function">batchUpdate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 批量删除</span>
<span class="token keyword">void</span> <span class="token function">batchDel</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BookDaoImpl 类：实现<code>batchAdd()</code>、<code>batchUpdate()</code>和<code>batchDel()</code>方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 批量添加</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchAdd</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_book(bid,bname,bstatus) values(?,?,?)&quot;</span><span class="token punctuation">;</span>
    <span class="token function">extractBatch</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 批量修改</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchUpdate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update t_book set bname=?,bstatus=? where bid=?&quot;</span><span class="token punctuation">;</span>
    <span class="token function">extractBatch</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 批量删除</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchDel</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;delete from t_book where bid=? &quot;</span><span class="token punctuation">;</span>
    <span class="token function">extractBatch</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">extractBatch</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ints <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">batchUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ints<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>代码测试</strong></p><p>测试批量添加</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 批量添加</span>
<span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;batchAdd&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;batchAdd&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C#&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;batchAdd&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book1<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book2<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book3<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookService<span class="token punctuation">.</span><span class="token function">batchAddBook</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p>`,16),bn={href:"https://s2.loli.net/2022/03/07/SgzfJ29Ph4VbpKl.png",target:"_blank",rel:"noopener noreferrer"},gn=n("img",{src:h,alt:"image-20220307223022287"},null,-1),qn=t(`<p>测试批量修改</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 批量修改</span>
<span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Java++&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;batchUpdate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Python++&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;batchUpdate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;C#++&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;batchUpdate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book1<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book2<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book3<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookService<span class="token punctuation">.</span><span class="token function">batchUpdateBook</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p>`,3),hn={href:"https://s2.loli.net/2022/03/07/Z8cquiezmorPxXY.png",target:"_blank",rel:"noopener noreferrer"},wn=n("img",{src:w,alt:"image-20220307223232655"},null,-1),fn=t(`<p>测试批量删除</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 批量删除</span>
<span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> bookList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> book2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book1<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book2<span class="token punctuation">)</span><span class="token punctuation">;</span>
bookService<span class="token punctuation">.</span><span class="token function">batchDelBook</span><span class="token punctuation">(</span>bookList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p>`,3),yn={href:"https://s2.loli.net/2022/03/07/Vvtmo9BXnd1IfFG.png",target:"_blank",rel:"noopener noreferrer"},xn=n("img",{src:f,alt:"image-20220307223407753"},null,-1),_n=n("p",null,"可以看出，上述测试都完全符合我们的预期",-1),Sn={href:"https://s2.loli.net/2022/03/07/9Fu65poPBDlmryn.gif",target:"_blank",rel:"noopener noreferrer"},jn=n("img",{src:y,alt:"img"},null,-1),Tn=t('<h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h3><p>简单总结下<code>JdbcTemplate</code>操作数据库的各个方法</p><ul><li><p>添加、修改、删除操作：<code>update()</code>方法</p></li><li><p>查询操作：<code>queryForObject()</code>和<code>query()</code></p><p>方法，关注两个参数：</p><ul><li><code>Class&lt;T&gt; requiredType</code>：返回值的<code>Class</code>类型</li><li><code>RowMapper&lt;T&gt; rowMapper</code>：接口，具体实现类<code>BeanPropertyRowMapper</code>，封装对象实体</li></ul></li><li><p>批量操作：<code>batchUpdate()</code>方法</p></li></ul><h2 id="_2、事务" tabindex="-1"><a class="header-anchor" href="#_2、事务" aria-hidden="true">#</a> 2、事务</h2><h3 id="_2-1、事务概念" tabindex="-1"><a class="header-anchor" href="#_2-1、事务概念" aria-hidden="true">#</a> 2.1、事务概念</h3><ul><li>1）事务是数据库操作的最基本单元，是逻辑上的一组操作。这一组操作，要么都成功，要么都失败（只要有一个操作失败，所有操作都失败）</li><li>2）典型场景：银行转账。Lucy 转账 100 元给 Mary，Lucy 少 100，Mary 多 100。转账过程中若出现任何问题，双方都不会多钱或少钱，转账就不会成功</li></ul><h3 id="_2-2、事务四个特性-acid" tabindex="-1"><a class="header-anchor" href="#_2-2、事务四个特性-acid" aria-hidden="true">#</a> 2.2、事务四个特性（ACID）</h3><ul><li>原子性（<strong>A</strong>tomicity）：一个事务中的所有操作，要么都成功，要么都失败，整个过程不可分割</li><li>一致性（<strong>C</strong>onsistency）：事务操作之前和操作之后，总量保持不变</li><li>隔离性（<strong>I</strong>solation）：多事务操作时，相互之间不会产生影响</li><li>持久性（<strong>D</strong>urability）：事务最终提交后，数据库表中数据才会真正发生变化</li></ul><h3 id="_2-3、搭建事务操作环境" tabindex="-1"><a class="header-anchor" href="#_2-3、搭建事务操作环境" aria-hidden="true">#</a> 2.3、搭建事务操作环境</h3><p>我们知道 JavaEE 中的三层架构分为：表示层（<code>web</code>层）、业务逻辑层（<code>service</code>层）、数据访问层（<code>dao</code>层）</p><ul><li><code>web</code>层：与客户端进行交互</li><li><code>service</code>层：处理业务逻辑</li><li><code>dao</code>层：与数据库进行交互</li></ul><p>因此，我们搭建操作环境也按照典型的三层架构来实现，不过目前现阶段我们只关注<code>Service</code>和<code>Dao</code>两层</p>',12),Rn={href:"https://s2.loli.net/2022/03/08/hsX2AgEaPbSK8dj.png",target:"_blank",rel:"noopener noreferrer"},Dn=n("img",{src:x,alt:"image-20220308195154702"},null,-1),An=t(`<p>我们以银行转账为例，因为整个转账操作包括两个操作：出账的操作和入账的操作</p><p><strong>过程概览</strong></p><ul><li>1）创建数据库表结构，添加几条记录</li><li>2）创建<code>Service</code>和<code>Dao</code>类，完成对象创建和关系注入</li><li>3）<code>Dao</code>中创建两个方法：出账的方法、入账的方法；<code>Service</code>中创建转账的方法</li></ul><p><strong>过程详解</strong></p><p>**1）**创建数据库表结构，添加几条记录</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 建表语句</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> t_account
<span class="token punctuation">(</span>
    id       <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    amount   <span class="token keyword">int</span>         <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> transfer_record_pk
        <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 添加语句</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book_db<span class="token punctuation">.</span>t_account <span class="token punctuation">(</span>id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Lucy&#39;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book_db<span class="token punctuation">.</span>t_account <span class="token punctuation">(</span>id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Mary&#39;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加完成效果</p>`,7),Bn={href:"https://s2.loli.net/2022/03/08/rAOuq8Ml7kaE3ZJ.png",target:"_blank",rel:"noopener noreferrer"},En=n("img",{src:_,alt:"image-20220308201554346"},null,-1),In=t(`<p>**2）**创建<code>Service</code>和<code>Dao</code>类，完成对象创建和关系注入Service<code>中注入</code>Dao<code>，</code>Dao<code>中注入</code>JdbcTemplate<code>，</code>JdbcTemplate<code>中注入\`\`DataSource</code></p><p><code>Service</code>和<code>Dao</code>类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransferRecordDao</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransferRecordDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring 配置文件</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--开启注解扫描--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vectorx.spring5.s16_transaction<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--配置dataSource--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.driverClassName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.username}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--配置JdbcTemplate--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--属性注入dataSource--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3）</strong><code>Dao</code>中创建两个方法：出账的方法、入账的方法；<code>Service</code>中创建转账的方法</p><ul><li><code>Dao</code>负责数据库操作，所以需要创建两个方法：出账的方法、入账的方法</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransferRecordDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">transferOut</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">transferIn</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransferRecordDao</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferOut</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update t_account set amount=amount-? where username=?&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token punctuation">{</span>amount<span class="token punctuation">,</span> username<span class="token punctuation">}</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferIn</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update t_account set amount=amount+? where username=?&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token punctuation">{</span>amount<span class="token punctuation">,</span> username<span class="token punctuation">}</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Service</code>负责业务操作，所以需要创建一个方法，来调用<code>Dao</code>中两个方法</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> fromUser<span class="token punctuation">,</span> <span class="token class-name">String</span> toUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferOut</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> fromUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferIn</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;bean14.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TransferRecordService</span> transferRecordService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;transferRecordService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">TransferRecordService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
transferRecordService<span class="token punctuation">.</span><span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p>`,13),Ln={href:"https://s2.loli.net/2022/03/08/djR3QoVOblLS7c5.png",target:"_blank",rel:"noopener noreferrer"},On=n("img",{src:S,alt:"image-20220308205044804"},null,-1),Mn=t(`<p>可以发现，转账如期完成了。但真的没有一点问题么？</p><h3 id="_2-4、引入事务场景" tabindex="-1"><a class="header-anchor" href="#_2-4、引入事务场景" aria-hidden="true">#</a> 2.4、引入事务场景</h3><p>我们模拟下在转账中途发生网络异常，修改<code>TransferRecordService</code>中转账方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> fromUser<span class="token punctuation">,</span> <span class="token class-name">String</span> toUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transferRecordDao<span class="token punctuation">.</span><span class="token function">transferOut</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> fromUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//模拟网络异常而导致操作中断</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    transferRecordDao<span class="token punctuation">.</span><span class="token function">transferIn</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了更清晰直观地看到数据的变化，我们还原数据表数据到最初状态</p>`,5),Cn={href:"https://s2.loli.net/2022/03/08/zVF7b5RdXPyJZ2l.png",target:"_blank",rel:"noopener noreferrer"},Pn=n("img",{src:j,alt:"image-20220308205938035"},null,-1),Un=t(`<p>按照期望，转账应该失败，即双方账户不应该有任何变化。事实真的能够如我们所料么？</p><p>我们执行测试方法，如期抛出异常</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ArithmeticException</span><span class="token operator">:</span> <span class="token operator">/</span> by zero
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>vectorx<span class="token punctuation">.</span>spring5<span class="token punctuation">.</span>s16_transaction<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>TransferRecordService</span><span class="token punctuation">.</span><span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token class-name">TransferRecordService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>vectorx<span class="token punctuation">.</span>spring5<span class="token punctuation">.</span>s16_transaction<span class="token punctuation">.</span></span>TestTransfer</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">TestTransfer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那数据表是否也如期变化呢？</p>`,4),Jn={href:"https://s2.loli.net/2022/03/08/uogKOIvxQhl3d9L.png",target:"_blank",rel:"noopener noreferrer"},Fn=n("img",{src:T,alt:"image-20220308210254891"},null,-1),zn=t(`<p>我们发现，<code>Lucy</code>虽然成功转出了 100 元，但<code>Mary</code>没有成功到账 100 元。从现实的角度来说，这个问题很严重！！！</p><p>从事务的角度来说，这个转账操作没有遵循事务的原子性、一致性，即没有做到“要么都成功，要么都失败”，也没有做到“操作前后的总量不变”</p><p>综上所述，我们需要引入事务</p><h3 id="_2-5、事务基本操作" tabindex="-1"><a class="header-anchor" href="#_2-5、事务基本操作" aria-hidden="true">#</a> 2.5、事务基本操作</h3><p>事务的基本操作过程如下</p><ul><li>Step1、开启一个事务</li><li>Step2、进行业务逻辑实现</li><li>Step3、没有异常，则提交事务</li><li>Step4、发生异常，则回滚事务</li></ul><p>事务的一般实现如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Step1、开启一个事务</span>
    <span class="token comment">// Step2、进行业务逻辑实现</span>
    transferRecordDao<span class="token punctuation">.</span><span class="token function">transferOut</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> fromUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//模拟网络异常而导致操作中断</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    transferRecordDao<span class="token punctuation">.</span><span class="token function">transferIn</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Step3、没有异常，则提交事务</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Step4、发生异常，则回滚事务</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不过，在 Spring 框架中提供了更方便的方式实现事务。“欲知后事如何，且听下回分解”</p><h3 id="小结-1" tabindex="-1"><a class="header-anchor" href="#小结-1" aria-hidden="true">#</a> 小结</h3><p>本小结主要内容关键点</p><ul><li>事务的基本概念：数据库操作的基本单元，逻辑上的一组操作，要么都成功，要么都失败</li><li>事务的四个基本特性：ACID，即原子性、一致性、隔离性和持久性</li></ul><h2 id="_3、声明式事务" tabindex="-1"><a class="header-anchor" href="#_3、声明式事务" aria-hidden="true">#</a> 3、声明式事务</h2><h3 id="_3-1、spring事务管理" tabindex="-1"><a class="header-anchor" href="#_3-1、spring事务管理" aria-hidden="true">#</a> 3.1、Spring事务管理</h3><p>事务一般添加到三层结构中的<code>Service</code>层（业务逻辑层）</p><p>在 Spring 中进行事务管理操作有两种方式：编程式事务管理和声明式事务管理</p><ul><li>编程式事务管理（不推荐）：上述事务的一般实现就是典型的编程式事务管理实现。但这种方式虽然并不好，但仍然需要我们有一定的了解，知道有这么一个过程即可。一般不推荐使用这种方式，主要原因如下 <ul><li>1）实现不方便</li><li>2）造成代码臃肿</li><li>3）维护起来麻烦</li></ul></li><li>声明式事务管理（推荐使用）：底层原理就是AOP，就是在不改变原代码基础上，扩展代码功能。有两种实现方式 <ul><li>基于注解方式（推荐方式）</li><li>基于XML配置文件方式</li></ul></li></ul><h3 id="_3-2、spring事务管理api" tabindex="-1"><a class="header-anchor" href="#_3-2、spring事务管理api" aria-hidden="true">#</a> 3.2、Spring事务管理API</h3><p>提供了一个接口，代表事务管理器，针对不同框架存在不同实现类</p>`,19),Nn={href:"https://s2.loli.net/2022/03/08/IDQY1ue4BTSLwtW.png",target:"_blank",rel:"noopener noreferrer"},Xn=n("img",{src:R,alt:"image-20220308214543681"},null,-1),Yn=t(`<p>主要掌握</p><ul><li><code>PlatformTransactionManager</code>接口：即事务管理器，有多个不同的抽象类和具体实现类，可满足不同的框架</li><li><code>DataSourceTrasactionManager</code>实现类：<code>JdbcTemplate</code>和<code>MyBatis</code>框架使用到它</li><li><code>HibernateTransactionManager</code>实现类：<code>Hibernate</code>框架使用到它</li></ul><h3 id="_3-3、声明式事务-注解方式" tabindex="-1"><a class="header-anchor" href="#_3-3、声明式事务-注解方式" aria-hidden="true">#</a> 3.3、声明式事务（注解方式）</h3><ul><li>1）在 Spring 配置文件中配置事务管理器：配置<code>DataSourceTransactionManager</code>对象创建</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--配置事务管理器--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>2）在 Spring 配置文件中开启事务：引入<code>xmlns:tx</code>的名称空间，并配置<code>&lt;tx:annotation-driven&gt;</code>标签以开启事务注解</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--其他配置信息略--&gt;</span>
    <span class="token comment">&lt;!--开启事务注解--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>3）在<code>Service</code>（或<code>Service</code>的方法）上添加事务注解<code>@Transactional</code></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先还原数据表信息至初始状态</p>`,10),Vn={href:"https://s2.loli.net/2022/03/08/lbWkLeNT67x5yKD.png",target:"_blank",rel:"noopener noreferrer"},Gn=n("img",{src:p,alt:"image-20220308221649689"},null,-1),Kn=n("p",null,"测试代码后刷新数据表",-1),Qn={href:"https://s2.loli.net/2022/03/08/lbWkLeNT67x5yKD.png",target:"_blank",rel:"noopener noreferrer"},Hn=n("img",{src:p,alt:"image-20220308221649689"},null,-1),Zn=n("p",null,"这一次数据没有发生变化，说明事务回滚了，符合我们预期",-1),Wn=n("h3",{id:"_3-4、事务参数",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3-4、事务参数","aria-hidden":"true"},"#"),e(" 3.4、事务参数")],-1),$n=n("p",null,[e("在"),n("code",null,"Service"),e("类上面添加注解"),n("code",null,"@Transactional"),e("，在这个注解里面可以配置事务相关参数")],-1),ns={href:"https://s2.loli.net/2022/03/09/42ncr6mtsbLGFvg.png",target:"_blank",rel:"noopener noreferrer"},ss=n("img",{src:D,alt:"image-20220309201640259"},null,-1),as=t(`<p>主要介绍参数有</p><ul><li><code>propagation</code>：事务传播行为</li><li><code>isolation</code>：事务隔离级别</li><li><code>timeout</code>：超时时间</li><li><code>readOnly</code>：是否只读</li><li><code>rollbackFor</code>：回滚</li><li><code>noRollbackFor</code>：不回滚</li></ul><h3 id="_3-5、传播行为" tabindex="-1"><a class="header-anchor" href="#_3-5、传播行为" aria-hidden="true">#</a> 3.5、传播行为</h3><ul><li><strong>事务传播行为</strong>：多事务方法直接进行调用，这个过程中事务是如何进行管理的</li><li><strong>事务方法</strong>：让数据表数据发生变化的操作</li></ul><p>事务的传播行为可以有传播属性指定。Spring 框架中定义了 7 种类传播行为：</p><table><thead><tr><th>传播属性</th><th>描述</th></tr></thead><tbody><tr><td><code>REQUIRED</code></td><td>如果有事务在运行，当前方法就在此事务内运行；否则，就启动一个新的事务，并在自己的事务内运行</td></tr><tr><td><code>REQUIRED_NEW</code></td><td>当前方法必须启动新事务，并在它自己的事务内运行；如果有事务正在运行，应该将它挂起</td></tr><tr><td><code>SUPPORTS</code></td><td>如果有事务在运行，当前方法就在此事务内运行；否则，它可以不运行在事务中</td></tr><tr><td><code>NOT_SOPPORTED</code></td><td>当前方法不应该运行在事务内部，如果有运行的事务，就将它挂起</td></tr><tr><td><code>MANDATORY</code></td><td>当前方法必须运行在事务内部，如果没有正在运行的事务，就抛出异常</td></tr><tr><td><code>NEVER</code></td><td>当前方法不应该运行在事务中，如果有运行的事务，就抛出异常</td></tr><tr><td><code>NESTED</code></td><td>如果有事务在运行，当前方法就应该在此事务的嵌套事务内运行；否则，就启动一个新的事务，并在它自己的事务内运行</td></tr></tbody></table><p>举个例子：定义两个方法<code>add()</code>和<code>update()</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 调用update方法</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// do something</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>则按照不同的传播属性，可以有以下解释</p><ul><li><code>REQUIRED</code><ul><li>如果<code>add()</code>方法本身有事务，调用<code>update()</code>方法之后，<code>update()</code>使用当前<code>add()</code>方法里面事务；</li><li>如果<code>add()</code>方法本身没有事务，调用<code>update()</code>方法之后，创建新的事务</li></ul></li><li><code>REQUIRED_NEW</code><ul><li>使用<code>add()</code>方法调用<code>update()</code>方法，无论<code>add()</code>是否有事务，都创建新的事务</li></ul></li></ul><p><strong>代码实现</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>等价于</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>即默认不写，其事务传播行为就是使用的<code>REQUIRED</code></p><h3 id="_3-6、隔离级别" tabindex="-1"><a class="header-anchor" href="#_3-6、隔离级别" aria-hidden="true">#</a> 3.6、隔离级别</h3><p>在事务的四个特性中，隔离性（<code>isolation</code>）指的是多事务之间互不影响。不考虑隔离性，在并发时会产生一系列问题</p><p>有三个典型的“读”的问题：脏读、不可重复读、虚（幻）读</p><ul><li><strong>脏读</strong>：一个未提交事务读取到了另一个未提交事务修改的数据</li></ul>`,19),ts={href:"https://s2.loli.net/2022/03/09/XNTP5Kwz3hGW1vp.png",target:"_blank",rel:"noopener noreferrer"},es=n("img",{src:A,alt:"image-20220309210526701"},null,-1),ps=n("ul",null,[n("li",null,[n("strong",null,"不可重复读"),e("：一个未提交事务读取到了另一个已提交事务修改的数据（不能算问题，只是算现象）")])],-1),os={href:"https://s2.loli.net/2022/03/09/MbpwgBudcGKx7rJ.png",target:"_blank",rel:"noopener noreferrer"},cs=n("img",{src:B,alt:"image-20220309210823168"},null,-1),ls=t(`<ul><li><strong>虚（幻）读</strong>：一个未提交事务读取到了另一个已提交事务添加的数据</li></ul><p>通过设置隔离级别，可以解决上述“读”的问题</p><table><thead><tr><th>事务隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td><code>READ UNCOMMITTED</code>（读未提交）</td><td>√</td><td>√</td><td>√</td></tr><tr><td><code>READ COMMITTED</code>（读已提交）</td><td>×</td><td>√</td><td>√</td></tr><tr><td><code>REPEATABLE READ</code>（可重复读）</td><td>×</td><td>×</td><td>√</td></tr><tr><td><code>SERIALIZABLE</code>（串行化）</td><td>×</td><td>×</td><td>×</td></tr></tbody></table><p><strong>代码实现</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">REPEATABLE_READ</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>小课堂：MySQL 中默认事务隔离级别为<code>REPEATABLE READ</code>（可重复读）</p><h3 id="_3-7、其他参数" tabindex="-1"><a class="header-anchor" href="#_3-7、其他参数" aria-hidden="true">#</a> 3.7、其他参数</h3><ul><li><code>timeout</code>：设置事务超时时间。事务需要在一定的时间内进行提交，若设定时间内事务未完成提交，则对事务进行回滚。默认值为<code>-1</code>，设置时间以秒为单位</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> fromUser<span class="token punctuation">,</span> <span class="token class-name">String</span> toUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferOut</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> fromUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//模拟处理超时</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferIn</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置超时时间后，执行测试代码，则日志信息会抛出<code>TransactionTimedOutException</code>即<strong>事务超时异常</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Exception in thread &quot;main&quot; org.springframework.transaction.TransactionTimedOutException: Transaction timed out: deadline was Wed Mar 09 21:30:33 CST 2022
    at org.springframework.transaction.support.ResourceHolderSupport.checkTransactionTimeout(ResourceHolderSupport.java:155)
    at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInMillis(ResourceHolderSupport.java:144)
    at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInSeconds(ResourceHolderSupport.java:128)
    at org.springframework.jdbc.datasource.DataSourceUtils.applyTimeout(DataSourceUtils.java:341)
...	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>readOnly</code>：是否只读。 <ul><li>默认值为<code>false</code>，表示读写操作都允许，可以进行增、删、改、查等操作；</li><li>可设置为<code>true</code>，表示只允许读操作，即只能进行查询操作</li></ul></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置只读后，执行测试代码，则日志信息会抛出<code>TransientDataAccessResourceException</code>即<strong>瞬态数据访问资源异常</strong>，同时还会抛出<code>SQLException</code>，并指出“连接是只读的，查询导致数据修改是不允许的”</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Exception in thread &quot;main&quot; org.springframework.dao.TransientDataAccessResourceException: PreparedStatementCallback; SQL [update t_account set amount=amount-? where username=?]; Connection is read-only. Queries leading to data modification are not allowed; nested exception is java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed
	...
Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed
    ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>rollbackFor</code>：设置出现哪些异常才进行回滚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> fromUser<span class="token punctuation">,</span> <span class="token class-name">String</span> toUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferOut</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> fromUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//模拟网络异常而导致操作中断</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferIn</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码表明，只有在抛出的异常为<code>ArithmeticException</code>时，才会进行事务的回滚操作</p><p>此时运行测试代码，后台会抛出<code>ArithmeticException</code>异常，因此会进行回滚，转账过程不会成功</p><p>此时数据库中的数据，就不会有任何变化</p>`,20),is={href:"https://s2.loli.net/2022/03/09/z8NyqRbflHhaPCK.png",target:"_blank",rel:"noopener noreferrer"},us=n("img",{src:E,alt:"image-20220308221649689"},null,-1),rs=t(`<ul><li><code>noRollbackFor</code>：设置出现哪些异常不进行回滚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>noRollbackFor <span class="token operator">=</span> <span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">,</span> <span class="token class-name">String</span> fromUser<span class="token punctuation">,</span> <span class="token class-name">String</span> toUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferOut</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> fromUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//模拟网络异常而导致操作中断</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        transferRecordDao<span class="token punctuation">.</span><span class="token function">transferIn</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为设置了<code>noRollbackFor = ArithmeticException.class</code>，即表示抛出<code>ArithmeticException</code>异常时不会进行回滚</p><p>此时运行测试代码，后台会抛出<code>ArithmeticException</code>异常，但不会进行回滚，转账事务中只有出账操作会成功</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Exception in thread &quot;main&quot; java.lang.ArithmeticException: / by zero
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时数据库中的数据，就会是下面情况（显然，这并不是我们想要的）</p>`,6),ks={href:"https://s2.loli.net/2022/03/09/z91mdZWXBLIuDKT.png",target:"_blank",rel:"noopener noreferrer"},ds=n("img",{src:I,alt:"image-20220309215806414"},null,-1),ms=t(`<h3 id="_3-8、声明式事务-xml方式" tabindex="-1"><a class="header-anchor" href="#_3-8、声明式事务-xml方式" aria-hidden="true">#</a> 3.8、声明式事务（XML方式）</h3><ul><li>Step1、配置事务管理器</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--配置事务管理器--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Step2、配置事务通知</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--1、配置事务通知--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transferAccounts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REPEATABLE_READ<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
                   <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rollback-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.ArithmeticException<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Step3、配置切入点和切面</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--2、配置切入点和切面--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span>
                  <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* com.vectorx.spring5.s17_transaction_xml.service.TransferRecordService.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>advisor</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring 配置文件整体内容</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--配置dataSource--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.driverClassName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.url}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.username}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${mysql.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--配置JdbcTemplate--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--属性注入dataSource--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--配置事务管理器--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--配置Dao创建和属性注入--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transferRecordDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vectorx.spring5.s17_transaction_xml.dao.TransferRecordDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbcTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--配置Service创建和属性注入--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transferRecordService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vectorx.spring5.s17_transaction_xml.service.TransferRecordService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transferRecordDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transferRecordDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--1、配置事务通知--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transferAccounts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REPEATABLE_READ<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
                       <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rollback-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.ArithmeticException<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--2、配置切入点和切面--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span>
                      <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* com.vectorx.spring5.s17_transaction_xml.service.TransferRecordService.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>advisor</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对<code>Service</code>和<code>Dao</code>类去除注解，并对代码稍作修改</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransferRecordDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferRecordService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTransferRecordDao</span><span class="token punctuation">(</span><span class="token class-name">TransferRecordDao</span> transferRecordDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transferRecordDao <span class="token operator">=</span> transferRecordDao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>运行测试代码</strong></p><p>后台结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Exception in thread &quot;main&quot; java.lang.ArithmeticException: / by zero
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>数据库结果</p>`,15),vs={href:"https://s2.loli.net/2022/03/09/vh6obZc7uBwU4pO.png",target:"_blank",rel:"noopener noreferrer"},bs=n("img",{src:L,alt:"image-20220308221649689"},null,-1),gs=t(`<h3 id="_3-9、完全注解开发" tabindex="-1"><a class="header-anchor" href="#_3-9、完全注解开发" aria-hidden="true">#</a> 3.9、完全注解开发</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 表示此类为配置类</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">// 自动扫描包</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.vectorx.spring5.s18_transaction_annotation&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 开启事务</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token comment">// 读取外部配置文件</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:jdbc.properties&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TxConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\${mysql.driverClassName}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> driverClassName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\${mysql.url}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\${mysql.username}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\${mysql.password}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">//配置dataSource</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DruidDataSource</span> <span class="token function">getDruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driverClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//配置JdbcTemplate</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//IOC容器会根据类型找到对应DataSource</span>
        <span class="token class-name">JdbcTemplate</span> jdbcTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//配置事务管理器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSourceTransactionManager</span> <span class="token function">getDataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DataSourceTransactionManager</span> transactionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transactionManager<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> transactionManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里我们对各个注解进行一一说明</p><ul><li><code>@Configuration</code>：表示此类为一个配置类，其作用等同于创建一个<code>bean.xml</code>，即</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>@ComponentScan</code>：自动扫描包，<code>basePackages</code>属性配置为需要扫描的包路径，等价于<code>&lt;context:component-scan&gt;</code>标签，即</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--开启注解扫描--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vectorx.spring5.s18_transaction_annotation<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>@EnableTransactionManagement</code>：开启事务管理，等价于<code>&lt;tx:annotation-driven&gt;</code>标签，即</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--开启事务注解--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>@PropertySource</code>：引入外部文件，<code>value</code>配置外部文件路径，等价于<code>&lt;context:property-placeholder&gt;</code>标签</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classpath:jdbc.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>@Value</code>：对普通类型的属性进行注入，同时其属性值可以使用<code>\${}</code>表达式对外部文件配置信息进行获取</li><li><code>@Bean</code>：配置对象创建，等价于<code>&lt;bean&gt;</code>标签。可以在被修饰的方法参数列表中传入受IOC容器管理的类型，IOC容器会自动根据类型找到对应对象并注入到此方法中。因此无论是配置JdbcTemplate还是配置事务管理器，都可以使用这种方式对外部Bean进行引用</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//配置JdbcTemplate</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">getJdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token comment">//配置事务管理器</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DataSourceTransactionManager</span> <span class="token function">getDataSourceTransactionManager</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试代码</strong></p><p>需要注意的是，之前创建的对象是<code>ClassPathXmlApplicationContext</code>，而现在是完全注解开发，所以需要创建的对象是<code>AnnotationConfigApplicationContext</code>，构造参数中传入配置类的<code>class</code>类型即可，其他代码与之前一致</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">TxConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TransferRecordService</span> transferRecordService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;transferRecordService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">TransferRecordService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
transferRecordService<span class="token punctuation">.</span><span class="token function">transferAccounts</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果</strong></p>`,17),qs={href:"https://s2.loli.net/2022/03/10/57BxlHsi6zJtPdZ.png",target:"_blank",rel:"noopener noreferrer"},hs=n("img",{src:O,alt:"image-20220310222153299"},null,-1),ws=t('<h3 id="小结-2" tabindex="-1"><a class="header-anchor" href="#小结-2" aria-hidden="true">#</a> 小结</h3><p>重点掌握</p><ul><li><p>Spring事务管理两种方式：编程式事务管理（不推荐）、声明式事务管理（推荐）</p></li><li><p>Spring事务管理API：<code>PlatformTransactionManager</code>、<code>DataSourceTrasactionManager</code>、<code>HibernateTransactionManager</code></p></li><li><p>声明式事务两种实现方式：注解方式和XML方式</p></li><li><p>事务相关参数有：</p><p>传播行为、隔离级别、超时时间、是否只读、（不）回滚</p><ul><li>传播行为：有7种传播属性，<code>REQUIRED</code>、<code>REQUIRED_NEW</code>、<code>SUPPORTS</code>、<code>NOT_SOPPORTED</code>、<code>MANDATORY</code>、<code>NEVER</code>、<code>NESTED</code></li><li>隔离级别：有3种典型“读”的问题，脏读、不可重复读、虚（幻）读，可设置4种隔离级别，<code>READ UNCOMMITTED</code>、<code>READ COMMITTED</code>、<code>REPEATABLE READ</code>、<code>SERIALIZABLE</code></li><li>其他参数：<code>timeout</code>、<code>readOnly</code>、<code>rollbackFor</code>、<code>noRollbackFor</code></li></ul></li><li><p>声明式事务（注解方式）：<code>@Transactional</code></p></li><li><p>声明式事务（XML方式）：配置事务管理器；配置事务通知<code>&lt;tx:advice&gt;</code>；配置切入点和切面</p></li><li><p>完全注解开发：<code>@EnableTransactionManagement</code>、<code>@Bean</code>、<code>AnnotationConfigApplicationContext</code></p></li></ul><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><ol><li><code>JdbcTemplate</code>的<code>CRUD</code>操作</li><li>事务<code>ACID</code>特性、Spring事务管理</li><li>声明式事务的注解方式和XML方式</li><li>事务相关属性：传播行为、隔离级别、其他参数</li></ol><p>下面思维导图经供参考</p>',6),fs={href:"https://s2.loli.net/2022/03/10/aYFXR3VmHZAeNhE.png",target:"_blank",rel:"noopener noreferrer"},ys=n("img",{src:M,alt:"03-JdbcTemplate与声明式事务"},null,-1);function xs(_s,Ss){const s=i("ExternalLinkIcon");return c(),l("div",null,[P,n("p",null,[n("a",U,[J,a(s)])]),F,n("p",null,[n("a",z,[N,a(s)])]),X,n("p",null,[n("a",Y,[V,a(s)])]),G,n("p",null,[n("a",K,[Q,a(s)])]),H,n("p",null,[n("a",Z,[W,a(s)])]),$,n("p",null,[n("a",nn,[sn,a(s)])]),an,n("p",null,[n("a",tn,[en,a(s)])]),pn,on,cn,ln,n("p",null,[n("a",un,[rn,a(s)])]),kn,n("p",null,[n("a",dn,[mn,a(s)])]),vn,n("p",null,[n("a",bn,[gn,a(s)])]),qn,n("p",null,[n("a",hn,[wn,a(s)])]),fn,n("p",null,[n("a",yn,[xn,a(s)])]),_n,n("p",null,[n("a",Sn,[jn,a(s)])]),Tn,n("p",null,[n("a",Rn,[Dn,a(s)])]),An,n("p",null,[n("a",Bn,[En,a(s)])]),In,n("p",null,[n("a",Ln,[On,a(s)])]),Mn,n("p",null,[n("a",Cn,[Pn,a(s)])]),Un,n("p",null,[n("a",Jn,[Fn,a(s)])]),zn,n("p",null,[n("a",Nn,[Xn,a(s)])]),Yn,n("p",null,[n("a",Vn,[Gn,a(s)])]),Kn,n("p",null,[n("a",Qn,[Hn,a(s)])]),Zn,Wn,$n,n("p",null,[n("a",ns,[ss,a(s)])]),as,n("p",null,[n("a",ts,[es,a(s)])]),ps,n("p",null,[n("a",os,[cs,a(s)])]),ls,n("p",null,[n("a",is,[us,a(s)])]),rs,n("p",null,[n("a",ks,[ds,a(s)])]),ms,n("p",null,[n("a",vs,[bs,a(s)])]),gs,n("p",null,[n("a",qs,[hs,a(s)])]),ws,n("p",null,[n("a",fs,[ys,a(s)])])])}const Rs=o(C,[["render",xs],["__file","04、JdbcTemplate与声明式事务.html.vue"]]);export{Rs as default};
