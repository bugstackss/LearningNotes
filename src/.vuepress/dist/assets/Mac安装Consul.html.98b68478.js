import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c as i,d as s,e as a,b as e,a as t,r}from"./app.9b10ba0a.js";const c={},p={id:"一、consul下载地址",tabindex:"-1"},d=s("a",{class:"header-anchor",href:"#一、consul下载地址","aria-hidden":"true"},"#",-1),u={href:"https://so.csdn.net/so/search?q=consul&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},v=t(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://www.consul.io/downloads
或者
https://releases.hashicorp.com/consul/1.12.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解压并安装</p><p>将下载文件解压后得到consul，复制consul文件到如下目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> consul /usr/local/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="二、开发模式启动验证" tabindex="-1"><a class="header-anchor" href="#二、开发模式启动验证" aria-hidden="true">#</a> 二、开发模式启动验证</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>consul agent <span class="token parameter variable">-dev</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过如下地址访问：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://127.0.0.1:8500/ui/dc1/services
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="三、启用server端" tabindex="-1"><a class="header-anchor" href="#三、启用server端" aria-hidden="true">#</a> 三、启用server端</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>consul agent <span class="token punctuation">\\</span>
<span class="token parameter variable">-server</span> <span class="token punctuation">\\</span>
-bootstrap-expect <span class="token number">1</span> <span class="token punctuation">\\</span>
-data-dir /Users//Documents/IDE/consul1.12.1/data <span class="token punctuation">\\</span>
<span class="token parameter variable">-node</span><span class="token operator">=</span>consulServer-emily <span class="token punctuation">\\</span>
<span class="token parameter variable">-bind</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token punctuation">\\</span>
<span class="token parameter variable">-ui</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-rejoin</span> <span class="token punctuation">\\</span>
-config-dir<span class="token operator">=</span>/Users/admin/Documents/IDE/consul1.12.1/consul.d/ <span class="token punctuation">\\</span>
<span class="token parameter variable">-client</span> <span class="token number">0.0</span>.0.0 <span class="token punctuation">\\</span>
<span class="token parameter variable">-datacenter</span><span class="token operator">=</span>emily-dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>server ： 定义agent运行在server模式</li><li>bootstrap ：用来控制一个server是否在bootstrap模式，在一个datacenter中只能有一个server处于bootstrap模式，当一个server处于bootstrap模式时，可以自己选举为raft leader</li><li>bootstrap-expect ：在一个datacenter中期望提供的server节点数目，当该值提供的时候，consul一直等到达到指定sever数目的时候才会引导整个集群，该标记不能和bootstrap共用</li><li>bind：该地址用来在集群内部的通讯，集群内的所有节点到地址都必须是可达的(默认是0.0.0.0,多张网卡的时候会报错，必须启动命令显式指定ip)</li><li>node：节点在集群中的名称，在一个集群中必须是唯一的，默认是该节点的主机名</li><li>rejoin：使consul忽略先前的离开，在再次启动后仍旧尝试加入集群中。</li><li>config-dir：配置文件目录，里面所有以.json结尾的文件都会被加载</li><li>client：consul服务侦听地址，这个地址提供HTTP、DNS、RPC等服务，默认是127.0.0.1所以不对外提供服务，如果你要对外提供服务改成0.0.0.0</li><li>datacenter: 指定数据中心名称，默认是dc1</li><li>ui:启动ui</li></ul><h2 id="四、以下将分两个步骤引导acl系统-即启用acl和创建引导令牌" tabindex="-1"><a class="header-anchor" href="#四、以下将分两个步骤引导acl系统-即启用acl和创建引导令牌" aria-hidden="true">#</a> 四、以下将分两个步骤引导ACL系统，即启用ACL和创建引导令牌</h2>`,12),b={href:"https://so.csdn.net/so/search?q=hcl&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},m=t(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acl <span class="token operator">=</span> <span class="token punctuation">{</span>
  enabled <span class="token operator">=</span> <span class="token boolean">true</span>
  default_policy <span class="token operator">=</span> <span class="token string">&quot;deny&quot;</span>
  enable_token_persistence <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>enabled：是否开启ACL；</li><li>default_policy：默认策略，deny标识默认拒绝所有操作，allow标识默认允许所有操作；</li><li>enable_token_persistence：持久化到磁盘，重启时重新加载；</li></ul><p>步骤二：创建初始化bootstrap token</p><p>创建初始化bootstrap token，可以使用acl bootstrap命令在其中一个server端</p><p>执行如下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>consul acl bootstrap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>或通过HTTP API:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token punctuation">\\</span>
    <span class="token parameter variable">--request</span> PUT <span class="token punctuation">\\</span>
    http://127.0.0.1:8500/v1/acl/bootstrap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>返回结果示例：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;ID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b4164a39-80a9-63cf-9c07-a6790ff9b64e&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;AccessorID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;17b8493f-f059-e1e6-65fc-f9ead783141d&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;SecretID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b4164a39-80a9-63cf-9c07-a6790ff9b64e&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bootstrap Token (Global Management)&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;Policies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		<span class="token property">&quot;ID&quot;</span><span class="token operator">:</span> <span class="token string">&quot;00000000-0000-0000-0000-000000000001&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;global-management&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;Local&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token property">&quot;CreateTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-05-27T11:33:07.529511+08:00&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;Hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;X2AgaFhnQGRhSSF/h0m6qpX1wj/HJWbyXcxkEM/5GrY=&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;CreateIndex&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
	<span class="token property">&quot;ModifyIndex&quot;</span><span class="token operator">:</span> <span class="token number">9</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中SecretID即为global-management策略的token;</p><h2 id="五、状态查询" tabindex="-1"><a class="header-anchor" href="#五、状态查询" aria-hidden="true">#</a> 五、状态查询</h2><ul><li>集群状态查询</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>consul operator raft list-peers
或
consul operator raft list-peers <span class="token parameter variable">-token</span> <span class="token string">&#39;b4164a39-80a9-63cf-9c07-a6790ff9b64e&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>单接单状态查询</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>consul members
或
consul members <span class="token parameter variable">-token</span> <span class="token string">&#39;b4164a39-80a9-63cf-9c07-a6790ff9b64e&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),h={id:"六、设置环境变量",tabindex:"-1"},k=s("a",{class:"header-anchor",href:"#六、设置环境变量","aria-hidden":"true"},"#",-1),g={href:"https://so.csdn.net/so/search?q=%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},_=t(`<p>如果开启了ACL，通过如下命令设置环境变量后就不用每次都带上token令牌了</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CONSUL_HTTP_TOKEN</span><span class="token operator">=</span><span class="token operator">&lt;</span>your_token_here<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h2 id="七、brew安装与使用" tabindex="-1"><a class="header-anchor" href="#七、brew安装与使用" aria-hidden="true">#</a> 七、brew安装与使用</h2>`,4),f={href:"https://developer.hashicorp.com/consul/downloads",target:"_blank",rel:"noopener noreferrer"},q={href:"https://developer.hashicorp.com/consul",target:"_blank",rel:"noopener noreferrer"},x=t(`<ol><li>安装</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>brew tap hashicorp/tap
brew <span class="token function">install</span> hashicorp/tap/consul
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>输入第二个命令的时候如果报错（不报错的请忽略此步骤）</li></ol>`,3),y=s("p",null,"错误信息：",-1),C=s("p",null,"consul",-1),E=s("p",null,"Install the Command Line Tools:",-1),w={href:"https://so.csdn.net/so/search?q=xcode&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},D=t(`<p>报上面的错误信息则输入命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>xcode-select <span class="token parameter variable">--install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输入完命令以后会弹框，点同意下载，ps:刚开始的时候显示的下载时间会很长，其实并不会很久，10几分钟左右，大概2个g，安装完成以后继续输入命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>brew install hashicorp/tap/consul
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>验证是否安装成功</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>consul <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>启动命令</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>brew services start consul
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>关闭命令</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>brew services stop consul
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="6"><li>启动成功以后访问consul网址</li></ol><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>http://localhost:8500/ui/dc1/intentions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,12);function I(A,T){const n=r("ExternalLinkIcon");return o(),i("div",null,[s("h2",p,[d,a(" 一、"),s("a",u,[a("consul"),e(n)]),a("下载地址：")]),v,s("p",null,[a("步骤一、启用ACL，上面已经开启了Consul-Server，我们先去config-dir指定的目录下创建agent."),s("a",b,[a("hcl"),e(n)]),a("来启用ACL")]),m,s("h2",h,[k,a(" 六、"),s("a",g,[a("设置环境变量"),e(n)])]),_,s("blockquote",null,[s("p",null,[a("下载地址："),s("a",f,[a("Install | Consul | HashiCorp Developer"),e(n)])]),s("p",null,[a("consul官网："),s("a",q,[a("Consul | HashiCorp Developer"),e(n)])])]),x,s("blockquote",null,[y,C,E,s("p",null,[s("a",w,[a("xcode"),e(n)]),a("-select --install")])]),D])}const N=l(c,[["render",I],["__file","Mac安装Consul.html.vue"]]);export{N as default};
