import{_ as o}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as e,c,d as s,e as n,b as p,a,r as u}from"./app.9b10ba0a.js";const l={},i=a(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>本文是博主从事后端开发以来，对公司、个人项目的经验总结，包含代码编写、功能推荐、第三方库使用及优雅配置等，希望大家看到都能有所收获</p><h2 id="一-优雅的进行线程池异常处理" tabindex="-1"><a class="header-anchor" href="#一-优雅的进行线程池异常处理" aria-hidden="true">#</a> 一. 优雅的进行线程池异常处理</h2><p>在Java开发中，线程池的使用必不可少，使用无返回值 <code>execute()</code> 方法时，线程执行发生异常的话，需要记录日志，方便回溯，一般做法是在线程执行方法内 <code>try/catch</code> 处理，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> submit <span class="token operator">=</span> threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是当线程池调用方法很多时，那么每个线程执行方法内都要 <code>try/catch</code> 处理，这就不优雅了，其实<code>ThreadPoolExecutor</code>类还支持传入 <code>ThreadFactory</code> 参数，自定义线程工厂，在创建 <code>thread</code> 时，指定 <code>setUncaughtExceptionHandler</code> 异常处理方法，这样就可以做到全局处理异常了，代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ThreadFactory</span> threadFactory <span class="token operator">=</span> r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 记录线程异常</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        threadFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;---------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二-线程池决绝策略设置错误导致业务接口执行超时" tabindex="-1"><a class="header-anchor" href="#二-线程池决绝策略设置错误导致业务接口执行超时" aria-hidden="true">#</a> 二. 线程池决绝策略设置错误导致业务接口执行超时</h2><p>先介绍下线程池得四种决绝策略</p><ul><li>AbortPolicy：丢弃任务并抛出RejectedExecutionException异常，这是线程池默认的拒绝策略</li><li>DiscardPolicy：丢弃任务，但是不抛出异常。如果线程队列已满，则后续提交的任务都会被丢弃，且是静默丢弃。 使用此策略，可能会使我们无法发现系统的异常状态。建议是一些无关紧要的业务采用此策略</li><li>DiscardOldestPolicy：丢弃队列最前面的任务，然后重新提交被拒绝的任务。此拒绝策略，是一种喜新厌旧的拒绝策略。是否要采用此种拒绝策略，还得根据实际业务是否允许丢弃老任务来认真衡量。</li><li>CallerRunsPolicy：由调用线程处理该任务</li></ul><p>如下是一个线上业务接口使用得线程池配置，决绝策略采用 <code>CallerRunsPolicy</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 某个线上线程池配置如下</span>
<span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
                <span class="token number">50</span><span class="token punctuation">,</span> <span class="token comment">// 最小核心线程数</span>
                <span class="token number">50</span><span class="token punctuation">,</span> <span class="token comment">// 最大线程数，当队列满时，能创建的最大线程数</span>
                <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token comment">// 空闲线程超过核心线程时，回收该线程的最大等待时间</span>
                <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 阻塞队列大小,当核心线程使用满时，新的线程会放进队列</span>
            <span class="token keyword">new</span> <span class="token class-name">CustomizableThreadFactory</span><span class="token punctuation">(</span><span class="token string">&quot;task&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 自定义线程名</span>
                <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>CallerRunsPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 线程执行的拒绝策略</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在某些情况下，子线程任务调用第三方接口超时，导致核心线程数、最大线程数占满、阻塞队列占满的情况下执行拒绝策略时，由于使用 <code>CallerRunsPolicy</code> 策略，导致业务线程执行子任务时继续超时，进而导致接口执行异常，这种情况下，考虑到子线程任务得重要性，不是很重要得话，可以使用 <code>DiscardPolicy</code> 策略，要是很重要，可以发送到消息队列中持久化子线程任务数据待后续处理</p><h2 id="三-优雅的单例模式懒加载帮助类代码实现" tabindex="-1"><a class="header-anchor" href="#三-优雅的单例模式懒加载帮助类代码实现" aria-hidden="true">#</a> 三. 优雅的单例模式懒加载帮助类代码实现</h2><p>博主推荐通过静态内部类实现单例模式，并实现懒加载效果，代码如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 使用静态内部类完成单例模式封装，避免线程安全问题，避免重复初始化成员属性  </span>
<span class="token annotation punctuation">@Slf4j</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterIpUtil</span> <span class="token punctuation">{</span>  
  
    <span class="token keyword">private</span> <span class="token class-name">FilterIpUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> strings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token comment">// 代码块在FilterIpUtil实例初始化时才会执行  </span>
    <span class="token punctuation">{</span>  
    
        <span class="token comment">// 在代码块中完成文件的第一次读写操作，后续不再读这个文件</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;FilterIpUtil init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span> <span class="token class-name">FilterIpUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;filterIp.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token comment">// 将文件内容放到string集合中  </span>
            <span class="token class-name">IoUtil</span><span class="token punctuation">.</span><span class="token function">readUtf8Lines</span><span class="token punctuation">(</span>resourceAsStream<span class="token punctuation">,</span> strings<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FilterIpUtil</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token class-name">InnerClassInstance</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
    <span class="token comment">// 使用内部类完成单例模式，由jvm保证线程安全  </span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InnerClassInstance</span> <span class="token punctuation">{</span>  
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">FilterIpUtil</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterIpUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token comment">// 判断集合中是否包含目标参数  </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isFilter</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四-使用ip2region实现请求地址解析" tabindex="-1"><a class="header-anchor" href="#四-使用ip2region实现请求地址解析" aria-hidden="true">#</a> 四. 使用ip2region实现请求地址解析</h2><p>在博主之前公司得项目中，ip解析是调用淘宝IP还有聚合IP接口获取结果，通常耗时200毫秒左右，并且接口不稳定时而会挂。都会影响业务接口耗时，后来在 <code>github</code> 上了解到 <code>ip2region</code> 这个项目，使用本地ip库查询，查询速度微秒级别， 精准度能达到90%，但是ip库还是有少部分ip信息不准，建议数据库中把请求ip地址保存下来。简介如下：</p><p><code>ip2region</code> v2.0 - 是一个离线IP地址定位库和IP定位数据管理框架，10微秒级别的查询效率，提供了众多主流编程语言的 <code>xdb</code> 数据生成和查询客户端实现基于 <code>xdb</code> 文件的查询，下面是一个 <code>Spring</code> 项目中 <code>ip2region</code> 帮助类来实现ip地址解析</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ip2region工具类
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ip2region</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Searcher</span> searcher <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${ip2region.path:}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ip2regionPath <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1、从 dbPath 加载整个 xdb 到内存。</span>
        <span class="token class-name">String</span> dbPath <span class="token operator">=</span> ip2regionPath<span class="token punctuation">;</span>

        <span class="token comment">// 1、从 dbPath 加载整个 xdb 到内存。</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cBuff<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            cBuff <span class="token operator">=</span> <span class="token class-name">Searcher</span><span class="token punctuation">.</span><span class="token function">loadContentFromFile</span><span class="token punctuation">(</span>dbPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            searcher <span class="token operator">=</span> <span class="token class-name">Searcher</span><span class="token punctuation">.</span><span class="token function">newWithBuffer</span><span class="token punctuation">(</span>cBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;failed to create content cached searcher: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">IpInfoBean</span> <span class="token function">getIpInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 3、查询</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> sTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 国家|区域|省份|城市|ISP</span>
            <span class="token class-name">String</span> region <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> cost <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">NANOSECONDS</span><span class="token punctuation">.</span><span class="token function">toMicros</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> sTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{region: {}, ioCount: {}, took: {} μs}&quot;</span><span class="token punctuation">,</span> region<span class="token punctuation">,</span> searcher<span class="token punctuation">.</span><span class="token function">getIOCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cost<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>region<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> region<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\|&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">IpInfoBean</span> ipInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IpInfoBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ipInfo<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ipInfo<span class="token punctuation">.</span><span class="token function">setCountry</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ipInfo<span class="token punctuation">.</span><span class="token function">setProvince</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ipInfo<span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ipInfo<span class="token punctuation">.</span><span class="token function">setIsp</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> ipInfo<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;failed to search({}): {}&quot;</span><span class="token punctuation">,</span> ip<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 4、关闭资源 - 该 searcher 对象可以安全用于并发，等整个服务关闭的时候再关闭 searcher</span>
        <span class="token comment">// searcher.close();</span>

        <span class="token comment">// 备注：并发使用，用整个 xdb 数据缓存创建的查询对象可以安全的用于并发，也就是你可以把这个 searcher 对象做成全局对象去跨线程访问。</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要注意得就是 <code>ip2region</code> v2.0 版本使用的xdb文件不建议放在项目 <code>resources</code> 下一起打包，存在编码格式问题，建议通过指定路径加载得方式单独放在服务器目录下</p><h2 id="五-优雅得springboot-mybatis配置多数据源方式" tabindex="-1"><a class="header-anchor" href="#五-优雅得springboot-mybatis配置多数据源方式" aria-hidden="true">#</a> 五. 优雅得Springboot + mybatis配置多数据源方式</h2><p><code>Springboot + mybatis</code> 得项目中一般通过 <code>@MapperScan</code> 注解配置 <code>dao</code> 层包目录，来实现 <code>dao</code> 层增强，其实项目中配置一个<code>@MapperScan</code> 是指定一个数据源，配置两个<code>@MapperScan</code>就可以指定两个数据源，通过不同得 <code>dao</code> 层包目录区分，来实现不同数据源得访问隔离。</p><p>比如下面代码中，<code>com.xxx.dao.master</code> 目录下为主数据源 <code>dao</code> 文件，<code>com.xxx.dao.slave</code> 为从数据源 <code>dao</code> 文件，这个方式比网上得基于 <code>aop</code> 加注解得方式更加简洁好用，也没有单个方法中使用不同数据源切换得问题，因此推荐这种写法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 主数据源
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;com.xxx.dao.master&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        sqlSessionFactoryRef <span class="token operator">=</span> <span class="token string">&quot;MasterSqlSessionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MasterDataSourceConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;MasterDataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;MasterDataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource.master&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">clickHouseDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">DruidDataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;MasterSqlSessionFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">getSqlSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;MasterDataSource&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">MybatisSqlSessionFactoryBean</span> sessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisSqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setMapperLocations</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;classpath*:mapper/master/*.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;------------------------------------------MasterDataSource 配置成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sessionFactoryBean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * 从数据源
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;com.xxx.dao.slave&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        sqlSessionFactoryRef <span class="token operator">=</span> <span class="token string">&quot;SlaveSqlSessionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SlaveDataSourceConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;SlaveDataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;SlaveDataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource.slave&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">clickHouseDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">DruidDataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;SlaveSqlSessionFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">getSqlSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;SlaveDataSource&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">MybatisSqlSessionFactoryBean</span> sessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisSqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionFactoryBean<span class="token punctuation">.</span><span class="token function">setMapperLocations</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;classpath*:mapper/slave/*.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;------------------------------------------SlaveDataSource 配置成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sessionFactoryBean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数据源yml配置</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token comment"># 主库数据源</span>
    <span class="token key atrule">master</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/db1<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span>
    <span class="token key atrule">slave</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/db2<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>博主刚开始编码一、两年得时候一个项目中遇到了多数据源使用得问题，那时候题主便在网上搜索<code>Spring 多数据源</code>得帖子，大多数都是基于Spring提供得<code>AbstractRoutingDataSource + AOP + 注解</code> 来做动态切换，包括现在流行得 <code>Mybatis plus</code> 官方得多数据源解决方案也是这种做法，这种做法解决了博主当时得多数据源使用问题，后来加了一个需求，在一个定时任务中，查询两个数据源得数据，才发现动态切换在单个方法中不好用了，最后使用得原生jdbc数据源解决。多年后，博主在另一家公司得项目中又遇到了多数据源问题，但是这次博主在网上搜索得是<code>Mybatis 多数据源</code>，才发现了这个优雅得解决方案，进而推荐给大家</p><h2 id="六-spring-security项目中-使用mdc实现接口请求调用追踪-以及用户id记录" tabindex="-1"><a class="header-anchor" href="#六-spring-security项目中-使用mdc实现接口请求调用追踪-以及用户id记录" aria-hidden="true">#</a> 六. Spring Security项目中，使用MDC实现接口请求调用追踪，以及用户ID记录</h2><h4 id="mdc介绍" tabindex="-1"><a class="header-anchor" href="#mdc介绍" aria-hidden="true">#</a> MDC介绍</h4><p>MDC(Mapped Diagnostic Context，映射调试上下文)是 log4j 、logback及log4j2 提供的一种方便在多线程条件下记录日志的功能。<strong>MDC</strong> 可以看成是一个<strong>与当前线程绑定的哈希表</strong>，可以往其中添加键值对。MDC 中包含的内容可以<strong>被同一线程中执行的代码所访问</strong>。当前线程的子线程会继承其父线程中的 MDC 的内容。当需要记录日志时，只需要从 MDC 中获取所需的信息即可。</p><p>虽然MDC能够方便得实现接口请求调用追踪功能，但是它在子线程中会丢失父线程中添加得键值对信息，解决方法是通过父线程中调用线程池前调用 <code>MDC.getCopyOfContextMap()</code> ，然后在子线程中第一个调用 <code>MDC.setConextMap()</code> 获取键值对信息，完整实现代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 自定义Spring线程池，解决子线程丢失reqest_id问题
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolExecutorMdcWrapper</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadPoolTaskExecutor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ThreadMdcUtil</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">getCopyOfContextMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">ThreadMdcUtil</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">getCopyOfContextMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">ThreadMdcUtil</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">getCopyOfContextMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * MDC帮助类，添加reqest_id
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadMdcUtil</span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REQUEST_ID</span> <span class="token operator">=</span> <span class="token string">&quot;request_id&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 设置请求唯一ID
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setTraceIdIfAbsent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">REQUEST_ID</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">REQUEST_ID</span><span class="token punctuation">,</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 存在userId则添加到REQUEST_ID中
     * <span class="token keyword">@param</span> <span class="token parameter">userId</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">REQUEST_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">REQUEST_ID</span><span class="token punctuation">,</span> s <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">removeTraceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token constant">REQUEST_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> callable<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">setContextMap</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">setTraceIdIfAbsent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> callable<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Runnable</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">setContextMap</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 设置traceId</span>
            <span class="token function">setTraceIdIfAbsent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                runnable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token constant">MDC</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>Spring Security</code> 中添加 <code>token</code> 过滤器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * token过滤器 验证token有效性
 *
 * <span class="token keyword">@author</span> ruoyi
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtAuthenticationTokenFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TokenService</span> tokenService<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 入口传入请求ID</span>
            <span class="token class-name">ThreadMdcUtil</span><span class="token punctuation">.</span><span class="token function">setTraceIdIfAbsent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">LoginUserDetail</span> loginUser <span class="token operator">=</span> tokenService<span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 记录userId</span>
                <span class="token class-name">ThreadMdcUtil</span><span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">.</span><span class="token function">getMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tokenService<span class="token punctuation">.</span><span class="token function">verifyToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">UsernamePasswordAuthenticationToken</span> authenticationToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                authenticationToken<span class="token punctuation">.</span><span class="token function">setDetails</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebAuthenticationDetailsSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildDetails</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// 出口移除请求ID</span>
            <span class="token class-name">ThreadMdcUtil</span><span class="token punctuation">.</span><span class="token function">removeTraceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后在 <code>logback.xml</code> 中添加 <code>%X{request_id}</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pattern<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{request_id}] [%thread] [%-5level] %logger{36}:%L %M - %msg%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>日志打印效果如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.008</span> <span class="token punctuation">[</span><span class="token number">86</span>c76336100c414dbe9217aeb099ccd5_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">INFO</span> <span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>m<span class="token punctuation">.</span>a<span class="token punctuation">.</span>s<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>IHomeServiceImpl</span><span class="token operator">:</span><span class="token number">56</span> getHomeIndexDataCompletableFuture <span class="token operator">-</span> getHomeIndexDataCompletableFuture<span class="token operator">:</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wayn<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>R</span><span class="token annotation punctuation">@701f7b8e</span><span class="token punctuation">[</span>code<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>msg<span class="token operator">=</span>操作成功<span class="token punctuation">,</span>map<span class="token operator">=</span><span class="token punctuation">{</span>bannerList<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-06-26 19:56:03&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token string">&quot;imgUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://m.360buyimg.com/mobilecms/s700x280_jfs/t1/117335/39/13837/263099/5f291a83E8ba761d0/5c0460445cb28248.jpg!cr_1125x449_0_166!q70.jpg.dpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jumpUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://82.157.141.70/mall/#/detail/1155015&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;hh2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2022-06-19 09:16:46&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-06-26 19:56:03&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string">&quot;imgUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://m.360buyimg.com/mobilecms/s700x280_jfs/t1/202096/26/11652/265782/616acb67E4fcdc9ac/8d7cdfbb6c934e67.jpg!cr_1125x449_0_166!q70.jpg.dpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jumpUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;#/detail/1155015&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;hh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2022-06-19 09:04:58&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> newGoodsList<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;酥脆奶香，甜酸回味&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008015</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">56.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1116011&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1116011</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;蔓越莓曲奇 200克&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/767b370d07f3973500db54900bcbd2a7.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">36.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;粉彩色泽，记录生活&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1012003</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">49.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1127047&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1127047</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;趣味粉彩系列笔记本&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/6c03ca93d8fe404faa266ea86f3f1e43.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">29.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;慢回弹海绵，时尚设计。&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008002</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">66.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1134030&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1134030</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;简约知性记忆棉坐垫&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/aa49dfe878becf768eddc4c1636643a6.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">46.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;慢回弹海绵的呵护，萌趣添彩。&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008002</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">69.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1134032&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1134032</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;趣味粉彩系列记忆棉坐垫&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/8b30eeb17c831eba08b97bdcb4c46a8e.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">49.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;100%桑蚕丝，丝滑润肤&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008009</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">2619.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1135002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1135002</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;宫廷奢华真丝四件套&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/45548f26cfd0c7c41e0afc3709d48286.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">2599.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;自由海军领探索未来梦&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1020003</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">89.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1135072&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1135072</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;经典海魂纹水手裙（婴童）&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/43e57d4208cdc78ac9c088f9b3e798f5.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">69.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;经典海魂纹自由海军领&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1020003</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">89.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1135073&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1135073</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;海魂纹哈衣水手服（婴童）&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/53052b04ae001d289c040e09ea92231c.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">69.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;差旅好伴侣&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1032000</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">119.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1152031&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1152031</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;魔兽世界-伊利丹颈枕眼罩套装&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/fd6e78a397bd9e9804116a36f0270b0a.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">99.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;桌面整理神器&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1032000</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">519.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1152095&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1152095</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;魔兽世界 联盟·暴风城 堡垒收纳盒&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/c86b49f635fa141decebabbd0966a6ef.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">499.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;3重透气，清爽柔滑&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008009</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">479.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1152161&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1152161</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;竹语丝麻印花四件套&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/977401e75113f7c8334c4fb5b4bf6215.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">459.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> categoryList<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-08 23:09:12&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/9fc3c52571aa38a1466f114c2dc892fc.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;大牌手机&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/2545dd00ca4575759024af2811949a9d.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:26:48&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;valueUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://baidu.com&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-06 13:27:54&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://82.157.141.70/upload/2022/02/21/a23fa32c8f4004a8c9fbbb1784462163.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;滋补保健2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/d4de7172eb7ae4178ae4dafd6a973d8f.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2022-06-19 09:17:20&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-08 23:26:15&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/6bc0f8a131d2d16b8fc2004d4aa4860c.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;不锈钢锅&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/314d87257f7a2ff03d5f4c5183797912.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:27:24&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">1036000</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:28:08&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/5a90531d901529967885279d7dc826e1.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;进口牛奶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/0b1f6ab63d5e222c52c83a2d0581e44c.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:28:33&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/33530951827ca7e59940d51cda537d84.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;量贩囤货&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/bb6daee3b3e51c3008db97585249f513.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:28:50&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/7d337f25111b263b29d5d12589015c46.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;清洁用品&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/be8995bda39d03b17349b8ec0dcab3d5.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:29:10&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/2e632ec0173bb477dcdb601495e0412a.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;洗护用品&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/53fb88c9d1245caa882aa3fc29187d0b.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:29:28&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/942323c0e74677cf2aa15f09a1e63bca.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;日用百货&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/8587f91db2edcb43e57da9835cc7ec76.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:29:46&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/18d9d860ba9b8b28522e050f11a8a8e0.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;明星乳胶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/65273c7fb2273e90958e92626248a90a.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 19:30:15&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;iconUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/7c790577afda91eebc3c95586e190957.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">&quot;jumpType&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;口碑好物&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://cdn.wayn.xin/210011b35be4ceee39e6a466b40b8e22.jpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2021-04-01 20:13:08&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;valueId&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> expire_time<span class="token operator">=</span><span class="token number">1669549170235</span><span class="token punctuation">,</span> hotGoodsList<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">1001045</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;一级桑蚕丝，吸湿透气柔软&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1036000</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">719.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1006013&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1006013</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;双宫茧桑蚕丝被 空调被&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/583812520c68ca7995b6fac4c67ae2c7.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">699.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2021-08-08 11:19:36&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">1001045</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;双层子母被，四季皆可使用&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008008</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">14199.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1006014&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1006014</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;双宫茧桑蚕丝被 子母被&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/2b537159f0f789034bf8c4b339c43750.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">1399.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">1001000</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;加大加厚，双色精彩&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1036000</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">219.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1011004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1011004</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;色织精梳AB纱格纹空调被&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/0984c9388a2c3fd2335779da904be393.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">199.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;共享亲密2人时光&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008008</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">219.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1019002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1019002</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;升级款护颈双人记忆枕&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/0118039f7cda342651595d994ed09567.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">199.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;健康保护枕&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008008</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">119.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1019006&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1019006</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;植物填充护颈夜交藤枕&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/60c3707837c97a21715ecc3986a744ce.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">99.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;厚实舒适&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008001</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">59.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1021000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1021000</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;被&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;埃及进口长绒棉毛巾&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/7191f2599c7fe44ed4cff7a76e853154.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">39.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;条&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">1001020</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;浪漫毛线绣球，简约而不简单&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008009</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">319.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1022000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1022000</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;意式毛线绣球四件套&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/5350e35e6f22165f38928f3c2c52ac57.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">299.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">1001000</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;柔软纱布，婴童可用&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1036000</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">269.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1027004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1027004</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;色织六层纱布夏凉被&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/6252f53aaf36c072b6678f3d8c635132.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">249.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;原生苦荞，健康护颈&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008008</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">119.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1036002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1036002</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;高山苦荞麦枕&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/ffd7efe9d5225dff9f36d5110b027caa.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">99.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;actualSales&quot;</span><span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;brief&quot;</span><span class="token operator">:</span><span class="token string">&quot;5cm记忆绵的亲密包裹&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;categoryId&quot;</span><span class="token operator">:</span><span class="token number">1008008</span><span class="token punctuation">,</span><span class="token string">&quot;counterPrice&quot;</span><span class="token operator">:</span><span class="token number">619.00</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;delFlag&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;goodsSn&quot;</span><span class="token operator">:</span><span class="token string">&quot;1037011&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1037011</span><span class="token punctuation">,</span><span class="token string">&quot;isHot&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;isNew&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;isOnSale&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;安睡慢回弹记忆绵床垫&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;picUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://yanxuan.nosdn.127.net/a03ea6f4509439acdafcb7ceba1debe0.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;retailPrice&quot;</span><span class="token operator">:</span><span class="token number">599.00</span><span class="token punctuation">,</span><span class="token string">&quot;shareUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sort&quot;</span><span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token string">&quot;unit&quot;</span><span class="token operator">:</span><span class="token string">&quot;件&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2018-02-01 00:00:00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;virtualSales&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.336</span> <span class="token punctuation">[</span><span class="token number">9d</span><span class="token number">919f</span>b6d33c4652ba28ff87ae210809_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">DEBUG</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>G</span><span class="token punctuation">.</span>selectGoodsListPage_mpCount<span class="token operator">:</span><span class="token number">137</span> debug <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">&gt;</span>  <span class="token class-name">Preparing</span><span class="token operator">:</span> <span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token constant">AS</span> total <span class="token constant">FROM</span> shop_goods <span class="token class-name">WHERE</span> del_flag <span class="token operator">=</span> <span class="token number">0</span> <span class="token class-name">AND</span> is_on_sale <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.387</span> <span class="token punctuation">[</span><span class="token number">9d</span><span class="token number">919f</span>b6d33c4652ba28ff87ae210809_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">DEBUG</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>G</span><span class="token punctuation">.</span>selectGoodsListPage_mpCount<span class="token operator">:</span><span class="token number">137</span> debug <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token class-name">Parameters</span><span class="token operator">:</span> 
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.426</span> <span class="token punctuation">[</span><span class="token number">9d</span><span class="token number">919f</span>b6d33c4652ba28ff87ae210809_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">DEBUG</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>G</span><span class="token punctuation">.</span>selectGoodsListPage_mpCount<span class="token operator">:</span><span class="token number">137</span> debug <span class="token operator">-</span> <span class="token operator">&lt;=</span><span class="token operator">=</span>      <span class="token class-name">Total</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.430</span> <span class="token punctuation">[</span><span class="token number">9d</span><span class="token number">919f</span>b6d33c4652ba28ff87ae210809_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">DEBUG</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>G</span><span class="token punctuation">.</span>selectGoodsListPage<span class="token operator">:</span><span class="token number">137</span> debug <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">&gt;</span>  <span class="token class-name">Preparing</span><span class="token operator">:</span> select id<span class="token punctuation">,</span> goods_sn<span class="token punctuation">,</span> name<span class="token punctuation">,</span> pic_url<span class="token punctuation">,</span> counter_price<span class="token punctuation">,</span> retail_price<span class="token punctuation">,</span> actual_sales<span class="token punctuation">,</span> virtual_sales from shop_goods <span class="token class-name">WHERE</span> del_flag <span class="token operator">=</span> <span class="token number">0</span> and is_on_sale <span class="token operator">=</span> <span class="token number">1</span> order by create_time desc <span class="token constant">LIMIT</span> <span class="token operator">?</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.452</span> <span class="token punctuation">[</span><span class="token number">9d</span><span class="token number">919f</span>b6d33c4652ba28ff87ae210809_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">DEBUG</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>G</span><span class="token punctuation">.</span>selectGoodsListPage<span class="token operator">:</span><span class="token number">137</span> debug <span class="token operator">-</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token class-name">Parameters</span><span class="token operator">:</span> <span class="token function">6</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">27</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">48.476</span> <span class="token punctuation">[</span><span class="token number">9d</span><span class="token number">919f</span>b6d33c4652ba28ff87ae210809_12<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">82</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">DEBUG</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>w<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>G</span><span class="token punctuation">.</span>selectGoodsListPage<span class="token operator">:</span><span class="token number">137</span> debug <span class="token operator">-</span> <span class="token operator">&lt;=</span><span class="token operator">=</span>      <span class="token class-name">Total</span><span class="token operator">:</span> <span class="token number">6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后分析上诉日志：通过<code>86c76336100c414dbe9217aeb099ccd5</code>实现接口调用追踪，通过<code>12</code>用户ID，实现用户调用追踪</p><h2 id="七-alibaba-excel导出时自定义格式转换优雅实现" tabindex="-1"><a class="header-anchor" href="#七-alibaba-excel导出时自定义格式转换优雅实现" aria-hidden="true">#</a> 七. alibaba excel导出时自定义格式转换优雅实现</h2><p>官网介绍：<code>EasyExcel</code> 是一个基于Java的简单、省内存的读写Excel的开源项目。在尽可能节约内存的情况下支持读写百M的Excel。</p><p><code>EasyExcel</code> 是 <code>alibaba</code> 出的一个基于 <code>java poi</code> 得excel通用处理类库，他的优势在于内存消耗。对比 <code>easypoi</code> 方案，<code>EasyExcel</code> 在内存消耗、知名度（大厂光环）上更出众些。</p><p>博主在使用过程中发现导出excel，官网对自定义格式字段提供了 <code>converter</code> 接口，但只简单提供了<code>CustomStringStringConverter</code> 类代码，达不到博主想要得优雅要求，如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomStringStringConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">supportJavaTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellDataTypeEnum</span> <span class="token function">supportExcelTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 这里读的时候会调用
     *
     * <span class="token keyword">@param</span> <span class="token parameter">context</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">convertToJavaData</span><span class="token punctuation">(</span><span class="token class-name">ReadConverterContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;自定义：&quot;</span> <span class="token operator">+</span> context<span class="token punctuation">.</span><span class="token function">getReadCellData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStringValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 这里是写的时候会调用 不用管
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertToExcelData</span><span class="token punctuation">(</span><span class="token class-name">WriteConverterContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以上代码中，打个比方想要实现性别字段得自定义格式转换，就需要在convertToExcelData方法中，添加如下代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertToExcelData</span><span class="token punctuation">(</span><span class="token class-name">WriteConverterContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> value <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，非常得不优雅，对于这种类型字段，博主习惯使用枚举类来定义字段所有类型，然后将枚举类转换为 <code>map(value,desc)</code> 结构，就可以优雅得实现这个自定义格式得需求</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 一、先定义int字段抽象转换类，实现通用转换逻辑
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractIntConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">abstract</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConverterDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">getArr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertToExcelData</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span> <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConverterDTO</span><span class="token punctuation">&gt;</span></span> values <span class="token operator">=</span> <span class="token function">getArr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">ConverterDTO</span><span class="token operator">::</span><span class="token function">getType</span><span class="token punctuation">,</span> <span class="token class-name">ConverterDTO</span><span class="token operator">::</span><span class="token function">getDesc</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WriteCellData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ConverterDTO</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> type<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> type<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">ConverterDTO</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> type<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * 二、定义通用状态字段转换类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatusConverter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractIntConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConverterDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">getArr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StatusEnum</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token class-name">StatusEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>sexEnum <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ConverterDTO</span><span class="token punctuation">(</span>sexEnum<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sexEnum<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 状态枚举
     */</span>
    <span class="token keyword">enum</span> <span class="token class-name">StatusEnum</span> <span class="token punctuation">{</span>
        <span class="token function">MAN</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;启用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">WOMAN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;禁用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">Integer</span> type<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

        <span class="token class-name">StatusEnum</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> type<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> type<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后再导出 <code>ExcelProperty</code> 中添加 <code>StatusConverter</code> ，就优雅得实现了自定义格式得需求</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEntity</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token doc-comment comment">/**
     * 用户状态 0 启用 1 禁用
     */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;用户状态&quot;</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">StatusConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userStatus<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="八-springboot-默认redis客户端lettuce经常连接超时解决方案" tabindex="-1"><a class="header-anchor" href="#八-springboot-默认redis客户端lettuce经常连接超时解决方案" aria-hidden="true">#</a> 八. Springboot 默认redis客户端lettuce经常连接超时解决方案</h2><p>不知道大家有没有遇到这种情况，线上项目使用 <code>lettuce</code> 客户端，当操作 <code>redis</code> 得接口一段时间没有调用后（比如30分钟），再次调用 <code>redis</code> 操作后，就会遇到连接超时得问题，导致接口异常。博主直接给出分析过程：</p><ol><li>通过wireshark抓包工具，发现项目中 <code>redis</code> 连接创建后，一段时间未传输数据后，客户端发送 <code>psh</code> 包，未收到服务端 <code>ack</code> 包，触发tcp得超时重传机制，在重传次数重试完后，最终客户端主动关闭了连接。</li></ol><p>到这里我们就知道这个问题，主要原因在于服务端没有回复客户端（比如tcp参数设置、防火墙主动关闭等，都是针对一段时间内没有数据传输得tcp连接会做关闭处理），造成了客户端得连接超时</p><p>面对这个问题有三种解决方案：</p>`,56),k={href:"https://juejin.cn/post/7084648654975270920",target:"_blank",rel:"noopener noreferrer"},r=a("<li>启用一个心跳定时任务，定时访问 <code>redis</code>，保持 <code>redis</code> 连接不被关闭，简而言之，就是写一个定时任务，定时调用 <code>redis</code>得 <code>get</code> 命令，进而保活 <code>redis</code> 连接</li><li>基于Springboot 提供得 <code>LettuceClientConfigurationBuilderCustomizer</code> 自定义客户端配置，博主这里主要针对第三种自定义客户端配置来讲解一种优雅得方式</li>",2),d=a(`<p><code>Springboot</code> 项目中关于 <code>lettuce</code> 客户端得自动配置是没有启用保活配置得，要启用得话代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 自定义lettuce客户端配置
 *
 * <span class="token keyword">@return</span> LettuceClientConfigurationBuilderCustomizer
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LettuceClientConfigurationBuilderCustomizer</span> <span class="token function">lettuceClientConfigurationBuilderCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> clientConfigurationBuilder <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">LettuceClientConfiguration</span> clientConfiguration <span class="token operator">=</span> clientConfigurationBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClientOptions</span> clientOptions <span class="token operator">=</span> clientConfiguration<span class="token punctuation">.</span><span class="token function">getClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">ClientOptions</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClientOptions</span> build <span class="token operator">=</span> clientOptions<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SocketOptions<span class="token punctuation">.</span>KeepAliveOptions<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> build<span class="token punctuation">.</span><span class="token function">getSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeepAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 保活配置</span>
        builder<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">idle</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SocketOptions<span class="token punctuation">.</span>Builder</span> socketOptionsBuilder <span class="token operator">=</span> clientOptions<span class="token punctuation">.</span><span class="token function">getSocketOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SocketOptions<span class="token punctuation">.</span>KeepAliveOptions</span> keepAliveOptions <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socketOptionsBuilder<span class="token punctuation">.</span><span class="token function">keepAlive</span><span class="token punctuation">(</span>keepAliveOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SocketOptions</span> socketOptions <span class="token operator">=</span> socketOptionsBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClientOptions</span> clientOptions1 <span class="token operator">=</span> <span class="token class-name">ClientOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">socketOptions</span><span class="token punctuation">(</span>socketOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        clientConfigurationBuilder<span class="token punctuation">.</span><span class="token function">clientOptions</span><span class="token punctuation">(</span>clientOptions1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加 <code>lettuce</code> 客户端的自定义配置，在 <code>KeepAliveOptions</code> 中启用 <code>enable</code> ，这样 <code>lettuce</code> 客户端就会在tcp协议规范上启用 <code>keep alive</code> 机制自动发送心跳包</p><h2 id="九-redis客户端lettuce启用epoll" tabindex="-1"><a class="header-anchor" href="#九-redis客户端lettuce启用epoll" aria-hidden="true">#</a> 九. redis客户端lettuce启用epoll</h2>`,4),q={href:"https://link.juejin.cn?target=https%3A%2F%2Flettuce.io%2Fcore%2Frelease%2Freference%2F%23native-transports",target:"_blank",rel:"noopener noreferrer"},m=s("code",null,"netty-all",-1),g=s("code",null,"lettuce",-1),v=s("code",null,"epoll",-1),b=s("code",null,"linux",-1),f=s("code",null,"netty-transport-native-epoll",-1),y=s("code",null,"netty-all",-1),w=s("code",null,"netty-transport-native-epoll",-1),h=s("code",null,"epoll",-1),S=a(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="十-springboot-web项目优雅停机" tabindex="-1"><a class="header-anchor" href="#十-springboot-web项目优雅停机" aria-hidden="true">#</a> 十. Springboot web项目优雅停机</h2><p>web项目配置了优雅停机后，在重启jar包，或者容器时可以防止正在活动得线程被突然停止（ <code>kill -9</code> 无解，请不要使用这个参数杀线上进程，<code>docker compose</code> 项目尽量不要用 <code>docker-compose down</code> 命令关闭项目，使用 <code>docker-compose rm -svf</code> 可以触发优雅停机），造成用户请求失败，在此期间允许完成现有请求但不允许新请求，配置如下：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span> <span class="token key atrule">shutdown</span><span class="token punctuation">:</span> <span class="token string">&quot;graceful&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="十一-nginx配置通用请求后缀" tabindex="-1"><a class="header-anchor" href="#十一-nginx配置通用请求后缀" aria-hidden="true">#</a> 十一. nginx配置通用请求后缀</h2><p>先说下这个配置产生得前提，博主公司pc客户项目是基于 <code>electron</code> 打包得网页项目，每次项目大版本更新时，为了做好兼容性，防止客户端网页缓存等，会使用一个新网页地址，打个比方：</p>`,6),x=s("code",null,"v1.1.0",-1),T={href:"https://link.juejin.cn?target=http%3A%2F%2Fapi.dev.com%2FpageV110",target:"_blank",rel:"noopener noreferrer"},I=s("code",null,"v1.2.0",-1),C={href:"https://link.juejin.cn?target=http%3A%2F%2Fapi.dev.com%2FpageV120",target:"_blank",rel:"noopener noreferrer"},_=a(`<p>那么项目得nginx配置则则需要新加一个 <code>v1.2.0</code> 得配置如下：</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>server {
   listen 80;
   server_name api.dev.com;
   client_max_body_size 10m;

   # 老网页v1.1.0配置
   location ~ ^/pageV110 {
               alias  /home/wwwroot/api.dev.com/pageV110;
               index  index.html index.htm;
       }
       
   # 新网页v1.2.0配置
   location ~ ^/pageV120 {
               alias  /home/wwwroot/api.dev.com/pageV120;
               index  index.html index.htm;
       }

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么博主在每次项目发布得时候就需要配合前端发版，配置一个新网页，故产生了这个通用配置得需求，如下：</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>server {
   listen 80;
   server_name api.dev.com;
   client_max_body_size 10m;

   # 配置正则localtion
   location ~ ^/pageV(.*) {
               set $s $1; # 定义后缀变量
               alias  /home/wwwroot/api.dev.com/pageV$s;
               index  index.html index.htm;
       }

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>nginx</code> 配置文件语法中，<code>location</code> 语句可以使用正则表达式，定义 <code>set $s $1</code> 变量，实现了通用配置</p><h2 id="十二-关于开发人员的自我提升和突破" tabindex="-1"><a class="header-anchor" href="#十二-关于开发人员的自我提升和突破" aria-hidden="true">#</a> 十二. 关于开发人员的自我提升和突破</h2><p>博主这里主要总结了四点：</p><ol><li>多和他人沟通，沟通能把复杂问题简单化，有时候开发阶段一个需求多问几句，可以减少因为个人理解差异导致的需求不一致问题，进而减少开发时间</li><li>建立长短期目标，观看技术视频、书籍给自己充电，比如7天利用业余时间看完一本电子书，三十天从零开始一个新项目等</li><li>善于总结，对于项目中的疑难bug，踩坑点要有记录，防止下次遇到再掉坑里</li><li>敢于尝试、担责，对项目、代码里明确不合理的地方要敢于跟他人沟通，修改问题代码，达到优化目的。对于自己造成的问题要承担，不要推卸责任。对于线上问题要重视，优先解决线上问题。</li></ol>`,8);function U(D,P){const t=u("ExternalLinkIcon");return e(),c("div",null,[i,s("ul",null,[s("li",null,[n("redis操作异常后进行重试，这篇文章有介绍 "),s("a",k,[n("生产环境Redis连接，长时间无响应被服务器断开问题"),p(t)])]),r]),d,s("p",null,[n("直接给 "),s("a",q,[n("官网连接"),p(t)]),n("，配置很简单，添加一个 "),m,n(" 得依赖，"),g,n(" 会自动检测项目系统是否支持 "),v,n("（"),b,n(" 系统支持），并且是否有"),f,n("依赖（ "),y,n(" 包含 "),w,n(" ），都满足得话就会自动启用 "),h,n(" 事件循环，进一步提升系统性能")]),S,s("p",null,[n("老网页地址，"),x,n(" 版本网页访问地址："),s("a",T,[n("api.dev.com/pageV110"),p(t)])]),s("p",null,[n("新网页地址，"),I,n(" 版本网页访问地址："),s("a",C,[n("api.dev.com/pageV120"),p(t)])]),_])}const E=o(l,[["render",U],["__file","十二条后端开发经验分享，纯干货.html.vue"]]);export{E as default};
