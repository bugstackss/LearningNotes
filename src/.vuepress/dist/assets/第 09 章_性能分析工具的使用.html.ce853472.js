import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as a,c as r,d as e,e as s,b as n,a as d,r as c}from"./app.9b10ba0a.js";const t="/assets/1771d1ef972c4fbd946c55b1fb52d0e7.033ff2cb.png",o="/assets/618f6a951d8e45473f8c5dc91185180f.67c04bd0.png",u="/assets/2344459cacd61a3a4d7f4aef4a3c9b69.4362419a.png",m="/assets/8d71a9fc5bc99ae8256d600fd9e9d883.b8a0637d.png",v="/assets/51771021b4ad2f3850697f73979f7176.e5f4ac18.png",b="/assets/image-20221219194235219.a4b09a8e.png",p="/assets/image-20221219194514648.5becc4b2.png",g="/assets/0e43bfc76b2ffd873a3e881e7c8fac6f.d9f931b0.png",_="/assets/image-20221219195144418.63dd9ea8.png",q="/assets/image-20221219195221387.9328d70f.png",y="/assets/0f20ee3121dfd0daee25ee3ba1db8b43.e4ea33ec.png",E="/assets/de7fcc7b8dbf7185f725b3005b5dca59.13fd9775.png",h="/assets/image-20221219195825729.b91eaabc.png",f="/assets/image-20221219195954069.e93cec3a.png",L="/assets/7e286d10ad9a06464f4911aa5505bb79.9eba8a89.png",N="/assets/6f96464bb4a6d101534a0b93e49741b5.5e7c6633.png",I="/assets/7422bfdc6cf19b57ded5f4254ee65e35.5127e63f.png",R="/assets/81e902a5c7c9b5f221123284878eb8fa.5ed36718.png",T="/assets/4ef38bf5e4227c4d210bbe65b1795fee.8bdf49ed.png",A="/assets/fc6d95febc423e95d0260b14a944808d.1162fb1f.png",S="/assets/f8df290a5abe558b37d4d2d30214511a.3cb6a3d9.png",x="/assets/839dcd890063ae9e8bee825a692ee3a0.d511686e.png",k="/assets/19c7755d36ff35764187600cbcc8a589.d49b773d.png",O="/assets/6399b387426312a0db573048fbc61a69.fdc2b545.png",w="/assets/dadcebd3c22a798e8dcf733fc5bdb336.5290b919.png",C="/assets/3e649e49816e6c5f36d7a89200e8e9ec.24c75919.png",M="/assets/3f8103e5fd2aa2c57809d89bcecfb954.cc29bf0c.png",U="/assets/e8a95008ea4188099f116abb2aa471ef.1327da21.png",P="/assets/ac17b7edf788865bde901b16ec2df81f.1ae333e0.png",F="/assets/579860e8c0a709e5f138cd7198b5274e.030ce997.png",D="/assets/bf53d00e679cc002f7639a072ff679d8.4d98fee4.png",H="/assets/443c33090218e85489aa896c3d40bac5.3ad6697f.png",W="/assets/4b7255cc3499c770af4107d58d068f91.fec27c28.png",X="/assets/c7a1ad766c232bc9908fe3774c7f4405.0dbe4cfc.png",Q="/assets/64bc2fbe360a54815bef3eaf3cd0baca.c7421f53.png",V="/assets/5a16dae8a7ed78b4c964cc5e0a090ab1.cd8a5f67.png",B="/assets/62fdaf009f7df3825af794fa7f08e940.baebb47b.png",Y="/assets/7795326f2fbf062b3f780738d090513a.e44bb2f1.png",z="/assets/abd6b80cf9af83f23f96405ba7a508ce.d11c34aa.png",G="/assets/33fed1ec92753f57c04b30d4e49408e4.50b125bd.png",J="/assets/039a334bda693450a704db328f63232a.be1ded01.png",K="/assets/aa7cef25b51eed6717a0dcca611cb57c.419384a4.png",j="/assets/463fd44a01a106555515b733dd924b90.e218954b.png",Z="/assets/3e649e49816e6c5f36d7a89200e8e9ec.24c75919.png",$="/assets/8e0bf84c12e29232846f33c0d5ccb348.b5aa8b60.png",ee="/assets/4cd4dc518ad4a0d5e6d1aff2a5702c88.f547df39.png",se="/assets/da666279f585df3d32ed6283bf355e3e.7a156246.png",ie="/assets/dd0ba7cdae1855b1be885c705fe66371.ac4f3d16.png",ne="/assets/55ced78a07a00fd64e29d529b18f0b3a.d730a3f3.png",de="/assets/9c7a7bbc8c50f71475d666d9cd2d37ef.534338c1.png",le="/assets/072c8b19335c8248750bb53fac6d67d1.d8a133ce.png",ae="/assets/cd850a3f00131c5bf7a465d85ccf6fee.e4987fbf.png",re="/assets/c84a8446fde8bf53098ace03aa7c8b0f.30b607e1.png",ce="/assets/78dd3fa35ca96b5e9d86d7e8f4708289.261d40a7.png",te="/assets/d2360c18b0684cb61dde5357d294e9a9.3182f63d.png",oe="/assets/a4316c0090b8f48957d5b3c1c1835af9.767d5d2c.png",ue="/assets/9c7a7bbc8c50f71475d666d9cd2d37ef.534338c1.png",me="/assets/438e61f3fbac7c2c247e6f0790983738.322a9b12.png",ve="/assets/91c29df3acfd7f2ff812283d986eaac5.d4315a95.png",be="/assets/74e99d43b8edeca80cac319d6ad3683c.8d184fcd.png",pe="/assets/085a9fd83bb9a904f8e19ef3c3e30b86.7c708be5.png",ge="/assets/d39b2803e548ded871be1d11b8c39e54.73d67436.png",_e="/assets/943b870f90f806ae36c59dfbc58153f7.ac96020c.png",qe="/assets/b86e40864ae71873b48563dc79324d44.b4721ec4.png",ye="/assets/8e6c3310d2274c233a39b5cbcff0faea.503da8be.png",Ee="/assets/87715dbb91a61e45c4e28e762fb23c05.1d7d7873.png",he="/assets/4c46aef74b172674355b6682a8ec664b.c3f48d95.png",fe="/assets/d5e0a6b30d7af406764fb914d1ce28de.91afa4ee.png",Le="/assets/a0b1e61fa25cf7aafe60f707a0e4b568.0c87367e.png",Ne="/assets/89341460345dfded0bd56d76365f9522.f753aa5d.png",Ie="/assets/8ae606fdcaeaa0e168ae0bd841b5dc99.e33eb578.png",Re="/assets/7ea6cd7f6ade1d2bcf622c216326fe27.a9ebc374.png",Te="/assets/967c60fcf417121c34c01c8a5a1d7d91.b8fbe5e7.png",Ae="/assets/624ba7e7e0e70765204a8d1f262bc214.c4cb79d7.png",Se="/assets/1f4f3e7866d4628c08f4facb306bf025.39f2333a.png",xe="/assets/4710de444b1372bb37080b1f87a4e891.f2c74fd1.png",ke="/assets/4d1f084f089f6b1e0ba42a5acba5b64d.5341b58c.png",Oe="/assets/bd734aba5d3e7dbe2330c82a10fe760e.c0db06f5.png",we="/assets/7aa84d8dec10c6ce420f87f81aca9b94.3d530745.png",Ce="/assets/d1da91c0cd4c8df7a3de7800f5b37f2f.07876bfb.png",Me="/assets/7613ab9833c481e0b2f6ab4d18a7d08b.4e9e4664.png",Ue="/assets/acf6bb063b8573f2fc4d5186dc156486.80fc6030.png",Pe="/assets/47426e2aea58b9c411ab07fc8b3bb670.809a6de4.png",Fe="/assets/22e27a8f8b50fa1141052c442d7b1804.6e263617.png",De="/assets/ba5e3ff12f7639a5addaee7e198623f5.ca56878a.png",He="/assets/a11259fdedf44db1c888723e4afe304c.46fcb1a9.png",We="/assets/219dfb90ff566a5e249a75589ce21a31.58246db4.png",Xe="/assets/c04be4cc5f90ec99d85736c11296772d.7c980bac.png",Qe="/assets/9d406060efdc6f72c8348b422bedd57f.cae92993.png",Ve="/assets/c3555f95e86cd2dc4358a0b8f3343d9d.d6564af0.png",Be="/assets/a18799a495c9a257fd847443cd082932.ff8db4ae.png",Ye="/assets/e6b93efd8e8ea0085d5117f268e231b7.f9ba7f9c.png",ze={},Ge=e("h1",{id:"ç¬¬-09-ç« -æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#ç¬¬-09-ç« -æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨","aria-hidden":"true"},"#"),s(" ç¬¬ 09 ç« _æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨")],-1),Je=e("p",null,"è®²å¸ˆï¼šå°šç¡…è°·-å®‹çº¢åº·ï¼ˆæ±Ÿæ¹–äººç§°ï¼šåº·å¸ˆå‚…ï¼‰",-1),Ke={href:"http://www.atguigu.com",target:"_blank",rel:"noopener noreferrer"},je=d('<h2 id="_1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤" aria-hidden="true">#</a> 1. æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤</h2><p>å½“æˆ‘ä»¬é‡åˆ°æ•°æ®åº“è°ƒä¼˜é—®é¢˜çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•æ€è€ƒå‘¢ï¼Ÿè¿™é‡ŒæŠŠæ€è€ƒçš„æµç¨‹æ•´ç†æˆä¸‹é¢è¿™å¼ å›¾ã€‚</p><p>æ•´ä¸ªæµç¨‹åˆ’åˆ†æˆäº†è§‚å¯Ÿï¼ˆShow statusï¼‰å’Œè¡ŒåŠ¨ï¼ˆActionï¼‰ä¸¤ä¸ªéƒ¨åˆ†ã€‚å­—æ¯ S çš„éƒ¨åˆ†ä»£è¡¨è§‚å¯Ÿï¼ˆä¼šä½¿ç”¨ç›¸åº”çš„åˆ†æå·¥å…·ï¼‰ï¼Œå­—æ¯ A ä»£è¡¨çš„éƒ¨åˆ†æ˜¯è¡ŒåŠ¨ï¼ˆå¯¹åº”åˆ†æå¯ä»¥é‡‡å–çš„è¡ŒåŠ¨ï¼‰ã€‚</p><p><img src="'+t+'" alt="image-20220811114111312"></p><p><img src="'+o+'" alt="img"></p><p><img src="'+u+`" alt="image-20220811114145753"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®åº“è°ƒä¼˜çš„æ­¥éª¤ä¸­è¶Šå¾€é‡‘å­—å¡”å°–èµ°ï¼Œå…¶æˆæœ¬è¶Šé«˜ï¼Œæ•ˆæœè¶Šå·®ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ•°æ®åº“è°ƒä¼˜çš„è¿‡ç¨‹ä¸­ï¼Œè¦é‡ç‚¹æŠŠæ¡é‡‘å­—å¡”åº•éƒ¨çš„ <mark>sql åŠç´¢å¼•è°ƒä¼˜ï¼Œæ•°æ®åº“è¡¨ç»“æ„è°ƒä¼˜</mark>ï¼Œç³»ç»Ÿé…ç½®å‚æ•°è°ƒä¼˜ç­‰è½¯ä»¶å±‚é¢çš„è°ƒä¼˜</p><h2 id="_2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°" aria-hidden="true">#</a> 2. æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</h2><p>å¯ä»¥ä½¿ç”¨ <code>SHOW STATUS</code> è¯­å¥æŸ¥è¯¢ä¸€äº›æ•°æ®åº“æœåŠ¡å™¨çš„æ€§èƒ½å‚æ•°å’Œä½¿ç”¨é¢‘ç‡ã€‚</p><p>å…¶è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW [GLOBAL][SESSION] STATUES LIKE &#39;å‚æ•°&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸€äº›å¸¸ç”¨çš„æ€§èƒ½å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>Connectionsï¼šè¿æ¥MySQLæœåŠ¡å™¨çš„æ¬¡æ•°ã€‚</li><li>Uptimeï¼šMySQLæœåŠ¡å™¨çš„ä¸Šçº¿æ—¶é—´ã€‚</li><li>Slow_queriesï¼šæ…¢æŸ¥è¯¢çš„æ¬¡æ•°ã€‚</li><li>Innodb_rows_readï¼šSelectæŸ¥è¯¢è¿”å›çš„è¡Œæ•°</li><li>Innodb_rows_insertedï¼šæ‰§è¡ŒINSERTæ“ä½œæ’å…¥çš„è¡Œæ•°</li><li>Innodb_rows_updatedï¼šæ‰§è¡ŒUPDATEæ“ä½œæ›´æ–°çš„è¡Œæ•°</li><li>Innodb_rows_deletedï¼šæ‰§è¡ŒDELETEæ“ä½œåˆ é™¤çš„è¡Œæ•°</li><li>Com_selectï¼šæŸ¥è¯¢æ“ä½œçš„æ¬¡æ•°ã€‚</li><li>Com_insertï¼šæ’å…¥æ“ä½œçš„æ¬¡æ•°ã€‚å¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚</li><li>Com_updateï¼šæ›´æ–°æ“ä½œçš„æ¬¡æ•°ã€‚</li><li>Com_deleteï¼šåˆ é™¤æ“ä½œçš„æ¬¡æ•°ã€‚</li></ul><p>ä¸¾ä¾‹ï¼š</p><ul><li>è‹¥æŸ¥è¯¢MYSQLæœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW STATUS LIKE &#39;Connections&#39;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Connections   | 34    |
+---------------+-------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è‹¥æŸ¥è¯¢æœåŠ¡å™¨å·¥ä½œæ—¶é—´ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW STATUS LIKE &#39;Uptime&#39;;
+---------------+--------+
| Variable_name | Value  |
+---------------+--------+
| Uptime        | 332933 |
+---------------+--------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è‹¥æŸ¥è¯¢MySQLæœåŠ¡å™¨çš„æ…¢æŸ¥è¯¢æ¬¡æ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW STATUS LIKE &#39;Slow_queries&#39;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Slow_queries  | 0     |
+---------------+-------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨ï¼šæ…¢æŸ¥è¯¢æ¬¡æ•°å‚æ•°å¯ä»¥ç»“åˆæ…¢æŸ¥è¯¢æ—¥å¿—æ‰¾å‡ºæ…¢æŸ¥è¯¢è¯­å¥ï¼Œç„¶åé’ˆå¯¹æ…¢æŸ¥è¯¢è¯­å¥è¿›è¡Œ <code>è¡¨ç»“æ„ä¼˜åŒ–</code> æˆ–è€…<code>æŸ¥è¯¢è¯­å¥ä¼˜åŒ–</code></p><ul><li>æŸ¥çœ‹å­˜å‚¨å¼•æ“å¢åˆ æ”¹æŸ¥çš„è¡Œæ•°ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show status like &#39;innodb_rows_%&#39;;
+----------------------+----------+
| Variable_name        | Value    |
+----------------------+----------+
| Innodb_rows_deleted  | 0        |
| Innodb_rows_inserted | 1000902  |
| Innodb_rows_read     | 37011100 |
| Innodb_rows_updated  | 0        |
+----------------------+----------+
4 rows in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-ç»Ÿè®¡sqlçš„æŸ¥è¯¢æˆæœ¬-last-query-cost" tabindex="-1"><a class="header-anchor" href="#_3-ç»Ÿè®¡sqlçš„æŸ¥è¯¢æˆæœ¬-last-query-cost" aria-hidden="true">#</a> 3. ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/a4241b17ff5659823e4c5ce6e8adf251.png" alt="image-20220811122857202"></p><p>æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨student_infoè¡¨ä¸ºä¾‹ï¼ˆå…·ä½“åº“è¡¨åˆ›å»ºä»¥åŠç”Ÿæˆæ•°æ®è¯­å¥è¯·å‚è€ƒä¸Šä¸€ç¯‡ç« ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE \`student_info\` (
\`id\` INT( 11 ) NOT NULL AUTO_INCREMENT,
\`student_id\` INT NOT NULL ,
\`name\` VARCHAR( 20 ) DEFAULT NULL,
\`course_id\` INT NOT NULL ,
\`class_id\` INT( 11 ) DEFAULT NULL,
\`create_time\` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
PRIMARY KEY (\`id\`)
) ENGINE=INNODB AUTO_INCREMENT= 1 DEFAULT CHARSET=utf8;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘ å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ id=900001 çš„è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨èšç°‡ç´¢å¼•ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SELECT * FROM student_info WHERE id = 900001;
+--------+------------+--------+-----------+----------+---------------------+
| id     | student_id | name   | course_id | class_id | create_time         |
+--------+------------+--------+-----------+----------+---------------------+
| 900001 |     154633 | SYnwsA |     10019 |    10134 | 2022-08-08 22:33:02 |
+--------+------------+--------+-----------+----------+---------------------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå†çœ‹ä¸‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æˆæœ¬ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦æ£€ç´¢ä¸€ä¸ªé¡µå³å¯ã€‚<code>Value</code>è¡¨ç¤º I/O åŠ è½½çš„æ•°æ®é¡µçš„é¡µæ•°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW STATUS LIKE &#39;last_query_cost&#39;;
+-----------------+----------+
| Variable_name   | Value    |
+-----------------+----------+
| Last_query_cost | 1.000000 |
+-----------------+----------+
1 row in set (0.01 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¡æˆ‘ä»¬æ‰©å¤§ä¸‹æŸ¥è¯¢èŒƒå›´ï¼Œstudent_id&gt; 199900çš„å­¦ç”Ÿè®°å½•å‘¢ï¼Ÿè¿è¡Œæ—¶é—´ 0.01sï¼Œè¿™æ—¶æˆ‘ä»¬å¤§æ¦‚éœ€è¦è¿›è¡Œ 232ä¸ªé¡µçš„æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SELECT * FROM student_info WHERE student_id &gt; 199900;
+--------+------------+--------+-----------+----------+---------------------+
| id     | student_id | name   | course_id | class_id | create_time         |
+--------+------------+--------+-----------+----------+---------------------+
//...
| 523982 |     200000 | vcaUvw |     10010 |    10173 | 2022-08-08 22:32:31 |
+--------+------------+--------+-----------+----------+---------------------+
516 rows in set (0.01 sec)

mysql&gt; SHOW STATUS LIKE &#39;last_query_cost&#39;;
+-----------------+------------+
| Variable_name   | Value      |
+-----------------+------------+
| Last_query_cost | 232.459000 |
+-----------------+------------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¢æˆ‘ä»¬å†æ¬¡æ‰©å¤§èŒƒå›´ï¼Œå‡è‹¥æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ student_id &gt; 199000çš„å­¦ç”Ÿè®°å½•å‘¢ï¼Ÿè¿è¡Œæ—¶é—´ 0.02sï¼Œè¿™æ—¶æˆ‘ä»¬å¤§æ¦‚éœ€è¦è¿›è¡Œ 2279ä¸ªé¡µçš„æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SELECT * FROM student_info WHERE student_id &gt; 199000;
//...
5065 rows in set (0.02 sec)

mysql&gt; SHOW STATUS LIKE &#39;last_query_cost&#39;;
+-----------------+-------------+
| Variable_name   | Value       |
+-----------------+-------------+
| Last_query_cost | 2279.509000 |
+-----------------+-------------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œä¸Šé¢çš„æŸ¥è¯¢é¡µçš„æ•°é‡æ˜¯åˆšæ‰çš„ 10å€ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•ˆç‡å¹¶æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œå°±æ˜¯å› ä¸ºé‡‡ç”¨äº†é¡ºåºè¯»å–çš„æ–¹å¼å°†é¡µé¢ä¸€æ¬¡æ€§åŠ è½½åˆ°ç¼“å†²æ± ä¸­ï¼Œç„¶åå†è¿›è¡ŒæŸ¥æ‰¾ã€‚è™½ç„¶é¡µæ•°é‡ï¼ˆlast_query_costï¼‰å¢åŠ äº†ä¸å°‘ï¼Œä½†æ˜¯é€šè¿‡ç¼“å†²æ± çš„æœºåˆ¶ï¼Œå¹¶æ²¡æœ‰å¢åŠ å¤šå°‘æŸ¥è¯¢æ—¶é—´ã€‚</p><p>**ä½¿ç”¨åœºæ™¯ï¼š**æŸ¥è¯¢ last_query_cost å¯¹äºæ¯”è¾ƒå¼€é”€æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬æœ‰å¥½å‡ ç§æŸ¥è¯¢æ–¹å¼å¯é€‰çš„æ—¶å€™</p><blockquote><p>ğŸˆ SQLæŸ¥è¯¢æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ï¼Œä»é¡µåŠ è½½çš„è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š</p><p>ä½ç½®å†³å®šæ•ˆç‡ï¼šå¦‚æœé¡µå°±åœ¨æ•°æ®åº“ç¼“å†²æ± ä¸­ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå¦åˆ™è¿˜éœ€è¦ä»å†…å­˜æˆ–è€…ç£ç›˜ä¸­è¿›è¡Œè¯»å–ï¼Œå½“ç„¶é’ˆå¯¹å•ä¸ªé¡µçš„è¯»å–æ¥è¯´ï¼Œå¦‚æœé¡µå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¼šæ¯”åœ¨ç£ç›˜ä¸­è¯»å–æ•ˆç‡é«˜å¾ˆå¤šã€‚å³ æ•°æ®åº“ç¼“å†²æ± &gt;å†…å­˜&gt;ç£ç›˜ æ‰¹é‡å†³å®šæ•ˆç‡ï¼šå¦‚æœæˆ‘ä»¬ä»ç£ç›˜ä¸­å•ä¸€é¡µè¿›è¡Œéšæœºè¯»ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼ˆå·®ä¸å¤š10msï¼‰ï¼Œè€Œé‡‡ç”¨é¡ºåºè¯»å–çš„æ–¹å¼ï¼Œæ‰¹é‡å¯¹é¡µè¿›è¡Œè¯»å–ï¼Œå¹³å‡ä¸€é¡µçš„è¯»å–æ•ˆç‡å°±ä¼šæå‡å¾ˆå¤šï¼Œç”šè‡³è¦å¿«äºå•ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„éšæœºè¯»å–ã€‚å³é¡ºåºè¯»å–&gt;å¤§äºéšæœºè¯»å– æ‰€ä»¥è¯´ï¼Œé‡åˆ° I/O å¹¶ä¸ç”¨æ‹…å¿ƒï¼Œæ–¹æ³•æ‰¾å¯¹äº†ï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚æˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘æ•°æ®å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚æœæ˜¯ç»å¸¸ä½¿ç”¨çš„æ•°æ®å°±è¦å°½é‡æ”¾åˆ°ç¼“å†²æ± ä¸­ï¼Œå…¶æ¬¡æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨ç£ç›˜çš„ååèƒ½åŠ›ï¼Œä¸€æ¬¡æ€§æ‰¹é‡è¯»å–æ•°æ®ï¼Œè¿™æ ·å•ä¸ªé¡µçš„è¯»å–æ•ˆç‡ä¹Ÿå°±å¾—åˆ°äº†æå‡ã€‚</p><p>æ³¨ï¼šç¼“å†²æ± å’ŒæŸ¥è¯¢ç¼“å­˜å¹¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿</p></blockquote><h2 id="_4-å®šä½æ‰§è¡Œæ…¢çš„-sql-æ…¢æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_4-å®šä½æ‰§è¡Œæ…¢çš„-sql-æ…¢æŸ¥è¯¢æ—¥å¿—" aria-hidden="true">#</a> 4. å®šä½æ‰§è¡Œæ…¢çš„ SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—</h2><p><img src="`+m+`" alt="image-20220811155538530"></p><h3 id="_4-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_4-1-å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°" aria-hidden="true">#</a> 4. 1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°</h3><ol><li><strong>å¼€å¯slow_query_log</strong></li></ol><p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œä»¥åŠæ—¥å¿—çš„ä½ç½®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show variables like &#39;%slow_query_log%&#39;;
+---------------------+-----------------------------------+
| Variable_name       | Value                             |
+---------------------+-----------------------------------+
| slow_query_log      | OFF                               |
| slow_query_log_file | /var/lib/mysql/hadoop102-slow.log |
+---------------------+-----------------------------------+
2 rows in set (0.03 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹æ…¢æŸ¥è¯¢æ—¥å¿—çŠ¶æ€ä¸ºå¼€å¯ï¼Œæ³¨æ„è¿™é‡Œè¦åŠ  <code>global</code>ï¼Œå› ä¸ºå®ƒæ˜¯å…¨å±€ç³»ç»Ÿå˜é‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; set global slow_query_log=&#39;ON&#39;;
Query OK, 0 rows affected (0.02 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æŸ¥çœ‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show variables like &#39;%slow_query_log%&#39;;
+---------------------+-----------------------------------+
| Variable_name       | Value                             |
+---------------------+-----------------------------------+
| slow_query_log      | ON                                |
| slow_query_log_file | /var/lib/mysql/hadoop102-slow.log |
+---------------------+-----------------------------------+
2 rows in set (0.01 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ä¿®æ”¹long_query_timeé˜ˆå€¼</li></ol><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢çš„æ—¶é—´é˜ˆå€¼è®¾ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show variables like &#39;%long_query_time%&#39;;
+-----------------+-----------+
| Variable_name   | Value     |
+-----------------+-----------+
| long_query_time | 10.000000 |
+-----------------+-----------+
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠæ—¶é—´ç¼©çŸ­ï¼Œæ¯”å¦‚è®¾ç½®ä¸º 1 ç§’ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code># æµ‹è¯•å‘ç°ï¼šè®¾ç½®globalçš„æ–¹å¼å¯¹å½“å‰sessionçš„long_query_timeå¤±æ•ˆã€‚å¯¹æ–°è¿æ¥çš„å®¢æˆ·ç«¯æœ‰æ•ˆï¼Œæ‰€ä»¥å¯ä»¥ä¸€å¹¶æ‰§è¡Œä¸‹åˆ—è¯­å¥
mysql&gt; set global long_query_time = 1;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; set long_query_time = 1;
Query OK, 0 rows affected (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æŸ¥çœ‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show global variables like &#39;%long_query_time%&#39;;
+-----------------+----------+
| Variable_name   | Value    |
+-----------------+----------+
| long_query_time | 1.000000 |
+-----------------+----------+
1 row in set, 1 warning (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+v+`" alt="img"></p><h3 id="_4-2-æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®" tabindex="-1"><a class="header-anchor" href="#_4-2-æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®" aria-hidden="true">#</a> 4. 2 æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®</h3><p>æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘æ¡æ…¢æŸ¥è¯¢è®°å½•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW GLOBAL STATUS LIKE &#39;%Slow_queries%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-3-æ¡ˆä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_4-3-æ¡ˆä¾‹æ¼”ç¤º" aria-hidden="true">#</a> 4. 3 æ¡ˆä¾‹æ¼”ç¤º</h3><p><strong>æ­¥éª¤1. å»ºè¡¨</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE \`student\` (
\`id\` INT( 11 ) NOT NULL AUTO_INCREMENT,
\`stuno\` INT NOT NULL ,
\`name\` VARCHAR( 20 ) DEFAULT NULL,
\`age\` INT( 3 ) DEFAULT NULL,
\`classId\` INT( 11 ) DEFAULT NULL,
PRIMARY KEY (\`id\`)
) ENGINE=INNODB AUTO_INCREMENT= 1 DEFAULT CHARSET=utf8;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ­¥éª¤ 2 ï¼šè®¾ç½®å‚æ•° log_bin_trust_function_creators</strong></p><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>This function has none of DETERMINISTIC......
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>set global log_bin_trust_function_creators= 1 ;  # ä¸åŠ globalåªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æ­¥éª¤ 3 ï¼šåˆ›å»ºå‡½æ•°</strong></p><p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²ï¼šï¼ˆåŒä¸Šä¸€ç« ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER //
CREATE FUNCTION rand_string(n INT)
RETURNS VARCHAR(255) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
BEGIN
DECLARE chars_str VARCHAR(100) DEFAULT
&#39;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#39;;
DECLARE return_str VARCHAR(255) DEFAULT &#39;&#39;;
DECLARE i INT DEFAULT 0;
WHILE i &lt; n DO
   SET return_str =CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));
   SET i = i + 1;
  END WHILE;
  RETURN return_str;
END //
DELIMITER ;

#æµ‹è¯•
SELECT rand_string(10);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº§ç”Ÿéšæœºæ•°å€¼ï¼šï¼ˆåŒä¸Šä¸€ç« ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER //
CREATE FUNCTION rand_num (from_num INT ,to_num INT) RETURNS INT(11)
BEGIN 
DECLARE i INT DEFAULT 0; 
SET i = FLOOR(from_num +RAND()*(to_num - from_num+1))  ;
RETURN i; 
END //
DELIMITER ;
#æµ‹è¯•ï¼š
SELECT rand_num(10,100);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ­¥éª¤ 4 ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER //
CREATE PROCEDURE insert_stu1(  START INT , max_num INT )
BEGIN 
DECLARE i INT DEFAULT 0; 
SET autocommit = 0;   #è®¾ç½®æ‰‹åŠ¨æäº¤äº‹åŠ¡
REPEAT  #å¾ªç¯
SET i = i + 1;  #èµ‹å€¼
INSERT INTO student (stuno, NAME ,age ,classId ) VALUES
((START+i),rand_string(6),rand_num(10,100),rand_num(10,1000)); 
UNTIL i = max_num 
END REPEAT; 
COMMIT;  #æäº¤äº‹åŠ¡
END //
DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ­¥éª¤ 5 ï¼šè°ƒç”¨å­˜å‚¨è¿‡ç¨‹</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#è°ƒç”¨åˆšåˆšå†™å¥½çš„å‡½æ•°, 4000000æ¡è®°å½•,ä»100001å·å¼€å§‹
mysql&gt; CALL insert_stu1(100001,4000000);
Query OK, 0 rows affected (10 min 47.03 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…å‡ åˆ†é’Ÿå“Ÿã€‚ç»“æŸåå¯ä»¥æŸ¥è¯¢ä¸‹æ˜¯ä¸æ˜¯æ’å…¥æˆåŠŸäº†ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; select count(*) from student;
+----------+
| count(*) |
+----------+
|  4000000 |
+----------+
1 row in set (0.82 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-æµ‹è¯•åŠåˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-4-æµ‹è¯•åŠåˆ†æ" aria-hidden="true">#</a> 4. 4 æµ‹è¯•åŠåˆ†æ</h3><p><strong>1. æ‰§è¡Œä¸€ä¸‹ä¸‹é¢çš„æŸ¥è¯¢æ“ä½œï¼Œè¿›è¡Œæ…¢æŸ¥è¯¢è¯­å¥çš„æµ‹è¯•</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code># æ³¨æ„ï¼šæ­¤æ—¶long_query_timeå·²ç»è®¾ç½®ä¸º1äº†å“¦~
mysql&gt; SELECT * FROM student WHERE stuno = 3455655;
+---------+---------+--------+------+---------+
| id      | stuno   | name   | age  | classId |
+---------+---------+--------+------+---------+
| 3355654 | 3455655 | ZfCwDz |   76 |     228 |
+---------+---------+--------+------+---------+
1 row in set (1.03 sec)

mysql&gt; SELECT * FROM student WHERE name = &#39;ZfCwDz&#39;;
+---------+---------+--------+------+---------+
| id      | stuno   | name   | age  | classId |
+---------+---------+--------+------+---------+
|   32843 |  132844 | zfcWDZ |   32 |     304 |
|  889126 |  989127 | ZfCwDz |   77 |     249 |
| 2015535 | 2115536 | zfcWDZ |   36 |     459 |
| 3176527 | 3276528 | ZFcwdZ |   81 |     941 |
| 3355654 | 3455655 | ZfCwDz |   76 |     228 |
+---------+---------+--------+------+---------+
5 rows in set (1.09 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢å­¦ç”Ÿç¼–å·åˆå’Œå§“åèŠ±è´¹æ—¶é—´ éƒ½åœ¨1sä»¥ä¸Šã€‚å·²ç»è¾¾åˆ°äº†ç§’çš„æ•°é‡çº§ï¼Œè¯´æ˜ç›®å‰æŸ¥è¯¢æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹åŸå› </p><p><strong>2. å…ˆæŸ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢çš„è®°å½•</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show status like &#39;slow_queries&#39;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Slow_queries  | 2     |
+---------------+-------+
1 row in set (0.01 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ¯è¡¥å……è¯´æ˜ï¼š</p><p>åœ¨Mysqlä¸­ï¼Œé™¤äº†ä¸Šè¿°å˜é‡ï¼Œæ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—çš„è¿˜æœ‰å¦å¤–ä¸€ä¸ªå˜é‡ <code>min_examined_row_limit</code> ã€‚è¿™ä¸ªå˜é‡çš„æ„æ€æ˜¯ï¼ŒæŸ¥è¯¢<code>æ‰«æè¿‡çš„æœ€å°‘è®°å½•æ•°</code>ã€‚è¿™ä¸ªå˜é‡å’ŒæŸ¥è¯¢æ‰§è¡Œæ—¶é—´ï¼Œå…±åŒç»„æˆäº†åˆ¤åˆ«ä¸€ä¸ªæŸ¥è¯¢æ˜¯å¦æ…¢æŸ¥è¯¢çš„æ¡ä»¶ã€‚å¦‚æœæŸ¥è¯¢æ‰«æè¿‡çš„è®°å½•æ•°å¤§äºç­‰äºè¿™ä¸ªå˜é‡çš„å€¼ï¼Œå¹¶ä¸”æŸ¥è¯¢æ‰§è¡Œæ—¶é—´è¶…è¿‡ <code>long_query_time</code> çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢å°±è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚åä¹‹ï¼Œåˆ™ä¸è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚å¦å¤–ï¼Œ<code>min_examined_row_limit</code> é»˜è®¤æ˜¯ 0ï¼Œæˆ‘ä»¬ä¹Ÿä¸€èˆ¬ä¸ä¼šå»ä¿®æ”¹å®ƒã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW VARIABLES like &#39;min%&#39;;
+------------------------+-------+
| Variable_name          | Value |
+------------------------+-------+
| min_examined_row_limit | 0     |
+------------------------+-------+
1 row in set (0.02 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è¿™ä¸ªå€¼ä¸ºé»˜è®¤å€¼0æ—¶ï¼Œä¸ long_query_time=10åˆåœ¨ä¸€èµ·ï¼Œè¡¨ç¤ºåªè¦æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡10ç§’é’Ÿï¼Œå“ªæ€•ä¸€ä¸ªè®°å½•ä¹Ÿæ²¡æœ‰æ‰«æè¿‡ï¼Œéƒ½è¦è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡ä¿®æ”¹&quot;my.ini&quot;æ–‡ä»¶ï¼Œæ¥ä¿®æ”¹æŸ¥è¯¢æ—¶é•¿ï¼Œæˆ–è€…é€šè¿‡SETæŒ‡ä»¤ï¼Œç”¨SQLè¯­å¥ä¿®æ”¹<code>min_examined_row_limit</code> çš„å€¼ã€‚</p></blockquote><h3 id="_4-5-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·-mysqldumpslow" tabindex="-1"><a class="header-anchor" href="#_4-5-æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·-mysqldumpslow" aria-hidden="true">#</a> 4. 5 æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æSQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMySQLæä¾›äº†æ—¥å¿—åˆ†æå·¥å…·<code>mysqldumpslow</code>ã€‚</p>`,87),Ze={href:"https://www.cnblogs.com/-mrl/p/15770811.html%E3%80%82",target:"_blank",rel:"noopener noreferrer"},$e=d(`<p>é€šè¿‡ <code>mysqldumpslow </code>å¯ä»¥æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å¸®åŠ©</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysqldumpslow --help
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+b+'" alt="image-20221219194235219"></p><p>mysqldumpslow å‘½ä»¤çš„å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><p>-a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS</p></li><li><p><code>-s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åºï¼š</code></p><ul><li>c: è®¿é—®æ¬¡æ•°</li><li>l: é”å®šæ—¶é—´</li><li>r: è¿”å›è®°å½•</li><li><strong>t: æŸ¥è¯¢æ—¶é—´</strong></li><li>al:å¹³å‡é”å®šæ—¶é—´</li><li>ar:å¹³å‡è¿”å›è®°å½•æ•°</li><li>at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰</li><li>ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•°</li></ul></li><li><p><code>-t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®ï¼›</code></p></li><li><p><code>-g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ï¼›</code></p></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—çš„ä½ç½®</p><p><img src="'+p+`" alt="image-20221219194514648"></p><p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬æƒ³è¦æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼ŒæŸ¥çœ‹å‰äº”æ¡ SQL è¯­å¥ï¼Œè¿™æ ·å†™å³å¯ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>[root@hadoop102 mysql]# mysqldumpslow -s t -t 5 /var/lib/mysql/hadoop102-slow.log 

Reading mysql slow query log from /var/lib/mysql/hadoop102-slow.log
Count: 1  Time=283.29s (283s)  Lock=0.00s (0s)  Rows=0.0 (0), root[root]@hadoop102
  CALL insert_stu1(N,N)

Count: 1  Time=1.09s (1s)  Lock=0.00s (0s)  Rows=5.0 (5), root[root]@localhost
  SELECT * FROM student WHERE name = &#39;S&#39;

Count: 1  Time=1.03s (1s)  Lock=0.00s (0s)  Rows=1.0 (1), root[root]@localhost
  SELECT * FROM student WHERE stuno = N

Died at /usr/bin/mysqldumpslow line 162, &lt;&gt; chunk 3.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢ sql ä¸­å…·ä½“çš„æ•°å€¼ç±»éƒ½è¢«Nä»£æ›¿ï¼Œå­—ç¬¦ä¸²éƒ½è¢«ä½¿ç”¨ S ä»£æ›¿ï¼Œå¦‚æœæƒ³è¦æ˜¾ç¤ºçœŸå®çš„æ•°æ®ï¼Œå¯ä»¥åŠ ä¸Šå‚æ•° <code>-a</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>[root@hadoop102 mysql]# mysqldumpslow -a -s t -t 5 /var/lib/mysql/hadoop102-slow.log 

Reading mysql slow query log from /var/lib/mysql/hadoop102-slow.log
Count: 1  Time=283.29s (283s)  Lock=0.00s (0s)  Rows=0.0 (0), root[root]@hadoop102
  CALL insert_stu1(100001,4000000)

Count: 1  Time=1.09s (1s)  Lock=0.00s (0s)  Rows=5.0 (5), root[root]@localhost
  SELECT * FROM student WHERE name = &#39;ZfCwDz&#39;

Count: 1  Time=1.03s (1s)  Lock=0.00s (0s)  Rows=1.0 (1), root[root]@localhost
  SELECT * FROM student WHERE stuno = 3455655

Died at /usr/bin/mysqldumpslow line 162, &lt;&gt; chunk 3.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åç½—åˆ—ä¸‹å·¥ä½œä¸­å¸¸ç”¨çš„ä¸€äº›æŸ¥è¯¢ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL
mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log

#å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL
mysqldumpslow -s c -t 10 /var/lib/mysql/atguigu-slow.log

#å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥
mysqldumpslow -s t -t 10 -g &quot;left join&quot; /var/lib/mysql/atguigu-slow.log

#å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ
mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log | more
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_4-6-å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—" aria-hidden="true">#</a> 4. 6 å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>MySQL æœåŠ¡å™¨åœæ­¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p><strong>æ–¹å¼ä¸€ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p><p>ä¿®æ”¹my.cnfæˆ–my.iniæ–‡ä»¶ï¼ŒæŠŠã€mysqldã€‘ç»„ä¸‹çš„slow_query_logå€¼è®¾ç½®ä¸ºOFFï¼Œä¿®æ”¹ä¿å­˜åï¼Œå†é‡å¯MySQLæœåŠ¡ï¼Œå³å¯ç”Ÿæ•ˆã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#é…ç½®æ–‡ä»¶
[mysqld]
slow_query_log=OFF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼ŒæŠŠslow_query_logä¸€é¡¹æ³¨é‡Šæ‰ æˆ– åˆ é™¤</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>[mysqld]
#slow_query_log =OFF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯MySQLæœåŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥æŸ¥è¯¢æ…¢æ—¥å¿—åŠŸèƒ½ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;%slow%&#39;;  #æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åœ¨ç›®å½•
SHOW VARIABLES LIKE &#39;%long_query_time%&#39;;  #æŸ¥è¯¢è¶…æ—¶æ—¶é•¿
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒMySQLç³»ç»Ÿä¸­çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å…³é—­çš„ã€‚</p><p><strong>æ–¹å¼äºŒï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p><p>ä½¿ç”¨ SET è¯­å¥æ¥è®¾ç½®ã€‚</p><p>ï¼ˆ1ï¼‰åœæ­¢ MySQL æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œå…·ä½“ SQL è¯­å¥å¦‚ä¸‹ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET GLOBAL slow_query_log=off;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ï¼ˆ2ï¼‰é‡å¯MySQLæœåŠ¡ï¼Œä½¿ç”¨ SHOW è¯­å¥æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ä¿¡æ¯ï¼Œå…·ä½“æ¼”ç¤ºå¦‚ä¸‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>[root@hadoop102 mysql]# systemctl restart mysqld;
[root@hadoop102 mysql]# mysql -hlocalhost -P3306 -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \\g.
Your MySQL connection id is 10
Server version: 8.0.25 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.
mysql&gt; SHOW VARIABLES LIKE &#39;%slow%&#39;;
+---------------------------+-----------------------------------+
| Variable_name             | Value                             |
+---------------------------+-----------------------------------+
| log_slow_admin_statements | OFF                               |
| log_slow_extra            | OFF                               |
| log_slow_slave_statements | OFF                               |
| slow_launch_time          | 2                                 |
| slow_query_log            | OFF  #æ…¢æŸ¥è¯¢æ—¥å¿—å·²å…³é—­               |
| slow_query_log_file       | /var/lib/mysql/hadoop102-slow.log |
+---------------------------+-----------------------------------+
6 rows in set (0.00 sec)

mysql&gt; SHOW VARIABLES LIKE &#39;%long_query_time%&#39;;
+-----------------+-----------+
| Variable_name   | Value     |
+-----------------+-----------+
| long_query_time | 10.000000 | #å·²æ¢å¤è‡³é»˜è®¤çš„ 10s
+-----------------+-----------+
1 row in set (0.01 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_4-7-åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—" aria-hidden="true">#</a> 4. 7 åˆ é™¤ä¸æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>ä½¿ç”¨SHOWè¯­å¥æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—ä¿¡æ¯ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;
+---------------------+-----------------------------------+
| Variable_name       | Value                             |
+---------------------+-----------------------------------+
| slow_query_log      | ON                                |
| slow_query_log_file | /var/lib/mysql/hadoop102-slow.log |
+---------------------+-----------------------------------+
2 rows in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒä¼˜ç»“æŸå¯ä»¥åŠæ—¶åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—èŠ‚çœç£ç›˜ç©ºé—´å“Ÿï¼Œå½“ç„¶æ‰‹å·¥åˆ é™¤ä¹Ÿæ˜¯å¯ä»¥çš„</p><p><img src="`+g+`" alt="image-20220812163728793"></p><p>å¦‚æœè¯¯åˆ äº†ï¼Œè€Œä¸”è¿˜æ²¡æœ‰äº†å¤‡ä»½ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥é‡æ–°æ¢å¤ç”Ÿæˆå“Ÿï¼Œæ‰§è¡Œå®Œæ¯•åä¼šåœ¨æ•°æ®ç›®å½•ä¸‹é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#å…ˆè¦æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log=ON;
#æ¢å¤æ…¢æŸ¥è¯¢æ—¥å¿—
mysqladmin -uroot -p flush-logs slow
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æç¤º</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—éƒ½æ˜¯ä½¿ç”¨<code>mysqladmin -uroot -p flush-logs slow</code> å‘½ä»¤æ¥åˆ é™¤é‡å»ºçš„ã€‚ä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ï¼Œä¸€æ—¦æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—éƒ½åªå­˜åœ¨äºæ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœéœ€è¦æ—§çš„æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»äº‹å…ˆå¤‡ä»½ã€‚</p></blockquote><h2 id="_5-æŸ¥çœ‹-sql-æ‰§è¡Œæˆæœ¬-show-profile" tabindex="-1"><a class="header-anchor" href="#_5-æŸ¥çœ‹-sql-æ‰§è¡Œæˆæœ¬-show-profile" aria-hidden="true">#</a> 5. æŸ¥çœ‹ SQL æ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/22ae55b626e6e1ea54578d2b08018236.png" alt="image-20220812175708623"></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; show variables like &#39;profiling&#39;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| profiling     | OFF   | #å½“å‰æ˜¯å…³é—­çŠ¶æ€
+---------------+-------+
1 row in set (0.01 sec)

mysql&gt; set profiling = &#39;ON&#39;;#å¼€å¯
Query OK, 0 rows affected, 1 warning (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ‰§è¡Œç›¸å…³çš„æŸ¥è¯¢è¯­å¥ã€‚æ¥ç€çœ‹ä¸‹å½“å‰ä¼šè¯ä¸‹æœ‰å“ªäº›profiles</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SELECT * FROM student WHERE stuno = 3455655;
//...
mysql&gt; SELECT * FROM student WHERE name = &#39;ZfCwDz&#39;;
//...
mysql&gt; show profiles;
+----------+------------+---------------------------------------------+
| Query_ID | Duration   | Query                                       |
+----------+------------+---------------------------------------------+
|        1 | 0.00133475 | show variables like &#39;profiling&#39;             |
|        2 | 0.00021050 | SELECT * FROM student WHERE stuno = 3455655 |
|        3 | 0.00053600 | SELECT DATABASE()                           |
|        4 | 0.01693325 | show databases                              |
|        5 | 0.00375125 | show tables                                 |
|        6 | 1.75597875 | SELECT * FROM student WHERE stuno = 3455655 |
|        7 | 1.11115150 | SELECT * FROM student WHERE name = &#39;ZfCwDz&#39; |
+----------+------------+---------------------------------------------+
7 rows in set, 1 warning (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ èƒ½çœ‹åˆ°å½“å‰ä¼šè¯ä¸€å…±æœ‰7ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡æŸ¥è¯¢çš„å¼€é”€ï¼Œå¯ä»¥ä½¿ç”¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>show profile;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+_+`" alt="image-20221219195144418"></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹æŒ‡å®šçš„Query IDçš„å¼€é”€ï¼Œåªéœ€è¦åé¢è·Ÿä¸Š <code>for num</code>ã€‚ä¹Ÿå¯ä»¥æŸ¥çœ‹ä¸åŒéƒ¨åˆ†çš„å¼€é”€ï¼Œæ¯”å¦‚CPUã€block.ioç­‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code> show profile cpu,block io for query 7;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+q+'" alt="image-20221219195221387"></p><p>é€šè¿‡å¦‚æœå‘ç°ä¸Šä¸€æ¡ sql æ…¢çš„åŸå› åœ¨äºæ‰§è¡Œæ…¢ï¼ˆ<code>executing</code>å­—æ®µè€—æ—¶å¤šï¼‰ï¼Œå°±å¯ä»¥æ¥ç€ç”¨ <code>Explain</code> è¿›è¡Œåˆ†æå…·ä½“çš„ sql è¯­å¥ã€‚ç­‰åé¢æˆ‘ä»¬ä¸ºå…¶å»ºç«‹ç´¢å¼•ï¼Œå°±å¯ä»¥å¤§å¤§æé«˜æ•ˆç‡äº†</p><p><strong>ğŸ”Š show profileçš„å¸¸ç”¨æŸ¥è¯¢å‚æ•°ï¼š</strong></p><p>â‘  ALLï¼šæ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¡ BLOCK IOï¼šæ˜¾ç¤ºå— IO å¼€é”€ã€‚</p><p>â‘¢ CONTEXT SWITCHESï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</p><p>â‘£ CPUï¼šæ˜¾ç¤º CPU å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¤ IPCï¼šæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¥ MEMORYï¼šæ˜¾ç¤ºå†…å­˜å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¦ PAGE FAULTSï¼šæ˜¾ç¤ºé¡µé¢é”™è¯¯å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘§ SOURCEï¼šæ˜¾ç¤ºå’Œ Source_functionï¼ŒSource_fileï¼ŒSource_line ç›¸å…³çš„å¼€é”€ä¿¡æ¯ã€‚</p><p>â‘¨ SWAPSï¼šæ˜¾ç¤ºäº¤æ¢æ¬¡æ•°å¼€é”€ä¿¡æ¯ã€‚</p><p><strong>ğŸ¨ æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„çš„ç»“è®ºï¼š</strong></p><p>â‘  <code>Coverting Heap to MyISAM</code>ï¼šæŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œå†…å­˜ä¸å¤Ÿï¼Œæ­£åœ¨å¾€ç£ç›˜ä¸­è¿ç§»</p><p>â‘¡ <code>Creating tmp table</code>ï¼šåˆ›å»ºä¸´æ—¶è¡¨ï¼Œå…ˆæ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œç”¨å®Œå†åˆ é™¤ä¸´æ—¶è¡¨</p><p>â‘¢<code>Coping to tmp table on disk</code>ï¼šæŠŠå†…å­˜ä¸­ä¸´æ—¶è¡¨å¤åˆ¶åˆ°ç£ç›˜ä¸Šï¼Œè­¦æƒ•ï¼</p><p>â‘£<code> locked</code></p><p><mark>å¦‚æœåœ¨ show profile çš„æŸ¥è¯¢ç»“æœä¸­ï¼Œå‡ºç°äº†ä»¥ä¸Š4æ¡ç»“æœä¸­çš„ä»»ä½•ä¸€æ¡ã€‚åˆ™sql è¯­å¥éœ€è¦ä¼˜åŒ–</mark></p><p><strong>æœ€åï¼Œè¿˜éœ€è¦æ³¨æ„ï¼š</strong></p><p><code>SHOW PROFILE</code> å‘½ä»¤å°†è¢«å¼ƒç”¨ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä» <code>information_schema</code> ä¸­çš„ <code>profiling</code> æ•°æ®è¡¨è¿›è¡ŒæŸ¥çœ‹</p><h2 id="_6-åˆ†ææŸ¥è¯¢è¯­å¥-explain" tabindex="-1"><a class="header-anchor" href="#_6-åˆ†ææŸ¥è¯¢è¯­å¥-explain" aria-hidden="true">#</a> 6. åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN</h2><h3 id="_6-1-explain-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_6-1-explain-æ¦‚è¿°" aria-hidden="true">#</a> 6.1 EXPLAIN æ¦‚è¿°</h3><p><img src="'+y+'" alt="image-20220812182818655"></p>',70),es={href:"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html",target:"_blank",rel:"noopener noreferrer"},ss={href:"https://dev.mysql.com/doc/refman/8.0/en/explain-output.html",target:"_blank",rel:"noopener noreferrer"},is=d('<p><img src="'+E+'" alt="image-20220812183245510"></p><p><strong>3.ç‰ˆæœ¬æƒ…å†µ</strong></p><ul><li><p>MySQL 5.6.3ä»¥å‰åªèƒ½<code>EXPLAIN SELECT</code> ï¼›MYSQL 5.6.3ä»¥åå°±å¯ä»¥<code>EXPLAIN SELECT</code>ï¼Œ<code>UPDATE</code>ï¼Œ<code>DELETE</code></p></li><li><p>åœ¨5.7ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæƒ³è¦æ˜¾ç¤º<code>partitions</code> éœ€è¦ä½¿ç”¨<code>explain partitions</code>å‘½ä»¤ï¼›æƒ³è¦æ˜¾ç¤º<code>filtered</code> éœ€è¦ä½¿ç”¨<code>explain extended</code> å‘½ä»¤ã€‚åœ¨5.7ç‰ˆæœ¬åï¼Œé»˜è®¤explainç›´æ¥æ˜¾ç¤ºpartitionså’Œfilteredä¸­çš„ä¿¡æ¯</p></li></ul><p><img src="'+h+`" alt="image-20221219195825729"></p><p><strong>æ³¨æ„ï¼š</strong><mark>EXPLAIN ä»…ä»…æ˜¯æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œä¸ä¼šçœŸå®çš„æ‰§è¡Œ sql</mark></p><h3 id="_6-2-åŸºæœ¬è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#_6-2-åŸºæœ¬è¯­æ³•" aria-hidden="true">#</a> 6. 2 åŸºæœ¬è¯­æ³•</h3><p>EXPLAIN æˆ– DESCRIBEè¯­å¥çš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT select_options
æˆ–è€…
DESCRIBE SELECT select_options
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬æƒ³çœ‹çœ‹æŸä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’çš„è¯ï¼Œå¯ä»¥åœ¨å…·ä½“çš„æŸ¥è¯¢è¯­å¥å‰è¾¹åŠ ä¸€ä¸ªEXPLAIN ï¼Œå°±åƒè¿™æ ·ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; EXPLAIN SELECT 1 ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+f+'" alt="image-20221219195954069"></p><p><img src="'+L+'" alt="image-20220812225822122"></p><p>EXPLAIN è¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><p><img src="'+N+`" alt="image-20220812225712460"></p><p>åœ¨è¿™é‡ŒæŠŠå®ƒä»¬éƒ½åˆ—å‡ºæ¥åªæ˜¯ä¸ºäº†æè¿°ä¸€ä¸ªè½®å»“ï¼Œè®©å¤§å®¶æœ‰ä¸€ä¸ªå¤§è‡´çš„å°è±¡ã€‚</p><h3 id="_6-3-æ•°æ®å‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_6-3-æ•°æ®å‡†å¤‡" aria-hidden="true">#</a> 6. 3 æ•°æ®å‡†å¤‡</h3><p><strong>1.å»ºè¡¨</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE s1 (
    id INT AUTO_INCREMENT,
    key1 VARCHAR( 100 ),
    key2 INT,
    key3 VARCHAR( 100 ),
    key_part1 VARCHAR( 100 ),
    key_part2 VARCHAR( 100 ),
    key_part3 VARCHAR( 100 ),
    common_field VARCHAR( 100 ),
    PRIMARY KEY (id),
    INDEX idx_key1 (key1),
    UNIQUE INDEX idx_key2 (key2),
    INDEX idx_key3 (key3),
    INDEX idx_key_part(key_part1, key_part2, key_part3)
) ENGINE=INNODB CHARSET=utf8;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE s2 (
    id INT AUTO_INCREMENT,
    key1 VARCHAR( 100 ),
    key2 INT,
    key3 VARCHAR( 100 ),
    key_part1 VARCHAR( 100 ),
    key_part2 VARCHAR( 100 ),
    key_part3 VARCHAR( 100 ),
    common_field VARCHAR( 100 ),
    PRIMARY KEY (id),
    INDEX idx_key1 (key1),
    UNIQUE INDEX idx_key2 (key2),
    INDEX idx_key3 (key3),
    INDEX idx_key_part(key_part1, key_part2, key_part3)
) ENGINE=INNODB CHARSET=utf8;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨ï¼šå»ºä¸¤ä¸ªè¡¨æ–¹ä¾¿è”åˆæŸ¥è¯¢</p><p><strong>2. åˆ›å»ºå­˜å‚¨å‡½æ•°</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER 
CREATE FUNCTION rand_string1(n INT)
    RETURNS VARCHAR(255) #è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
BEGIN
DECLARE chars_str VARCHAR(100) DEFAULT &#39;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#39;;
    DECLARE return_str VARCHAR(255) DEFAULT &#39;&#39;;
    DECLARE i INT DEFAULT 0;
    WHILE i &lt; n DO
        SET return_str =CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));
        SET i = i + 1;
    END WHILE;
    RETURN return_str;
END 
DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼Œéœ€è®¾ç½®å‚æ•° <code>log_bin_trust_function_creators</code>ï¼Œå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>set global log_bin_trust_function_creators=1;   # ä¸åŠ globalåªæ˜¯å½“å‰çª—å£æœ‰æ•ˆã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>3. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</strong></p><p>åˆ›å»ºå¾€ s1 è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER //
CREATE PROCEDURE insert_s1 (IN min_num INT (10),IN max_num INT (10))
BEGIN
    DECLARE i INT DEFAULT 0;
    SET autocommit = 0;
    REPEAT
    SET i = i + 1;
    INSERT INTO s1 VALUES(
     (min_num + i),
     rand_string1(6),
     (min_num + 30 * i + 5),
     rand_string1(6),
     rand_string1(10),
     rand_string1(5),
     rand_string1(10),
     rand_string1(10));
    UNTIL i = max_num
    END REPEAT;
    COMMIT;
END //
DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºå¾€ s2 è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER //
CREATE PROCEDURE insert_s2 (IN min_num INT (10),IN max_num INT (10))
BEGIN
    DECLARE i INT DEFAULT 0;
    SET autocommit = 0;
    REPEAT
    SET i = i + 1;
    INSERT INTO s2 VALUES((min_num + i),
        rand_string1(6),
        (min_num + 30 * i + 5),
        rand_string1(6),
        rand_string1(10),
        rand_string1(5),
        rand_string1(10),
        rand_string1(10));
    UNTIL i = max_num
    END REPEAT;
    COMMIT;
END //
DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</strong></p><p>s1 è¡¨æ•°æ®çš„æ·»åŠ ï¼šåŠ å…¥ 1 ä¸‡æ¡è®°å½•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CALL insert_s1(10001,10000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>s2 è¡¨æ•°æ®çš„æ·»åŠ ï¼šåŠ å…¥ 1 ä¸‡æ¡è®°å½•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CALL insert_s2(10001,10000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-4-explainå„åˆ—ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_6-4-explainå„åˆ—ä½œç”¨" aria-hidden="true">#</a> 6. 4 EXPLAINå„åˆ—ä½œç”¨</h3><p>ä¸ºäº†è®©å¤§å®¶æœ‰æ¯”è¾ƒå¥½çš„ä½“éªŒï¼Œæˆ‘ä»¬è°ƒæ•´äº†ä¸‹<code>EXPLAIN</code>è¾“å‡ºåˆ—çš„é¡ºåºã€‚</p><h4 id="_1-table" tabindex="-1"><a class="header-anchor" href="#_1-table" aria-hidden="true">#</a> 1. table</h4><p>ä¸è®ºæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šå¤æ‚ï¼Œé‡Œè¾¹å„¿åŒ…å«äº†å¤šå°‘ä¸ªè¡¨ï¼Œåˆ°æœ€åä¹Ÿæ˜¯éœ€è¦å¯¹æ¯ä¸ªè¡¨è¿›è¡Œå•è¡¨è®¿é—®çš„ï¼Œæ‰€ä»¥MySQLè§„å®š EXPLAINè¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³• ï¼Œè¯¥æ¡è®°å½•çš„<code>tableåˆ—ä»£è¡¨ç€è¯¥è¡¨çš„è¡¨å</code>ï¼ˆæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—ï¼Œå¯èƒ½æ˜¯ç®€ç§°ï¼‰ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 INNER JOIN s2;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚ä¸‹å›¾ï¼Œä¸€å¼ è¡¨å¯¹åº”ä¸€ä¸ªè®°å½•ã€‚</p><p><img src="`+I+'" alt="image-20220812235854193"></p><h4 id="_2-id" tabindex="-1"><a class="header-anchor" href="#_2-id" aria-hidden="true">#</a> 2. id</h4><p>ä¾‹1ï¼šä¸‹é¢çš„æŸ¥è¯¢ç»“æœï¼Œä¸¤ä¸ªè®°å½•ä¼¼ä¹idéƒ½æ˜¯1.è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><img src="'+R+'" alt="image-20220813001639812"></p><p>å®é™…ä¸Šï¼Œåœ¨æŸ¥è¯¢è¯­å¥ä¸­æ¯å‡ºç°ä¸€ä¸ªSELECTå…³é”®å­—ï¼ŒMySQLå°±ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„id ï¼Œä»£è¡¨ç€ä¸€æ¬¡æŸ¥è¯¢ã€‚è¿™ä¸ªid å°±æ˜¯ <code>EXPLAIN</code>è¯­å¥çš„ç¬¬ä¸€åˆ—ã€‚</p><p>ä¾‹2ï¼šä¸‹é¢çš„æŸ¥è¯¢ä¸­åªæœ‰ä¸€ä¸ªSELECTï¼Œæ‰€ä»¥<code>EXPLAIN</code>çš„ç»“æœä¸­ä¹Ÿå°±åªæœ‰ä¸€æ¡idä¸º 1 çš„è®°å½•å–½~</p><p><img src="'+T+'" alt="image-20220813001157042"></p><p>ä¾‹3ï¼šä¸‹é¢çš„æŸ¥è¯¢æœ‰ä¸¤ä¸ªSELECTï¼Œæ‰€ä»¥<code>EXPLAIN</code>çš„ç»“æœä¸­ ä¼šæœ‰ä¸¤æ¡è®°å½•ï¼Œä¸”idåˆ†åˆ«å°±æ˜¯1å’Œ2å–½~ ã€‚å…¶ä¸­ s1è¢«ç§°ä¸ºé©±åŠ¨è¡¨ï¼Œs2è¢«ç§°ä¸º è¢«é©±åŠ¨è¡¨</p><p><img src="'+A+`" alt="image-20220813005516485"></p><p>ä¾‹4ï¼šä¸‹é¢è¿™æ¡SQLæœ‰ä¸€ä¸ªå‘ï¼Œè¯·æ³¨æ„ï¼ï¼ï¼</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 IN (SELECT key2 FROM s2 WHERE common_field = &#39;a&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸¤ä¸ªè®°å½•çš„ id éƒ½æ˜¯ 1ï¼Œå°å°çš„çœ¼ç›æ˜¯å¦å……æ»¡äº†å¤§å¤§çš„ç–‘æƒ‘ï¼Ÿ</p><p><img src="`+S+`" alt="image-20220813105713820"></p><p>è¿™æ˜¯å› ä¸ºä¼˜åŒ–å™¨ä¼šå¯¹ä¸Šé¢çš„ sql è¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶è½¬æ¢ä¸ºå¤šè¡¨è¿æ¥ï¼Œè€Œä¸æ˜¯å­æŸ¥è¯¢ã€‚å› ä¸ºå­æŸ¥è¯¢å…¶å®æ˜¯ä¸€ç§åµŒå¥—æŸ¥è¯¢çš„æƒ…å†µï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯ O(n^m)ï¼Œå…¶ä¸­ m æ˜¯åµŒå¥—çš„å±‚æ•°ï¼Œè€Œå¤šè¡¨æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n*m)</p><p>ä¾‹5ï¼šå†çœ‹çœ‹ Union è”åˆæŸ¥è¯¢çš„æƒ…å†µã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 UNION SELECT * FROM s2;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»“æœæ˜¯è¿™æ ·ï¼Œç«Ÿç„¶ä¼šå‡ºç°ä¸‰å¼ è¡¨~ Amazingï¼</p><p><img src="`+x+`" alt="image-20220813110019454"></p><p>è¿™æ˜¯å› ä¸º Union æ˜¯å–è¡¨çš„å¹¶é›†ï¼Œéœ€è¦å»ºä¸´æ—¶è¡¨è¿›è¡Œå»é‡ï¼Œå› æ­¤ä¼šæœ‰ä¸‰æ¡è®°å½•ã€‚å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ¡è®°å½•çš„ <code>Extra</code> å°±æ ‡è¯†äº†å®ƒæ˜¯ä¸€å¼ ä¸´æ—¶è¡¨å“¦ã€‚<code>ä¸´æ—¶è¡¨ id æ˜¯ Null</code>ã€‚</p><p>ä¾‹6ï¼šå†çœ‹çœ‹ Union ALLï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1  UNION ALL SELECT * FROM s2;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>äº§ç”Ÿä¸¤æ¡è®°å½•ï¼Œå› ä¸ºå®ƒä¸ä¼šå»é‡~</p><p><img src="`+k+'" alt="image-20220813110210174"></p><blockquote><p><strong>ğŸ’Œå°ç»“</strong></p><ol><li>idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œ</li><li>åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ</li><li>å…³æ³¨ç‚¹ï¼šidå·æ¯ä¸ªå·ç ï¼Œè¡¨ç¤ºä¸€è¶Ÿç‹¬ç«‹çš„æŸ¥è¯¢, ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¶Ÿæ•°è¶Šå°‘è¶Šå¥½</li></ol></blockquote><h4 id="_3-select-type" tabindex="-1"><a class="header-anchor" href="#_3-select-type" aria-hidden="true">#</a> 3. select_type</h4><p><img src="'+O+'" alt="image-20220813114910520"></p><p><img src="'+w+'" alt="image-20220813115146750"></p><p><strong>â‘ ï¼šæŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«<code>UNION</code>æˆ–è€…å­æŸ¥è¯¢çš„æŸ¥è¯¢éƒ½ç®—ä½œæ˜¯<code>SIMPLE</code>ç±»å‹</strong></p><p><img src="'+C+'" alt="image-20220813133415051"></p><p>å†çœ‹ä¸‹è¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥çœ‹åˆ° è¿æ¥æŸ¥è¯¢ä¹Ÿç®—æ˜¯<code>SIMPLE</code>ç±»å‹</p><p><img src="'+M+'" alt="image-20220813133509606"></p><p><strong>â‘¡ï¼šUnion è”åˆæŸ¥è¯¢ã€‚å…¶å·¦è¾¹çš„æŸ¥è¯¢æ˜¯ <code>Primary</code>ï¼Œå³è¾¹çš„æŸ¥è¯¢ç±»å‹æ˜¯ <code>Union</code>ï¼Œå»é‡çš„ä¸´æ—¶è¡¨æŸ¥è¯¢ç±»å‹æ˜¯ï¼š <code>Union Result</code></strong></p><ul><li>å¯¹äºåŒ…å«<code>UNION</code>æˆ–è€…<code>UNION ALL</code>çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå®ƒæ˜¯ç”±å‡ ä¸ªå°æŸ¥è¯¢ç»„æˆçš„ï¼Œå…¶ä¸­é™¤äº†æœ€å·¦è¾¹çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å€¼å°±æ˜¯<code>PRIMARY</code>ï¼Œå…¶ä½™çš„å°æŸ¥è¯¢çš„<code>select_type</code>å€¼å°±æ˜¯<code>UNION</code></li><li><code>MySQL</code>é€‰æ‹©ä½¿ç”¨ä¸´æ—¶è¡¨æ¥å®Œæˆ<code>UNION</code>æŸ¥è¯¢çš„å»é‡å·¥ä½œï¼Œé’ˆå¯¹è¯¥ä¸´æ—¶è¡¨çš„æŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>UNION RESULT</code></li><li>å¯¹åº”å­æŸ¥è¯¢çš„å¤§æŸ¥è¯¢æ¥è¯´ï¼Œå­æŸ¥è¯¢æ˜¯å¤–è¾¹çš„é‚£ä¸ªæ˜¯<code>PRIMARY</code></li></ul><p><img src="'+U+'" alt="image-20220813133840236"></p><p><img src="'+P+'" alt="image-20220813134118038"></p><p><strong>â‘¢ï¼šä¸ä¼šè¢«ä¼˜åŒ–æˆå¤šè¡¨è¿æ¥çš„å­æŸ¥è¯¢</strong></p><p>å¦‚æœåŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸èƒ½å¤Ÿè½¬ä¸ºå¤šè¡¨è¿æ¥çš„å½¢å¼(ä¹Ÿå°±æ˜¯ä¸ä¼šè¢«ä¼˜åŒ–å™¨è¿›è¡Œè‡ªåŠ¨çš„ä¼˜åŒ–)ï¼Œå¹¶ä¸”è¯¥å­æŸ¥è¯¢æ˜¯ä¸ç›¸å…³çš„å­æŸ¥è¯¢</p><p>è¯¥å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ª<code>SELECT</code>å…³é”®å­—ä»£è¡¨çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>SUBQUERY</code>ã€‚ä¹Ÿå°±æ˜¯å¤–å±‚æŸ¥è¯¢æ˜¯ <code>Primary</code>ï¼Œå†…å±‚æŸ¥è¯¢æ˜¯ <code>SUBQUERY</code></p><p><img src="'+F+'" alt="image-20220813134931380"></p><p>å¦‚æœå­æŸ¥è¯¢ä¸èƒ½è¢«è½¬æ¢ä¸ºå¤šè¡¨è¿æ¥çš„å½¢å¼ï¼Œå¹¶ä¸”è¯¥å­æŸ¥è¯¢æ˜¯ç›¸å…³å­æŸ¥è¯¢ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢åœ¨å†…éƒ¨å­æŸ¥è¯¢ä½¿ç”¨äº†å¤–éƒ¨çš„è¡¨ã€‚åˆ™è¯¥å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ª<code>SELECT</code>å…³é”®å­—ä»£è¡¨çš„é‚£ä¸ªæŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>DEPENDENT SUBQUERY</code>ã€‚ å¤–å±‚æŸ¥è¯¢æ˜¯<code>Primary</code>ï¼Œå†…å±‚æŸ¥è¯¢æ˜¯<code>DEPENDENT SUBQUERY</code></p><p><img src="'+D+'" alt="image-20220813135056579"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>DEPENDENT SUBQUERY</code> çš„æŸ¥è¯¢è¯­å¥å¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œå› ä¸ºå†…å±‚æŸ¥è¯¢ä¾èµ–äºå¤–å±‚çš„æŸ¥è¯¢ï¼Œå› æ­¤å¯èƒ½ä¼šæ˜¯å¤–å±‚ä¼ ä¸€ä¸ªå€¼ï¼Œå†…å±‚å°±æ‰§è¡Œä¸€æ¬¡çš„æ¨¡å¼ã€‚</p><blockquote><p>å­æŸ¥è¯¢éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼Œå³é‡‡ç”¨å¾ªç¯çš„æ–¹å¼ï¼Œå…ˆä»å¤–éƒ¨æŸ¥è¯¢å¼€å§‹ï¼Œæ¯æ¬¡éƒ½ä¼ å…¥å­æŸ¥è¯¢è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åå†å°†ç»“æœåé¦ˆç»™å¤–éƒ¨ï¼Œè¿™ç§åµŒå¥—çš„æ‰§è¡Œæ–¹å¼å°±ç§°ä¸ºç›¸å…³å­æŸ¥è¯¢ã€‚</p><p>å­æŸ¥è¯¢ä»æ•°æ®è¡¨ä¸­æŸ¥è¯¢äº†æ•°æ®ç»“æœï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ç»“æœåªæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè¿™ä¸ªæ•°æ®ç»“æœä½œä¸ºä¸»æŸ¥è¯¢çš„æ¡ ä»¶è¿›è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆè¿™æ ·çš„å­æŸ¥è¯¢å«åšä¸ç›¸å…³å­æŸ¥è¯¢ã€‚</p></blockquote><p><strong>â‘£ï¼šåŒ…å«<code>UNION</code>æˆ–è€…<code>UNION ALL</code>çš„å­æŸ¥è¯¢</strong></p><p>åœ¨åŒ…å« <code>Union</code>æˆ–è€… <code>Union All</code> çš„å­æŸ¥è¯¢ sql ä¸­ï¼Œå¦‚æœå„ä¸ªå°æŸ¥è¯¢éƒ½ä¾èµ–äºå¤–æŸ¥è¯¢ï¼Œé‚£ä¹ˆé™¤äº†æœ€å·¦è¾¹çš„å°æŸ¥è¯¢å¤–ï¼Œå„ä¸ªå°æŸ¥è¯¢çš„ç±»å‹éƒ½æ˜¯ <code>DEPENDENT UNION</code></p><p><img src="'+H+'" alt="image-20220813145005814"></p><p>å¤–æŸ¥è¯¢æ˜¯ <code>Primary</code>ï¼Œæœ€å·¦è¾¹çš„å­æŸ¥è¯¢æ˜¯ <code>DEPENDENT SUBQUERY</code>ï¼Œåé¢çš„å­æŸ¥è¯¢æ˜¯ <code>DEPENDENT UNION</code>ï¼Œä¸´æ—¶å»é‡è¡¨çš„ç±»å‹æ˜¯ <code>Union Result</code>ã€‚è¿™é‡Œå¤§å®¶å¯èƒ½è¦å›°æƒ‘ï¼Œç¬¬ä¸€ä¸ªå­æŸ¥è¯¢ä¸­ä¹Ÿæ²¡æœ‰çœ‹åˆ°ä¾èµ– s1 å•Šã€‚è¿™å…¶å®ä¹Ÿæ˜¯ä¼˜åŒ–å™¨ä¼šåœ¨æ‰§è¡Œæ—¶è¿›è¡Œä¼˜åŒ–ï¼Œå°† <code>IN</code> æ”¹æˆ <code>Exist</code>ï¼Œå¹¶ä¸”æŠŠå¤–éƒ¨çš„è¡¨ç§»åˆ°å†…éƒ¨å»ã€‚è¿™é‡Œæˆ‘ä»¬äº†è§£å°±è¡Œï¼Œä»¥åä¼šæœ‰æ–‡ç« ç»™å¤§å®¶ä»‹ç»ä¼˜åŒ–å™¨çš„ã€‚</p><p><strong>â‘¤ï¼šå…³äºæ´¾ç”Ÿè¡¨çš„å­æŸ¥è¯¢</strong></p><p>å¯¹äºåŒ…å«<code>æ´¾ç”Ÿè¡¨</code>çš„æŸ¥è¯¢ï¼Œè¯¥æ´¾ç”Ÿè¡¨å¯¹åº”çš„å­æŸ¥è¯¢çš„<code>select_type</code>å°±æ˜¯<code>DERIVED</code></p><p><img src="'+W+'" alt="image-20220813145348553"></p><p><strong>â‘¥ï¼šå­æŸ¥è¯¢çš„ç‰©åŒ–åä¸å¤–å±‚è¿æ¥æŸ¥è¯¢</strong></p><p>å½“ä¼˜åŒ–å™¨åœ¨æ‰§è¡Œå­æŸ¥è¯¢æ—¶é€‰æ‹©æŠŠå­æŸ¥è¯¢ä¼˜åŒ–æˆä¸ºä¸€å¼ ç‰©åŒ–è¡¨ï¼Œä¸å¤–å±‚æŸ¥è¯¢è¿›è¡Œè¿æ¥æŸ¥è¯¢æ—¶ã€‚</p><p><img src="'+X+'" alt="image-20220813150059254"></p><p>ä»ä¸‹å¾€ä¸Šçœ‹ï¼Œå­æŸ¥è¯¢çš„æŸ¥è¯¢ç±»å‹æ˜¯ <code>MATERIALIZED</code>ï¼›ç‰©åŒ–è¿‡ç¨‹æ˜¯åŸºäº id ä¸º 2 çš„æŸ¥è¯¢ç»“æœè¡¨è¿›è¡Œçš„ï¼Œå…¶ table æ˜¯ <code>subquery</code> 2ï¼ŒæŸ¥è¯¢ç±»å‹æ˜¯ <code>SIMPLE</code>ï¼Œè€Œå¤–å±‚ä¹Ÿç›¸å½“äºæ˜¯ä¸å›ºå®šçš„ç›´æ¥å€¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå…¶ç±»å‹ä¹Ÿæ˜¯ <code>SIMPLE</code></p><blockquote><p>ä¸Šé¢çš„ä»‹ç»éƒ½æ˜¯ä¸€äº›åŸºæœ¬çš„æƒ…å†µï¼Œè¿˜æ²¡æœ‰çœŸæ­£çš„ä»‹ç»ä¸ç´¢å¼•ç›¸å…³çš„æƒ…å†µå“¦ã€‚è§‰å¾—æ˜¯ä¸æ˜¯æ™•æ™•çš„äº†ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªè¡¨æ ¼è¿›è¡Œä¸‹æ€»ç»“å§</p></blockquote><h4 id="_4-partitions-å¯ç•¥" tabindex="-1"><a class="header-anchor" href="#_4-partitions-å¯ç•¥" aria-hidden="true">#</a> 4. partitions (å¯ç•¥)</h4><p>ä»£è¡¨åˆ†åŒºè¡¨ä¸­çš„å‘½ä¸­æƒ…å†µï¼Œéåˆ†åŒºè¡¨ï¼Œè¯¥é¡¹ä¸º <code>NULL</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’çš„<code>partitions</code> åˆ—çš„å€¼éƒ½æ˜¯<code>NULL</code></p>',98),ns={href:"https://dev.mysql.com/doc/refman/8.0/en/alter-table-partition-operations.html",target:"_blank",rel:"noopener noreferrer"},ds=d(`<p>å¦‚æœæƒ³è¯¦ç»†äº†è§£ï¼Œå¯ä»¥å¦‚ä¸‹æ–¹å¼æµ‹è¯•ã€‚åˆ›å»ºåˆ†åŒºè¡¨ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºåˆ†åŒºè¡¨ï¼Œ
-- æŒ‰ç…§idåˆ†åŒºï¼Œid&lt;100 p0åˆ†åŒºï¼Œå…¶ä»–p1åˆ†åŒº
CREATE TABLE user_partitions (id INT auto_increment,
    NAME VARCHAR(12),PRIMARY KEY(id))
    PARTITION BY RANGE(id)(
    PARTITION p0 VALUES less than(100),
    PARTITION p1 VALUES less than MAXVALUE
 );
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥è¯¢idå¤§äº 200 ï¼ˆ 200 &gt; 100 ï¼Œp 1 åˆ†åŒºï¼‰çš„è®°å½•ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œpartitionsæ˜¯p 1 ï¼Œç¬¦åˆæˆ‘ä»¬çš„åˆ†åŒºè§„åˆ™</p><p><img src="`+Q+`" alt="image-20220813151056438"></p><h4 id="_5-type-â˜†" tabindex="-1"><a class="header-anchor" href="#_5-type-â˜†" aria-hidden="true">#</a> 5. type â˜†</h4><p><img src="https://img-blog.csdnimg.cn/img_convert/7c4a44543222a55b2b32b0f6bdbe7e80.png" alt="image-20220813152916930"></p><p>å®Œæ•´çš„è®¿é—®æ–¹æ³•å¦‚ä¸‹ï¼š <code>system </code>ã€<code>const</code>ã€<code>eq_ref </code>ã€<code>ref </code>ã€<code>fulltext</code>ã€<code>ref_or_null</code>ã€<code>index_merge</code>ã€<code>unique_subquery</code>ã€<code>index_subquery</code>ã€ <code>range</code>ã€<code>index</code>ã€<code>ALL</code>ã€‚</p><p>æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p><p><strong>1ï¸âƒ£system</strong></p><p>å½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”è¯¥è¡¨ä¸­å­˜å‚¨å¼•æ“ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚ MYISAMï¼ŒMemoryï¼Œé‚£ä¹ˆå…¶è®¿é—®æ–¹æ³•å°±æ˜¯<code>System</code>ã€‚è¿™ç§æ–¹å¼å‡ ä¹æ˜¯æ€§èƒ½æœ€é«˜çš„ï¼Œå½“ç„¶æˆ‘ä»¬å‡ ä¹ç”¨ä¸ä¸Šã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE t(i int) Engine=MyISAM;#åˆ›å»ºè¡¨
INSERT INTO t VALUES(1);# æ’å…¥ç¬¬ä¸€æ¡è®°å½•
EXPLAIN SELECT * FROM t;# æŸ¥çœ‹æ€§èƒ½
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+V+'" alt="image-20220813161234015"></p><p>ä½†å‡¡æˆ‘ä»¬å†æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå…¶è®¿é—®æ–¹å¼å°±å˜æˆäº†æ€§èƒ½æœ€å·®çš„å…¨è¡¨æ‰«æ <code>ALL</code>ã€‚</p><p><img src="'+B+'" alt="image-20220813161324653"></p><p>å¦‚æœå­˜å‚¨å¼•æ“æ˜¯InnoDBï¼Œå³ä½¿åªæœ‰ä¸€æ¡æ•°æ®ï¼Œå…¶è®¿é—®æ–¹å¼ä¹Ÿæ˜¯ALLï¼Œè¿™æ˜¯å› ä¸º InnnoDB è®¿é—®æ•°æ®ä¸æ˜¯ç²¾ç¡®çš„</p><p><img src="'+Y+`" alt="image-20220813161518641"></p><p><strong>2ï¸âƒ£Const</strong></p><p>å½“æˆ‘ä»¬æ ¹æ®ä¸»é”®æˆ–è€…å”¯ä¸€çš„äºŒçº§ç´¢å¼•ï¼Œä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ <code>const</code>ã€‚è¿™ä¸ªè®¿é—®æ–¹å¼çš„æ•ˆç‡ä½äº <code>system</code>ï¼Œä½†ä¹Ÿæ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</p><p>æ¯”å¦‚å¯¹ä¸»é”®ä¸å¸¸æ•°åŒ¹é…ï¼Œè¿›è¡Œç­‰å€¼æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE id = 10005;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+z+`" alt="image-20220813161700890"></p><p>æ¯”å¦‚å¯¹Uniqueæ ‡è¯†çš„å”¯ä¸€äºŒçº§ç´¢å¼•key2ä¸å¸¸æ•°åŒ¹é…ï¼Œè¿›è¡Œç­‰å€¼æŸ¥è¯¢ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key2 = 10066;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+G+'" alt="image-20220813163815258"></p><p>å½“æˆ‘ä»¬æŠŠwhereåé¢çš„å…³é”®å­—æ”¹æˆkey3 æ™®é€šç´¢å¼•æ—¶ï¼Œç”±äºkey3çš„å­—æ®µå€¼æ˜¯å¯é‡å¤çš„ã€‚typeç±»å‹å°±å˜æˆäº† <code>All</code>ï¼Œå…¨è¡¨æŸ¥è¯¢</p><p><img src="'+J+'" alt="image-20220813164458327"></p><p>æ³¨æ„ï¼šæ­¤æ—¶å¯èƒ½æœ‰ç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½æ³¨æ„åˆ°æˆ‘ä»¬çš„key3ä¸æ˜¯ä¹Ÿæœ‰ç´¢å¼•<code>idx_key3</code>ï¼Œæ€§èƒ½å†æŸ¥ä¹Ÿä¸è‡³äºå…¨è¡¨æŸ¥è¯¢å§~ ä½†æ˜¯å¿˜è®°äº†ä¸€ä¸ªç»†èŠ‚ï¼Œkey3æœ¬èº«æ˜¯varcharç±»å‹çš„ï¼Œ <code>key3 = 10066</code>ä¼šè¿›è¡Œä¸€ä¸ªéšå¼ç±»å‹è½¬æ¢ï¼Œä»è€Œä¼šå¯¼è‡´ ç´¢å¼•å¤±æ•ˆï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° <code>key</code>åˆ—å¯¹åº”çš„ä¸ºç©ºã€‚</p><p>å½“ä¿®æ”¹æˆ<code>key3 = 10066</code>åï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="'+K+`" alt="image-20220813172536786"></p><p><strong>3ï¸âƒ£eq_ref</strong></p><p>å†è¿›è¡Œ<strong>è¿æ¥æŸ¥è¯¢</strong>æ—¶ï¼Œå¦‚æœ<strong>è¢«é©±åŠ¨è¡¨</strong>æ˜¯é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œé‚£ä¹ˆè¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹å¼æ˜¯ <code>eq_ref</code>ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§æ€§èƒ½å¾ˆä¸é”™çš„æ–¹å¼ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.id = s2.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šé¢è¿æ¥æŸ¥è¯¢è¯­å¥ï¼Œå¯¹äºé©±åŠ¨è¡¨æ¥è¯´ï¼Œå°±æ˜¯å¯¹s1å…¨è¡¨è¿›è¡Œæ‰«æï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå› æ­¤å…¶<code>type</code>æ˜¯<code>All</code>,å¯¹è¢«é©±åŠ¨è¡¨æ¥è¯´ï¼Œç›¸äºç›´æ¥è®¿é—®é©±åŠ¨è¡¨æŸ¥è¯¢åˆ°çš„æ•°æ®è¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œå› æ­¤å…¶è®¿é—®æ–¹å¼æ˜¯<code>eq_ref</code></p><p><img src="`+j+`" alt="image-20220813173413307"></p><p><strong>4ï¸âƒ£ref</strong></p><p>å½“ä½¿ç”¨æ™®é€šçš„äºŒçº§ç´¢å¼•ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œtype æ˜¯ <code>ref</code>ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Z+`" alt="image-20220813173618072"></p><p>ä¸‹é¢è€ƒè€ƒä½ ã€‚ä»¥ä¸‹ sql çš„å¼•ç”¨ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key3 = 10066;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>çœ‹çœ‹ç­”æ¡ˆã€‚ä½ æ˜¯ä¸æ˜¯çŒœé”™äº†ã€‚æ˜¯ <code>All</code>ã€‚è¿™æ˜¯å› ä¸º key3 çš„å­—æ®µ varchar ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå¸¸é‡å€¼æ˜¯æ•´å½¢ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å‡½æ•°è¿›è¡Œéšå¼çš„ç±»å‹è½¬æ¢ï¼Œä¸€æ—¦ä½¿ç”¨å‡½æ•°ï¼Œç´¢å¼•å°±å¤±æ•ˆäº†ï¼Œå› æ­¤è®¿é—®ç±»å‹å˜æˆäº†å…¨è¡¨æ‰«æ <code>All</code></p><p><img src="`+$+'" alt="image-20220813173814439"></p><p>å½“æˆ‘ä»¬å¸¸é‡ä½¿ç”¨å¯¹åº”çš„ç±»å‹ï¼Œå°±æ˜¯æœŸæœ›çš„<code>ref</code>è®¿é—®ç±»å‹äº†</p><p><img src="'+ee+`" alt="image-20220813173912091"></p><p><strong>5ï¸âƒ£ref_or_null</strong></p><p>å½“ä½¿ç”¨æ™®é€šçš„äºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå½“ç´¢å¼•å€¼å¯ä»¥æ˜¯ Null æ—¶ï¼Œtype æ˜¯ <code>ref_or_null</code>ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39; OR key1 IS NULL;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+se+`" alt="image-20220813174556607"></p><p><strong>6ï¸âƒ£index_merge</strong></p><p>å½“è¿›è¡Œå•è¡¨è®¿é—®æ—¶ï¼Œå¦‚æœå¤šä¸ªæŸ¥è¯¢å­—æ®µåˆ†åˆ«å»ºç«‹äº†å•åˆ—ç´¢å¼•ï¼Œä½¿ç”¨ OR è¿æ¥ï¼Œå…¶è®¿é—®ç±»å‹æ˜¯ <code>index_merge</code>ã€‚åŒæ—¶è¿˜å¯ä»¥çœ‹åˆ° <code>key </code>è¿™ä¸€å­—æ®µï¼Œæ˜¯ä½¿ç”¨äº†å¤šä¸ªç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39; OR key3 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ie+`" alt="image-20220813174718756"></p><p>çŒœçŒœä¸‹é¢ sql çš„å¼•ç”¨ç±»å‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39; AND key3 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>çŒœå¯¹äº†å—ï¼Ÿç­”æ¡ˆæ˜¯ <code>ref</code>ï¼Œè¿™æ˜¯å› ä¸ºç”¨ AND è¿æ¥ä¸¤ä¸ªæŸ¥è¯¢æ—¶ï¼Œå®é™…ä¸Šåªä½¿ç”¨äº† key1 çš„ç´¢å¼•ã€‚</p><p><img src="`+ne+`" alt="image-20220813174912860"></p><p><strong>7ï¸âƒ£unique_subquery</strong></p><p>é’ˆå¯¹ä¸€äº›åŒ…å« <code>IN</code> çš„ å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¦‚æœä¼˜åŒ–å™¨å†³å®šå°† IN å­æŸ¥è¯¢ä¼˜åŒ–ä¸º EXIST å­æŸ¥è¯¢ï¼Œè€Œä¸”å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ä¸»é”®è¿›è¡Œç­‰å€¼åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆè¯¥å­æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’çš„ <code>type </code>å°±æ˜¯ <code>unique_subquery</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key2 IN (SELECT id FROM s2 where s1.key1 = s2.key1) OR key3 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+de+`" alt="image-20220813182322867"></p><p><strong>8ï¸âƒ£range</strong></p><p>å¦‚æœä½¿ç”¨ç´¢å¼•è·å–æŸäº›<code>èŒƒå›´åŒºé—´</code>çš„è®°å½•ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä½¿ç”¨åˆ°<code>range</code>è®¿é—®æ–¹æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 IN (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;);
EXPLAIN SELECT * FROM s1 WHERE key1 &gt; &#39;a&#39; AND key1 &lt; &#39;b&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+le+`" alt="image-20220813182743852"></p><p><strong>9ï¸âƒ£index</strong></p><p>å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†æ˜¯éœ€è¦æ‰«æçš„å…¨éƒ¨çš„ç´¢å¼•è®°å½•æ—¶ï¼Œè¯¥è¡¨çš„è®¿é—®æ–¹å¼å°±æ˜¯ <code>index</code>ã€‚ç´¢å¼•è¦†ç›–åé¢æ–‡ç« ä»‹ç»ä¼˜åŒ–å™¨æ—¶ä¼šè¯¦ç»†ä»‹ç»ï¼Œä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œå…ˆç®€å•ä»‹ç»å¦‚ä¸‹ã€‚æ¯”å¦‚ä¸‹é¢ sql è¯­å¥ä¸­ï¼Œkey_part2 ï¼Œkey_part2 éƒ½å±äºè”åˆç´¢å¼• <code>idx_key_part(key_part1, key_part2, key_part3)</code> çš„ä¸€éƒ¨åˆ†ï¼Œ<mark>åœ¨æŸ¥æ‰¾æ•°æ®æ—¶å¯ä»¥ç”¨ä¸Šè¿™ä¸ªè”åˆç´¢å¼•ï¼Œè€Œä¸ç”¨è¿›è¡Œå›è¡¨æ“ä½œ</mark>ï¼Œè¿™ç§æƒ…å†µå³<code>ç´¢å¼•è¦†ç›–</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT key_part2 FROM s1 WHERE key_part2 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ae+`" alt="image-20220813183057913"></p><p><strong>1ï¸âƒ£0ï¸âƒ£ALL</strong></p><p>æœ€ç†Ÿæ‚‰çš„å…¨è¡¨æ‰«æ <code>ALL</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+re+'" alt="image-20220813183153914"></p><blockquote><p>â¤æ¸©é¦¨æç¤ºï¼šè¿™é‡Œå¾ˆå¤šå°ä¼™ä¼´ä¼šè§‰å¾—è®°ä¸ä½ï¼Œå…¶å®æ‚¨å¯ä»¥æ”¶è—è¿™ç¯‡åšå®¢ï¼Œæ‰§è¡Œ EXPLAIN æ—¶å¯¹åº”ç»“æœï¼Œåå‘æŸ¥æ‰¾åšæ–‡å¯¹åº”å†…å®¹ï¼Œæ¯•ç«Ÿå’±ä»¬åªéœ€è¦èƒ½å¤Ÿè¯»æ‡‚æ€§èƒ½åˆ†æçš„ç»“æœ</p></blockquote><p>å°ç»“</p><ul><li><p>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯ï¼š system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæå–å‡ºæ¥ï¼ˆè§ç»¿è‰²éƒ¨åˆ†ï¼‰</p></li><li><p>SQL æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯ ref çº§åˆ«ï¼Œæœ€å¥½æ˜¯ consts çº§åˆ«ï¼ˆé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¦æ±‚ï¼‰</p></li></ul><h4 id="_6-possible-keyså’Œkey" tabindex="-1"><a class="header-anchor" href="#_6-possible-keyså’Œkey" aria-hidden="true">#</a> 6. possible_keyså’Œkey</h4><p><img src="'+ce+`" alt="image-20220813225540107"></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 &gt; &#39;z&#39; AND key3 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+te+'" alt="image-20220813225634984"></p><p>å¯¹åº”ä¼˜åŒ–å™¨æ¥è¯´ï¼Œå¯ä»¥é€‰æ‹©çš„ <code>possible_keys</code> è¶Šå°‘è¶Šå¥½ï¼Œå› ä¸ºé€‰é¡¹è¶Šå¤šï¼Œè¿›è¡Œè¿‡æ»¤èŠ±çš„æ—¶é—´ä¹Ÿå°±å¯¹åº”æ›´å¤šã€‚å¦å¤–ï¼Œä¼˜åŒ–å™¨ä¼šå¯¹å„ä¸ªç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ•ˆç‡è¿›è¡Œè¯„ä¼°ï¼Œä»¥æ­¤æ¥é€‰æ‹©å®é™…ä½¿ç”¨çš„ <code>key</code>ã€‚è€Œä¸”ç”±äºä¼˜åŒ–å™¨ä¼šå¯¹ sql è¿›è¡Œä¼˜åŒ–ï¼Œå®Œå…¨å¯èƒ½ä¼šå‡ºç° <code>possible_keys</code> æ˜¯ nullï¼Œä½†æ˜¯ <code>key</code> ä¸ä¸º null çš„æƒ…å†µ</p><h4 id="_7-key-len-â˜†" tabindex="-1"><a class="header-anchor" href="#_7-key-len-â˜†" aria-hidden="true">#</a> 7. key_len â˜†</h4><p>å®é™…ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚å¯ä»¥å¸®åŠ©ä½ æ£€æŸ¥æ˜¯å¦å……åˆ†åˆ©ç”¨äº†ç´¢å¼•ï¼Œä¸»è¦é’ˆå¯¹è”åˆç´¢å¼•å…·æœ‰ä¸€å®šçš„å‚è€ƒï¼Œå¯¹åŒä¸€ç´¢å¼•æ¥è¯´ï¼Œkey_len å€¼è¶Šå¤§è¶Šå¥½ï¼ˆä¸è‡ªå·±æ¯”è¾ƒï¼Œåé¢å°†è§£é‡Šï¼‰ã€‚</p><p><strong>â‘  ä¸‹é¢SQLæ‰§è¡Œç»“æœæ˜¯ 4ï¼Œè¿™ä¸ªç»“æœæ€ä¹ˆç®—å‡ºæ¥çš„å‘¢ï¼Ÿ</strong></p><p><img src="'+oe+`" alt="image-20220813230641143"></p><p>è¿™æ˜¯å› ä¸ºä½¿ç”¨çš„æ˜¯ä¸»é”® id ä½œä¸ºç´¢å¼•ï¼Œå…¶ç±»å‹æ˜¯ intï¼Œå  4 ä¸ªå­—èŠ‚</p><p><strong>â‘¡ å†æ¥çŒœçŒœä¸‹é¢çš„ key_len æ˜¯å¤šå°‘~</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key2 = 10126;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»€ä¹ˆï¼Ÿä½ çŒœçš„æ˜¯ 4ï¼Œè€Œç­”æ¡ˆæ˜¯ 5~</p><p><img src="`+ue+`" alt="image-20220813230839120"></p><p>è¿™æ˜¯å› ä¸ºè™½ç„¶ key2 ä¹Ÿæ˜¯ int ç±»å‹ï¼Œä½†æ˜¯å®ƒè¢« unique ä¿®é¥°ï¼Œå¹¶æ²¡æœ‰æ ‡è¯†éç©ºï¼ˆè€Œä¸»é”®éƒ½æ˜¯éç©ºçš„ï¼‰ï¼Œå› æ­¤åŠ ä¸Šç©ºå€¼æ ‡è®°ï¼Œä¸€å…±æ˜¯5å­—èŠ‚</p><p><strong>â‘¢ å­—ç¬¦ç±»å‹çš„ç´¢å¼•é•¿åº¦ä¸ºå¤šå°‘å‘¢</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code> EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+me+`" alt="image-20220813231154852"></p><p>ç­”æ¡ˆæ˜¯ 303ï¼Œå› ä¸ºç±»å‹æ˜¯ varchar(100)ï¼Œ100 ä¸ªå­—ç¬¦ï¼Œutf-8 æ¯ä¸ªå­—ç¬¦å  3 ä¸ªå­—èŠ‚ï¼Œå…± 300 ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šå˜é•¿åˆ—è¡¨ 2 ä¸ªå­—èŠ‚ä¸ä¸€ä¸ªç©ºå€¼æ ‡è¯†å ä¸€ä¸ªå­—èŠ‚ï¼Œå…± 303 å­—èŠ‚ã€‚</p><p><strong>â‘£ çœ‹çœ‹è”åˆç´¢å¼•çš„æƒ…å†µ</strong></p><ul><li>çœ‹ä¸‹é¢çš„è”åˆç´¢å¼•ï¼Œkey_lenè¿˜æ˜¯303ï¼Œä¸éœ€è¦è§£é‡Šäº†å§</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key_part1 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ve+`" alt="image-20220813231414814"></p><ul><li>å†çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè”åˆç´¢å¼•ï¼Œå…¶ç»“æœæ˜¯ 606</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key_part1 = &#39;a&#39; AND key_part2 = &#39;b&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+be+`" alt="image-20220813231505907"></p><p>è¿™ä¸ªæŸ¥è¯¢çš„ key-len æ¯”ä¸Šé¢çš„æŸ¥è¯¢å¤§ï¼Œæ€§èƒ½å°±æ¯”ä¸Šé¢çš„å¥½ï¼Œæ€ä¹ˆç†è§£å‘¢ï¼Ÿå…¶å®åªè¦ä½ çœ‹è¿‡æˆ‘ä¹‹å‰ä»‹ç»B+æ ‘çš„æ–‡ç« å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚å› ä¸ºåœ¨ç›®å½•é¡µæˆ‘é™¤äº†è€ƒè™‘ key_part1 ï¼Œè¿˜ä¼šè€ƒè™‘ key_part2ï¼Œå®šä½åˆ°çš„æ•°æ®å°±æ›´åŠ ç²¾å‡†ï¼ŒèŒƒå›´æ›´å°ï¼Œéœ€è¦åŠ è½½ I/O çš„æ•°æ®é¡µæ•°é‡å°±ä¼šæ›´å°‘ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æ€§èƒ½å°±æ¯”è¾ƒå¥½å•Š~</p><ul><li>çŒœçŒœä¸‹é¢çš„ sql æ‰§è¡Œå key_len æ˜¯å¤šå°‘</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key_part3 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+pe+`" alt="image-20220813231734678"></p><p>æ˜¯ç©ºå“¦ï¼Œå› ä¸ºéƒ½ä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸€ç›´åœ¨æçš„<strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»çš„ã€‚</p><p><strong>ğŸ“šç»ƒä¹ ï¼škey_lençš„é•¿åº¦è®¡ç®—å…¬å¼ï¼š</strong></p><ul><li>varchar(10)å˜é•¿å­—æ®µä¸”å…è®¸NULL = 10 <em>( character setï¼šutf8=3, gbk=2, latin1=1) + 1(NULL)+2(å˜é•¿å­—æ®µ)</em></li><li><em>varchar(10)å˜é•¿å­—æ®µä¸”ä¸å…è®¸NULL = 10</em> ( character setï¼šutf8=3 ,gbk=2, latin1=1) +2(å˜é•¿å­—æ®µ)</li><li>char(10)å›ºå®šå­—æ®µä¸”å…è®¸NULL = 10 <em>( character setï¼šutf8=3, gbk=2, latin1=1) +1(NULL)</em></li><li><em>char(10)å›ºå®šå­—æ®µä¸”ä¸å…è®¸NULL = 10</em> ( character setï¼šutf8=3,gbk=2,latin1=1)</li></ul><h4 id="_8-ref" tabindex="-1"><a class="header-anchor" href="#_8-ref" aria-hidden="true">#</a> 8. ref</h4><p>å½“ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯ã€‚</p><p>â‘  æ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¸¸æ•°æˆ–è€…æ˜¯æŸä¸ªåˆ—ï¼Œå…¶ <code>ref</code> æ˜¯ <code>const</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ge+`" alt="image-20220814103925203"></p><p>â‘¡ å½“è¿›è¡Œå¤šè¡¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¯¹è¢«é©±åŠ¨è¡¨s2æ‰§è¡Œçš„æŸ¥è¯¢å¼•ç”¨äº†atguigudb1.s1.idå­—æ®µè¿›è¡Œç­‰å€¼æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.id = s2.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+_e+`" alt="image-20220814104029459"></p><p>â‘¢ å½“è¿æ¥æ¡ä»¶ä½¿ç”¨å‡½æ•°æ—¶ï¼Œå…¶ <code>ref</code> å°±æ˜¯ <code>func</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code> EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s2.key1 = UPPER(s1.key1);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+qe+`" alt="image-20220814104217790"></p><h4 id="_9-rows-â˜†" tabindex="-1"><a class="header-anchor" href="#_9-rows-â˜†" aria-hidden="true">#</a> 9. rows â˜†</h4><p>â‘  é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡ç›®æ•°ï¼Œæ¡ç›®æ•°è¶Šå°è¶Šå¥½ã€‚è¿™æ˜¯å› ä¸ºå€¼è¶Šå°ï¼ŒåŠ è½½I/Oçš„é¡µæ•°å°±è¶Šå°‘~</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 &gt; &#39;z&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ye+`" alt="image-20220814104350297"></p><h4 id="_10-filtered" tabindex="-1"><a class="header-anchor" href="#_10-filtered" aria-hidden="true">#</a> 10. filtered</h4><p><mark>ç»è¿‡æœç´¢æ¡ä»¶åè¿‡æ»¤å‰©ä¸‹çš„è®°å½•æ‰€å çš„ç™¾åˆ†æ¯”ã€‚ç™¾åˆ†æ¯”è¶Šé«˜è¶Šå¥½</mark>ï¼Œæ¯”å¦‚åŒæ · rows æ˜¯ 40ï¼Œå¦‚æœ filter æ˜¯ 100ï¼Œåˆ™æ˜¯ä» 40 æ¡è®°å½•é‡Œè¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœ filter æ˜¯ 10ï¼Œåˆ™æ˜¯ä» 400 æ¡è®°å½•é‡Œè¿›è¡ŒæŸ¥æ‰¾ï¼Œç›¸æ¯”è¾ƒè€Œè¨€å½“ç„¶æ˜¯å‰è€…çš„æ•ˆç‡æ›´é«˜å“¦ã€‚</p><p><strong>â‘  å¦‚æœæ‰§è¡Œçš„æ˜¯å•è¡¨æ‰«æï¼Œé‚£ä¹ˆè®¡ç®—æ—¶éœ€è¦ä¼°è®¡é™¤äº†å¯¹åº”æœç´¢æ¡ä»¶å¤–çš„å…¶ä»–æœç´¢æ¡ä»¶æ»¡è¶³çš„è®°å½•æœ‰å¤šå°‘æ¡</strong> æ™•äº†å°±çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 &gt; &#39;z&#39; AND common_field = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»“æœæ˜¯ 10ï¼Œè¡¨ç¤ºæœ‰ 347 æ¡è®°å½•æ»¡è¶³ key1 &gt; â€˜zâ€™ çš„æ¡ä»¶ï¼Œè¿™ 347 æ¡è®°å½•çš„ 10% æ»¡è¶³ common_field = â€˜aâ€™ æ¡ä»¶ã€‚</p><p><img src="`+Ee+`" alt="image-20220814104530103"></p><p>â‘¡ å®é™…ä¸Šï¼Œå¯¹äºå•è¡¨æŸ¥è¯¢ï¼Œè¿™ä¸ªå­—æ®µæ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ï¼Œæˆ‘ä»¬æ›´åŠ å…³æ³¨è¿æ¥æŸ¥è¯¢æ—¶çš„ filtered å€¼ï¼Œå®ƒå†³å®šäº†è¢«é©±åŠ¨è¡¨è¦æ‰§è¡Œçš„æ¬¡æ•°ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.key1 = s2.key1 WHERE
s1.common_field = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœå¦‚ä¸‹ã€‚åœ¨æ ‡æ˜é©±åŠ¨è¡¨ s1 æä¾›ç»™è¢«é©±åŠ¨è¡¨çš„è®°å½•æ•°æ˜¯ 9895 æ¡ï¼Œå…¶ä¸­ 989.5 æ¡æ»¡è¶³è¿‡æ»¤æ¡ä»¶s1.key1 = s2.key1ï¼Œé‚£ä¹ˆè¢«é©±åŠ¨è¡¨éœ€è¦æ‰§è¡Œ 990 æ¬¡æŸ¥è¯¢ã€‚</p><p><img src="`+he+`" alt="image-20220814104852338"></p><blockquote><p>filtered=(æœ€ç»ˆæŸ¥è¯¢ç»“æœ/rowsåˆ—æ•°æ®)*100%ï¼Œè¶Šå¤§è¡¨ç¤ºè¿‡æ»¤åçš„æ•°æ®ï¼Œè¶Šæ˜¯æœ€ç»ˆç»“æœã€‚</p><p>ç›¸æ¯”è¾ƒfilteredè¶Šå°ï¼Œå‡å°‘äº†æ•°æ®å†æ¬¡è¿‡æ»¤çš„æ€§èƒ½</p></blockquote><h4 id="_11-extra-â˜†" tabindex="-1"><a class="header-anchor" href="#_11-extra-â˜†" aria-hidden="true">#</a> 11. Extra â˜†</h4><p>é¡¾åæ€ä¹‰ï¼ŒExtra åˆ—æ˜¯ç”¨æ¥è¯´æ˜ä¸€äº›é¢å¤–ä¿¡æ¯çš„ï¼ŒåŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›é¢å¤–ä¿¡æ¯æ¥æ›´å‡†ç¡®çš„ç†è§£MySQLåˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥ã€‚MySQLæä¾›çš„é¢å¤–ä¿¡æ¯æœ‰å¥½å‡ åä¸ªï¼Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæŒ‘æ¯”è¾ƒé‡è¦çš„é¢å¤–ä¿¡æ¯ä»‹ç»ç»™å¤§å®¶ã€‚</p><p>â‘  <code>No tables used</code></p><p>å½“æŸ¥è¯¢è¯­å¥çš„æ²¡æœ‰FROMå­å¥æ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+fe+`" alt="image-20220814111715918"></p><p>â‘¡ <code>Impossible WHERE</code></p><p>å½“æŸ¥è¯¢æ¡ä»¶æ°¸è¿œä¸å¯èƒ½æ»¡è¶³ï¼ŒæŸ¥ä¸åˆ°æ•°æ®æ—¶ä¼šå‡ºç°è¯¥ä¿¡æ¯ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE 1 != 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Le+`" alt="image-20220814111830017"></p><p>â‘¢ <code>Using where</code></p><ul><li>å½“æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ™®é€šçš„ where æŸ¥è¯¢æ—¶ï¼Œä¼šå‡ºç°è¯¥ä¿¡æ¯</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE common_field = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Ne+`" alt="image-20220814111940959"></p><ul><li>ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ï¼Œåˆ™é»˜é»˜ä½¿ç”¨ç´¢å¼•ï¼Œä»€ä¹ˆé¢å¤–ä¿¡æ¯ä¹Ÿæ²¡æœ‰ã€‚</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Ie+`" alt="image-20220814112044015"></p><ul><li>ç´¢å¼•åŠ æ™®é€š whereï¼Œé‚£è¿˜æ˜¯ using where</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39; AND common_field = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Re+`" alt="image-20220814112128725"></p><p>â‘£ <code>No matching min/max row</code></p><p>å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ MINã€MAX ç­‰èšåˆå‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç¬¦åˆ where æ¡ä»¶çš„æœç´¢è®°å½•æ—¶ï¼Œä¼šæä¾›é¢å¤–ä¿¡æ¯ <code>No matching min/max row</code>ï¼ˆè¡¨ä¸­æ ¹æœ¬æ²¡æœ‰æ»¡è¶³ where æ¡ä»¶çš„å­—å¥ï¼Œæ‰¾ minã€max æ²¡æœ‰æ„ä¹‰ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT MIN(key1) FROM s1 WHERE key1 = &#39;abcdefg&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Te+`" alt="image-20220814112312678"></p><p>â‘¤ <code>Select tables optimized away</code></p><p>å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ MINã€MAX ç­‰èšåˆå‡½æ•°ï¼Œæœ‰ç¬¦åˆ where æ¡ä»¶çš„æœç´¢è®°å½•æ—¶</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT MIN(key1) FROM s1 WHERE key1 = &#39;oCUPss&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Ae+`" alt="image-20220814112508271"></p><p>â‘¥ <code>Using index</code></p><p>åœ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æƒ…å†µæç¤ºã€‚æ‰€è°“è¦†ç›–ç´¢å¼•ï¼Œå°±æ˜¯ç´¢å¼•ä¸­è¦†ç›–äº†éœ€è¦æŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µï¼Œä¸éœ€è¦å†ä½¿ç”¨èšç°‡ç´¢å¼•è¿›è¡Œå›è¡¨æŸ¥æ‰¾ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œä½¿ç”¨ key1 ä½œä¸ºæŸ¥æ‰¾æ¡ä»¶ï¼Œè¯¥å­—æ®µå»ºç«‹äº†ç´¢å¼•ï¼ŒB+ æ ‘å¯ä»¥æŸ¥æ‰¾åˆ° key1 å­—æ®µå’Œä¸»é”®ï¼Œå› æ­¤ä¸‹é¢åªæŸ¥æ‰¾ key1 å­—æ®µå°±ä¸ç”¨è¿›è¡Œå›è¡¨æ“ä½œï¼Œè¿™æ˜¯éå¸¸æ£’çš„æƒ…å†µã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT key1 FROM s1 WHERE key1 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Se+`" alt="image-20220814112621332"></p><p>â‘¦ <code>Using index condition</code></p><p>æœç´¢åˆ—ä¸­è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µæ˜¯æ¯”è¾ƒå‘çš„~</p><p>æ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦è¿›è¡Œå›è¡¨æŸ¥æ‰¾ï¼Œå›è¡¨æ“ä½œæ˜¯ä¸€ä¸ªéšæœº I/Oï¼Œæ¯”è¾ƒè€—æ—¶ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 &gt; &#39;z&#39; AND key1 LIKE &#39;%a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+xe+`" alt="image-20220814114314395"></p><p>ä¸Šé¢è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ç´¢å¼•ä¸‹æ¨(å¯ä»¥é€šè¿‡é…ç½®é¡¹è¿›è¡Œé…ç½®)ï¼Œä½¿æˆ‘ä»¬ä½¿ç”¨ WHERE key1 &gt; â€˜zâ€™ å¾—åˆ°çš„ç»“æœå…ˆè¿›è¡Œæ¨¡ç³ŠåŒ¹é… key1 LIKE â€˜%aâ€™ï¼Œç„¶åå†å»å›è¡¨ï¼Œå°±å¯ä»¥å‡å°‘å›è¡¨çš„æ¬¡æ•°äº†ã€‚</p><p>â‘§<code> Using join buffer</code></p><p>åœ¨è¿æ¥æŸ¥è¯¢ä¸­ï¼Œå½“è¢«é©±åŠ¨è¡¨ä¸èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨ç´¢å¼•å®ç°æå‡é€Ÿåº¦ï¼Œæ•°æ®åº“å°±ä½¿ç”¨ç¼“å­˜æ¥å°½å¯èƒ½æå‡ä¸€äº›æ€§èƒ½ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.common_field = s2.common_field;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ke+`" alt="image-20220814115201430"></p><p>â‘¨ <code>Not exists</code></p><p>å½“æˆ‘ä»¬ä½¿ç”¨å·¦ï¼ˆå¤–ï¼‰è¿æ¥æ—¶ï¼Œå¦‚æœ<code>WHERE</code>å­å¥ä¸­åŒ…å«è¦æ±‚è¢«é©±åŠ¨è¡¨çš„æŸä¸ªåˆ—ç­‰äº<code>NULL</code>å€¼çš„æœç´¢æ¡ä»¶ï¼Œè€Œä¸”é‚£ä¸ªåˆ—åˆæ˜¯ä¸å…è®¸å­˜å‚¨<code>NULL</code>å€¼çš„ï¼Œé‚£ä¹ˆåœ¨è¯¥è¡¨çš„æ‰§è¡Œè®¡åˆ’çš„Extraåˆ—å°±ä¼šæç¤º<code>Not exists</code>é¢å¤–ä¿¡æ¯</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 LEFT JOIN s2 ON s1.key1 = s2.key1 WHERE s2.id IS NULL;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Oe+`" alt="image-20220814115302073"></p><p>â‘© <code>Using intersect(â€¦) ã€ Using union(â€¦) å’Œ Using sort_union(â€¦)</code></p><ul><li>å¦‚æœæ‰§è¡Œè®¡åˆ’çš„Extraåˆ—å‡ºç°äº†Using intersect(...)æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨Intersectç´¢å¼• åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‹¬å·ä¸­çš„...è¡¨ç¤ºéœ€è¦è¿›è¡Œç´¢å¼•åˆå¹¶çš„ç´¢å¼•åç§°ï¼›</li><li>å¦‚æœå‡ºç°äº†Using union(...)æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨Unionç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ï¼›</li><li>å¦‚æœå‡ºç°äº†Using sort_union(...)æç¤ºï¼Œè¯´æ˜å‡†å¤‡ä½¿ç”¨Sort-Unionç´¢å¼•åˆå¹¶çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 = &#39;a&#39; OR key3 = &#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+we+`" alt="image-20220814115726815"></p><p>â‘ª <code>Zero limit</code></p><p>å½“æˆ‘ä»¬çš„<code>LIMIT</code>å­å¥çš„å‚æ•°ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤ºå‹æ ¹å„¿ä¸æ‰“ç®—ä»è¡¨ä¸­è¯»å‡ºä»»ä½•è®°å½•ï¼Œå°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 LIMIT 0;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Ce+`" alt="image-20220814115904221"></p><p>â‘« <code>Using filesort</code></p><p>å¾ˆå¤šæƒ…å†µä¸‹æ’åºæ“ä½œæ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œåªèƒ½åœ¨å†…å­˜ä¸­ï¼ˆè®°å½•è¾ƒå°‘çš„æ—¶å€™ï¼‰æˆ–è€…ç£ç›˜ä¸­ï¼ˆè®°å½•è¾ƒå¤šçš„æ—¶å€™ï¼‰è¿›è¡Œæ’åºï¼ŒMySQLæŠŠè¿™ç§åœ¨å†…å­˜ä¸­æˆ–è€…ç£ç›˜ä¸Šè¿›è¡Œæ’åºçš„æ–¹å¼ç»Ÿç§°ä¸º<strong>æ–‡ä»¶æ’åº</strong>ï¼ˆè‹±æ–‡åï¼š<code>filesort</code>ï¼‰ã€‚è¿™ç§æƒ…å†µæ—¶æ¯”è¾ƒæ‚²å£®çš„~</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 ORDER BY common_field LIMIT 10;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Me+`" alt="image-20220814120453672"></p><p>â‘¬ <code>Using temporary</code></p><p>åœ¨è®¸å¤šæŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒMySQLå¯èƒ½ä¼šå€ŸåŠ©ä¸´æ—¶è¡¨æ¥å®Œæˆä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚å»é‡ã€æ’åºä¹‹ç±»çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æ‰§è¡Œè®¸å¤šåŒ…å«DISTINCTã€GROUP BYã€UNIONç­‰å­å¥çš„æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•æ¥å®ŒæˆæŸ¥è¯¢ï¼ŒMySQLå¾ˆæœ‰å¯èƒ½å¯»æ±‚é€šè¿‡å»ºç«‹å†…éƒ¨çš„ä¸´æ—¶è¡¨æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°äº†å†…éƒ¨çš„ä¸´æ—¶è¡¨ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’çš„Extraåˆ—å°†ä¼šæ˜¾ç¤ºUsing temporaryæç¤º</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT DISTINCT common_field FROM s1;
EXPLAIN SELECT common_field, COUNT(*) AS amount FROM s1 GROUP BY common_field;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+Ue+`" alt="image-20220814121232140"></p><p>æ‰§è¡Œè®¡åˆ’ä¸­å‡ºç°<code>Using temporary</code>å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å¾å…†ï¼Œå› ä¸ºå»ºç«‹ä¸ç»´æŠ¤ä¸´æ—¶è¡¨è¦ä»˜å‡ºå¾ˆå¤§æˆæœ¬çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬<code>æœ€å¥½èƒ½ä½¿ç”¨ç´¢å¼•æ¥æ›¿ä»£æ‰ä½¿ç”¨ä¸´æ—¶è¡¨</code>ã€‚æ¯”å¦‚ï¼šæ‰«ææŒ‡å®šçš„ç´¢å¼•idx_key1å³å¯</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code> EXPLAIN SELECT key1, COUNT(*) AS amount FROM s1 GROUP BY key1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Pe+`" alt="image-20220814121019942"></p><h4 id="_12-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_12-å°ç»“" aria-hidden="true">#</a> 12. å°ç»“</h4><ul><li>EXPLAINä¸è€ƒè™‘å„ç§Cache</li><li>EXPLAINä¸èƒ½æ˜¾ç¤ºMySQLåœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€ä½œçš„ä¼˜åŒ–å·¥ä½œ</li><li>EXPLAINä¸ä¼šå‘Šè¯‰ä½ å…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µéƒ¨åˆ†ç»Ÿè®¡</li><li>ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼</li></ul><h2 id="_7-explainçš„è¿›ä¸€æ­¥ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_7-explainçš„è¿›ä¸€æ­¥ä½¿ç”¨" aria-hidden="true">#</a> 7. EXPLAINçš„è¿›ä¸€æ­¥ä½¿ç”¨</h2><h3 id="_7-1-explainå››ç§è¾“å‡ºæ ¼å¼" tabindex="-1"><a class="header-anchor" href="#_7-1-explainå››ç§è¾“å‡ºæ ¼å¼" aria-hidden="true">#</a> 7. 1 EXPLAINå››ç§è¾“å‡ºæ ¼å¼</h3><p>è¿™é‡Œè°ˆè°ˆEXPLAINçš„è¾“å‡ºæ ¼å¼ã€‚EXPLAINå¯ä»¥è¾“å‡ºå››ç§æ ¼å¼ï¼š<mark>ä¼ ç»Ÿæ ¼å¼ï¼ŒJSONæ ¼å¼ï¼ŒTREEæ ¼å¼ä»¥åŠå¯è§†åŒ–è¾“å‡º</mark>ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚ç”¨äºè‡ªå·±çš„æ ¼å¼ã€‚</p><h4 id="_1-ä¼ ç»Ÿæ ¼å¼" tabindex="-1"><a class="header-anchor" href="#_1-ä¼ ç»Ÿæ ¼å¼" aria-hidden="true">#</a> 1. ä¼ ç»Ÿæ ¼å¼</h4><p>ä¼ ç»Ÿæ ¼å¼ç®€å•æ˜äº†ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªè¡¨æ ¼å½¢å¼ï¼Œæ¦‚è¦è¯´æ˜æŸ¥è¯¢è®¡åˆ’ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.key1 = s2.key2 WHERE s1.common_field =&#39;a&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Fe+'" alt="image-20220814131829731"></p><h4 id="_2-jsonæ ¼å¼" tabindex="-1"><a class="header-anchor" href="#_2-jsonæ ¼å¼" aria-hidden="true">#</a> 2. JSONæ ¼å¼</h4><p>ç¬¬1ç§æ ¼å¼ä¸­ä»‹ç»çš„<code>EXPLAIN</code>è¯­å¥è¾“å‡ºä¸­ç¼ºå°‘äº†ä¸€ä¸ªè¡¡é‡æ‰§è¡Œè®¡åˆ’å¥½åçš„é‡è¦å±æ€§â€“æˆæœ¬ã€‚ è€ŒJSONæ ¼å¼æ˜¯å››ç§æ ¼å¼é‡Œé¢è¾“å‡º<code>ä¿¡æ¯æœ€è¯¦å°½</code>çš„æ ¼å¼ï¼Œé‡Œé¢åŒ…å«äº†æ‰§è¡Œçš„æˆæœ¬ä¿¡æ¯ã€‚</p><p><mark>JSONæ ¼å¼ï¼šåœ¨EXPLAINå•è¯å’ŒçœŸæ­£çš„æŸ¥è¯¢è¯­å¥ä¸­é—´åŠ ä¸ŠFORMAT=JSON</mark></p><p>ä¼ ç»Ÿæ ¼å¼ä¸jsonæ ¼å¼çš„å„ä¸ªå­—æ®µå­˜åœ¨å¦‚ä¸‹è¡¨æ‰€ç¤ºçš„å¯¹åº”å…³ç³»(mysql5.7å®˜æ–¹æ–‡æ¡£)ã€‚</p><p><img src="'+De+`" alt="image-20220814122734392"></p><p>æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN FORMAT=JSON SELECT s1.key1, s2.key1 FROM s1 LEFT JOIN s2 ON s1.key1 = s2.key1 WHERE s2.common_field IS NOT NULL;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° json æ ¼å¼çš„ä¿¡æ¯é‡ä¼šæ›´åŠ ä¸°å¯Œã€‚å°¤å…¶æ˜¯æˆæœ¬ä¿¡æ¯ï¼Œæ˜¯ç”¨äºè¡¡é‡ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’çš„å¥½åçš„é‡è¦æŒ‡æ ‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; EXPLAIN FORMAT=JSON SELECT * FROM s1 INNER JOIN s2 ON s1.key1 = s2.key2 WHERE s1.common_field =&#39;a&#39;\\G;
*************************** 1. row ***************************
EXPLAIN: {
  &quot;query_block&quot;: {
    &quot;select_id&quot;: 1,
    &quot;cost_info&quot;: {
      &quot;query_cost&quot;: &quot;1360.07&quot;
    },
    &quot;nested_loop&quot;: [
      {
        &quot;table&quot;: {
          &quot;table_name&quot;: &quot;s1&quot;,
          &quot;access_type&quot;: &quot;ALL&quot;,
          &quot;possible_keys&quot;: [
            &quot;idx_key1&quot;
          ],
          &quot;rows_examined_per_scan&quot;: 9895,
          &quot;rows_produced_per_join&quot;: 989,
          &quot;filtered&quot;: &quot;10.00&quot;,
          &quot;cost_info&quot;: {
            &quot;read_cost&quot;: &quot;914.80&quot;,
            &quot;eval_cost&quot;: &quot;98.95&quot;,
            &quot;prefix_cost&quot;: &quot;1013.75&quot;,
            &quot;data_read_per_join&quot;: &quot;1M&quot;
          },
          &quot;used_columns&quot;: [
            &quot;id&quot;,
            &quot;key1&quot;,
            &quot;key2&quot;,
            &quot;key3&quot;,
            &quot;key_part1&quot;,
            &quot;key_part2&quot;,
            &quot;key_part3&quot;,
            &quot;common_field&quot;
          ],
          &quot;attached_condition&quot;: &quot;((\`atguigudb1\`.\`s1\`.\`common_field\` = &#39;a&#39;) and (\`atguigudb1\`.\`s1\`.\`key1\` is not null))&quot;
        }
      },
      {
        &quot;table&quot;: {
          &quot;table_name&quot;: &quot;s2&quot;,
          &quot;access_type&quot;: &quot;eq_ref&quot;,
          &quot;possible_keys&quot;: [
            &quot;idx_key2&quot;
          ],
          &quot;key&quot;: &quot;idx_key2&quot;,
          &quot;used_key_parts&quot;: [
            &quot;key2&quot;
          ],
          &quot;key_length&quot;: &quot;5&quot;,
          &quot;ref&quot;: [
            &quot;atguigudb1.s1.key1&quot;
          ],
          &quot;rows_examined_per_scan&quot;: 1,
          &quot;rows_produced_per_join&quot;: 989,
          &quot;filtered&quot;: &quot;100.00&quot;,
          &quot;index_condition&quot;: &quot;(cast(\`atguigudb1\`.\`s1\`.\`key1\` as double) = cast(\`atguigudb1\`.\`s2\`.\`key2\` as double))&quot;,
          &quot;cost_info&quot;: {
            &quot;read_cost&quot;: &quot;247.38&quot;,
            &quot;eval_cost&quot;: &quot;98.95&quot;,
            &quot;prefix_cost&quot;: &quot;1360.08&quot;,
            &quot;data_read_per_join&quot;: &quot;1M&quot;
          },
          &quot;used_columns&quot;: [
            &quot;id&quot;,
            &quot;key1&quot;,
            &quot;key2&quot;,
            &quot;key3&quot;,
            &quot;key_part1&quot;,
            &quot;key_part2&quot;,
            &quot;key_part3&quot;,
            &quot;common_field&quot;
          ]
        }
      }
    ]
  }
}
1 row in set, 2 warnings (0.00 sec)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä½¿ç”¨<code>#</code>åé¢è·Ÿéšæ³¨é‡Šçš„å½¢å¼ä¸ºå¤§å®¶è§£é‡Šäº† <code>EXPLAIN FORMAT=JSON</code> è¯­å¥çš„è¾“å‡ºå†…å®¹ï¼Œä½†æ˜¯å¤§å®¶æœ‰ç–‘é—® <code>cost_info</code>é‡Œè¾¹çš„æˆæœ¬çœ‹ç€æ€ªæ€ªçš„ï¼Œå®ƒä»¬æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼Ÿ</p><p>å…ˆçœ‹ s1 è¡¨çš„ &quot;cost_info&quot;éƒ¨åˆ†ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>&quot;cost_info&quot;: {
	&quot;read_cost&quot;: &quot;914.80&quot;,
    &quot;eval_cost&quot;: &quot;98.95&quot;,
    &quot;prefix_cost&quot;: &quot;1013.75&quot;,
    &quot;data_read_per_join&quot;: &quot;1M&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>read_cost</code> æ˜¯ç”±ä¸‹è¾¹è¿™ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼š <ul><li><code>IO</code>æˆæœ¬</li><li>æ£€æµ‹ <code>rows Ã— (1 - filter) </code>æ¡è®°å½•çš„ <code>CPU </code>æˆæœ¬</li></ul></li></ul><blockquote><p>ğŸ’š rowså’Œfilteréƒ½æ˜¯æˆ‘ä»¬å‰è¾¹ä»‹ç»æ‰§è¡Œè®¡åˆ’çš„è¾“å‡ºåˆ—ï¼Œåœ¨JSONæ ¼å¼çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œrowsç›¸å½“äºrows_examined_per_scanï¼Œfilteredåç§°ä¸å˜</p></blockquote><ul><li><code>eval_cost</code>æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š <ul><li>æ£€æµ‹ <code>rows Ã— filter</code> æ¡è®°å½•çš„æˆæœ¬ã€‚</li></ul></li><li><code>prefix_cost</code>å°±æ˜¯å•ç‹¬æŸ¥è¯¢ s1 è¡¨çš„æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ï¼š<code>read_cost + eval_cost</code></li><li><code>data_read_per_join </code>è¡¨ç¤ºåœ¨æ­¤æ¬¡æŸ¥è¯¢ä¸­éœ€è¦è¯»å–çš„æ•°æ®é‡ã€‚</li></ul><p>å¯¹äº s2 è¡¨çš„ â€œcost_infoâ€ éƒ¨åˆ†æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>&quot;cost_info&quot;: {
	&quot;read_cost&quot;: &quot;247.38&quot;,
    &quot;eval_cost&quot;: &quot;98.95&quot;,
    &quot;prefix_cost&quot;: &quot;1360.08&quot;,
    &quot;data_read_per_join&quot;: &quot;1M&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº s2 è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ï¼Œæ‰€ä»¥å¯èƒ½è¢«è¯»å–å¤šæ¬¡ï¼Œè¿™é‡Œçš„ read_cost å’Œ eval_cost æ˜¯è®¿é—®å¤šæ¬¡ s2 è¡¨åç´¯åŠ èµ·æ¥çš„å€¼ï¼Œå¤§å®¶ä¸»è¦å…³æ³¨é‡Œè¾¹å„¿çš„ prefix_cost çš„å€¼ä»£è¡¨çš„æ˜¯æ•´ä¸ªè¿æ¥æŸ¥è¯¢é¢„è®¡çš„æˆæœ¬ï¼Œä¹Ÿå°±æ˜¯å•æ¬¡æŸ¥è¯¢ s1 è¡¨å’Œå¤šæ¬¡æŸ¥è¯¢ s2 è¡¨åçš„æˆæœ¬çš„å’Œï¼Œä¹Ÿå°±æ˜¯ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>247.38 + 98.95 + 1013.75 = 1360.08
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3-treeæ ¼å¼" tabindex="-1"><a class="header-anchor" href="#_3-treeæ ¼å¼" aria-hidden="true">#</a> 3. TREEæ ¼å¼</h4><p>TREEæ ¼å¼æ˜¯8.0.16ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„æ–°æ ¼å¼ï¼Œä¸»è¦æ ¹æ®æŸ¥è¯¢çš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»å’Œå„éƒ¨åˆ†çš„æ‰§è¡Œé¡ºåºæ¥æè¿°å¦‚ä½•æŸ¥è¯¢ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; EXPLAIN FORMAT=TREE SELECT * FROM s1 INNER JOIN s2 ON s1.key1 = s2.key2 WHERE s1.common_field =&#39;a&#39;\\G;
*************************** 1. row ***************************
EXPLAIN: -&gt; Nested loop inner join  (cost=1360.08 rows=990)
    -&gt; Filter: ((s1.common_field = &#39;a&#39;) and (s1.key1 is not null))  (cost=1013.75 rows=990)
        -&gt; Table scan on s1  (cost=1013.75 rows=9895)
    -&gt; Single-row index lookup on s2 using idx_key2 (key2=s1.key1), with index condition: (cast(s1.key1 as double) = cast(s2.key2 as double))  (cost=0.25 rows=1)

1 row in set, 1 warning (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-å¯è§†åŒ–è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#_4-å¯è§†åŒ–è¾“å‡º" aria-hidden="true">#</a> 4. å¯è§†åŒ–è¾“å‡º</h4><p>å¯è§†åŒ–è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡MySQL Workbenchå¯è§†åŒ–æŸ¥çœ‹MySQLçš„æ‰§è¡Œè®¡åˆ’ã€‚é€šè¿‡ç‚¹å‡»Workbenchçš„æ”¾å¤§é•œå›¾æ ‡ï¼Œå³å¯ç”Ÿæˆå¯è§†åŒ–çš„æŸ¥è¯¢è®¡åˆ’ã€‚</p><p><img src="`+He+`" alt="img"></p><p>ä¸Šå›¾æŒ‰ä»å·¦åˆ°å³çš„è¿æ¥é¡ºåºæ˜¾ç¤ºè¡¨ã€‚çº¢è‰²æ¡†è¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œè€Œç»¿è‰²æ¡†è¡¨ç¤ºä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚å¯¹äºæ¯ä¸ªè¡¨ï¼Œæ˜¾ç¤ºä½¿ç”¨çš„ç´¢å¼•ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªè¡¨æ ¼çš„æ¡†ä¸Šæ–¹æ˜¯æ¯ä¸ªè¡¨è®¿é—®æ‰€å‘ç°çš„è¡Œæ•°çš„ä¼°è®¡å€¼ä»¥åŠè®¿é—®è¯¥è¡¨çš„æˆæœ¬ã€‚</p><h3 id="_7-2-show-warningsçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_7-2-show-warningsçš„ä½¿ç”¨" aria-hidden="true">#</a> 7. 2 SHOW WARNINGSçš„ä½¿ç”¨</h3><p>å¯ä»¥æ˜¾ç¤ºæ•°æ®åº“çœŸæ­£æ‰§è¡Œçš„ SQL ï¼Œå› ä¸ºæœ‰æ—¶å€™MySQLæ‰§è¡Œå¼•æ“ä¼šå¯¹æˆ‘ä»¬çš„SQLè¿›è¡Œä¼˜åŒ–~</p><p>â‘  å…ˆä½¿ç”¨ <code>Explain</code>ï¼Œæˆ‘ä»¬å†™çš„ sql æŒ‰é“ç†æ˜¯ä½¿ç”¨ s1 ä½œä¸ºé©±åŠ¨è¡¨ï¼Œs2ä½œä¸ºè¢«é©±åŠ¨è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT s1.key1, s2.key1 FROM s1 LEFT JOIN s2 ON s1.key1 = s2.key1 WHERE s2.common_field IS NOT NULL;*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½†æ˜¯ æ‰§è¡Œç»“æœæŠŠ s2 ä½œä¸ºäº†é©±åŠ¨è¡¨ï¼Œs1 ä½œä¸ºäº†è¢«é©±åŠ¨è¡¨</p><p><img src="`+We+'" alt="image-20220814133158223"></p><p>ç´§æ¥ç€ä½¿ç”¨<code>SHOW WARNINGS</code> ï¼ŒåŸæ¥æ‰§è¡Œå¼•æ“å°†<code> LEFT JOIN</code>ä¼˜åŒ–æˆäº† <code>INNER JOIN</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW WARNINGS\\G;\n*************************** 1. row ***************************\n  Level: Note\n   Code: 1003\nMessage: /* select#1 */ select `atguigudb1`.`s1`.`key1` AS `key1`,`atguigudb1`.`s2`.`key1` AS `key1` \nfrom `atguigudb1`.`s1` \njoin `atguigudb1`.`s2` \nwhere ((`atguigudb1`.`s1`.`key1` = `atguigudb1`.`s2`.`key1`) \nand (`atguigudb1`.`s2`.`common_field` is not null))\n1 row in set (0.00 sec)\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ message ä¸­æ˜¾ç¤ºçš„æ˜¯æ•°æ®åº“ä¼˜åŒ–ã€é‡å†™åçœŸæ­£æ‰§è¡Œçš„æŸ¥è¯¢è¯­å¥ã€‚æœç„¶å®ƒå¸®æˆ‘ä»¬åšäº†ä¼˜åŒ–</p><p>â‘¡ å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼šä¸‹é¢æ˜¯ä¸€ä¸ª å­æŸ¥è¯¢SQLï¼Œåº”è¯¥å¯¹åº”ç€ä¸¤ä¸ªä¸åŒçš„id~</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM s1 WHERE key1 IN (SELECT key2 FROM s2 WHERE common_field = &#39;a&#39;);\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½†æ˜¯çœŸæ­£æ‰§è¡Œåï¼Œå¯¹åº”ç€ç«Ÿç„¶æ˜¯ç›¸åŒçš„id</p><p><img src="'+Xe+`" alt="image-20220814134557598"></p><p>æˆ‘ä»¬ä½¿ç”¨<code>SHOW WARNINGS\\G;</code>è¿›è¡Œåˆ†æï¼Œå‘ç°æ‰§è¡Œå¼•æ“å°†å…¶ä¼˜åŒ–æˆäº† <strong>å¤šè¡¨è¿æ¥æŸ¥è¯¢</strong>çš„æ–¹å¼</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SHOW WARNINGS\\G;
*************************** 1. row ***************************
  Level: Warning
   Code: 1739
Message: Cannot use ref access on index &#39;idx_key1&#39; due to type or collation conversion on field &#39;key1&#39;
*************************** 2. row ***************************
  Level: Note
   Code: 1003
Message: /* select#1 */ select \`atguigudb1\`.\`s1\`.\`id\` AS \`id\`,\`atguigudb1\`.\`s1\`.\`key1\` AS \`key1\`,\`atguigudb1\`.\`s1\`.\`key2\` AS \`key2\`,\`atguigudb1\`.\`s1\`.\`key3\` AS \`key3\`,\`atguigudb1\`.\`s1\`.\`key_part1\` AS \`key_part1\`,\`atguigudb1\`.\`s1\`.\`key_part2\` AS \`key_part2\`,\`atguigudb1\`.\`s1\`.\`key_part3\` AS \`key_part3\`,\`atguigudb1\`.\`s1\`.\`common_field\` AS \`common_field\` 
from \`atguigudb1\`.\`s2\` 
join \`atguigudb1\`.\`s1\` 
where ((\`atguigudb1\`.\`s2\`.\`common_field\` = &#39;a&#39;) 
and (cast(\`atguigudb1\`.\`s1\`.\`key1\` as double) = cast(\`atguigudb1\`.\`s2\`.\`key2\` as double)))
2 rows in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’-trace" tabindex="-1"><a class="header-anchor" href="#_8-åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’-trace" aria-hidden="true">#</a> 8. åˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ï¼štrace</h2><p><code>OPTIMIZE_TRACE</code> æ˜¯ mysql 5.6 ä¸­å¼•å…¥çš„ä¸€ä¸ªè·Ÿè¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªä¼˜åŒ–å™¨åšå‡ºçš„å„ç§å†³ç­–ï¼Œæ¯”å¦‚è®¿é—®è¡¨çš„æ–¹æ³•ï¼Œå„ç§å¼€é”€è®¡ç®—ï¼Œå„ç§è½¬æ¢ï¼Œç»“æœä¼šè¢«è®°å½•åˆ°<code>information_schema.optimizer_trace</code>ä¸­ã€‚</p><p>æ­¤åŠŸèƒ½é»˜è®¤å…³é—­ã€‚å¼€å¯traceï¼Œå¹¶è®¾ç½®æ ¼å¼ä¸ºJSONï¼ŒåŒæ—¶è®¾ç½®traceæœ€å¤§èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› ä¸ºé»˜è®¤å†…å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET optimizer_trace=&quot;enabled=on&quot;,end_markers_in_json=on;

set optimizer_trace_max_mem_size=1000000;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼€å¯åï¼Œå¯åˆ†æå¦‚ä¸‹è¯­å¥ï¼š</p><ul><li>SELECT</li><li>INSERT</li><li>REPLACE</li><li>UPDATE</li><li>DELETE</li><li>EXPLAIN</li><li>SET</li><li>DECLARE</li><li>CASE</li><li>IF</li><li>RETURN</li><li>CALL</li></ul><p>æµ‹è¯•ï¼šæ‰§è¡Œå¦‚ä¸‹ SQL è¯­å¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select * from student where id &lt; 10;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æœ€åï¼Œ æŸ¥è¯¢ information_schema.optimizer_trace å°±å¯ä»¥çŸ¥é“ MySQL æ˜¯å¦‚ä½•æ‰§è¡Œ SQL çš„</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select * from information_schema.optimizer_trace\\G;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»“æœå¦‚ä¸‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>*************************** 1. row ***************************
 //ç¬¬1éƒ¨åˆ†ï¼šæŸ¥è¯¢è¯­å¥
 QUERY: select * from student where id &lt; 10
 //ç¬¬2éƒ¨åˆ†ï¼šQUERYå­—æ®µå¯¹åº”è¯­å¥çš„è·Ÿè¸ªä¿¡æ¯
 TRACE: {
 &quot;steps&quot;: [
 {
   &quot;join_preparation&quot;: {  //é¢„å¤‡å·¥ä½œ
    &quot;select#&quot;: 1,
    &quot;steps&quot;: [
    {
      &quot;expanded_query&quot;: &quot;/* select#1 */ select \`student\`.\`id\` AS
\`id\`,\`student\`.\`stuno\` AS \`stuno\`,\`student\`.\`name\` AS \`name\`,\`student\`.\`age\` AS
\`age\`,\`student\`.\`classId\` AS \`classId\` from \`student\` where (\`student\`.\`id\` &lt; 10)&quot;
    }
   ] /* steps */
  } /* join_preparation */
 },
 {
   &quot;join_optimization&quot;: {  //è¿›è¡Œä¼˜åŒ–
    &quot;select#&quot;: 1,
    &quot;steps&quot;: [
    {
      &quot;condition_processing&quot;: {  //æ¡ä»¶å¤„ç†
       &quot;condition&quot;: &quot;WHERE&quot;,
       &quot;original_condition&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;,
       &quot;steps&quot;: [
       {
         &quot;transformation&quot;: &quot;equality_propagation&quot;,
         &quot;resulting_condition&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;
       },
       {
         &quot;transformation&quot;: &quot;constant_propagation&quot;,
         &quot;resulting_condition&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;
       },
       {
         &quot;transformation&quot;: &quot;trivial_condition_removal&quot;,
         &quot;resulting_condition&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;
       }
] /* steps */
     } /* condition_processing */
    },
    {
      &quot;substitute_generated_columns&quot;: {  //æ›¿æ¢ç”Ÿæˆçš„åˆ—
     } /* substitute_generated_columns */
    },
    {
      &quot;table_dependencies&quot;: [   //è¡¨çš„ä¾èµ–å…³ç³»
      {
        &quot;table&quot;: &quot;\`student\`&quot;,
        &quot;row_may_be_null&quot;: false,
        &quot;map_bit&quot;: 0,
        &quot;depends_on_map_bits&quot;: [
       ] /* depends_on_map_bits */
      }
     ] /* table_dependencies */
    },
    {
      &quot;ref_optimizer_key_uses&quot;: [   //ä½¿ç”¨é”®
     ] /* ref_optimizer_key_uses */
    },
    {
      &quot;rows_estimation&quot;: [   //è¡Œåˆ¤æ–­
      {
        &quot;table&quot;: &quot;\`student\`&quot;,
        &quot;range_analysis&quot;: {
         &quot;table_scan&quot;: {
          &quot;rows&quot;: 3973767,
          &quot;cost&quot;: 408558
        } /* table_scan */,   //æ‰«æè¡¨
         &quot;potential_range_indexes&quot;: [   //æ½œåœ¨çš„èŒƒå›´ç´¢å¼•
         {
           &quot;index&quot;: &quot;PRIMARY&quot;,
           &quot;usable&quot;: true,
           &quot;key_parts&quot;: [
            &quot;id&quot;
          ] /* key_parts */
         }
        ] /* potential_range_indexes */,
         &quot;setup_range_conditions&quot;: [   //è®¾ç½®èŒƒå›´æ¡ä»¶
        ] /* setup_range_conditions */,
         &quot;group_index_range&quot;: {
          &quot;chosen&quot;: false,
          &quot;cause&quot;: &quot;not_group_by_or_distinct&quot;
        } /* group_index_range */,
         &quot;skip_scan_range&quot;: {
          &quot;potential_skip_scan_indexes&quot;: [
          {
            &quot;index&quot;: &quot;PRIMARY&quot;,
            &quot;usable&quot;: false,
            &quot;cause&quot;: &quot;query_references_nonkey_column&quot;
          }
         ] /* potential_skip_scan_indexes */
        } /* skip_scan_range */,
         &quot;analyzing_range_alternatives&quot;: {  //åˆ†æèŒƒå›´é€‰é¡¹
          &quot;range_scan_alternatives&quot;: [
          {
&quot;index&quot;: &quot;PRIMARY&quot;,
            &quot;ranges&quot;: [
             &quot;id &lt; 10&quot;
           ] /* ranges */,
            &quot;index_dives_for_eq_ranges&quot;: true,
            &quot;rowid_ordered&quot;: true,
            &quot;using_mrr&quot;: false,
            &quot;index_only&quot;: false,
            &quot;rows&quot;: 9,
            &quot;cost&quot;: 1.91986,
            &quot;chosen&quot;: true
          }
         ] /* range_scan_alternatives */,
          &quot;analyzing_roworder_intersect&quot;: {
           &quot;usable&quot;: false,
           &quot;cause&quot;: &quot;too_few_roworder_scans&quot;
         } /* analyzing_roworder_intersect */
        } /* analyzing_range_alternatives */,
         &quot;chosen_range_access_summary&quot;: {   //é€‰æ‹©èŒƒå›´è®¿é—®æ‘˜è¦
          &quot;range_access_plan&quot;: {
           &quot;type&quot;: &quot;range_scan&quot;,
           &quot;index&quot;: &quot;PRIMARY&quot;,
           &quot;rows&quot;: 9,
           &quot;ranges&quot;: [
            &quot;id &lt; 10&quot;
          ] /* ranges */
         } /* range_access_plan */,
          &quot;rows_for_plan&quot;: 9,
          &quot;cost_for_plan&quot;: 1.91986,
          &quot;chosen&quot;: true
        } /* chosen_range_access_summary */
       } /* range_analysis */
      }
     ] /* rows_estimation */
    },
    {
      &quot;considered_execution_plans&quot;: [  //è€ƒè™‘æ‰§è¡Œè®¡åˆ’
      {
        &quot;plan_prefix&quot;: [
       ] /* plan_prefix */,
        &quot;table&quot;: &quot;\`student\`&quot;,
        &quot;best_access_path&quot;: {  //æœ€ä½³è®¿é—®è·¯å¾„
         &quot;considered_access_paths&quot;: [
         {
           &quot;rows_to_scan&quot;: 9,
           &quot;access_type&quot;: &quot;range&quot;,
           &quot;range_details&quot;: {
            &quot;used_index&quot;: &quot;PRIMARY&quot;
          } /* range_details */,
           &quot;resulting_rows&quot;: 9,
           &quot;cost&quot;: 2.81986,
           &quot;chosen&quot;: true
         }
        ] /* considered_access_paths */
       } /* best_access_path */,
        &quot;condition_filtering_pct&quot;: 100,  //è¡Œè¿‡æ»¤ç™¾åˆ†æ¯”
        &quot;rows_for_plan&quot;: 9,
        &quot;cost_for_plan&quot;: 2.81986,
        &quot;chosen&quot;: true
      }
     ] /* considered_execution_plans */
    },
    {
      &quot;attaching_conditions_to_tables&quot;: {  //å°†æ¡ä»¶é™„åŠ åˆ°è¡¨ä¸Š
       &quot;original_condition&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;,
       &quot;attached_conditions_computation&quot;: [
      ] /* attached_conditions_computation */,
       &quot;attached_conditions_summary&quot;: [  //é™„åŠ æ¡ä»¶æ¦‚è¦
       {
         &quot;table&quot;: &quot;\`student\`&quot;,
         &quot;attached&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;
       }
      ] /* attached_conditions_summary */
     } /* attaching_conditions_to_tables */
    },
    {
      &quot;finalizing_table_conditions&quot;: [
      {
        &quot;table&quot;: &quot;\`student\`&quot;,
        &quot;original_table_condition&quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;,
        &quot;final_table_condition  &quot;: &quot;(\`student\`.\`id\` &lt; 10)&quot;
      }
     ] /* finalizing_table_conditions */
    },
    {
      &quot;refine_plan&quot;: [  //ç²¾ç®€è®¡åˆ’
      {
        &quot;table&quot;: &quot;\`student\`&quot;
      }
     ] /* refine_plan */
    }
   ] /* steps */
  } /* join_optimization */
 },
 {
   &quot;join_execution&quot;: {   //æ‰§è¡Œ
    &quot;select#&quot;: 1,
    &quot;steps&quot;: [
   ] /* steps */
  } /* join_execution */
 }
] /* steps */
}
//ç¬¬3éƒ¨åˆ†ï¼šè·Ÿè¸ªä¿¡æ¯è¿‡é•¿æ—¶ï¼Œè¢«æˆªæ–­çš„è·Ÿè¸ªä¿¡æ¯çš„å­—èŠ‚æ•°ã€‚
MISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0  //ä¸¢å¤±çš„è¶…å‡ºæœ€å¤§å®¹é‡çš„å­—èŠ‚
//ç¬¬4éƒ¨åˆ†ï¼šæ‰§è¡Œè·Ÿè¸ªè¯­å¥çš„ç”¨æˆ·æ˜¯å¦æœ‰æŸ¥çœ‹å¯¹è±¡çš„æƒé™ã€‚å½“ä¸å…·æœ‰æƒé™æ—¶ï¼Œè¯¥åˆ—ä¿¡æ¯ä¸º1ä¸”TRACEå­—æ®µä¸ºç©ºï¼Œä¸€èˆ¬åœ¨
è°ƒç”¨å¸¦æœ‰SQL SECURITY DEFINERçš„è§†å›¾æˆ–è€…æ˜¯å­˜å‚¨è¿‡ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ­¤é—®é¢˜ã€‚
INSUFFICIENT_PRIVILEGES: 0  //ç¼ºå¤±æƒé™
1 row in set (0.00 sec)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-mysqlç›‘æ§åˆ†æè§†å›¾-sys-schema" tabindex="-1"><a class="header-anchor" href="#_9-mysqlç›‘æ§åˆ†æè§†å›¾-sys-schema" aria-hidden="true">#</a> 9. MySQLç›‘æ§åˆ†æè§†å›¾-sys schema</h2><p><img src="`+Qe+`" alt="image-20220814140207739"></p><h3 id="_9-1-sys-schemaè§†å›¾æ‘˜è¦" tabindex="-1"><a class="header-anchor" href="#_9-1-sys-schemaè§†å›¾æ‘˜è¦" aria-hidden="true">#</a> 9.1 Sys schemaè§†å›¾æ‘˜è¦</h3><ol><li>ä¸»æœºç›¸å…³ï¼šä»¥ host_summary å¼€å¤´ï¼Œä¸»è¦æ±‡æ€»äº† IO å»¶è¿Ÿçš„ä¿¡æ¯ã€‚</li><li>Innodb ç›¸å…³ï¼šä»¥ innodb å¼€å¤´ï¼Œæ±‡æ€»äº† innodb buffer ä¿¡æ¯å’Œäº‹åŠ¡ç­‰å¾… innodb é”çš„ä¿¡æ¯ã€‚</li><li>I/Oç›¸å…³ï¼šä»¥ IO å¼€å¤´ï¼Œæ±‡æ€»äº†ç­‰å¾… I/Oã€I/O ä½¿ç”¨é‡æƒ…å†µã€‚</li><li>å†…å­˜ä½¿ç”¨æƒ…å†µï¼šä»¥ memory å¼€å¤´ï¼Œä»ä¸»æœºã€çº¿ç¨‹ã€äº‹ä»¶ç­‰è§’åº¦å±•ç¤ºå†…å­˜çš„ä½¿ç”¨æƒ…å†µ</li><li>è¿æ¥ä¸ä¼šè¯ä¿¡æ¯ï¼šprocesslist å’Œ session ç›¸å…³è§†å›¾ï¼Œæ€»ç»“äº†ä¼šè¯ç›¸å…³ä¿¡æ¯ã€‚</li><li>è¡¨ç›¸å…³ï¼šä»¥ schema_table å¼€å¤´çš„è§†å›¾ï¼Œå±•ç¤ºäº†è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>ç´¢å¼•ä¿¡æ¯ï¼šç»Ÿè®¡äº†ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…å«å†—ä½™ç´¢å¼•å’Œæœªä½¿ç”¨çš„ç´¢å¼•æƒ…å†µã€‚</li><li>è¯­å¥ç›¸å…³ï¼šä»¥ statement å¼€å¤´ï¼ŒåŒ…å«æ‰§è¡Œå…¨è¡¨æ‰«æã€ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ’åºç­‰çš„è¯­å¥ä¿¡æ¯ã€‚</li><li>ç”¨æˆ·ç›¸å…³ï¼šä»¥ user å¼€å¤´çš„è§†å›¾ï¼Œç»Ÿè®¡äº†ç”¨æˆ·ä½¿ç”¨çš„æ–‡ä»¶ I/Oã€æ‰§è¡Œè¯­å¥ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>ç­‰å¾…äº‹ä»¶ç›¸å…³ä¿¡æ¯ï¼šä»¥ wait å¼€å¤´ï¼Œå±•ç¤ºç­‰å¾…äº‹ä»¶çš„å»¶è¿Ÿæƒ…å†µã€‚</li></ol><h3 id="_9-2-sys-schemaè§†å›¾ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_9-2-sys-schemaè§†å›¾ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> 9.2 Sys schemaè§†å›¾ä½¿ç”¨åœºæ™¯</h3><p><strong>1.ç´¢å¼•æƒ…å†µ</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#1. æŸ¥è¯¢å†—ä½™ç´¢å¼•
select * from sys.schema_redundant_indexes;

#2. æŸ¥è¯¢æœªä½¿ç”¨è¿‡çš„ç´¢å¼•
select * from sys.schema_unused_indexes;

#3. æŸ¥è¯¢ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ
select index_name,rows_selected,rows_inserted,rows_updated,rows_deleted
from sys.schema_index_statistics where table_schema=&#39;dbname&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¾ä¾‹ï¼šæ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹ä¸‹æ•°æ®çš„çš„å†—ä½™ç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select * from sys.schema_redundant_indexes;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+Ve+'" alt="image-20220814141233022"></p><p>æˆ‘ä»¬ä»»æ„é€‰æ‹©ä¸€æ¡ï¼Œæ¯”å¦‚æœ€åä¸€æ¡ï¼Œç„¶åæŸ¥çœ‹ä¸‹student_infoçš„ç´¢å¼•æƒ…å†µï¼Œçœ‹çœ‹æ˜¯å¦<code>idx_cre_time</code>å†—ä½™äº†</p><p><img src="'+Be+`" alt="image-20220814141532332"></p><p>å¯ä»¥ çœ‹åˆ° <code>idx_cre_time</code>å’Œ<code>idx_cre_time_sid</code>ä¸¤ä¸ªç´¢å¼•ä¸­éƒ½æœ‰ <code>create_time</code>ã€‚è€Œä¸”è”åˆç´¢å¼•æ€§èƒ½è¦é«˜äºå•åˆ—ç´¢å¼•ï¼Œæ‰€ä»¥<code>idx_cre_time </code>å®Œå…¨å¯ä»¥åˆ æ‰~</p><p><strong>2.è¡¨ç›¸å…³</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code># 1. æŸ¥è¯¢è¡¨çš„è®¿é—®é‡
select table_schema,table_name,sum(io_read_requests+io_write_requests) as io from sys.schema_table_statistics group by table_schema,table_name order by io desc;

# 2. æŸ¥è¯¢å ç”¨bufferpoolè¾ƒå¤šçš„è¡¨
select object_schema,object_name,allocated,data
from sys.innodb_buffer_stats_by_table order by allocated limit 10;

# 3. æŸ¥çœ‹è¡¨çš„å…¨è¡¨æ‰«ææƒ…å†µ
select * from sys.statements_with_full_table_scans where db=&#39;dbname&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼šæŸ¥è¯¢è¡¨çš„è®¿é—®é‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code># 1. æŸ¥è¯¢è¡¨çš„è®¿é—®é‡
select table_schema,table_name,sum(io_read_requests+io_write_requests) as io from sys.schema_table_statistics group by table_schema,table_name order by io desc;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+Ye+`" alt="image-20220814142303829"></p><p><strong>3.è¯­å¥ç›¸å…³</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#1. ç›‘æ§SQLæ‰§è¡Œçš„é¢‘ç‡
select db,exec_count,query from sys.statement_analysis
order by exec_count desc;

#2. ç›‘æ§ä½¿ç”¨äº†æ’åºçš„SQL
select db,exec_count,first_seen,last_seen,query
from sys.statements_with_sorting limit 1;

#3. ç›‘æ§ä½¿ç”¨äº†ä¸´æ—¶è¡¨æˆ–è€…ç£ç›˜ä¸´æ—¶è¡¨çš„SQL
select db,exec_count,tmp_tables,tmp_disk_tables,query
from sys.statement_analysis where tmp_tables&gt;0 or tmp_disk_tables &gt;0
order by (tmp_tables+tmp_disk_tables) desc;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. IOç›¸å…³</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#æŸ¥çœ‹æ¶ˆè€—ç£ç›˜IOçš„æ–‡ä»¶
select file,avg_read,avg_write,avg_read+avg_write as avg_io
from sys.io_global_by_file_by_bytes order by avg_read  limit 10;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5.Innodb ç›¸å…³</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#è¡Œé”é˜»å¡æƒ…å†µ
select * from sys.innodb_lock_waits;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>é£é™©æç¤ºï¼š</strong></p><p>é€šè¿‡sysåº“å»æŸ¥è¯¢æ—¶ï¼ŒMySQLä¼šæ¶ˆè€—å¤§é‡èµ„æºå»æ”¶é›†ç›¸å…³ä¿¡æ¯ï¼Œä¸¥é‡çš„å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡è¯·æ±‚è¢«é˜»å¡ï¼Œä»è€Œå¼•èµ·æ•…éšœã€‚å»ºè®®ç”Ÿäº§ä¸Šä¸è¦é¢‘ç¹çš„å»æŸ¥è¯¢sysæˆ–è€…<code>performance_ schema</code>ã€ <code>information_ schema</code>æ¥å®Œæˆç›‘æ§ã€å·¡æ£€ç­‰å·¥ä½œã€‚</p></blockquote><h2 id="_10-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_10-å°ç»“" aria-hidden="true">#</a> 10. å°ç»“</h2><p>æŸ¥è¯¢æ—¶æ•°æ®åº“ä¸­æœ€é¢‘ç¹çš„æ“ä½œï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦å¯ä»¥æœ‰æ•ˆåœ°æé«˜MySQLæ•°æ®åº“çš„æ€§èƒ½ã€‚é€šè¿‡å¯¹æŸ¥è¯¢è¯­å¥çš„åˆ†æå¯ä»¥äº†è§£æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæƒ…å†µï¼Œæ‰¾å‡ºæŸ¥è¯¢è¯­å¥æ‰§è¡Œçš„ç“¶é¢ˆï¼Œä»è€Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼</p>`,288);function ls(as,rs){const i=c("ExternalLinkIcon");return a(),r("div",null,[Ge,Je,e("p",null,[s("å®˜ç½‘ï¼š "),e("a",Ke,[s("http://www.atguigu.com"),n(i)])]),je,e("blockquote",null,[e("p",null,[s("ğŸ“‘ æ³¨æ„: 1.è¯¥å·¥å…·å¹¶ä¸æ˜¯ MySQL å†…ç½®çš„ï¼Œä¸è¦åœ¨ MySQL ä¸‹æ‰§è¡Œï¼Œå¯ä»¥ç›´æ¥åœ¨æ ¹ç›®å½•æˆ–è€…å…¶ä»–ä½ç½®æ‰§è¡Œ 2.è¯¥å·¥å…·åªæœ‰ Linux ä¸‹æ‰æ˜¯å¼€ç®±å¯ç”¨çš„ï¼Œå®é™…ä¸Šç”Ÿäº§ä¸­mysqlæ•°æ®åº“ä¸€èˆ¬ä¹Ÿæ˜¯éƒ¨ç½²åœ¨linuxç¯å¢ƒä¸­çš„ã€‚å¦‚æœæ‚¨æ˜¯windowsç¯å¢ƒä¸‹ï¼Œå¯ä»¥å‚è€ƒåšå®¢"),e("a",Ze,[s("https://www.cnblogs.com/-mrl/p/15770811.htmlã€‚"),n(i)])])]),$e,e("blockquote",null,[e("p",null,[e("a",es,[s("https://dev.mysql.com/doc/refman/5.7/en/explain-output.html"),n(i)])]),e("p",null,[e("a",ss,[s("https://dev.mysql.com/doc/refman/8.0/en/explain-output.html"),n(i)])])]),is,e("p",null,[s("å®˜æ–¹æ–‡æ¡£ï¼š"),e("a",ns,[s("https://dev.mysql.com/doc/refman/8.0/en/alter-table-partition-operations.html"),n(i)])]),ds])}const os=l(ze,[["render",ls],["__file","ç¬¬ 09 ç« _æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨.html.vue"]]);export{os as default};
