import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as l,c as d,d as e,e as n,b as i,a,r as c}from"./app.9b10ba0a.js";const r="/assets/1604498725652.c9792440.png",p="/assets/1604421296014.085055bc.png",v="/assets/1604421312486.fa54329e.png",u="/assets/1604422564855.f1dc1f9a.png",o="/assets/1604493947499.55f9f9f2.png",m="/assets/1604494128097.31dc2ed1.png",b="/assets/1604494156197.5469a1dd.png",g="data:image/png;base64,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",h="/assets/1604494269848.a107f4fd.png",k="/assets/1604494822961.73fd1f29.png",x="/assets/1604494843886.b93d5eb2.png",A="/assets/1604494860954.22b15dd4.png",_="/assets/1604495169905.0291f6e7.png",f="/assets/1604495824757.f760c050.png",R="/assets/1604495442179.7f17e364.png",P="/assets/1604599529242.3bef2ff2.png",E="/assets/1604599616821.790cd387.png",V="/assets/1604599709822.79a6afa3.png",T="/assets/1604600079149.92d3c4b8.png",I="/assets/1604600145318.8409d644.png",N={},w=a('<h2 id="nginx与tomcat部署" tabindex="-1"><a class="header-anchor" href="#nginx与tomcat部署" aria-hidden="true">#</a> Nginx与Tomcat部署</h2><p>前面课程已经将Nginx的大部分内容进行了讲解，我们都知道了Nginx在高并发场景和处理静态资源是非常高性能的，但是在实际项目中除了静态资源还有就是后台业务代码模块，一般后台业务都会被部署在Tomcat，weblogic或者是websphere等web服务器上。那么如何使用Nginx接收用户的请求并把请求转发到后台web服务器？</p><p><img src="'+r+`" alt="1604498725652"></p><p>步骤分析:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1.准备Tomcat环境，并在Tomcat上部署一个web项目
2.准备Nginx环境，使用Nginx接收请求，并把请求分发到Tomat上
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="环境准备-tomcat" tabindex="-1"><a class="header-anchor" href="#环境准备-tomcat" aria-hidden="true">#</a> 环境准备(Tomcat)</h3><p>浏览器访问:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.200.146:8080/demo/index.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+p+`" alt="1604421296014"></p><p>获取动态资源的链接地址:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.200.146:8080/demo/getAddress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>本次课程将采用Tomcat作为后台web服务器</p><p>（1）在Centos上准备一个Tomcat</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1.Tomcat官网地址:https://tomcat.apache.org/
2.下载tomcat,本次课程使用的是apache-tomcat-8.5.59.tar.gz
3.将tomcat进行解压缩
mkdir web_tomcat
tar -zxf apache-tomcat-8.5.59.tar.gz -C /web_tomcat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）准备一个web项目，将其打包为war</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1.将资料中的demo.war上传到tomcat8目录下的webapps包下
2.将tomcat进行启动，进入tomcat8的bin目录下
./startup.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）启动tomcat进行访问测试。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>静态资源: http://192.168.200.146:8080/demo/index.html
动态资源: http://192.168.200.146:8080/demo/getAddress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="环境准备-nginx" tabindex="-1"><a class="header-anchor" href="#环境准备-nginx" aria-hidden="true">#</a> 环境准备(Nginx)</h3><p>（1）使用Nginx的反向代理，将请求转给Tomcat进行处理。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>upstream webservice {
	server 192.168.200.146:8080;
}
server{
    listen		80;
    server_name localhost;
    location /demo {
    	proxy_pass http://webservice;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）启动访问测试</p><p><img src="`+v+'" alt="1604421312486"></p><p>学习到这，可能大家会有一个困惑，明明直接通过tomcat就能访问，为什么还需要多加一个nginx，这样不是反而是系统的复杂度变高了么? 那接下来我们从两个方便给大家分析下这个问题，</p><p>第一个使用Nginx实现动静分离</p><p>第二个使用Nginx搭建Tomcat的集群</p><h2 id="nginx实现动静分离" tabindex="-1"><a class="header-anchor" href="#nginx实现动静分离" aria-hidden="true">#</a> Nginx实现动静分离</h2><p>什么是动静分离?</p><p>动:后台应用程序的业务处理</p><p>静:网站的静态资源(html,javaScript,css,images等文件)</p><p>分离:将两者进行分开部署访问，提供用户进行访问。举例说明就是以后所有和静态资源相关的内容都交给Nginx来部署访问，非静态内容则交个类似于Tomcat的服务器来部署访问。</p><p>为什么要动静分离?</p><p>​ 前面我们介绍过Nginx在处理静态资源的时候，效率是非常高的，而且Nginx的并发访问量也是名列前茅，而Tomcat则相对比较弱一些，所以把静态资源交个Nginx后，可以减轻Tomcat服务器的访问压力并提高静态资源的访问速度。</p><p>​ 动静分离以后，降低了动态资源和静态资源的耦合度。如动态资源宕机了也不影响静态资源的展示。</p><p>如何实现动静分离?</p><p>实现动静分离的方式很多，比如静态资源可以部署到CDN、Nginx等服务器上，动态资源可以部署到Tomcat,weblogic或者websphere上。本次课程只要使用Nginx+Tomcat来实现动静分离。</p><h3 id="需求分析" tabindex="-1"><a class="header-anchor" href="#需求分析" aria-hidden="true">#</a> 需求分析</h3><p><img src="'+u+`" alt="1604422564855"></p><h3 id="动静分离实现步骤" tabindex="-1"><a class="header-anchor" href="#动静分离实现步骤" aria-hidden="true">#</a> 动静分离实现步骤</h3><p>1.将demo.war项目中的静态资源都删除掉，重新打包生成一个war包，在资料中有提供。</p><p>2.将war包部署到tomcat中，把之前部署的内容删除掉</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>进入到tomcat的webapps目录下，将之前的内容删除掉
将新的war包复制到webapps下
将tomcat启动
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.在Nginx所在服务器创建如下目录，并将对应的静态资源放入指定的位置</p><p><img src="`+o+`" alt="1604493947499"></p><p>其中index.html页面的内容如下:</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;http://192.168.200.133/demo/getAddress&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Nginx如何将请求转发到后端服务器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>images/mv.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.配置Nginx的静态资源与动态资源的访问</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>upstream webservice{
   server 192.168.200.146:8080;
}
server {
        listen       80;
        server_name  localhost;

        #动态资源
        location /demo {
                proxy_pass http://webservice;
        }
        #静态资源
        location ~/.*\\.(png|jpg|gif|js){
                root html/web;
                gzip on;
        }

        location / {
            root   html/web;
            index  index.html index.htm;
        }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,48),z={href:"http://192.168.200.133/index.html",target:"_blank",rel:"noopener noreferrer"},O=a('<p><img src="'+m+'" alt="1604494128097"></p><p>假如某个时间点，由于某个原因导致Tomcat后的服务器宕机了，我们再次访问Nginx,会得到如下效果，用户还是能看到页面，只是缺失了访问次数的统计，这就是前后端耦合度降低的效果，并且整个请求只和后的服务器交互了一次，js和images都直接从Nginx返回，提供了效率，降低了后的服务器的压力。</p><p><img src="'+b+'" alt="1604494156197"></p><h2 id="nginx实现tomcat集群搭建" tabindex="-1"><a class="header-anchor" href="#nginx实现tomcat集群搭建" aria-hidden="true">#</a> Nginx实现Tomcat集群搭建</h2><p>在使用Nginx和Tomcat部署项目的时候，我们使用的是一台Nginx服务器和一台Tomcat服务器，效果图如下:</p><p><img src="'+g+'" alt="1604494256017"></p><p>那么问题来了，如果Tomcat的真的宕机了，整个系统就会不完整，所以如何解决上述问题，一台服务器容易宕机，那就多搭建几台Tomcat服务器，这样的话就提升了后的服务器的可用性。这也就是我们常说的集群，搭建Tomcat的集群需要用到了Nginx的反向代理和赋值均衡的知识，具体如何来实现?我们先来分析下原理</p><p><img src="'+h+'" alt="1604494269848"></p><p>环境准备：</p>',9),M={href:"http://xn--server-2g0js76l.ml",target:"_blank",rel:"noopener noreferrer"},q=a(`<p>(2)启动tomcat并访问测试，</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.200.146:8080/demo/getAddress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+k+`" alt="1604494822961"></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.200.146:8180/demo/getAddress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+x+`" alt="1604494843886"></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.200.146:8280/demo/getAddress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+A+`" alt="1604494860954"></p><p>(3)在Nginx对应的配置文件中添加如下内容:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>upstream webservice{
        server 192.168.200.146:8080;
        server 192.168.200.146:8180;
        server 192.168.200.146:8280;
    }

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>好了，完成了上述环境的部署，我们已经解决了Tomcat的高可用性，一台服务器宕机，还有其他两条对外提供服务，同时也可以实现后台服务器的不间断更新。但是新问题出现了，上述环境中，如果是Nginx宕机了呢，那么整套系统都将服务对外提供服务了，这个如何解决？</p><h2 id="nginx高可用解决方案" tabindex="-1"><a class="header-anchor" href="#nginx高可用解决方案" aria-hidden="true">#</a> Nginx高可用解决方案</h2><p>针对于上面提到的问题，我们来分析下要想解决上述问题，需要面临哪些问题?</p><p><img src="`+_+`" alt="1604495169905"></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>需要两台以上的Nginx服务器对外提供服务，这样的话就可以解决其中一台宕机了，另外一台还能对外提供服务，但是如果是两台Nginx服务器的话，会有两个IP地址，用户该访问哪台服务器，用户怎么知道哪台是好的，哪台是宕机了的?
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="keepalived" tabindex="-1"><a class="header-anchor" href="#keepalived" aria-hidden="true">#</a> Keepalived</h3><p>使用Keepalived来解决，Keepalived 软件由 C 编写的，最初是专为 LVS 负载均衡软件设计的，Keepalived 软件主要是通过 VRRP 协议实现高可用功能。</p><h3 id="vrrp介绍" tabindex="-1"><a class="header-anchor" href="#vrrp介绍" aria-hidden="true">#</a> VRRP介绍</h3><p><img src="`+f+`" alt="1604495824757"></p><p>VRRP（Virtual Route Redundancy Protocol）协议，翻译过来为虚拟路由冗余协议。VRRP协议将两台或多台路由器设备虚拟成一个设备，对外提供虚拟路由器IP,而在路由器组内部，如果实际拥有这个对外IP的路由器如果工作正常的话就是MASTER,MASTER实现针对虚拟路由器IP的各种网络功能。其他设备不拥有该虚拟IP，状态为BACKUP,处了接收MASTER的VRRP状态通告信息以外，不执行对外的网络功能。当主机失效时，BACKUP将接管原先MASTER的网络功能。</p><p>从上面的介绍信息获取到的内容就是VRRP是一种协议，那这个协议是用来干什么的？</p><p>1.选择协议</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>VRRP可以把一个虚拟路由器的责任动态分配到局域网上的 VRRP 路由器中的一台。其中的虚拟路由即Virtual路由是由VRRP路由群组创建的一个不真实存在的路由，这个虚拟路由也是有对应的IP地址。而且VRRP路由1和VRRP路由2之间会有竞争选择，通过选择会产生一个Master路由和一个Backup路由。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2.路由容错协议</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Master路由和Backup路由之间会有一个心跳检测，Master会定时告知Backup自己的状态，如果在指定的时间内，Backup没有接收到这个通知内容，Backup就会替代Master成为新的Master。Master路由有一个特权就是虚拟路由和后端服务器都是通过Master进行数据传递交互的，而备份节点则会直接丢弃这些请求和数据，不做处理，只是去监听Master的状态
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>用了Keepalived后，解决方案如下:</p><p><img src="`+R+`" alt="1604495442179"></p><h3 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h3><p>环境准备</p><table><thead><tr><th>VIP</th><th>IP</th><th>主机名</th><th>主/从</th></tr></thead><tbody><tr><td></td><td>192.168.200.133</td><td>keepalived1</td><td>Master</td></tr><tr><td>192.168.200.222</td><td></td><td></td><td></td></tr><tr><td></td><td>192.168.200.122</td><td>keepalived2</td><td>Backup</td></tr></tbody></table><p>keepalived的安装</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>步骤1:从官方网站下载keepalived,官网地址https://keepalived.org/
步骤2:将下载的资源上传到服务器
	keepalived-2.0.20.tar.gz
步骤3:创建keepalived目录，方便管理资源
	mkdir keepalived
步骤4:将压缩文件进行解压缩，解压缩到指定的目录
	tar -zxf keepalived-2.0.20.tar.gz -C keepalived/
步骤5:对keepalived进行配置，编译和安装
	cd keepalived/keepalived-2.0.20
	./configure --sysconf=/etc --prefix=/usr/local
	make &amp;&amp; make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完成后，有两个文件需要我们认识下，一个是 <code>/etc/keepalived/keepalived.conf</code>(keepalived的系统配置文件，我们主要操作的就是该文件)，一个是/usr/local/sbin目录下的<code>keepalived</code>,是系统配置脚本，用来启动和关闭keepalived</p><h3 id="keepalived配置文件介绍" tabindex="-1"><a class="header-anchor" href="#keepalived配置文件介绍" aria-hidden="true">#</a> Keepalived配置文件介绍</h3><p>打开keepalived.conf配置文件</p><p>这里面会分三部，第一部分是global全局配置、第二部分是vrrp相关配置、第三部分是LVS相关配置。 本次课程主要是使用keepalived实现高可用部署，没有用到LVS，所以我们重点关注的是前两部分</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>global全局部分：
global_defs {
   #通知邮件，当keepalived发送切换时需要发email给具体的邮箱地址
   notification_email {
     tom@itcast.cn
     jerry@itcast.cn
   }
   #设置发件人的邮箱信息
   notification_email_from zhaomin@itcast.cn
   #指定smpt服务地址
   smtp_server 192.168.200.1
   #指定smpt服务连接超时时间
   smtp_connect_timeout 30
   #运行keepalived服务器的一个标识，可以用作发送邮件的主题信息
   router_id LVS_DEVEL
   
   #默认是不跳过检查。检查收到的VRRP通告中的所有地址可能会比较耗时，设置此命令的意思是，如果通告与接收的上一个通告来自相同的master路由器，则不执行检查(跳过检查)
   vrrp_skip_check_adv_addr
   #严格遵守VRRP协议。
   vrrp_strict
   #在一个接口发送的两个免费ARP之间的延迟。可以精确到毫秒级。默认是0
   vrrp_garp_interval 0
   #在一个网卡上每组na消息之间的延迟时间，默认为0
   vrrp_gna_interval 0
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>VRRP部分，该部分可以包含以下四个子模块
1. vrrp_script
2. vrrp_sync_group
3. garp_group
4. vrrp_instance
我们会用到第一个和第四个，
#设置keepalived实例的相关信息，VI_1为VRRP实例名称
vrrp_instance VI_1 {
    state MASTER  		#有两个值可选MASTER主 BACKUP备
    interface ens33		#vrrp实例绑定的接口，用于发送VRRP包[当前服务器使用的网卡名称]
    virtual_router_id 51#指定VRRP实例ID，范围是0-255
    priority 100		#指定优先级，优先级高的将成为MASTER
    advert_int 1		#指定发送VRRP通告的间隔，单位是秒
    authentication {	#vrrp之间通信的认证信息
        auth_type PASS	#指定认证方式。PASS简单密码认证(推荐)
        auth_pass 1111	#指定认证使用的密码，最多8位
    }
    virtual_ipaddress { #虚拟IP地址设置虚拟IP地址，供用户访问使用，可设置多个，一行一个
        192.168.200.222
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置内容如下:</p><p>服务器1</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>global_defs {
   notification_email {
        tom@itcast.cn
        jerry@itcast.cn
   }
   notification_email_from zhaomin@itcast.cn
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id keepalived1
   vrrp_skip_check_adv_addr
   vrrp_strict
   vrrp_garp_interval 0
   vrrp_gna_interval 0
}

vrrp_instance VI_1 {
    state MASTER
    interface ens33
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.200.222
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>服务器2</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>! Configuration File for keepalived

global_defs {
   notification_email {
        tom@itcast.cn
        jerry@itcast.cn
   }
   notification_email_from zhaomin@itcast.cn
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id keepalived2
   vrrp_skip_check_adv_addr
   vrrp_strict
   vrrp_garp_interval 0
   vrrp_gna_interval 0
}

vrrp_instance VI_1 {
    state BACKUP
    interface ens33
    virtual_router_id 51
    priority 90
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.200.222
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问测试" tabindex="-1"><a class="header-anchor" href="#访问测试" aria-hidden="true">#</a> 访问测试</h3><ol><li>启动keepalived之前，咱们先使用命令 <code>ip a</code>,查看192.168.200.133和192.168.200.122这两台服务器的IP情况。</li></ol><p><img src="`+P+`" alt="1604599529242"></p><ol start="2"><li>分别启动两台服务器的keepalived</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cd /usr/local/sbin
./keepalived
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>再次通过 <code>ip a</code>查看ip</p><p><img src="`+E+'" alt="1604599616821"></p><ol start="3"><li>当把192.168.200.133服务器上的keepalived关闭后，再次查看ip</li></ol><p><img src="'+V+`" alt="1604599709822"></p><p>通过上述的测试，我们会发现，虚拟IP(VIP)会在MASTER节点上，当MASTER节点上的keepalived出问题以后，因为BACKUP无法收到MASTER发出的VRRP状态通过信息，就会直接升为MASTER。VIP也会&quot;漂移&quot;到新的MASTER。</p><p>上面测试和Nginx有什么关系?</p><p>我们把192.168.200.133服务器的keepalived再次启动下，由于它的优先级高于服务器192.168.200.122的，所有它会再次成为MASTER，VIP也会&quot;漂移&quot;过去，然后我们再次通过浏览器访问:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.200.222/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+T+'" alt="1604600079149"></p><p>如果把192.168.200.133服务器的keepalived关闭掉，再次访问相同的地址</p><p><img src="'+I+`" alt="1604600145318"></p><p>效果实现了以后， 我们会发现要想让vip进行切换，就必须要把服务器上的keepalived进行关闭，而什么时候关闭keepalived呢?应该是在keepalived所在服务器的nginx出现问题后，把keepalived关闭掉，就可以让VIP执行另外一台服务器，但是现在这所有的操作都是通过手动来完成的，我们如何能让系统自动判断当前服务器的nginx是否正确启动，如果没有，要能让VIP自动进行&quot;漂移&quot;，这个问题该如何解决?</p><h3 id="keepalived之vrrp-script" tabindex="-1"><a class="header-anchor" href="#keepalived之vrrp-script" aria-hidden="true">#</a> keepalived之vrrp_script</h3><p>keepalived只能做到对网络故障和keepalived本身的监控，即当出现网络故障或者keepalived本身出现问题时，进行切换。但是这些还不够，我们还需要监控keepalived所在服务器上的其他业务，比如Nginx,如果Nginx出现异常了，仅仅keepalived保持正常，是无法完成系统的正常工作的，因此需要根据业务进程的运行状态决定是否需要进行主备切换，这个时候，我们可以通过编写脚本对业务进程进行检测监控。</p><p>实现步骤:</p><ol><li>在keepalived配置文件中添加对应的配置像</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>vrrp_script 脚本名称
{
    script &quot;脚本位置&quot;
    interval 3 #执行时间间隔
    weight -20 #动态调整vrrp_instance的优先级
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>编写脚本</li></ol><p>ck_nginx.sh</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#!/bin/bash
num=\`ps -C nginx --no-header | wc -l\`
if [ $num -eq 0 ];then
 /usr/local/nginx/sbin/nginx
 sleep 2
 if [ \`ps -C nginx --no-header | wc -l\` -eq 0 ]; then
  killall keepalived
 fi
fi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Linux ps命令用于显示当前进程 (process) 的状态。</p><p>-C(command) :指定命令的所有进程</p><p>--no-header 排除标题</p><ol start="3"><li>为脚本文件设置权限</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>chmod 755 ck_nginx.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>将脚本添加到</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>vrrp_script ck_nginx {
   script &quot;/etc/keepalived/ck_nginx.sh&quot; #执行脚本的位置
   interval 2		#执行脚本的周期，秒为单位
   weight -20		#权重的计算方式
}
vrrp_instance VI_1 {
    state MASTER
    interface ens33
    virtual_router_id 10
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.200.111
    }
    track_script {
      ck_nginx
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>如果效果没有出来，可以使用 <code>tail -f /var/log/messages</code>查看日志信息，找对应的错误信息。</li><li>测试</li></ol><p>问题思考:</p><p>通常如果master服务死掉后backup会变成master，但是当master服务又好了的时候 master此时会抢占VIP，这样就会发生两次切换对业务繁忙的网站来说是不好的。所以我们要在配置文件加入 nopreempt 非抢占，但是这个参数只能用于state 为backup，故我们在用HA的时候最好master 和backup的state都设置成backup 让其通过priority来竞争。</p>`,77);function C(H,S){const s=c("ExternalLinkIcon");return l(),d("div",null,[w,e("p",null,[n("5.启动测试，访问"),e("a",z,[n("http://192.168.200.133/index.html"),i(s)])]),O,e("p",null,[n("(1)准备3台tomcat,使用端口进行区分[实际环境应该是三台服务器]，"),e("a",M,[n("修改server.ml"),i(s)]),n("，将端口修改分别修改为8080,8180,8280")]),q])}const G=t(N,[["render",C],["__file","十三、Nginx实现服务器端集群搭建.html.vue"]]);export{G as default};
